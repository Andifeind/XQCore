/*!
 * XQCore Minimal - 0.3.15
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2013 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2013-05-07
 */
(function(e,t){"function"==typeof define&&define.amd?define("xqcore",["jquery"],t):e.XQCore=t(e.jQuery)})(this,function(e){var t={version:"0.3.15",defaultRoute:"default",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent"};return window.include||(window.include=function(e,t){var r=location.protocol+"//"+location.host+e;$.ajax({url:r,dataType:"script",success:t,async:!1})},window.preload=function(e){var t,r=location.protocol+"//"+location.host+e;return $.ajax({url:r,dataType:"text",success:function(e){t=e},async:!1}),{execute:function(e){eval.call(e||window,t)}}}),t._dump={},t.dump=function(e){return t._dump[e]?(console.log("[XQCore dump]",e,t._dump[e]),t._dump[e]):!1},t.Event=function(){var e,t=function(){"use strict";function e(){}function t(e,t){if(n)return t.indexOf(e);for(var r=t.length;r--;)if(t[r]===e)return r;return-1}var r=e.prototype,n=Array.prototype.indexOf?!0:!1;return r.getListeners=function(e){var t=this._events||(this._events={});return t[e]||(t[e]=[])},r.addListener=function(e,r){var n=this.getListeners(e);return-1===t(r,n)&&n.push(r),this},r.removeListener=function(e,r){var n=this.getListeners(e),i=t(r,n);return-1!==i&&(n.splice(i,1),0===n.length&&(this._events[e]=null)),this},r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"==typeof t)for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o.call(this,n,i):s.call(this,n,i));else for(n=r.length;n--;)o.call(this,t,r[n]);return this},r.removeEvent=function(e){return e?this._events[e]=null:this._events=null,this},r.emitEvent=function(e,t){for(var r,n=this.getListeners(e),i=n.length;i--;)r=t?n[i].apply(null,t):n[i](),r===!0&&this.removeListener(e,n[i]);return this},e}();return e=function(){this.store=[],this.ee=new t},e.prototype.emit=function(e,t){return this.debug&&console.debug("XQCore - Emit event",e,t),this.ee.emitEvent(e,[t],this)},e.prototype.on=function(e,t){return this.debug&&console.debug("XQCore - Add listener",e,t,this),this.ee.addListener(e,t)},e.prototype.once=function(e,t){var r=function(){return this.ee.removeListener(e,t),t.apply(null,arguments),!0}.bind(this);return this.debug&&console.debug("XQCore - Add once listener",e,t),this.ee.addListener(e,r)},e.prototype.off=function(e,t){return this.debug&&console.debug("XQCore - Remove listener",e,t),void 0===t?this.ee.removeEvent(e):this.ee.removeListener(e,t)},e.prototype.getListeners=function(e){return this.ee.getListeners(e)},e}(),t.Logger=function(){function e(e){return 1e3>e?e+" ms":6e4>e?Math.round(e/100)/10+" sec":Math.round(e/6e4)+" min "+Math.round(e%6e4/1e3)+" sec"}var t=function(){};return t.prototype.log=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.log.apply(console,e))},t.prototype.warn=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.warn.apply(console,e))},t.prototype.error=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.error.apply(console,e))},t.prototype.timer=function(t){var r={start:null,stop:null,name:t,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",e(this.stop-this.start))}};return this.log("Start Timer",t),r.start=Date.now(),r},t.prototype.timerEnd=function(){},t.prototype.__scope={getHumanTime:e},t}(),t.GetSet=function(e,r,n,i){var o=function(e){this.properties={},this._isValid=!1,e&&(this.schema=e.schema,this.debug=Boolean(e.debug)),this.name="GetSet",n.extend(this,new t.Logger),n.extend(this,new t.Event)},s=function(e,t){return e&&(e=e.split("."),e.forEach(function(e){t=t[e]})),t};return o.prototype.set=function(){var e,t,r={},n=this.get();if(null===arguments[0])r=arguments[1],this.log("Set data",r,n);else if("object"==typeof arguments[0])r=arguments[0],this.log("Set data",r,n);else if("string"==typeof arguments[0]){r=this.get(),t=arguments[0];var i=arguments[1];r[t]=i,this.log("Set data",r,n)}else this.warn("Data are incorrect in getset.set()",arguments);return this.schema&&(e=this.validate(r),null!==e)?(this.warn("Validate error in getset.set",e),this.emit("validation.error",e),!1):this.customValidate&&(console.log("Use custom validation",this.customValidate),e=this.customValidate(r),null!==e)?(this.warn("Validate error in getset.set",e),this.emit("validation.error",e),!1):(this.properties=r,this.emit("data.change",r,n),t&&this.emit("change."+t,r[t]),!0)},o.prototype.get=function(e){return e===i?this.properties:this.properties[e]},o.prototype.has=function(e){return!!this.properties[e]},o.prototype.reset=function(){this.log("Reset getset"),this.properties={}},o.prototype.append=function(e,t){1===arguments.length&&(t=e,e=null);var r=this.properties,n=this.get(),i=!0;return e&&e.split(".").forEach(function(e){r=r[e]}),console.log(r===this.properties),r instanceof Array?r.push(t):null===e?(this.properties=[t],r=this.get()):this.warn("GetSet.append requires an array. Dataset isn't an array",e),i&&this.emit("data.change",r,n),console.log(r,this.properties),t},o.prototype.prepend=function(e,t){1===arguments.length&&(t=e,e=null);var r=this.properties,n=this.get(),i=!0;return e&&e.split(".").forEach(function(e){r=r[e]}),r instanceof Array?r.unshift(t):null===e?(this.properties=[t],r=this.get()):this.warn("GetSet.append requires an array. Dataset isn't an array",e),i&&this.emit("data.change",r,n),t},o.prototype.remove=function(e,t){var r=this.properties,n=null;return e.split(".").forEach(function(e){r=r[e]}),r instanceof Array?(n=r.splice(t,1),n=n[0]||null):this.warn("getset.remove() doesn't work with Objects in getset",this.name),n},o.prototype.search=function(e,t){var r=s(e,this.properties);if(r)for(var n=0;r.length>n;n++){var i,o=r[n];for(var a in t)if(t.hasOwnProperty(a)){if(!o[a]||o[a]!==t[a]){i=!1;break}i=!0}if(i===!0)return o}return null},o.prototype.sortBy=function(e,t){1===arguments.length&&(t=e,e=null);var r,n=s(e,this.properties);return n.sort(function(e,n){r=-1;for(var i in t)if(r=(s(i,e)+"").localeCompare(s(i,n)+""),0!==r){-1===t[i]&&(r=r>0?-1:1);break}return r}),this.set(e,n),n},o.prototype.validate=function(e){var t=[];return this.schema&&Object.keys(this.schema).forEach(function(r){var n=this.validateOne(r,e[r]);n.isValid===!0?e[r]=n.value:t.push(n.error)}.bind(this)),0===t.length?(this._isValid=!0,null):(this._isValid=!1,t)},o.prototype.validateOne=function(e,t){var r=null,n=this.schema[e];if(console.log("Schema",n,n.match),""===t&&n.noEmpty===!0&&(t=i),t!==i&&null!==t||!n.default||(t=n.default),t!==i&&null!==t&&""!==t||n.required!==!0)if("string"===n.type)n.convert&&"number"==typeof t&&(t+=""),n.type!==typeof t?r={property:e,msg:"Property type is a "+typeof t+", but a string is required",errCode:11}:n.min&&n.min>t.length?r={property:e,msg:"String length is too short",errCode:12}:n.max&&n.max<t.length?r={property:e,msg:"String length is too long",errCode:13}:n.match&&!n.match.test(t)&&(r={property:e,msg:"String doesn't match regexp",errCode:14});else if("number"===n.type)n.convert&&"string"==typeof t&&(t=parseInt(t,10)),n.type!==typeof t?r={property:e,msg:"Property type is a "+typeof t+", but a number is required",errCode:21}:n.min&&n.min>t?r={property:e,msg:"Number is too low",errCode:22}:n.max&&t>n.max&&(r={property:e,msg:"Number is too high",errCode:23});else if("date"===n.type){if(t){var o=Date.parse(t);isNaN(o)&&(r={property:e,msg:"Property isn't a valid date",errCode:31})}}else"array"===n.type?Array.isArray(t)?n.min&&n.min>t.length?r={property:e,msg:"Array length is "+t.length+" but must be greater than "+n.min,errCode:42}:n.max&&n.max<t.length&&(r={property:e,msg:"Array length is "+t.length+" but must be lesser than "+n.max,errCode:43}):r={property:e,msg:"Property type is a "+typeof t+", but an array is required",errCode:41}:"object"===n.type?"object"!=typeof t&&(r={property:e,msg:"Property isn't a valid object",errCode:51}):"boolean"===n.type&&"object"!=typeof t&&(r={property:e,msg:"Property isn't a valid boolean",errCode:61});else r={property:e,msg:"Property is undefined or null, but it's required",errCode:10};return null===r?r={isValid:!0,value:t,error:null}:(this.warn("Validation error on property",e,r,"Data:",t),r={isValid:!1,value:t,error:r}),r},o.prototype.isValid=function(){return this._isValid},o}(window,document,e),t});