/*!
 * XQCore - +0.11.1-241
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2015 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2015-10-22
 * 
 */
var XQCore;(function(e,t){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery")):e.XQCore=t(e.jQuery)})(this,function(e){"use strict";return XQCore={version:"0.11.1-241",defaultRoute:"/",html5Routes:!1,basePath:"",hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire",socketPort:9889,eventListenerMaxLength:1328},XQCore.extend=e.extend,XQCore.isEmptyObject=e.isEmptyObject,XQCore.isPlainObject=e.isPlainObject,XQCore.isFunction=e.isFunction,XQCore.__moduleCache={},XQCore.isObjectId=function(e){return this.objectIdPattern.test(e)},XQCore.modules={jquery:{cjs:"jquery",amd:"jquery",win:"jQuery"},firetpl:{cjs:"firetpl",amd:"firetpl",win:"fireTpl"},sockjs:{cjs:"xqcore/lib/sockjs.js",amd:"xqcore/lib/sockjs.js",win:"SockJS"}},XQCore.require=function(e){if(XQCore.__moduleCache[e])return XQCore.__moduleCache[e];var t="win";"undefined"!=typeof module&&module.exports&&"function"==typeof require?t="cjs":"function"==typeof define&&define.amd&&(t="amd"),XQCore.modules[e][t]&&(e=XQCore.modules[e][t]);try{if("cjs"===t||"amd"===t)try{return require(e)}catch(n){console.warn("Module not registered as a "+("cjs"===t?"CommonJS":"AMD")+" module! Try to load from window object",e)}return window[e]}catch(n){console.error("Could not load module!",e,n)}},XQCore.setLocale=function(e){localStorage.setItem("xqcore.locale",e)},XQCore.getLocale=function(){var e=localStorage.getItem("xqcore.locale");return e?e:navigator.language},XQCore.logLevel=1,XQCore}),function(e,t){"use strict";e.undotify=function(e,n){return e&&(e=e.split("."),e.forEach(function(e){n=n?n[e]:t})),n},e.dedotify=function(e,n,o){"string"==typeof e&&(o=n,n=e,e={});var i=e;if(n){n=n.split(".");var r=n.length;n.forEach(function(n,i){return i===r-1?/\[\]$/.test(n)?(n=n.substr(0,n.length-2),e[n]||(e[n]=[]),e[n].push(o),t):(e[n]=o,t):(e[n]||(e[n]={}),e=e[n],t)})}return e=o,i},e.uid=function(e){e=e||7;for(var t="";e>t.length;){var n=Math.random().toString(36).substr(2);t+=n}return t.substr(0,e)}}(XQCore),function(e){"use strict";e.getQuery=function(t){return e.__query||(e.__query={},location.search.substr(1).split("&").forEach(function(t){if(t=t.split("="),t&&t[0]){var n=encodeURI(t[1]);e.__query[t[0]]=isNaN(n)?n:Number(n)}})),t?e.__query[t]:e.__query}}(XQCore),function(e){"use strict";var t=function(t){this.loggerName=t,this.logLevel=e.logLevel};t.prototype.log=function(){var e;this.logLevel>=3&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.log.apply(console,e))},t.prototype.warn=function(){var e;this.logLevel>=2&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.warn.apply(console,e))},t.prototype.error=function(){var e;this.logLevel>=1&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.error.apply(console,e))},t.prototype.debug=function(){var e;this.logLevel>=4&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.debug.apply(console,e))},t.prototype.info=t.prototype.log,t.prototype.timer=function(e){var t=this,n={start:null,stop:null,name:e,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+e+" finished after "+t.getHumanTime(this.stop-this.start))}};return this.log("Start Timer "+e),n.start=Date.now(),n},t.prototype.dev=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.debug.apply(console,e))},t.prototype.req=t.prototype.log,t.prototype.res=t.prototype.log,t.prototype.getHumanTime=function(e){return 1e3>e?e+"ms":6e4>e?Math.round(e/100)/10+"sec":Math.round(e/6e4)+"min "+Math.round(e%6e4/1e3)+"sec"},e.Logger=t}(XQCore),function(e){"use strict";var t=new e.Logger("Event"),n=function(e,t,n){this.fn=n,this.calls=0,this.once=!1,this.remove=function(){e.off(t,n)}},o=function(){this.__events={},this.__logger=t,this.maxLength=e.eventListenerMaxLength};o.prototype.on=function(e,o){var i=new n(this,e,o);return this.__events[e]||(this.__events[e]=[]),this.__events[e].push(i),this.__events[e].length>this.maxLength?t.warn("Listener max length was exceeded!","List:",e,"Length:",this.__events[e].length):t.info("Register new `"+e+"` event"),i},o.prototype.once=function(){var e=Array.prototype.slice.call(arguments),t=this.on.apply(this,e);return t.once=!0,t},o.prototype.emit=function(e,n){if(!this.__events[e])return t.info("Emit `"+e+"` event failed! No listener of this type are registered"),0;for(var o=Array.prototype.slice.call(arguments,1),i=this.__events[e].length,r=i-1;r>=0;r--){var s=this.__events[e][r];s.fn.apply(this,o),s.calls++,s.once===!0&&this.__events[e].splice(r,1)}return i&&(t.info("Emit `"+e+"` event to",i,"listener"),t.debug(" ... emit data:",n)),i},o.prototype.off=function(e,n){var o=0;if(!this.__events[e])return t.info("Unregister events failed! No `"+e+"` events were found!"),0;if(n)for(var i=this.__events[e].length,r=0;i>r;r++){var s=this.__events[e][r];s&&s.fn===n&&(this.__events[e].splice(r,1),o++,0===this.__events[e].length&&delete this.__events[e])}else o=this.__events[e].length,delete this.__events[e];return t.info("Unregister `"+e+"` events!","Removed "+o+" listener"),o},o.prototype.clearEvents=function(){this.__events={}},e.Event=o}(XQCore),function(e){var t=function(){this.__isReady=!1,this.__readyFuncs=[]};t.prototype.ready=function(e){this.__isReady?e.call(this):this.__readyFuncs.push(e)},t.prototype.setReady=function(){var e=this;this.__isReady=!0,this.__readyFuncs&&(this.__readyFuncs.forEach(function(t){t.call(e)}),this.__readyFuncs=[])},t.prototype.unsetReady=function(){this.__isReady=!1},e.ReadyState=t}(XQCore),function(e){"use strict";var t,n=e.require("jquery"),o=function(o,i){var r=this;"function"==typeof arguments[0]&&(i=o,o=null),this.name=o||"Nameless",this.router=e.Router.getInstance(),t=new e.Logger(this.name+"Presenter"),this.__views={},"function"==typeof i&&i.call(this,r,t),n(function(){r.router.callRoute(r.router.getPath())})};e.extend(o.prototype,new e.Event),o.prototype.init=function(){},o.prototype.pushState=function(n,o){var i=e.html5Routes||"/"===n.charAt(0)?"":e.hashBang;n=i+n,history.pushState(o,"",n||null),t.info("Update history with pushState. New URL: "+o,n)},o.prototype.replaceState=function(n,o){var i=e.html5Routes||"/"===n.charAt(0)?"":e.hashBang;n=i+n,history.replaceState(o,"",n||null),t.info("Update history with replaceState. New URL: "+o,n)},o.prototype.navigateTo=function(t,n){n=n||{},e.html5Routes?this.router.callRoute(t,n):(location.hash=e.hashBang+t,this.router.callRoute(t,n))},o.prototype.navigateBack=function(){history.back()},o.prototype.getView=function(e){return this.__views[e]||null},o.prototype.getHash=function(){return location.hash},o.prototype.getPathname=function(){return location.pathname},o.prototype.couple=function(t,n,o){o=o||{},n instanceof e.List?this.coupleList(t,n,o):this.coupleModel(t,n,o),this.coupleView(t,n,o)},o.prototype.coupleModel=function(n,o,i){if(i=i||{},!(n instanceof e.View))return t.error("Could not couple model with view. First arg is not a valid view!");if(!(o instanceof e.Model))return t.error("Could not couple model with view. Second arg is not a valid model!");t.info("Couple model",o.name,"with",n.name),o.__coupled&&o.__coupled.uncouple(),o.__coupled={obj:n,events:[],uncouple:function(){t.info("Uncouple model",o.name,"from",n.name),o.__coupled.events.forEach(function(e){e.remove()}),delete o.__coupled}};var r={"data.replace":"xrender","data.set":"xrender","value.set":"xrender","item.insert":"xrender","item.remove":"remove","validation.error":"validationFailed","state.change":"onStateChange"},s=function(e,t){var i=n[t];"xrender"===t&&(i=function(){n.render(o.get())});var r=o.on(e,i);o.__coupled.events.push(r)};for(var a in r)r.hasOwnProperty(a)&&s(a,r[a]);n.render(o.get()),console.log("VIEW",n),console.log("MODEL",o)},o.prototype.coupleList=function(n,o){if(!(n instanceof e.View))return t.error("Could not couple list with view. First arg is not a valid view!");if(!(o instanceof e.List))return t.error("Could not couple list with view. Second arg is not a valid list!");t.info("Couple list",o.name,"with",n.name),o.__coupled&&o.__coupled.uncouple(),o.__coupled={obj:n,events:[],uncouple:function(){t.info("Uncouple list",o.name,"from",n.name),o.__coupled.events.forEach(function(e){e.remove()}),delete o.__coupled}};var i={"item.push":"xrender","item.unshift":"xrender","item.pop":"xrender","item.shift":"xrender","item.update":"xrender","state.change":"onStateChange"},r=function(e,t){var i=n[t];"xrender"===t&&(i=function(){n.render(o.get())});var r=o.on(e,i);o.__coupled.events.push(r)};for(var s in i)i.hasOwnProperty(s)&&r(s,i[s]);n.render(o.toArray()),console.log("VIEW",n),console.log("LIST",o)},o.prototype.coupleView=function(n,o){if(!(n instanceof e.View))return t.error("Could not couple list with view. First arg is not a valid view!");if(!(o instanceof e.Model||o instanceof e.List))return t.error("Could not couple list with view. Second arg is not a valid model or list!");t.info("Couple view",n.name,"with",o.name),n.__coupled&&n.__coupled.uncouple(),n.__coupled={obj:o,events:[],uncouple:function(){t.info("Uncouple view",n.name,"from",o.name),n.__coupled.events.forEach(function(e){e.remove()}),delete n.__coupled}};var i={"form.submit":"submit"},r=function(e,t){var o=n[t],i=n.on(e,o);n.__coupled.events.push(i)};for(var s in i)i.hasOwnProperty(s)&&r(s,i[s]);console.log("VIEW",n),console.log("MODE or LIST",o)},o.prototype.initView=function(t,n,o){o=o||{};var i={};o.viewDir&&(i.viewDir=o.viewDir);var r=new e.View(t,function(r){r.template=e.Tmpl.getTemplate(t,i),r.mode=o.mode||"replace",r.container=n||"body",r.hidden=!!o.hidden,r.forms=o.forms,o.inject===!1&&(r.autoInject=!1)});this.__views[t]=r;var s=this;return e.html5Routes&&r.on("xqcore.navigate",function(e){s.router.callRoute(e)}),r},o.prototype.route=function(e,n){var o=this;return"string"==typeof n&&(n=this[n]),"function"==typeof n?"string"==typeof e?this.router.addRoute(e,n):Array.isArray(e)&&e.forEach(function(e){o.router.addRoute(e,n)}):t.warn("Router callback isn't a function",n,"of route",e),this},e.Presenter=o}(XQCore),function(e,t){"use strict";var n=e.require("jquery"),o=function(){this.server=null};o.prototype.onSend=function(e){return e},o.prototype.send=function(e,o,i,r){var s=this;"object"==typeof o?(r=i,i=o,o=this.server,e=e):"function"==typeof i?(r=i,i=this.get()):i===t&&(i=this.get()),e===t&&(e="POST"),o||(o=this.server),"GET"===e&&Array.isArray(i)&&(o=o.replace(/\/$/,"")+"/"+i.join("/"),i=null),"function"==typeof this.onSend&&(i=this.onSend.call(this,i)),this.log("Send an ajax call to ",o,"with data: ",i),this.state("syncing"),n.ajax({url:o,type:e,data:i,dataType:"json",success:function(e,t,n){"function"==typeof r&&r.call(s,null,e,t,n),s.state("success")},error:function(e,t,n){"function"==typeof r&&r.call(s,{type:t,http:n},null,t,e),s.state("failed")}})},o.prototype.sendPOST=function(e,t,n){this.send("POST",e,t,n)},o.prototype.sendGET=function(e,t,n){this.send("GET",e,t,n)},o.prototype.sendPUT=function(e,t,n){this.send("PUT",e,t,n)},o.prototype.sendDELETE=function(e,t,n){this.send("DELETE",e,t,n)},o.prototype.fetch=function(e,t){this.sendGET(e,t)},o.prototype.save=function(e,t){"function"==typeof e&&(t=e,e=this.schema?this.getByKeys(Object.keys(this.schema)):this.get()),this.isValid()?this.sendPOST(e,t):"function"==typeof t&&t({msg:"Model isn't valid. Cancle save"})},o.prototype.update=function(e,t){"function"==typeof e&&(t=e,e=this.schema?this.getByKeys(Object.keys(this.schema)):this.get()),this.isValid()?this.sendPUT(e,t):"function"==typeof t&&t({msg:"Model isn't valid. Cancel update"})},o.prototype.submit=function(e){if(this.set(e,{extend:!0})){if(e.id===t||null===e.id)return this.save(e),t;this.update(e)}},e.Sync=o}(XQCore),function(XQCore,undefined){"use strict";var Model;Model=function(e,t){XQCore.ReadyState.call(this),XQCore.Event.call(this),"object"==typeof arguments[0]&&(t=e,e=t.name),this.debug=XQCore.debug,this.properties={},t===undefined&&(t={}),"function"==typeof t?t.call(this,this):XQCore.extend(this,t),this.__state="starting",this.__unfiltered={},this.customValidate=t.validate,delete t.validate,this.conf=t,this.name=(e?e.replace(/Model$/,""):"Nameless")+"Model",this._isValid=!1,this.defaults&&!XQCore.isEmptyObject(this.defaults)&&this.set(this.defaults,{silent:!0,noValidation:!0}),this._isValid=!this.schema,this.state("ready")},XQCore.extend(Model.prototype,XQCore.ReadyState.prototype),XQCore.extend(Model.prototype,XQCore.Event.prototype),XQCore.extend(Model.prototype,new XQCore.Logger),XQCore.Sync&&XQCore.extend(Model.prototype,XQCore.Sync.prototype),Model.inherit=function(e,t){"object"==typeof e&&(t=e,e=undefined);var n=function(n,o){XQCore.Model.call(this,e,t),n&&("string"==typeof n?e=n:o=n,"function"==typeof o?o.call(this,this):"object"==typeof o&&XQCore.extend(this,o))};return n.prototype=Object.create(XQCore.Model.prototype),n.prototype.constructor=n,n},Model.prototype.init=function(){console.warn("Model.init is deprecated since v0.10.0")},Model.prototype.state=function(e){this.__state=e,this.emit("state."+e),this.emit("state.change",e)},Model.prototype.getState=function(){return this.__state},Model.prototype.set=function(e,t,n){var o,i={},r=this.get(),s=!1,a=!1;if(n=n||{},null===arguments[0])i=arguments[1],a=!0,this.log("Set data",i,r);else if("object"==typeof arguments[0])n=t||{},i=n.replace?arguments[0]:XQCore.extend(i,r,arguments[0]),a=!0,e=null,this.log("Set data",i,r);else if("string"==typeof arguments[0]){if(i=XQCore.extend({},this.get()),s=!0,XQCore.dedotify(i,e,t),this.log("Set data",i,r),n=n||{},!this.customValidate&&n.validateOne&&(n.noValidation=!0,o=this.validateOne(this.schema[e],t),o.isValid===!1))return o.error=o.error||{},o.error.property=e,this.warn("Validation error in model.set of property",e,o),n.silent!==!0&&this.emit("validation.error",o,i),!1}else this.warn("Data are incorrect in model.set()",arguments);return n=n||{},!this.customValidate&&this.schema&&n.noValidation!==!0&&(o=this.validate(i),null!==o)?(this.warn("Validate error in model.set",o),n.silent!==!0&&this.emit("validation.error",o,i),!1):this.customValidate&&n.noValidation!==!0&&(o=this.customValidate(i),this.log("Using a custom validation which returns:",o),null!==o)?(this.warn("Validate error in model.set",o),this.emit("validation.error",o,i),!1):(this.properties=i,n.silent!==!0&&(a?n.noSync||"function"!=typeof this.sync?this.emit(n.replace?"data.replace":"data.set",i,r):this.sync(n.replace?"replace":"set",i):s&&(n.noSync||"function"!=typeof this.sync||this.sync("value",e,t),this.emit("value.set",e,t)),this.emit("data.change",i,r)),!0)},Model.prototype.get=function(key,options){options===undefined&&(options={});var data;if("object"==typeof key&&1===arguments.length&&(options=key,key=null),key===undefined||null===key){if(options.copy===!0)switch(data=this.properties,typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+(""+data)+")");default:return data}return this.properties}if("string"==typeof key&&"number"==typeof options){var index=options;3===arguments.length&&(options=arguments[2]);var item=this.get(key);return options.copy===!0&&"object"==typeof item[index]?XQCore.extend({},item[index]):item?item[index]:null}if(options.copy===!0)switch(data=XQCore.undotify(key,this.properties),typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+(""+data)+")");default:return data}return XQCore.undotify(key,this.properties)},Model.prototype.getByKeys=function(e,t){if("object"!=typeof e)throw Error("First param must be an object or array in Model.getByKeys()!");var n={};if(t=t||this.get(),Array.isArray(e))e.forEach(function(e){-1===e.indexOf(".")?n[e]=t[e]:n=XQCore.dedotify(n,e,XQCore.undotify(e,t))});else for(var o in e)if(e.hasOwnProperty(o)){var i=t[o];n[o]="object"==typeof i?this.getByKeys(e[o],t[o]):t[o]}return n},Model.prototype.has=function(e){var t=!0,n=this.properties;e=e.split(".");for(var o=0,i=e.length;i>o;o++){if("object"!=typeof n||!n.hasOwnProperty(e[o])){t=!1;break}n=n[e[o]]}return t},Model.prototype.reset=function(e){e=e||{},this.log("Reset model");var t=this.get();return this.properties=XQCore.extend({},this.defaults),this.state("starting"),e.silent||this.emit("data.reset",t),e.removeListener&&this.clearEvents(),e.noSync||"function"==typeof this.sync&&this.sync("reset",t),t},Model.prototype.push=function(e,t,n){var o=XQCore.undotify(e,this.properties);if(n=n||{},o instanceof Array)o.push(t);else if(o===undefined)XQCore.dedotify(this.properties,e,[t]);else{if("object"!=typeof o||e||!XQCore.isEmptyObject(this.properties))return this.error("Model.push requires an array. Dataset isn't an array. Path: ",e),undefined;this.properties=[t]}n.silent!==!0&&(n.noSync||"function"!=typeof this.sync||this.sync("insert",e,-1,t),this.emit("item.insert",e,-1,t),this.emit("data.change",this.properties))},Model.prototype.unshift=function(e,t,n){var o=XQCore.undotify(e,this.properties);if(n=n||{},o instanceof Array)o.unshift(t);else if(o===undefined)XQCore.dedotify(this.properties,e,[t]);else{if("object"!=typeof o||e||!XQCore.isEmptyObject(this.properties))return this.error("Model.unshift requires an array. Dataset isn't an array. Path: ",e),undefined;this.properties=[t]}n.silent!==!0&&(n.noSync||"function"!=typeof this.sync||this.sync("insert",e,0,t),this.emit("item.insert",e,0,t),this.emit("data.change",this.properties))},Model.prototype.insert=function(e,t,n,o){var i=XQCore.undotify(e,this.properties);if(o=o||{},i instanceof Array)-1===t?i.push(n):0===t?i.unshift(n):i.splice(t,0,n);else{if(i)return this.error("Model.insert requires an array. Dataset isn't an array. Path: ",e),undefined;XQCore.dedotify(this.properties,e,[n])}o.silent!==!0&&(o.noSync||"function"!=typeof this.sync||this.sync("insert",e,t,n),this.emit("item.insert",e,t,n),this.emit("data.change",this.properties))},Model.prototype.remove=function(e,t,n){var o=XQCore.undotify(e,this.properties),i=null;if(n=n||{},o instanceof Array)i=o.splice(t,1);else if("object"==typeof o)return this.error("Model.remove requires an array. Dataset isn't an array. Path: ",e),undefined;return i&&n.silent!==!0&&(n.noSync||"function"!=typeof this.sync||this.sync("remove",e,t),this.emit("item.remove",e,t,i[0]),this.emit("data.change",this.properties)),i},Model.prototype.replace=function(e,t){return t=t||{},t.replace=!0,this.set(e,t)},Model.prototype.search=function(e,t){var n;if(1===arguments.length?(t=e,e="",n=this.properties):n=e?XQCore.undotify(e,this.properties):this.properties,n)for(var o=0;n.length>o;o++){var i,r=n[o];for(var s in t)if(t.hasOwnProperty(s)){if(r[s]&&r[s]===t[s]){i=!0;break}i=!1}if(i===!0)return r}return null},Model.prototype.update=function(e,t,n,o){var i;o=o||{},i="number"==typeof t?this.get(e,t):this.search(e,t);var r=XQCore.extend({},i);i&&(XQCore.extend(i,n),o.silent!==!0&&(this.emit("data.update",e,t,n,r),this.emit("data.change",this.properties)),o.noSync||"function"!=typeof this.sync||this.sync("update",e,t,n))},Model.prototype.sortBy=function(e,t){1===arguments.length&&(t=e,e=null);var n,o=XQCore.undotify(e,this.properties);return Array.isArray(o)?(o.sort(function(e,o){n=-1;for(var i in t)if(t.hasOwnProperty(i)){if(n=(XQCore.undotify(i,e)+"").localeCompare(XQCore.undotify(i,o)+""),0===n)continue;-1===t[i]&&(n=n>0?-1:1);break}return n}),this.set(e,o),o):(this.warn("Could not sort data of type",typeof o),[])},Model.prototype.filter=function(e,t,n,o){if(1===arguments.length&&(o=e,e=null),"string"==typeof o){if(!this.__registeredFilter[o])throw Error("Filter "+o+" not registered!");o=this.__registeredFilter[o]}for(var i=XQCore.undotify(e,this.__unfiltered.data||this.properties),r=[],s=0,a=i.length;a>s;s++)o(t,n,i[s])&&r.push(i[s]);return this.__unfiltered={path:e,data:i},this.set(e,r),r},Model.prototype.filterReset=function(e){this.__unfiltered&&this.set(this.__unfiltered.path,this.__unfiltered.data,e)},Model.prototype.validate=function(e,t){var n=this,o=[];return t=t||this.schema,t&&Object.keys(t).forEach(function(i){if("object"==typeof e[i]&&t[i].type===undefined){var r=n.validate(XQCore.extend({},e[i]),XQCore.extend({},t[i]));return Array.isArray(r)&&r.length>0&&(o=o.concat(r)),undefined}var s=n.validateOne(t[i],e[i]);s.isValid===!0?e[i]=s.value:(s.error.property=i,o.push(s.error))}),0===o.length?(this._isValid=!0,this.state("valid"),null):(this._isValid=!1,this.state("invalid"),o)},Model.prototype.validateOne=function(e,t){var n,o="function"==typeof e.type?typeof e.type():e.type.toLowerCase();if(""===t&&e.noEmpty===!0&&(t=undefined),t!==undefined&&null!==t&&""!==t||!e["default"]||(t=e["default"]),t===undefined||null===t||""===t)e.required===!0&&(n={msg:"Property is undefined or null, but it's required",errCode:10});else{if(!this.__registeredValidations[o])throw Error("Undefined schema type",e);n=this.__registeredValidations[o].call(this,t,e)}return n=n===undefined?{isValid:!0,value:t,error:null}:{isValid:!1,value:t,error:n}},Model.prototype.isValid=function(){return this._isValid},Model.prototype.setData=function(e){this.warn("Model.setData has been deprecated since v0.9"),this.set(e,{extend:!0})},Model.registerFilter=function(e,t){if("function"!=typeof t)throw Error("Filter function isn't a function");var n="function"==typeof this?Model.prototype:this;n.__registeredFilter[e]=t},Model.prototype.registerFilter=Model.registerFilter,Model.prototype.__registeredFilter={quicksearch:function(e,t,n){var o=XQCore.undotify(e,n),i=RegExp(t.replace(/[a-z0-9äüöß]/g,"$&.*"),"i");return i.test(o)}},Model.registerValidation=function(e,t){var n="function"==typeof this?Model.prototype:this;n.__registeredValidations[e]=t},Model.prototype.registerValidation=Model.registerValidation,Model.prototype.__registeredValidations={string:function(e,t){return t.convert&&"number"==typeof e&&(e+=""),"string"!=typeof e?{msg:"Property type is a "+typeof e+", but a string is required",errCode:11}:t.min&&t.min>e.length?{msg:"String length is too short",errCode:12}:t.max&&t.max<e.length?{msg:"String length is too long",errCode:13}:t.match&&!t.match.test(e)?{msg:"String doesn't match regexp",errCode:14}:undefined},number:function(e,t){return t.convert&&"string"==typeof e&&(e=parseInt(e,10)),"number"!=typeof e||isNaN(e)?{msg:"Property type is not a valid number",errCode:21}:t.min&&t.min>e?{msg:"Number is too low",errCode:22}:t.max&&e>t.max?{msg:"Number is too high",errCode:23}:undefined},date:function(e){if(e){var t=Date.parse(e);if(isNaN(t))return{msg:"Property isn't a valid date",errCode:31}}},array:function(e,t){return Array.isArray(e)?t.min&&t.min>e.length?{msg:"Array length is "+e.length+" but must be greater than "+t.min,errCode:42}:t.max&&t.max<e.length?{msg:"Array length is "+e.length+" but must be lesser than "+t.max,errCode:43}:undefined:{msg:"Property type is a "+typeof e+", but an array is required",errCode:41}},object:function(e){return"object"!=typeof e?{msg:"Property isn't a valid object",errCode:51}:undefined},objectid:function(e){return/^[a-zA-Z0-9]{24}$/.test(e)?undefined:{msg:"Property isn't a valid objectId",errCode:52}},"boolean":function(e){return"boolean"!=typeof e?{msg:"Property isn't a valid boolean",errCode:61}:undefined},time:function(e){return/^\d+(:\d{2}){1,3}$/.test(e)?undefined:{msg:"Property isn't a valid time",errCode:61}}},XQCore.Model=Model}(XQCore),function(e,t){"use strict";if("function"==typeof define&&define.amd)define("xqcore",[XQCore.templateEngine],t);else if("undefined"!=typeof module&&module.exports)module.exports=t(require(XQCore.templateEngine));else{var n="firetpl"===XQCore.templateEngine?"FireTPL":"Handlebars";e.XQCore=t(e[n])}}(this,function(e){"use strict";return XQCore.Tmpl={type:XQCore.templateEngine,compile:e.compile,getTemplate:function(t,n){if(n=n||{},"firetpl"===XQCore.templateEngine){var o=e;if(o.templateCache&&o.templateCache[t])return o.templateCache[t];if(o.loadFile){var i=n.viewDir||XQCore.viewsDir,r=o.readFile(i.replace(/\/$/,"")+"/"+t+"."+XQCore.viewExt.replace(/^\./,""));return o.compile(r,{eventAttrs:!0})}throw Error("FireTPL runtime is being used. Please preload the "+t+"View")}}},XQCore}),function(e,t){"use strict";var n,o=e.require("jquery"),i=function(i,r){e.Event.call(this),"object"==typeof arguments[0]||"function"==typeof arguments[0]?(r=i,i=null):"string"==typeof arguments[0]&&(this.name=i),n=new e.Logger(this.name+"View"),this.container="body",this.tag=t,this.className=t,this.id=t,this.mode="replace",this.autoInject=!0,this.__domReady=!1,this.__viewEvents=[];var s=this;"function"==typeof r?r.call(this,s):e.extend(this,r),this.name=(this.name?this.name.replace(/View$/,""):"Nameless")+"View",this.__createView(),o(function(){s.container.length>0?(window.addEventListener("resize",function(e){s.resize(e)},!1),n.info("Initialize view "+this.name," with conf:",r),n.info(" ... using Container:",s.container)):n.error("Can't initialize View, Container not found!",s.container)})};e.extend(i.prototype,e.Event.prototype),i.prototype.show=function(e){var t=this;return e&&t.$ct.children(".xq-view").each(function(){if(this!==t.el){var e=o(this).data("view");e.hide()}}),this.$el.show().removeClass("xq-hidden"),this.emit("view.show"),this},i.prototype.hide=function(){return this.$el.hide().addClass("xq-hidden"),this.emit("view.hide"),this},i.prototype.active=function(e){var t=this;return e&&t.$ct.children(".xq-view").each(function(){if(this!==t.el){var e=o(this).data("view");e.inactive()}}),this.$el.addClass("xq-active").removeClass("xq-inactive"),this.emit("view.active"),this},i.prototype.inactive=function(){return this.$el.removeClass("xq-active").addClass("xq-inactive"),this.emit("view.inactive"),this},i.prototype.renderHTML=function(t,o){return n.log("Render html snippet",t,"with data:",o),t="function"==typeof t?t:e.Tmpl.compile(t),t(o)},i.prototype.resize=function(){return this},i.prototype.getElementData=function(e){var n=o(e,this.container);if(n.length){var i,r={},s=n.get(0).attributes;for(i=0;s.length>i;i++)if(0===s[i].name.indexOf("data-")){var a=s[i].name.substr(5),c=s[i].value;if("string"==typeof c)try{c="true"===c||"TRUE"===c?!0:"false"===c||"FALSE"===c?!1:"null"===c||"NULL"===c?null:"undefined"===c?t:+c+""===c?+c:JSON.parse(c)}catch(l){}r[a]=c}return r}return null},i.prototype.validationFailed=function(e){var t=this;e.forEach(function(e){t.$el.find('[name="'+e.property+'"]').addClass("xq-invalid")})},i.prototype.onStateChange=function(e){var t=this.el.className.split(" ");t=t.filter(function(e){return!/^xq-state-/.test(e)}),t.push("xq-state-"+e),this.el.className=t.join(" ")},i.prototype.ready=function(e){this.isReady?e.call(this):(this.__readyCallbacks||(this.__readyCallbacks=[]),this.__readyCallbacks.push(e))},i.prototype.__setReadyState=function(){var e=this;this.isReady=!0,this.__readyCallbacks&&(this.__readyCallbacks.forEach(function(t){t.call(e)}),this.__readyCallbacks=[])},i.prototype.inject=function(){if(this.el.parentNode!==this.ct)if(n.info("Inject view into container",this.$ct),"replace"===this.mode){var e=this.$ct.contents();e.each(function(){var e=o(this).data("view");e?e.destroy():o(this).remove()}),this.$ct.append(this.$el)}else if("append"===this.mode)this.$ct.append(this.$el);else{if("prepend"!==this.mode)throw Error("Unknown insert mode in view constructor");this.$ct.prepend(this.$el)}},i.prototype.parse=function(e,t,n){var i,r;e.scopeStore={},e.scopes=n||{};try{i=e(t||{},e.scopes)}catch(s){i='<p class="renderError"><b>View render error!</b><br>'+s.message+"</p>",this.error("View render error!",s)}var a=function(t,n,i){t=o.parseHTML(t);var r=o(t),s=r.find("scope"),c={};return s.each(function(){var t,r=o(this).attr("id"),s=o(this).attr("path"),l=i?i+"."+s:s,h=n;if(Array.isArray(n)&&(c[s]=c[s]||0,h=n[c[s]++]),t={},r){var u=e.scopes[r](n[s],n);t.value=u?a(u,n[s],l):document.createTextNode(""),t.id=r}else t.value=o.parseHTML(n[s]);e.scopeStore[l]=e.scopeStore[l]||[],e.scopeStore[l].push(t),o(this).replaceWith(o(t.value))}),r};return i&&(r=a(i,t)),r},i.prototype.render=function(t){if(this.__domReady===!1)return this.__initialData=t||{},this;this.autoInject&&this.inject();var o;n.info("Render view template of view "+this.name,"with data:",t);var i="function"==typeof this.template?this.template:e.Tmpl.compile(this.template);this.scopes={};try{o=i(t||{},this.scopes)}catch(r){o='<p class="renderError"><b>View render error!</b><br>'+r.message+"</p>",this.error("View render error!",r)}return this.el.innerHTML=o,this.emit("content.change",t),this.registerListener(this.$el),this.registerForms(),this},i.prototype.registerListener=function(e){var t=this;e.find("[on]").addBack("[on]").each(function(){var e,n=o(this),i=o(this).attr("on"),r=o(this).data();n.removeAttr("on"),i=i.split(";"),i.forEach(function(o){o=o.split(":"),e="submit"===o[0]?function(e){e.preventDefault(),r=t.serializeForm(e.target),r=t.onSubmit(r,e.target),t.emit(o[1],r,e)}:function(e){var n;e.originalEvent instanceof KeyboardEvent?n={key:e.key,code:e.keyCode,alt:e.altKey,ctrl:e.ctrlKey,meta:e.metaKey,shift:e.shiftKey}:e.originalEvent instanceof MouseEvent?(e.preventDefault(),n={button:e.button,alt:e.altKey,ctrl:e.ctrlKey,meta:e.metaKey,shift:e.shiftKey},"click"===e.type&&e.currentTarget.href&&(n.href=e.currentTarget.href)):(e.preventDefault(),n=e.currentTarget.value||""),t.emit(o[1],n,r,e)},n.bind(o[0],e)})}),this.__viewEvents.forEach(function(e){t.$el.delegate(e.selector,e.events,e.callback)})},i.prototype.serializeForm=function(t){var i={},r=o(t);return"INPUT"!==r.get(0).tagName&&(r=r.find(":input")),r.serializeArray().forEach(function(t){e.dedotify(i,t.name,t.value)}),n.info("Serialize form of view "+this.name,"form selector:",r,"form data:",i),i},i.prototype.insert=function(e,t,n){var i=this,r=this.$el.find('[fire-path="'+e+'"]');r.length&&r.each(function(){var e=o(this).attr("fire-scope"),r=i.scopes[e]([n]),s=o(this).children();t>-1?(t>s.length-1&&(t=s.length-1),s.eq(t).before(r)):s.eq(t).after(r)})},i.prototype.update=function(){n.warn("XQCore doesn`t support update events yet")},i.prototype.append=function(e,t){this.insert(e,-1,t)},i.prototype.prepend=function(e,t){this.insert(e,0,t)},i.prototype.remove=function(e,t){var n=this.$el.find('[fire-path="'+e+'"]');n.children(":eq("+t+")").remove()},i.prototype.formSetup=function(e,t){var n=this;this.ready(function(){var i="xq-invalid",r="xq-disabled";t||(t=this.$el.find("form"));var s=function(){var t=o(this).closest("form"),n=o(this);n.removeClass(i);var s=n.attr("name"),a=n.val();if(s&&e.schema&&e.schema[s]){var c=e.validateOne(e.schema[s],a);c.isValid?0===t.find(':input[class~="'+i+'"]').length&&(t.removeClass(i),t.find(":submit").removeAttr("disabled").removeClass(r)):(n.addClass(i),t.addClass(i),t.find(":submit").attr("disabled","disabled").addClass(r))}},a=function(e){e.preventDefault();var t=n.serializeForm(e.target);n.emit("form.submit",t)};this.addEvent(":input","blur",s),this.addEvent("form","submit",a)})},i.prototype.onSubmit=function(e){return e},i.prototype.destroy=function(){n.info("Destroy view"),this.emit("view.destroy"),this.$el.remove(),this.__coupled&&(this.__coupled.obj.__coupled&&this.__coupled.obj.__coupled.obj===this&&this.__coupled.obj.__coupled.uncouple(),this.__coupled.uncouple()),n.info("View "+this.name+" has been destroyed")},i.prototype.addEvent=function(e,t,n){this.__viewEvents.push({events:t,selector:e,callback:n}),this.$el&&this.$el.delegate(e,t,n)},i.prototype.__viewTagTypes={"*":"div",body:"section",section:"section",ul:"li",table:"tbody",tbody:"tr",tr:"td"},i.prototype.__createViewElement=function(){if(this.tag)return document.createElement(this.tag);var e=this.ct?this.ct.tagName.toLowerCase():"*",t=this.__viewTagTypes["*"];return this.__viewTagTypes[e]&&(t=this.__viewTagTypes[e]),document.createElement(t)
},i.prototype.__createView=function(){var t=this,n=[];o(function(){t.$ct=t.$ct||o(t.container),t.ct=t.$ct.get(0),t.el=t.__createViewElement(),t.$el=o(t.el),t.$el.data("view",t),n.push("xq-view xq-"+t.name.replace(/View$/,"-view").toLowerCase()),t.id&&t.el.setAttribute("id",t.id),t.className&&n.push(t.className),t.hidden===!0&&(n.push("xq-hidden"),t.$el.hide()),t.el.className=n.join(" "),t.__domReady=!0,t.__initialData&&(t.render(t.__initialData),delete t.__initialData),t.__setReadyState(),t.registerListener(t.$el),e.html5Routes&&t.$el.on("click","a",function(e){/^http(s)?:\/\//.test(e.href)||/^\/?[a-z]/.test(e.href)&&(e.preventDefault(),e.stopPropagation(),t.emit("xqcore.navigate",e.href))})})},i.prototype.registerForms=function(){if(this.forms){var e="form";"string"==typeof this.forms&&(e=this.forms),this.ready(function(){this.$forms=this.$el.find(e),this.$forms.addClass("xq-forms"),this.$forms.find(":input").addClass("xq-input")})}},e.View=i}(XQCore),function(e){"use strict";var t,n=new e.Logger("Router"),o=function(t){var o,r,s=[];return n.logLevel=e.logLevel,t instanceof RegExp?(r=t,o=""+t):(r=i(t,s),o=t),{re:r,src:""+t,keys:s}},i=function(e,t){return e=e.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?|\*/g,function(e,n,o,i,r,s){return"*"===e?(t.push(void 0),e):(t.push(i),n=n||"",""+(s?"":n)+"(?:"+(s?n:"")+(o||"")+(r||"([^/]+?)")+")"+(s||""))}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),RegExp("^"+e+"$","i")},r=function(e,t,n){for(var o,i=n||0,r=e.length;r>i;++i){var s=e[i],a=s.re,c=s.keys,l=[],h={};if(o=t.match(a)){for(var u=1,p=o.length;p>u;++u){var f=c[u-1],d="string"==typeof o[u]?unescape(o[u]):o[u];f?h[f]=d:l.push(d)}return{params:h,splats:l,route:s.src,next:i+1}}}},s=function(e){e=e||{},this.routes=[],this.routeMap={},e.noListener||this.registerListener()};s.getInstance=function(){return t||(t=new e.Router),t},s.prototype.registerListener=function(){e.html5Routes?(console.log("DEFINE"),window.addEventListener("popstate",this.onPopStateHandler.bind(this))):window.addEventListener("hashchange",this.onPopStateHandler.bind(this))},s.prototype.onPopStateHandler=function(){var e=this.getPath();this.callRoute(e,{noPush:!0})},s.prototype.getPath=function(){var t;return e.html5Routes?(t=location.pathname,t.replace(RegExp("^"+e.basePath),"")):(t=location.hash,t=t.replace(RegExp("^"+e.hashBang),""),t="/"+t)},s.prototype.addRoute=function(e,t){if(n.info("Register new route:",e,t),!e)throw Error(" route requires a path");if(!t)throw Error(" route "+(""+e)+" requires a callback");if(this.routeMap[e])throw Error("path is already defined: "+e);"/"!==e.charAt(0)&&(e="/"+e);var i=new o(e);return i.fn=t,this.routes.push(i),this.routeMap[e]=t,this},s.prototype.removeRoute=function(e){if(!e)throw Error(" route requires a path");if(!this.routeMap[e])return n.warn("Can not remove route! Route does not exists: "+e),this;for(var t=0;this.routes.length>t;t++){var o=this.routes[t];o.src===e&&this.routes.splice(t,1)}return delete this.routeMap[e],this},s.prototype.match=function(e,t){var n=r(this.routes,e,t);return n&&(n.fn=this.routeMap[n.route],n.next=this.match.bind(this,e,n.next)),n},s.prototype.callRoute=function(t,o){if(o=o||{},n.info("Call route",t),void 0===t)throw Error("XQCore.Router error! Path is undefined in callRoute()!");var i=this.match(t);if(!i)return n.warn("Could not call any route! No route were found! Called path: "+t),void 0;!e.html5Routes||o.noPush||o.replace?e.html5Routes&&o.replace&&history.replaceState(null,"",t):history.pushState(null,"",t);var r=function(){n.info("... trigger route",this.route,this.fn,this.next),this.fn.call(this,this.params,this.splats,function(){var e=this.next();e&&r.call(e)}.bind(this))};r.call(i)},e.Router=s}(XQCore),function(e){"use strict";var t=new e.Logger("SocketConnection"),n=e.require("sockjs"),o={},i=function(e){return o[e]?o[e]:(o[e]=this,this.__isReady=!1,this.__onReadyCallbacks=[],this.__channels={},this.conn=null,this.connect(e),this.autoReconnect=!0,this.reconnectionInterval=1500,void 0)};i.prototype.connect=function(e){var o=this;this.conn&&"disconnected"!==this.connectionState||(t.info("Connect to socket server ",e),this.conn=new n(e,null,{debug:t.logLevel>=4}),this.connectionState="connecting",this.conn.onopen=function(){t.info("Connection was successful!"),o.setReady(),o.connectionState="connected"},this.conn.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(i){console.error("Could not parse socket message!",e.data)}if(!n.channel)throw Error("No socket channel was sent!");t.info("Got socket message",n.eventName,"in channel "+n.channel,n.args);var r=n.args||[];r.unshift(n.eventName),o.__channels[n.channel]?o.__channels[n.channel].emit.apply(o.__channels[n.channel],r):t.info(" ... channel not found!",n.channel)},this.conn.onclose=function(n){o.connectionState="disconnected",o.unsetReady(),t.warn("Connection to "+e+" closed!",n),o.autoReconnect&&(t.info("Try to reconnect to "+e),setTimeout(function(){o.connect(e)},o.reconnectionInterval))})},i.prototype.registerChannel=function(e,n){t.info("Register new channel",e),this.__channels[e]?t.info(" ... channel already registered!"):this.__channels[e]=n},i.prototype.unregisterChannel=function(e){t.info("Unregister channel",e),this.__channels[e]?delete this.__channels[e]:t.info(" ... channel not found!")},i.prototype.send=function(e,n){var o=this,i=Array.prototype.slice.call(arguments,2);this.ready(function(){t.info("Send socket message to channel "+e,n,i),o.conn.send(JSON.stringify({channel:e,eventName:n,args:i}))})},i.prototype.ready=function(e){this.__isReady?e.call(this):this.__onReadyCallbacks.push(e)},i.prototype.setReady=function(){var e=this;this.__isReady=!0,this.__onReadyCallbacks.forEach(function(t){t.call(e)}),this.__onReadyCallbacks=[]},i.prototype.unsetReady=function(){this.__isReady=!1},e.SocketConnection=i}(XQCore),function(e){"use strict";var t=new e.Logger("Socket");t.logLevel=5;var n=function(t,n){this.__isReady=!1,this.__onReadyCallbacks=[],this.channel=n,this.socket=new e.SocketConnection(t),this.socket.registerChannel(n,this)};e.extend(n.prototype,new e.Event),n.prototype.send=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.channel),this.socket.send.apply(this.socket,e)},e.Socket=n}(XQCore),function(e,t){"use strict";var n;n=function(t,n){this.noAutoRegister=!1,e.Model.call(this,t,n),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||e.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},n.prototype=Object.create(e.Model.prototype),n.prototype.constructor=n,n.inherit=function(n,o){"object"==typeof n&&(o=n,n=t);var i=function(){e.SyncModel.call(this,n,o)};return i.prototype=Object.create(e.SyncModel.prototype),i.prototype.constructor=i,i},n.prototype.connectToSocket=function(){var t=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",t),this.socket=new e.Socket(t,this.channel))},n.prototype.register=function(e){var t=this;this.syncEnabled=!!e,t.dev("Register syncmodel at server:",t.name);var n={noSync:!0};t.socket.on("syncmodel.set",function(e){t.set(e,n)}),t.socket.on("syncmodel.replace",function(e){n.replace=!0,t.set(e,n)}),t.socket.on("syncmodel.item",function(e,o){t.set(e,o,n)}),t.socket.on("syncmodel.insert",function(e,o,i){t.insert(e,o,i,n)}),t.socket.on("syncmodel.remove",function(e,o,i){t.remove(e,o,i,n)}),t.socket.on("syncmodel.reset",function(){t.reset(n)}),t.socket.on("syncmodel.init",function(e){console.log("Got initial data request:",e),t.set(e,n)}),t.socket.send("syncmodel.register",{name:t.name})},n.prototype.unregister=function(){var e=this.conf.syncWith||this.name.replace(/Model$/,"");this.socket.send("syncmodel.unregister",{name:e}),this.socket.off("syncmodel.set"),this.socket.off("syncmodel.replace"),this.socket.off("syncmodel.item"),this.socket.off("syncmodel.insert"),this.socket.off("syncmodel.remove"),this.socket.off("syncmodel.reset"),this.socket.off("syncmodel.init")},n.prototype.emitRemote=function(e,t){this.socket.send(e,t)},n.prototype.sync=function(e){if(this.syncEnabled){var t=Array.prototype.slice.call(arguments,1);t.unshift("syncmodel."+e),this.emitRemote.apply(this,t)}},n.prototype.fetchModel=function(){this.emitRemote("syncmodel.fetch")},e.SyncModel=n}(XQCore),function(e,t){"use strict";var n;n=function(n,o){e.ReadyState.call(this),e.Event.call(this);var i=this;"object"==typeof arguments[0]&&(o=n,n=o.name),this.debug=e.debug,o===t&&(o={}),this.__unfiltered={},this.name=(n?n.replace(/List$/,""):"Nameless")+"List",this.items=[],this.maxLength=null,this.model||(this.model=e.Model),"function"==typeof o?o.call(this,i):e.extend(this,o),this.state("ready")},e.extend(n.prototype,e.ReadyState.prototype),e.extend(n.prototype,e.Event.prototype),e.extend(n.prototype,new e.Logger),n.inherit=function(n,o){"object"==typeof n&&(o=n,n=t);var i=function(){e.List.call(this,n,o)};return i.prototype=Object.create(e.List.prototype),i.prototype.constructor=i,i},Object.defineProperty(n.prototype,"length",{get:function(){return this.items.length}}),n.prototype.state=function(e){this.__state=e,this.emit("state."+e),this.emit("state.change",e)},n.prototype.getState=function(){return this.__state},n.prototype.push=function(t,n){var o,i,r=[];n=n||{},Array.isArray(t)||(t=[t]);for(var s=0,a=t.length;a>s;s++){if(i=t[s],i instanceof e.Model?o=i:(o=new this.model("ListItem"),o.set(i)),!o.isValid())return!1;r.push(o)}var c=this.items.push.apply(this.items,r);return c&&(this.maxLength&&this.items.length>this.maxLength&&this.items.splice(0,this.items.length-this.maxLength),n.silent||this.emit("item.push",r,c),n.noSync||"function"==typeof this.sync&&this.sync("push",r)),!0},n.prototype.unshift=function(t,n){var o,i,r=[];n=n||{},Array.isArray(t)||(t=[t]);for(var s=0,a=t.length;a>s;s++){if(i=t[s],i instanceof e.Model?o=i:(o=new this.model("ListItem"),o.set(i)),!o.isValid())return!1;r.unshift(o)}var c=this.items.unshift.apply(this.items,r);return c&&(this.maxLength&&this.items.length>this.maxLength&&this.items.splice(this.maxLength),n.silent||this.emit("item.unshift",r,c),n.noSync||"function"==typeof this.sync&&this.sync("unshift",r)),!0},n.prototype.pop=function(e){var n;return e=e||{},n=this.items.pop()||null,n===t?null:(e.silent||this.emit("item.pop",n),e.noSync||"function"==typeof this.sync&&this.sync("pop",n),n)},n.prototype.shift=function(e){var n;return e=e||{},n=this.items.shift()||null,n===t?null:(e.silent||this.emit("item.shift",n),e.noSync||"function"==typeof this.sync&&this.sync("shift",n),n)},n.prototype.update=function(e,t,n){n=n||{};var o;return o="number"==typeof e?this.models[e]:this.findOne(e),o&&(o.set(t,{noSync:!0}),n.silent||this.emit("item.update",o),n.noSync||"function"==typeof this.sync&&this.sync("update",e,t)),o},n.prototype.clear=function(e){if(e=e||{},0===this.items.length)return 0;var t=this.toArray();return this.items=[],e.silent||this.emit("item.clear",t),e.noSync||"function"==typeof this.sync&&this.sync("clear",t),t.length},n.prototype.toArray=function(){return this.items.map(function(e){return e.properties})},n.prototype.findOne=function(e){var t;if(t=this.items)for(var n=0;t.length>n;n++){var o,i=t[n];for(var r in e)if(e.hasOwnProperty(r)){if(i.properties[r]&&i.properties[r]===e[r]){o=!0;break}o=!1}if(o===!0)return i}return null},n.prototype.find=function(e){var t,n=[];if(t=this.items)for(var o=0;t.length>o;o++){var i,r=t[o];for(var s in e)if(e.hasOwnProperty(s)){if(r.properties[s]&&r.properties[s]===e[s]){i=!0;break}i=!1}i===!0&&n.push(r)}return n},n.prototype.each=function(e,t){"function"==typeof e&&(t=e,e=null);for(var n=e,o=0,i=this.items.length;i>o;o++)n=t(n,this.items[o].properties);return n},e.List=n}(XQCore),function(e,t){"use strict";var n;n=function(t,n){this.noAutoRegister=!1,e.List.call(this,t,n),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||e.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},n.prototype=Object.create(e.List.prototype),n.prototype.constructor=n,n.inherit=function(n,o){"object"==typeof n&&(o=n,n=t);var i=function(){e.SyncList.call(this,n,o)};return i.prototype=Object.create(e.SyncList.prototype),i.prototype.constructor=i,i},n.prototype.connectToSocket=function(){var t=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",t),this.socket=new e.Socket(t,this.channel))},n.prototype.register=function(e){var t=this;"boolean"==typeof e&&(this.syncEnabled=e),t.dev("Register synclist at server:",t.name);var n={noSync:!0};t.socket.on("synclist.push",function(e){t.push(e,n)}),t.socket.on("synclist.unshift",function(e){t.push(e,n)}),t.socket.on("synclist.pop",function(){t.push(n)}),t.socket.on("synclist.shift",function(){t.push(n)}),t.socket.on("synclist.update",function(e,o){t.update(e,o,n)}),t.socket.on("synclist.clear",function(){t.clear(n)}),t.socket.on("synclist.init",function(e){console.log("Got initial data request:",e),t.push(e,n)}),t.socket.send("synclist.register",{name:t.name})},n.prototype.unregister=function(){this.dev("Unregister synclist at server:",this.name),this.socket.send("synclist.unregister",{name:this.name}),this.socket.off("synclist.push"),this.socket.off("synclist.unshift"),this.socket.off("synclist.pop"),this.socket.off("synclist.shift"),this.socket.off("synclist.update"),this.socket.off("synclist.clear"),this.socket.off("synclist.init")},n.prototype.emitRemote=function(e,t){this.socket.send(e,t)},n.prototype.sync=function(e){if(this.syncEnabled){var t=Array.prototype.slice.call(arguments,1);t.unshift("syncmodel."+e),this.emitRemote.apply(this,t)}},n.prototype.fetchList=function(){this.emitRemote("synclist.fetch")},e.SyncList=n}(XQCore);