/*!
 * XQCore - +0.8.0-24
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2014 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2014-05-21
 */
var XQCore;!function(a,b){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],b):"undefined"!=typeof module&&module.exports?module.exports=b(require("jquery")):a.XQCore=b(a.jQuery)}(this,function(a){"use strict";return XQCore={version:"0.8.0-24",defaultRoute:"index",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire"},XQCore.extend=a.extend,XQCore.isEmptyObject=a.isEmptyObject,XQCore.isPlainObject=a.isPlainObject,XQCore.isFunction=a.isFunction,XQCore.isObjectId=function(a){return this.objectIdPattern.test(a)},XQCore._dump={},XQCore.dump=function(a){return XQCore._dump[a]?(console.log("[XQCore dump]",a,XQCore._dump[a]),XQCore._dump[a]):!1},XQCore.include=function(b){return"jquery"===b?a:void 0},XQCore}),function(a){"use strict";/*!
	 * EventEmitter v4.2.5 - git.io/ee
	 * Oliver Caldwell
	 * MIT license
	 * @preserve
	 */
function b(){}function c(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function d(a){return function(){return this[a].apply(this,arguments)}}var e=b.prototype;e.getListeners=function(a){var b,c,d=this._getEvents();if("object"==typeof a){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},e.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},e.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},e.addListener=function(a,b){var d,e=this.getListenersAsObject(a),f="object"==typeof b;for(d in e)e.hasOwnProperty(d)&&-1===c(e[d],b)&&e[d].push(f?b:{listener:b,once:!1});return this},e.on=d("addListener"),e.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},e.once=d("addOnceListener"),e.defineEvent=function(a){return this.getListeners(a),this},e.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},e.removeListener=function(a,b){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=c(f[e],b),-1!==d&&f[e].splice(d,1));return this},e.off=d("removeListener"),e.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},e.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},e.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},e.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if("object"===c)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},e.removeAllListeners=d("removeEvent"),e.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},e.trigger=d("emitEvent"),e.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},e.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},a.Event=b}(XQCore),function(a){"use strict";function b(a){return 1e3>a?a+" ms":6e4>a?Math.round(a/100)/10+" sec":Math.round(a/6e4)+" min "+Math.round(a%6e4/1e3)+" sec"}var c=function(){};c.prototype.log=function(){var a;this.debug&&(a=Array.prototype.slice.call(arguments),a.unshift("["+this.name+"]"),console.log.apply(console,a))},c.prototype.warn=function(){var a;this.debug&&(a=Array.prototype.slice.call(arguments),a.unshift("["+this.name+"]"),console.warn.apply(console,a))},c.prototype.error=function(){var a;this.debug&&(a=Array.prototype.slice.call(arguments),a.unshift("["+this.name+"]"),console.error.apply(console,a))},c.prototype.timer=function(a){var c={start:null,stop:null,name:a,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",b(this.stop-this.start))}};return this.log("Start Timer",a),c.start=Date.now(),c},c.prototype.__scope={getHumanTime:b},a.Logger=c}(XQCore),function(a){"use strict";var b=a.include("jquery"),c=function(b,c){"object"==typeof arguments[0]&&(c=b,b=c.name),this.__views=[],this.debug=a.debug,this.name=(b?b.replace(/Presenter$/,""):"Nameless")+"Presenter",this.routes=[],c=c||{},this.conf=c,this.eventCallbacks={},this.lastShownView=null,this.registeredViews=[],this.registeredModels=[],this.fireViewInit=function(a){var b=!0;this.registeredViews.forEach(function(c){a===c.view&&(c.isReady=!0),c.isReady===!1&&(b=!1)}),this.viewInit(a),b===!0&&this.emit("views.ready")},this.registerView=function(a){this.warn("presenter.registerView was deprecated since XQCore 0.7.0");var b;if(a instanceof Array)for(b=0;b<a.length;b++)this.registeredViews.push({view:a[b],isReady:!1});else this.registeredViews.push({view:a,isReady:!1})},this.registerModel=function(a){this.warn("presenter.registerModel was deprecated since XQCore 0.7.0");var b;if(a instanceof Array)for(b=0;b<a.length;b++)this.registeredModels.push({model:a[b],isReady:!1});else this.registeredModels.push({model:a,isReady:!1})},this.__Router=new a.Router};a.extend(c.prototype,new a.Event,new a.Logger),c.prototype.events={},c.prototype.init=function(c){var d,e=this,f=this.conf;"function"==typeof f?f.call(this,e):a.extend(this,f),f.routes&&Object.keys(f.routes).forEach(function(a){var b=this.routes[a];"string"==typeof b&&(b=this[b]),"function"==typeof b?this.__Router.addRoute(a,b):this.warn("Router callback isn't a function",b,"of route",a)}.bind(this)),window.addEventListener("popstate",function(a){e.__onPopstate(a.state)},!1);var g=a.defaultRoute;if(/^#![a-zA-Z0-9]+/.test(e.getHash())&&(g=e.getHash().substr(2)),g=e.__Router.match(g)){var h=g.params;a.callerEvent&&(h[a.callerEvent]="pageload"),b(function(){e.log("Trigger route",g,h),g.fn.call(e,g.params)})}if("function"==typeof f.init&&f.init.call(this),c instanceof Array)for(d=0;d<c.length;d++)this.registerView(c[d]);else c&&this.registerView(c);this.registeredViews.forEach(function(a){a.view.init(e)}),this.registeredModels.forEach(function(a){a.model.init(e)})},c.prototype.viewInit=function(){},c.prototype.pushState=function(b,c){var d=a.html5Routes||"/"===c.charAt(0)?"":a.hashBang;c=d+c,history.pushState(b,"",c||null),this.log("Update history with pushState",b,c)},c.prototype.replaceState=function(b,c){var d=a.html5Routes||"/"===c.charAt(0)?"":a.hashBang;c=d+c,history.replaceState(b,"",c||null),this.log("Update history with replaceState",b,c)},c.prototype.navigateTo=function(a,b,c){this.log("Navigate to route: ",a,b,c),c?this.replaceState(b,a):this.pushState(b,a);var d=new PopStateEvent("popstate",{bubbles:!1,cancelable:!1,state:null});window.dispatchEvent(d)},c.prototype.getView=function(a){var b,c;for(b=0;b<this.registeredViews.length;b++)if(c=this.registeredViews[b].view,c.name===a)return c;return null},c.prototype.showView=function(a,b){var c=this.getView(a+"View");return c?(this.log("Show view:",a,b),this.log("Hide view:",this.lastShownView),this.lastShownView!==c&&(this.lastShownView&&"function"==typeof this.lastShownView.hide?(this.lastShownView.hide(),c.show()):c.show(!0)),void 0):(this.warn("View not defined!",a),void 0)},c.prototype.getHash=function(){return location.hash},c.prototype.getPathname=function(){return location.pathname},c.prototype.couple=function(b){var c,d=b.view,e=b.model,f=a.extend({"data.replace":"render","data.item":"update","data.append":"append","data.prepend":"prepend","data.insert":"insert","data.remove":"remove","validation.error":"validationFailed","state.change":"stateChanged"},b.modelEvents),g=a.extend({"form.submit":"setData"},b.viewEvents);if(!d instanceof a.View)return this.error("Can't couple view with model! View isn't a XQCore.View"),void 0;if(!e instanceof a.Model)return this.error("Can't couple model with model! Model isn't a XQCore.Model"),void 0;this.log("Couple view ",d.name,"with model",e.name),d.__coupledWith||(d.__coupledWith=[]),e.__coupledWith||(e.__coupledWith=[]),d.__coupledWith.some(function(a){return a===e})||d.__coupledWith.push(e),e.__coupledWith.some(function(a){return a===d})||e.__coupledWith.push(d);var h=function(a,b){e.on(a,function(){var a=Array.prototype.slice.call(arguments);a.push(e.name),d[b].apply(d,a)})},i=function(a,b){d.on(a,function(a,c){e[b](a,c,d.name)})};for(c in f)f.hasOwnProperty(c)&&(h(c,f[c]),"data.replace"===c&&e.emit(c,e.get()));for(c in g)g.hasOwnProperty(c)&&i(c,g[c]);return this},c.prototype.triggerEvent=function(a,b,c,d,e){this.events[b]?this.events[b].call(this,c,d,e):(c.preventDefault(),c.stopPropagation(),a.__coupledWith.forEach(function(a){"function"==typeof a[b]?(this.log("Autotrigger to model ",a.name," - ",b,e),a[b](e)):this.warn("Autotrigger to model failed! Function doesn't exists:",b,e)}))},c.prototype.__onPopstate=function(b){var c=this;c.log("popstate event recived",b,c);var d=a.defaultRoute;if(a.html5Routes){var e=new RegExp("^"+c.root);d=c.getPathname().replace(e,"")}else/^#!\S+/.test(this.getHash())&&(d=c.getHash().substr(2));d=c.__Router.match(d),d&&(b=b||d.params,a.callerEvent&&(b[a.callerEvent]="popstate"),c.log("Trigger route",d,b),d.fn.call(c,b))},c.prototype.initView=function(b,c,d){if(d=d||{},this.__views[b])return this.warn("View allready registered!",b),void 0;this.debug&&this.log("Init view",b);var e=new a.View(b,function(e){e.template=a.Tmpl.getTemplate(b),e.mode=d.mode||"replace",e.container=c||"body",d.inject===!1&&(e.autoInject=!1)});return this.__views[b]=e,e.init(this),e},c.prototype.route=function(a,b){"string"==typeof b&&(b=this[b]),"function"==typeof b?"string"==typeof a?(this.log("Register route",a,"with callback",b),this.__Router.addRoute(a,b)):Array.isArray(a)&&a.forEach(function(a){this.log("Register route",a,"with callback",b),this.__Router.addRoute(a,b)}.bind(this)):this.warn("Router callback isn't a function",b,"of route",a)},a.Presenter=c}(XQCore),function(a,b){"use strict";var c=a.include("jquery"),d=function(){};d.prototype.onSend=function(a){return a},d.prototype.send=function(a,d,e,f){"object"==typeof d?(f=e,e=d,d=this.server,a=a):"function"==typeof e?(f=e,e=this.get()):e===b&&(e=this.get()),a===b&&(a="POST"),d||(d=this.server),"function"==typeof this.onSend&&(e=this.onSend.call(this,e)),this.log("Sending an ajax call to ",d,"with data: ",e),this.state("syncing"),c.ajax({url:d,type:a,data:e,dataType:"json",success:function(a,b,c){"function"==typeof f&&f.call(this,null,a,b,c),this.state("success")}.bind(this),error:function(a,b,c){"function"==typeof f&&f.call(this,{type:b,http:c},null,b,a),this.state("failed")}.bind(this)})},d.prototype.sendPOST=function(a,b,c){this.send("POST",a,b,c)},d.prototype.sendGET=function(a,b,c){this.send("GET",a,b,c)},d.prototype.sendPUT=function(a,b,c){this.send("PUT",a,b,c)},d.prototype.sendDELETE=function(a,b,c){this.send("DELETE",a,b,c)},d.prototype.ready=function(a){a===!0?(Array.isArray(this.__callbacksOnReady)&&(this.log("Trigger ready state"),this.__callbacksOnReady.forEach(function(a){a.call(this)}.bind(this))),this.__isReady=!0,delete this.__callbacksOnReady):"function"==typeof a?this.__isReady===!0?a():(this.__callbacksOnReady||(this.__callbacksOnReady=[]),this.__callbacksOnReady.push(a)):this.warn("arg0 isn't a callback in model.ready()!")},d.prototype.fetch=function(a,b){this.sendGET(a,b)},d.prototype.save=function(a){this.isValid()?this.sendPOST(this.get(),a):"function"==typeof a&&a({msg:"Model isn't valid. Cancle save"})},d.prototype.update=function(a){this.isValid()?this.sendPUT(this.get(),a):"function"==typeof a&&a({msg:"Model isn't valid. Cancle update"})},a.Sync=d}(XQCore),function(a,b){"use strict";var c;c=function(c,d){"object"==typeof arguments[0]&&(d=c,c=d.name),this.debug=a.debug,d===b&&(d={}),this.__state="starting",this.__unfiltered={},this.customValidate=d.validate,delete d.validate,this.conf=d,this.name=(c?c.replace(/Model$/,""):"Nameless")+"Model",this._isValid=!1,this.properties={},this.schema=d.schema},a.extend(c.prototype,new a.Event,new a.Logger),a.Sync&&a.extend(c.prototype,a.Sync.prototype),c.prototype.init=function(){var b=this,c=this.conf;"function"==typeof c?c.call(this,b):a.extend(this,c),this.debug&&(a._dump[this.name]=this),this.defaults&&!a.isEmptyObject(this.defaults)&&this.set(this.defaults),this.state("ready")},c.prototype.state=function(a){this.__state=a,this.emit("state."+a),this.emit("state.change",a)},c.prototype.getState=function(){return this.__state},c.prototype.set=function(b,c,d){var e,f={},g=this.get(),h=!1,i=!1;if(d=d||{},null===arguments[0])f=arguments[1],i=!0,this.log("Set data",f,g);else if("object"==typeof arguments[0])b=null,d=c||{},f=d.extend?a.extend(f,g,arguments[0]):arguments[0],i=!0,this.log("Set data",f,g);else if("string"==typeof arguments[0]){if(f=a.extend({},this.get()),h=!0,a.dedotify(f,b,c),this.log("Set data",f,g),d=d||{},!this.customValidate&&d.validateOne&&(d.noValidation=!0,e=this.validateOne(this.schema[b],c),e.isValid===!1))return this.warn("Validate error in model.set",e),d.silent!==!0&&this.emit("validation.error",e,f),!1}else this.warn("Data are incorrect in model.set()",arguments);return d=d||{},!this.customValidate&&this.schema&&d.noValidation!==!0&&(e=this.validate(f),null!==e)?(this.warn("Validate error in model.set",e),d.silent!==!0&&this.emit("validation.error",e,f),!1):this.customValidate&&d.noValidation!==!0&&(e=this.customValidate(f),this.log("Using a custom validation which returns:",e),null!==e)?(this.warn("Validate error in model.set",e),this.emit("validation.error",e,f),!1):(this.properties=f,d.silent!==!0&&(i?("function"==typeof this.sync&&d.sync!==!1&&this.sync("replace",f),this.emit("data.replace",f,g)):h&&("function"==typeof this.sync&&d.sync!==!1&&this.sync("item",b,c),this.emit("data.item",b,c)),this.emit("data.change",f,g)),!0)},c.prototype.get=function(c){return c===b?this.properties:a.undotify(c,this.properties)},c.prototype.has=function(a){return!!this.properties[a]},c.prototype.reset=function(){this.log("Reset model"),this.properties={}},c.prototype.append=function(b,c,d){var e=a.undotify(b,this.properties);if(d=d||{},e instanceof Array)e.push(c);else if("undefined"==typeof e)a.dedotify(this.properties,b,[c]);else{if("object"!=typeof e||b||!a.isEmptyObject(this.properties))return this.error("Model.append requires an array. Dataset isn't an array. Path: ",b),void 0;this.properties=[c]}d.silent!==!0&&("function"==typeof this.sync&&d.sync!==!1&&this.sync("append",b,c),this.emit("data.append",b,c),this.emit("data.change",this.properties))},c.prototype.prepend=function(b,c,d){var e=a.undotify(b,this.properties);if(d=d||{},e instanceof Array)e.unshift(c);else if("undefined"==typeof e)a.dedotify(this.properties,b,[c]);else{if("object"!=typeof e||b||!a.isEmptyObject(this.properties))return this.error("Model.prepend requires an array. Dataset isn't an array. Path: ",b),void 0;this.properties=[c]}d.silent!==!0&&("function"==typeof this.sync&&d.sync!==!1&&this.sync("prepend",b,c),this.emit("data.prepend",b,c),this.emit("data.change",this.properties))},c.prototype.insert=function(b,c,d,e){var f=a.undotify(b,this.properties);if(e=e||{},f instanceof Array)f.splice(c,0,d);else if("undefined"==typeof f)a.dedotify(this.properties,b,[d]);else{if("object"!=typeof f||b||!a.isEmptyObject(this.properties))return this.error("Model.insert requires an array. Dataset isn't an array. Path: ",b),void 0;this.properties=[d]}e.silent!==!0&&("function"==typeof this.sync&&e.sync!==!1&&this.sync("insert",b,1,d),this.emit("data.insert",b,c,d),this.emit("data.change",this.properties))},c.prototype.remove=function(b,c,d){var e=a.undotify(b,this.properties),f=null;if(d=d||{},e instanceof Array)f=e.splice(c,1);else if("object"==typeof e)return this.error("Model.remove requires an array. Dataset isn't an array. Path: ",b),void 0;return f&&d.silent!==!0&&("function"==typeof this.sync&&d.sync!==!1&&this.sync("remove",b,c),this.emit("data.remove",b,c,f[0]),this.emit("data.change",this.properties)),f},c.prototype.search=function(b,c){var d;if(1===arguments.length?(c=b,b="",d=this.properties):d=a.undotify(b,this.properties),d)for(var e=0;e<d.length;e++){var f,g=d[e];for(var h in c)if(c.hasOwnProperty(h)){if(!g[h]||g[h]!==c[h]){f=!1;break}f=!0}if(f===!0)return g}return null},c.prototype.sortBy=function(b,c){1===arguments.length&&(c=b,b=null);var d,e=a.undotify(b,this.properties);return e.sort(function(b,e){d=-1;for(var f in c)if(c.hasOwnProperty(f)){if(d=String(a.undotify(f,b)).localeCompare(String(a.undotify(f,e))),0===d)continue;-1===c[f]&&(d=d>0?-1:1);break}return d}),this.set(b,e),e},c.prototype.filter=function(b,c,d,e){if(1===arguments.length&&(e=b,b=null),"string"==typeof e){if(!this.__registeredFilter[e])throw new Error("Filter "+e+" not registered!");e=this.__registeredFilter[e]}for(var f=a.undotify(b,this.__unfiltered.data||this.properties),g=[],h=0,i=f.length;i>h;h++)e(c,d,f[h])&&g.push(f[h]);return this.__unfiltered={path:b,data:f},this.set(b,g),g},c.prototype.filterReset=function(a){this.__unfiltered&&this.set(this.__unfiltered.path,this.__unfiltered.data,a)},c.prototype.validate=function(b,c){var d=[];return c=c||this.schema,c&&Object.keys(c).forEach(function(e){if("object"==typeof b[e]&&"undefined"==typeof c[e].type){var f=this.validate(a.extend({},b[e]),a.extend({},c[e]));return Array.isArray(f)&&f.length>0&&(d=d.concat(f)),void 0}var g=this.validateOne(c[e],b[e]);g.isValid===!0?b[e]=g.value:(g.error.property=e,d.push(g.error))}.bind(this)),0===d.length?(this._isValid=!0,null):(this._isValid=!1,d)},c.prototype.validateOne=function(a,c){var d=null,e="function"==typeof a.type?typeof a.type():a.type.toLowerCase();if(""===c&&a.noEmpty===!0&&(c=b),c!==b&&null!==c||!a.default||(c=a.default),c===b||null===c||""===c)a.required===!0&&(d={msg:"Property is undefined or null, but it's required",errCode:10});else if("string"===e)a.convert&&"number"==typeof c&&(c=String(c)),e!==typeof c?d={msg:"Property type is a "+typeof c+", but a string is required",errCode:11}:a.min&&a.min>c.length?d={msg:"String length is too short",errCode:12}:a.max&&a.max<c.length?d={msg:"String length is too long",errCode:13}:a.match&&!a.match.test(c)&&(d={msg:"String doesn't match regexp",errCode:14});else if("number"===e)a.convert&&"string"==typeof c&&(c=parseInt(c,10)),e!==typeof c?d={msg:"Property type is a "+typeof c+", but a number is required",errCode:21}:a.min&&a.min>c?d={msg:"Number is too low",errCode:22}:a.max&&a.max<c&&(d={msg:"Number is too high",errCode:23});else if("date"===e){if(c){var f=Date.parse(c);isNaN(f)&&(d={msg:"Property isn't a valid date",errCode:31})}}else"array"===e?Array.isArray(c)?a.min&&a.min>c.length?d={msg:"Array length is "+c.length+" but must be greater than "+a.min,errCode:42}:a.max&&a.max<c.length&&(d={msg:"Array length is "+c.length+" but must be lesser than "+a.max,errCode:43}):d={msg:"Property type is a "+typeof c+", but an array is required",errCode:41}:"object"===e?"object"!=typeof c&&(d={msg:"Property isn't a valid object",errCode:51}):"objectid"===e?/^[a-zA-Z0-9]{24}$/.test(c)||(d={msg:"Property isn't a valid objectId",errCode:52}):"boolean"===e&&"boolean"!=typeof c&&(d={msg:"Property isn't a valid boolean",errCode:61});return null===d?d={isValid:!0,value:c,error:null}:(this.warn("Validation error on property",d,"Data:",c),d={isValid:!1,value:c,error:d}),d},c.prototype.isValid=function(){return this._isValid},c.prototype.setData=function(a){return this.set(a,{extend:!0})},c.registerFilter=function(a,b){if("function"!=typeof b)throw new Error("Filter function isn't a function");var d="function"==typeof this?c.prototype:this;d.__registeredFilter[a]=b},c.prototype.registerFilter=c.registerFilter,c.prototype.__registeredFilter={quicksearch:function(b,c,d){var e=a.undotify(b,d),f=new RegExp(c.replace(/[a-z0-9äüöß]/g,"$&.*"),"i");return f.test(e)}},a.Model=c}(XQCore),XQCore.GetSet=XQCore.Model,function(a,b){"use strict";if("function"==typeof define&&define.amd)define("xqcore",[XQCore.templateEngine],b);else if("undefined"!=typeof module&&module.exports)module.exports=b(require(XQCore.templateEngine));else{var c="firetpl"===XQCore.templateEngine?"FireTPL":"Handlebars";a.XQCore=b(a[c])}}(this,function(a){"use strict";return XQCore.Tmpl={type:XQCore.templateEngine,compile:a.compile,getTemplate:function(b){if("firetpl"===XQCore.templateEngine){var c=a;if(c.templateCache&&c.templateCache[b])return c.templateCache[b];if(c.loadFile){var d=c.loadFile(XQCore.viewsDir.replace(/\/$/,"")+"/"+b+"."+XQCore.viewExt.replace(/^\./,""));return c.compile(d)}throw new Error("FireTPL runtime is being used. Please preload the "+b+"View")}}},XQCore}),function(a,b){"use strict";var c=a.include("jquery"),d=function(b,c){var d;"object"==typeof arguments[0]&&(d=b,b=d.name),this.debug=a.debug,this.name=(b?b.replace(/View$/,""):"Nameless")+"View",this.container="body",this.tag="div",this.mode="replace",this.autoInject=!0,this.initFunc=c,this.__domReady=!1,d=d||{events:null},this.conf=d};a.extend(d.prototype,new a.Event,new a.Logger),d.prototype.init=function(b){var d=this,f=this.conf;if("function"==typeof this.initFunc&&this.initFunc.call(this,d),"object"!=typeof b)throw new Error("No presenter was set in view.init()");this.presenter=b,c(function(){this.container.length>0?(window.addEventListener("resize",function(a){d.resize(a)},!1),this.log("Initialize view with conf:",f),this.log("  ... using Presenter:",this.presenter.name),this.log("  ... using Container:",this.container),this.events&&Object.keys(this.events).forEach(function(b){var d,f=b.indexOf(" "),g=this.events[b],h=b.substr(0,f),i=b.substr(f+1)||this.container,j=this;if("function"==typeof g)d=this;else if(0===g.indexOf("view:"))g=this[g.substr(5)],d=this;else if("function"==typeof this.presenter.events[this.events[b]])g=this.presenter.events[this.events[b]],d=this.presenter;else{var k=g;g=function(a,b,c){this.triggerEvent(k,a,b,c)}.bind(this),d=this}g&&h?"function"==typeof g?(this.container.delegate(i,h,function(b){var f=null,h=null;"submit"===b.type?f=a.Util.serializeForm(b.currentTarget):("keydown"===b.type||"keyup"===b.type||"keypress"===b.type)&&(f=c(b.currentTarget).val()),h=c.extend(c(b.currentTarget).data(),{itemIndex:e.call(j,b.currentTarget)}),g.call(d,b,h,f)}.bind(this)),this.log("Register Event:",h,"on selector",i,"with callback",g)):this.warn("Event handler callback not defined in Presenter:",this.events[b]):this.warn("Incorect event configuration",b)},this),"function"==typeof this.customInit&&this.customInit.call(this)):this.error("Can't initialize View, Container not found!",this.container),this.__domReady=!0,this.__initialData&&(this.render(this.__initialData),delete this.__initialData)}.bind(this))},d.prototype.show=function(){this.$el.show()},d.prototype.hide=function(){this.$el.hide()},d.prototype.renderHTML=function(b,c){return this.log("Render view html snipet",b,"with data:",c),b="function"==typeof b?b:a.Tmpl.compile(b),b(c)},d.prototype.resize=function(){},d.prototype.getElementData=function(a){var d=c(a,this.container);if(d.length){var e,f={},g=d.get(0).attributes;for(e=0;e<g.length;e++)if(0===g[e].name.indexOf("data-")){var h=g[e].name.substr(5),i=g[e].value;if("string"==typeof i)try{i="true"===i||"TRUE"===i?!0:"false"===i||"FALSE"===i?!1:"null"===i||"NULL"===i?null:"undefined"===i?b:+i+""===i?+i:JSON.parse(i)}catch(j){}f[h]=i}return f}return null},d.prototype.triggerEvent=function(a,b,c,d){this.presenter.events[a]?this.presenter.events[a].call(this.presenter,b,c,d):(b&&(b.preventDefault(),b.stopPropagation()),this.__coupledWith&&this.__coupledWith.forEach(function(b){"function"==typeof b[a]?(this.log("Autotrigger to model:",a,d),b[a](d)):this.warn("Autotrigger to model failed! Function doesn't exists:",a,d)}.bind(this)))},d.prototype.navigateTo=function(a,b,c){this.presenter.navigateTo(a,b,c)},d.prototype.validationFailed=function(a,b){console.log(a,b),a.forEach(function(a){this.$el.find('[name="'+a.property+'"]').addClass("xq-invalid")}.bind(this))},d.prototype.stateChanged=function(){},d.prototype.ready=function(a){this.isReady?a.call(this):(this.__readyCallbacks||(this.__readyCallbacks=[]),this.__readyCallbacks.push(a))},d.prototype.__setReadyState=function(){this.isReady=!0,this.__readyCallbacks&&this.__readyCallbacks.forEach(function(a){a.call(this)}.bind(this))};var e=function(a){var b=null,d=c(this.container).get(0),e=c(a),f=e.parent(),g=c(this.subSelector).get(0),h=0;if(this.subSelector)do{if(f.get(0)===g)return c(e).index();if(e=e.parent(),f=e.parent(),++h>100){console.error("Break loop!");break}}while(e.length&&e.get(0)!==d);return b};d.prototype.inject=function(){if(this.$ct=c(this.container),this.log("Inject view into container",this.$ct),this.el=this.$el.get(0),this.$el.addClass("xq-view xq-view-"+this.name.toLowerCase()),this.ct=this.$ct.get(0),this.hidden===!0&&this.$el.hide(),this.id&&this.$el.attr("id",this.id),this.className&&this.$el.addClass(this.className),"replace"===this.mode)this.$ct.contents().detach(),this.$ct.append(this.$el);else if("append"===this.mode)this.$ct.append(this.$el);else{if("prepend"!==this.mode)throw new Error("Unknow insert mode in view.init()");this.$ct.prepend(this.$el)}},d.prototype.parse=function(a,b){var d,e;a.scopeStore={},a.scopes={};try{d=a(b||{},a.scopes)}catch(f){d='<p class="renderError"><b>View render error!</b><br>'+f.message+"</p>",this.error("View render error!",f)}if(d){d=c.parseHTML(d),e=c(d);var g=e.find("scope");console.log("EL",g.length),g.each(function(){var d,f=c(this).attr("id"),g=c(this).attr("path");console.log("Parse path",g),d={},f?(d.value=c.parseHTML(a.scopes[f](b[g],b)),d.id=f):d.value=c.parseHTML(b[g]),a.scopeStore[g]=a.scopeStore[g]||[],a.scopeStore[g].push(d),console.log("EL",c(this).get(0).outerHTML),console.log("CONTENT",c(d.value).get(0).outerHTML),c(this).replaceWith(c(d.value)),console.log("REPLACETD",e.get(0).outerHTML)})}return e},d.prototype.render=function(b){if(this.__domReady===!1)return this.__initialData=b||{},void 0;var d,e,f=!1;this.$el||(f=!0),this.log("Render view template",this.template,"with data:",b);var g="function"==typeof this.template?this.template:a.Tmpl.compile(this.template);this.scopes={};try{e=g(b||{},this.scopes)}catch(h){e='<p class="renderError"><b>View render error!</b><br>'+h.message+"</p>",this.error("View render error!",h)}e=c.parseHTML(e),d=c(e),this.$el&&this.$el.replaceWith(d),this.$el=d,f&&(this.autoInject&&this.inject(),this.__setReadyState()),this.registerListener(this.$el),this.emit("content.change",b)},d.prototype.registerListener=function(a){var b=this;a.find("[on]").addBack("[on]").each(function(){var a,d=c(this),e=c(this).attr("on"),f=c(this).data();d.removeAttr("on"),e=e.split(";"),e.forEach(function(c){c=c.split(":"),a="submit"===c[0]?function(a){a.preventDefault(),f=b.serializeForm(a.target),b.presenter.emit(c[1],f,a),b.emit("form.submit",f)}.bind(this):function(a){a.preventDefault();var d=a.currentTarget.value||"";b.presenter.emit(c[1],d,f,a)}.bind(this),d.bind(c[0],a)})})},d.prototype.serializeForm=function(b){var d={},e=c(b);return"INPUT"!==e.get(0).tagName&&(e=e.find(":input")),e.serializeArray().forEach(function(b){a.dedotify(d,b.name,b.value)}),this.debug&&console.log("XQCore - Serialize form:",e,d),d},d.prototype.insert=function(a,b,d){var e=this,f=this.$el.find('.xq-scope[xq-path="'+a+'"]');f.length&&f.each(function(){var a=c(this).attr("xq-scope"),f=e.scopes[a]([d]),g=c(this).children();b>-1?(b>g.length-1&&(b=g.length-1),g.eq(b).before(f)):g.eq(b).after(f)})},d.prototype.update=function(){console.warn("XQCore doesn`t support update event yet")},d.prototype.append=function(a,b){this.insert(a,-1,b)},d.prototype.prepend=function(a,b){this.insert(a,0,b)},d.prototype.remove=function(a,b){var c=this.$el.find('.xq-scope[xq-path="'+a+'"]');c.children(":eq("+b+")").remove()},a.View=d}(XQCore),function(a){"use strict";a.undotify=function(a,b){return a&&(a=a.split("."),a.forEach(function(a){b=b[a]})),b},a.dedotify=function(a,b,c){"string"==typeof a&&(c=b,b=a,a={});var d=a;if(b){b=b.split(".");var e=b.length;b.forEach(function(b,d){return d===e-1?(a[b]=c,void 0):(a[b]||(a[b]={}),a=a[b],void 0)})}return a=c,d}}(XQCore),function(a){"use strict";var b=function(a){var b,d,e=[];return a instanceof RegExp?(d=a,b=a.toString()):(d=c(a,e),b=a),{re:d,src:a.toString(),keys:e}},c=function(a,b){return a=a.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push(e),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)"),new RegExp("^"+a+"$","i")},d=function(a,b){for(var c,d=0,e=a.length;e>d;++d){var f,g=a[d],h=g.re,i=g.keys,j=[],k={};if(c=h.exec(b)){for(f=1,e=c.length;e>f;++f){var l=i[f-1],m="string"==typeof c[f]?decodeURIComponent(c[f]):c[f];l?k[l]=m:j.push(m)}return{params:k,splats:j,route:g.src}}}},e=function(b){b=a.extend({debug:!1},b),this.debug=Boolean(b.debug),this.routes=[],this.routeMap={}};e.prototype.addRoute=function(a,c){if(!a)throw new Error(" route requires a path");if(!c)throw new Error(" route "+a.toString()+" requires a callback");var d=new b(a);d.fn=c,this.routes.push(d),this.routeMap[a]=c},e.prototype.match=function(a){var b=d(this.routes,a);return b&&(b.fn=this.routeMap[b.route]),b},e.prototype.fire=function(a,b){a=this.match(a),a&&a.fn(b)},a.Router=e}(XQCore),function(a){"use strict";var b=function(){this.__isReady=!1,this.__onReadyCallbacks=[],this.__eventEmitter=new a.Event};a.extend(b.prototype,new a.Logger),b.prototype.connect=function(a,b,c){var d=this;this.sockJS=new SockJS(a,null,b),console.log("Connect to socket server ",a,"using options:",b),this.sockJS.onopen=function(){console.log("Connection was successful!"),"function"==typeof c&&c(),d.setReady()}.bind(this),this.sockJS.onmessage=function(a){var b;try{b=JSON.parse(a.data)}catch(c){console.error("Could't parse socket message!",a.data)}console.log("Got message",b.eventName,b.data),d.__eventEmitter.emit(b.eventName,b.data)}.bind(this),this.sockJS.onclose=function(){console.log("Connection closed!")}.bind(this)},b.prototype.emit=function(a,b){this.ready(function(){console.log("Send message ",a,b),this.sockJS.send(JSON.stringify({eventName:a,data:b}))}.bind(this))},b.prototype.on=function(a,b){this.__eventEmitter.on(a,b)},b.prototype.once=function(a,b){this.__eventEmitter.once(a,b)},b.prototype.off=function(a,b){this.__eventEmitter.off(a,b)},b.prototype.ready=function(a){this.__isReady?a.call(this):this.__onReadyCallbacks.push(a)},b.prototype.setReady=function(){this.__isReady=!0,this.__onReadyCallbacks.forEach(function(a){a.call(this)}.bind(this)),this.__onReadyCallbacks=[]},a.Socket=b}(XQCore),function(a){"use strict";var b;b=function(b,c){a.Model.call(this,b,c),this.server=c.server||location.protocol+"//"+location.hostname,this.port=c.port||9999,this.path=c.path||"xqsocket/"+b,this.syncEnabled=!1},b.prototype=Object.create(a.Model.prototype),b.prototype.constructor=b,b.prototype.init=function(){a.Model.prototype.init.call(this),this.connectToSocket()},b.prototype.connectToSocket=function(){var b=this.server+":"+this.port+"/"+this.path;this.socket||(this.socket=new a.Socket,this.socket.connect(b))},b.prototype.register=function(a){var b=this,c=this.conf.syncWith||this.name.replace(/Model$/,"");this.syncEnabled=!!a,console.log("register model at server"),this.socket.emit("syncmodel.register",{name:c}),this.socket.on("syncmodel.change",function(a){var c={sync:!1},d=a.slice(1);switch(d.push(c),a[0]){case"replace":case"item":b.set.apply(b,d);break;case"append":b.append.apply(b,d);break;case"prepend":b.prepend.apply(b,d);break;case"insert":b.insert.apply(b,d);break;case"remove":b.remove.apply(b,d);break;default:b.warn("Unknown syncmodel event",a[0])}})},b.prototype.unregister=function(){var a=this.conf.syncWith||this.name.replace(/Model$/,"");this.socket.emit("syncmodel.unregister",{name:a}),this.socket.off("syncmodel.change")},b.prototype.emitRemote=function(a,b){this.socket.emit(a,b)},b.prototype.sync=function(){if(this.syncEnabled){var a=Array.prototype.slice.call(arguments);this.emitRemote("syncmodel.change",a)}},a.SyncModel=b}(XQCore);