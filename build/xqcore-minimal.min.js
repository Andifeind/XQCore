/*!
 * XQCore - +0.7.1-29
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2014 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2014-01-22
 */
var XQCore;(function(e,t){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery")):e.XQCore=t(e.jQuery)})(this,function(e){"use strict";return XQCore={version:"0.7.1-29",defaultRoute:"index",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire"},XQCore.extend=e.extend,XQCore.isEmptyObject=e.isEmptyObject,XQCore.isObjectId=function(e){return this.objectIdPattern.test(e)},XQCore._dump={},XQCore.dump=function(e){return XQCore._dump[e]?(console.log("[XQCore dump]",e,XQCore._dump[e]),XQCore._dump[e]):!1},XQCore.require=function(t){return"jquery"===t?e:void 0},XQCore}),function(e){"use strict";/*!
	 * EventEmitter v4.2.5 - git.io/ee
	 * Oliver Caldwell
	 * MIT license
	 * @preserve
	 */
function t(){}function i(e,t){for(var i=e.length;i--;)if(e[i].listener===t)return i;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=t.prototype;r.getListeners=function(e){var t,i,n=this._getEvents();if("object"==typeof e){t={};for(i in n)n.hasOwnProperty(i)&&e.test(i)&&(t[i]=n[i])}else t=n[e]||(n[e]=[]);return t},r.flattenListeners=function(e){var t,i=[];for(t=0;e.length>t;t+=1)i.push(e[t].listener);return i},r.getListenersAsObject=function(e){var t,i=this.getListeners(e);return i instanceof Array&&(t={},t[e]=i),t||i},r.addListener=function(e,t){var n,r=this.getListenersAsObject(e),s="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===i(r[n],t)&&r[n].push(s?t:{listener:t,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,t){var n,r,s=this.getListenersAsObject(e);for(r in s)s.hasOwnProperty(r)&&(n=i(s[r],t),-1!==n&&s[r].splice(n,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,i){var n,r,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=i.length;n--;)s.call(this,t,i[n]);else for(n in t)t.hasOwnProperty(n)&&(r=t[n])&&("function"==typeof r?s.call(this,n,r):o.call(this,n,r));return this},r.removeEvent=function(e){var t,i=typeof e,n=this._getEvents();if("string"===i)delete n[e];else if("object"===i)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var i,n,r,s,o=this.getListenersAsObject(e);for(r in o)if(o.hasOwnProperty(r))for(n=o[r].length;n--;)i=o[r][n],i.once===!0&&this.removeListener(e,i.listener),s=i.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.Event=t}(XQCore),function(e){"use strict";function t(e){return 1e3>e?e+" ms":6e4>e?Math.round(e/100)/10+" sec":Math.round(e/6e4)+" min "+Math.round(e%6e4/1e3)+" sec"}var i=function(){};i.prototype.log=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.log.apply(console,e))},i.prototype.warn=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.warn.apply(console,e))},i.prototype.error=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.error.apply(console,e))},i.prototype.timer=function(e){var i={start:null,stop:null,name:e,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",t(this.stop-this.start))}};return this.log("Start Timer",e),i.start=Date.now(),i},i.prototype.__scope={getHumanTime:t},e.Logger=i}(XQCore),function(e,t){"use strict";var i;i=function(i,n){"object"==typeof arguments[0]&&(n=i,i=n.name),this.debug=e.debug,n===t&&(n={}),this.__state="starting",this.customValidate=n.validate,delete n.validate,this.conf=n,this.name=(i?i.replace(/Model$/,""):"Nameless")+"Model",this._isValid=!1,this.properties={},this.schema=n.schema,this.defaults&&!e.isEmptyObject(this.defaults)&&this.set(this.defaults)},e.extend(i.prototype,new e.Event,new e.Logger),e.Sync&&e.extend(i.prototype,e.Sync.prototype),i.prototype.init=function(){var t=this,i=this.conf;"function"==typeof i?i.call(this,t):e.extend(this,i),this.debug&&(e._dump[this.name]=this),this.state("ready")},i.prototype.state=function(e){this.__state=e,this.emit("state."+e),this.emit("state.change",e)},i.prototype.getState=function(){return this.__state},i.prototype.set=function(t,i,n){var r,s={},o=this.get();if(n=n||{},null===arguments[0])s=arguments[1],this.log("Set data",s,o);else if("object"==typeof arguments[0])t=null,n=i||{},s=n.extend?e.extend(s,o,arguments[0]):arguments[0],this.log("Set data",s,o);else if("string"==typeof arguments[0]){s=e.extend({},this.get()),t=arguments[0];var a=arguments[1];if(e.dedotify(s,t,a),this.log("Set data",s,o),n=n||{},!this.customValidate&&n.validateOne&&(n.noValidation=!0,r=this.validateOne(this.schema[t],a),r.isValid===!1))return this.warn("Validate error in model.set",r),n.silent!==!0&&this.emit("validation.error",r,s),!1}else this.warn("Data are incorrect in model.set()",arguments);return n=n||{},!this.customValidate&&this.schema&&n.noValidation!==!0&&(r=this.validate(s),null!==r)?(this.warn("Validate error in model.set",r),n.silent!==!0&&this.emit("validation.error",r,s),!1):this.customValidate&&n.noValidation!==!0&&(r=this.customValidate(s),this.log("Using a custom validation which returns:",r),null!==r)?(this.warn("Validate error in model.set",r),this.emit("validation.error",r,s),!1):(this.properties=s,n.silent!==!0&&this.emit("data.change",s,o),!0)},i.prototype.get=function(i){return i===t?this.properties:e.undotify(i,this.properties)},i.prototype.has=function(e){return!!this.properties[e]},i.prototype.reset=function(){this.log("Reset model"),this.properties={}},i.prototype.append=function(e,t){1===arguments.length&&(t=e,e=null);var i=this.properties,n=!0;return e&&e.split(".").forEach(function(e){i=i[e]}),i instanceof Array?i.push(t):null===e?(this.properties=[t],i=this.get()):this.warn("Model.append requires an array. Dataset isn't an array",e),n&&this.emit("data.append",e,t),t},i.prototype.prepend=function(e,t){1===arguments.length&&(t=e,e=null);var i=this.properties,n=!0;return e&&e.split(".").forEach(function(e){i=i[e]}),i instanceof Array?i.unshift(t):null===e?(this.properties=[t],i=this.get()):this.warn("Model.append requires an array. Dataset isn't an array",e),n&&this.emit("data.prepend",e,t),t},i.prototype.remove=function(e,t){var i=this.properties,n=null;return e.split(".").forEach(function(e){i=i[e]}),i instanceof Array?(n=i.splice(t,1),n=n[0]||null):this.warn("Model.remove() doesn't work with Objects in model",this.name),n},i.prototype.search=function(t,i){var n;if(1===arguments.length?(i=t,t="",n=this.properties):n=e.undotify(t,this.properties),n)for(var r=0;n.length>r;r++){var s,o=n[r];for(var a in i)if(i.hasOwnProperty(a)){if(!o[a]||o[a]!==i[a]){s=!1;break}s=!0}if(s===!0)return o}return null},i.prototype.sortBy=function(t,i){1===arguments.length&&(i=t,t=null);var n,r=e.undotify(t,this.properties);return r.sort(function(t,r){n=-1;for(var s in i)if(i.hasOwnProperty(s)){if(n=(e.undotify(s,t)+"").localeCompare(e.undotify(s,r)+""),0===n)continue;-1===i[s]&&(n=n>0?-1:1);break}return n}),this.set(t,r),r},i.prototype.validate=function(i,n){var r=[];return n=n||this.schema,n&&Object.keys(n).forEach(function(s){if("object"==typeof i[s]&&n[s].type===t){var o=this.validate(e.extend({},i[s]),e.extend({},n[s]));return Array.isArray(o)&&o.length>0&&(r=r.concat(o)),t}var a=this.validateOne(n[s],i[s]);a.isValid===!0?i[s]=a.value:(a.error.property=s,r.push(a.error))}.bind(this)),0===r.length?(this._isValid=!0,null):(this._isValid=!1,r)},i.prototype.validateOne=function(e,i){var n=null,r="function"==typeof e.type?typeof e.type():e.type.toLowerCase();if(""===i&&e.noEmpty===!0&&(i=t),i!==t&&null!==i||!e.default||(i=e.default),i===t||null===i||""===i)e.required===!0&&(n={msg:"Property is undefined or null, but it's required",errCode:10});else if("string"===r)e.convert&&"number"==typeof i&&(i+=""),r!==typeof i?n={msg:"Property type is a "+typeof i+", but a string is required",errCode:11}:e.min&&e.min>i.length?n={msg:"String length is too short",errCode:12}:e.max&&e.max<i.length?n={msg:"String length is too long",errCode:13}:e.match&&!e.match.test(i)&&(n={msg:"String doesn't match regexp",errCode:14});else if("number"===r)e.convert&&"string"==typeof i&&(i=parseInt(i,10)),r!==typeof i?n={msg:"Property type is a "+typeof i+", but a number is required",errCode:21}:e.min&&e.min>i?n={msg:"Number is too low",errCode:22}:e.max&&i>e.max&&(n={msg:"Number is too high",errCode:23});else if("date"===r){if(i){var s=Date.parse(i);isNaN(s)&&(n={msg:"Property isn't a valid date",errCode:31})}}else"array"===r?Array.isArray(i)?e.min&&e.min>i.length?n={msg:"Array length is "+i.length+" but must be greater than "+e.min,errCode:42}:e.max&&e.max<i.length&&(n={msg:"Array length is "+i.length+" but must be lesser than "+e.max,errCode:43}):n={msg:"Property type is a "+typeof i+", but an array is required",errCode:41}:"object"===r?"object"!=typeof i&&(n={msg:"Property isn't a valid object",errCode:51}):"objectid"===r?/^[a-zA-Z0-9]{24}$/.test(i)||(n={msg:"Property isn't a valid objectId",errCode:52}):"boolean"===r&&"boolean"!=typeof i&&(n={msg:"Property isn't a valid boolean",errCode:61});return null===n?n={isValid:!0,value:i,error:null}:(this.warn("Validation error on property",n,"Data:",i),n={isValid:!1,value:i,error:n}),n},i.prototype.isValid=function(){return this._isValid},i.prototype.setData=function(e){return this.set(e,{extend:!0})},e.Model=i}(XQCore);