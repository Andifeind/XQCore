/*!
 * XQCore - +0.8.0-18
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2014 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2014-05-19
 */
var XQCore;!function(a,b){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],b):"undefined"!=typeof module&&module.exports?module.exports=b(require("jquery")):a.XQCore=b(a.jQuery)}(this,function(a){"use strict";return XQCore={version:"0.8.0-18",defaultRoute:"index",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire"},XQCore.extend=a.extend,XQCore.isEmptyObject=a.isEmptyObject,XQCore.isPlainObject=a.isPlainObject,XQCore.isFunction=a.isFunction,XQCore.isObjectId=function(a){return this.objectIdPattern.test(a)},XQCore._dump={},XQCore.dump=function(a){return XQCore._dump[a]?(console.log("[XQCore dump]",a,XQCore._dump[a]),XQCore._dump[a]):!1},XQCore.require=function(b){return"jquery"===b?a:void 0},XQCore}),function(a){"use strict";/*!
	 * EventEmitter v4.2.5 - git.io/ee
	 * Oliver Caldwell
	 * MIT license
	 * @preserve
	 */
function b(){}function c(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function d(a){return function(){return this[a].apply(this,arguments)}}var e=b.prototype;e.getListeners=function(a){var b,c,d=this._getEvents();if("object"==typeof a){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},e.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},e.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},e.addListener=function(a,b){var d,e=this.getListenersAsObject(a),f="object"==typeof b;for(d in e)e.hasOwnProperty(d)&&-1===c(e[d],b)&&e[d].push(f?b:{listener:b,once:!1});return this},e.on=d("addListener"),e.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},e.once=d("addOnceListener"),e.defineEvent=function(a){return this.getListeners(a),this},e.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},e.removeListener=function(a,b){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=c(f[e],b),-1!==d&&f[e].splice(d,1));return this},e.off=d("removeListener"),e.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},e.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},e.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},e.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if("object"===c)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},e.removeAllListeners=d("removeEvent"),e.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},e.trigger=d("emitEvent"),e.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},e.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},a.Event=b}(XQCore),function(a){"use strict";function b(a){return 1e3>a?a+" ms":6e4>a?Math.round(a/100)/10+" sec":Math.round(a/6e4)+" min "+Math.round(a%6e4/1e3)+" sec"}var c=function(){};c.prototype.log=function(){var a;this.debug&&(a=Array.prototype.slice.call(arguments),a.unshift("["+this.name+"]"),console.log.apply(console,a))},c.prototype.warn=function(){var a;this.debug&&(a=Array.prototype.slice.call(arguments),a.unshift("["+this.name+"]"),console.warn.apply(console,a))},c.prototype.error=function(){var a;this.debug&&(a=Array.prototype.slice.call(arguments),a.unshift("["+this.name+"]"),console.error.apply(console,a))},c.prototype.timer=function(a){var c={start:null,stop:null,name:a,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",b(this.stop-this.start))}};return this.log("Start Timer",a),c.start=Date.now(),c},c.prototype.__scope={getHumanTime:b},a.Logger=c}(XQCore),function(a,b){"use strict";var c;c=function(c,d){"object"==typeof arguments[0]&&(d=c,c=d.name),this.debug=a.debug,d===b&&(d={}),this.__state="starting",this.__unfiltered={},this.customValidate=d.validate,delete d.validate,this.conf=d,this.name=(c?c.replace(/Model$/,""):"Nameless")+"Model",this._isValid=!1,this.properties={},this.schema=d.schema},a.extend(c.prototype,new a.Event,new a.Logger),a.Sync&&a.extend(c.prototype,a.Sync.prototype),c.prototype.init=function(){var b=this,c=this.conf;"function"==typeof c?c.call(this,b):a.extend(this,c),this.debug&&(a._dump[this.name]=this),this.defaults&&!a.isEmptyObject(this.defaults)&&this.set(this.defaults),this.state("ready")},c.prototype.state=function(a){this.__state=a,this.emit("state."+a),this.emit("state.change",a)},c.prototype.getState=function(){return this.__state},c.prototype.set=function(b,c,d){var e,f={},g=this.get(),h=!1,i=!1;if(d=d||{},null===arguments[0])f=arguments[1],i=!0,this.log("Set data",f,g);else if("object"==typeof arguments[0])b=null,d=c||{},f=d.extend?a.extend(f,g,arguments[0]):arguments[0],i=!0,this.log("Set data",f,g);else if("string"==typeof arguments[0]){if(f=a.extend({},this.get()),h=!0,a.dedotify(f,b,c),this.log("Set data",f,g),d=d||{},!this.customValidate&&d.validateOne&&(d.noValidation=!0,e=this.validateOne(this.schema[b],c),e.isValid===!1))return this.warn("Validate error in model.set",e),d.silent!==!0&&this.emit("validation.error",e,f),!1}else this.warn("Data are incorrect in model.set()",arguments);return d=d||{},!this.customValidate&&this.schema&&d.noValidation!==!0&&(e=this.validate(f),null!==e)?(this.warn("Validate error in model.set",e),d.silent!==!0&&this.emit("validation.error",e,f),!1):this.customValidate&&d.noValidation!==!0&&(e=this.customValidate(f),this.log("Using a custom validation which returns:",e),null!==e)?(this.warn("Validate error in model.set",e),this.emit("validation.error",e,f),!1):(this.properties=f,d.silent!==!0&&(i?("function"==typeof this.sync&&d.sync!==!1&&this.sync("replace",f),this.emit("data.replace",f,g)):h&&("function"==typeof this.sync&&d.sync!==!1&&this.sync("item",b,c),this.emit("data.item",b,c)),this.emit("data.change",f,g)),!0)},c.prototype.get=function(c){return c===b?this.properties:a.undotify(c,this.properties)},c.prototype.has=function(a){return!!this.properties[a]},c.prototype.reset=function(){this.log("Reset model"),this.properties={}},c.prototype.append=function(b,c,d){var e=a.undotify(b,this.properties);if(d=d||{},e instanceof Array)e.push(c);else if("undefined"==typeof e)a.dedotify(this.properties,b,[c]);else{if("object"!=typeof e||b||!a.isEmptyObject(this.properties))return this.error("Model.append requires an array. Dataset isn't an array. Path: ",b),void 0;this.properties=[c]}d.silent!==!0&&("function"==typeof this.sync&&d.sync!==!1&&this.sync("append",b,c),this.emit("data.append",b,c),this.emit("data.change",this.properties))},c.prototype.prepend=function(b,c,d){var e=a.undotify(b,this.properties);if(d=d||{},e instanceof Array)e.unshift(c);else if("undefined"==typeof e)a.dedotify(this.properties,b,[c]);else{if("object"!=typeof e||b||!a.isEmptyObject(this.properties))return this.error("Model.prepend requires an array. Dataset isn't an array. Path: ",b),void 0;this.properties=[c]}d.silent!==!0&&("function"==typeof this.sync&&d.sync!==!1&&this.sync("prepend",b,c),this.emit("data.prepend",b,c),this.emit("data.change",this.properties))},c.prototype.insert=function(b,c,d,e){var f=a.undotify(b,this.properties);if(e=e||{},f instanceof Array)f.splice(c,0,d);else if("undefined"==typeof f)a.dedotify(this.properties,b,[d]);else{if("object"!=typeof f||b||!a.isEmptyObject(this.properties))return this.error("Model.insert requires an array. Dataset isn't an array. Path: ",b),void 0;this.properties=[d]}e.silent!==!0&&("function"==typeof this.sync&&e.sync!==!1&&this.sync("insert",b,1,d),this.emit("data.insert",b,c,d),this.emit("data.change",this.properties))},c.prototype.remove=function(b,c,d){var e=a.undotify(b,this.properties),f=null;if(d=d||{},e instanceof Array)f=e.splice(c,1);else if("object"==typeof e)return this.error("Model.remove requires an array. Dataset isn't an array. Path: ",b),void 0;return f&&d.silent!==!0&&("function"==typeof this.sync&&d.sync!==!1&&this.sync("remove",b,c),this.emit("data.remove",b,c,f[0]),this.emit("data.change",this.properties)),f},c.prototype.search=function(b,c){var d;if(1===arguments.length?(c=b,b="",d=this.properties):d=a.undotify(b,this.properties),d)for(var e=0;e<d.length;e++){var f,g=d[e];for(var h in c)if(c.hasOwnProperty(h)){if(!g[h]||g[h]!==c[h]){f=!1;break}f=!0}if(f===!0)return g}return null},c.prototype.sortBy=function(b,c){1===arguments.length&&(c=b,b=null);var d,e=a.undotify(b,this.properties);return e.sort(function(b,e){d=-1;for(var f in c)if(c.hasOwnProperty(f)){if(d=String(a.undotify(f,b)).localeCompare(String(a.undotify(f,e))),0===d)continue;-1===c[f]&&(d=d>0?-1:1);break}return d}),this.set(b,e),e},c.prototype.filter=function(b,c,d,e){if(1===arguments.length&&(e=b,b=null),"string"==typeof e){if(!this.__registeredFilter[e])throw new Error("Filter "+e+" not registered!");e=this.__registeredFilter[e]}for(var f=a.undotify(b,this.__unfiltered.data||this.properties),g=[],h=0,i=f.length;i>h;h++)e(c,d,f[h])&&g.push(f[h]);return this.__unfiltered={path:b,data:f},this.set(b,g),g},c.prototype.filterReset=function(a){this.__unfiltered&&this.set(this.__unfiltered.path,this.__unfiltered.data,a)},c.prototype.validate=function(b,c){var d=[];return c=c||this.schema,c&&Object.keys(c).forEach(function(e){if("object"==typeof b[e]&&"undefined"==typeof c[e].type){var f=this.validate(a.extend({},b[e]),a.extend({},c[e]));return Array.isArray(f)&&f.length>0&&(d=d.concat(f)),void 0}var g=this.validateOne(c[e],b[e]);g.isValid===!0?b[e]=g.value:(g.error.property=e,d.push(g.error))}.bind(this)),0===d.length?(this._isValid=!0,null):(this._isValid=!1,d)},c.prototype.validateOne=function(a,c){var d=null,e="function"==typeof a.type?typeof a.type():a.type.toLowerCase();if(""===c&&a.noEmpty===!0&&(c=b),c!==b&&null!==c||!a.default||(c=a.default),c===b||null===c||""===c)a.required===!0&&(d={msg:"Property is undefined or null, but it's required",errCode:10});else if("string"===e)a.convert&&"number"==typeof c&&(c=String(c)),e!==typeof c?d={msg:"Property type is a "+typeof c+", but a string is required",errCode:11}:a.min&&a.min>c.length?d={msg:"String length is too short",errCode:12}:a.max&&a.max<c.length?d={msg:"String length is too long",errCode:13}:a.match&&!a.match.test(c)&&(d={msg:"String doesn't match regexp",errCode:14});else if("number"===e)a.convert&&"string"==typeof c&&(c=parseInt(c,10)),e!==typeof c?d={msg:"Property type is a "+typeof c+", but a number is required",errCode:21}:a.min&&a.min>c?d={msg:"Number is too low",errCode:22}:a.max&&a.max<c&&(d={msg:"Number is too high",errCode:23});else if("date"===e){if(c){var f=Date.parse(c);isNaN(f)&&(d={msg:"Property isn't a valid date",errCode:31})}}else"array"===e?Array.isArray(c)?a.min&&a.min>c.length?d={msg:"Array length is "+c.length+" but must be greater than "+a.min,errCode:42}:a.max&&a.max<c.length&&(d={msg:"Array length is "+c.length+" but must be lesser than "+a.max,errCode:43}):d={msg:"Property type is a "+typeof c+", but an array is required",errCode:41}:"object"===e?"object"!=typeof c&&(d={msg:"Property isn't a valid object",errCode:51}):"objectid"===e?/^[a-zA-Z0-9]{24}$/.test(c)||(d={msg:"Property isn't a valid objectId",errCode:52}):"boolean"===e&&"boolean"!=typeof c&&(d={msg:"Property isn't a valid boolean",errCode:61});return null===d?d={isValid:!0,value:c,error:null}:(this.warn("Validation error on property",d,"Data:",c),d={isValid:!1,value:c,error:d}),d},c.prototype.isValid=function(){return this._isValid},c.prototype.setData=function(a){return this.set(a,{extend:!0})},c.registerFilter=function(a,b){if("function"!=typeof b)throw new Error("Filter function isn't a function");var d="function"==typeof this?c.prototype:this;d.__registeredFilter[a]=b},c.prototype.registerFilter=c.registerFilter,c.prototype.__registeredFilter={quicksearch:function(b,c,d){var e=a.undotify(b,d),f=new RegExp(c.replace(/[a-z0-9äüöß]/g,"$&.*"),"i");return f.test(e)}},a.Model=c}(XQCore);