var CoreRouter=function(e){var t,n;return t=Backbone.Router.extend(e),n=new t,Backbone.history.start(),n},CorePresenter=function(){var e=function(e){var t=this;this.root="/",this.debug=!1,e=e||{},$.extend(this,e,new CoreEvent,new CoreLogger),this.name=(e.name||"Nameless")+"Presenter",this.eventCallbacks={},this.log("Initialize presenter with conf:",e),this.init(),e.routes&&(window.addEventListener("popstate",function(n){t.log("popstate event recived",n);if(!n.state)return;var r=n.state.tag,i=n.state.url;typeof e[r]=="function"&&e[r].call(t,n.state.data)},!1),window.addEventListener("hashchange",function(n){t.log("hashchange event recived",n,location.hash);var r=location.hash.substring(1);typeof e[r]=="function"&&(t.log("Call func",e[r]),e[r].call(t))},!1))};return e.prototype.init=function(){},e.prototype.viewInit=function(e){console.log("I",e.name,e)},e.prototype.pushState=function(e,t,n){history.pushState(e,t,n)},e}(),CoreModel=function(e,t,n,r){var i;return i=function(e){e===r&&(e={}),n.extend(this,e,new CoreEvent,new CoreLogger),this.name=(e.name||"Nameless")+"Model",this.debug=Boolean(e.debug),this.attributes={},this._isValid=!1,e.validate&&(this.validate=function(t){var n;this._isValid=!1,n=e.validate.call(this,t);if(!n||typeof n=="object"&&Object.keys(n).length===0)this._isValid=!0;return n}.bind(this)),this.init()},i.prototype.init=function(){},i.prototype.validate=function(){},i.prototype.isValid=function(){return this._isValid},i.prototype.set=function(){var e={},t;typeof arguments[0]=="object"?(n.extend(e,arguments[0]),this.log("Set data",arguments[0])):typeof arguments[0]=="string"?(e[arguments[0]]=arguments[1],this.log("Set data",arguments[0],arguments[1])):this.warn("Data are incorrect in model.set()",arguments);if(this.validate){t=this.validate(e);if(t)return this.warn("Validate error in model.set",t),t}n.extend(this.attributes,e)},i.prototype.get=function(e){return e===r?this.attributes:this.attributes[e]},i.prototype.has=function(e){return!!this.attributes[e]},i.prototype.reset=function(){this.log("Reset model"),this.attributes={}},i.prototype.send=function(e,t){var r;e=e||"POST",r=this.get();if(!this.server)return this.error("Can not send an ajax request! You must define a server URL first."),!1;this.log("Sending an ajax call to ",this.server,"with data: ",r),n.ajax({url:this.server,method:e,data:r,success:function(e,n,r){t.call(this,null,e,n,r)}.bind(this),error:function(e,n,r){t.call(this,{type:n,http:r},null,n,e)}.bind(this)})},i}(window,document,jQuery),CoreView=function(){var e=function(e,t){var n=this;t=t||{events:null},$.extend(this,t,new CoreEvent,new CoreLogger),this.name=(t.name||"Nameless")+"View",this.presenter=e,this.debug=Boolean(t.debug),this.container=$(t.container),this.container.length>0?(window.addEventListener("resize",function(e){n.resize(e)},!1),this.log("Initialize view with conf:",t),this.log("  ... using Presenter:",this.presenter.name),this.log("  ... using Container:",this.container),this.events?Object.keys(this.events).forEach(function(e){var t=e.split(" ",2),n,r=t[0],i=t[1]||null,s=this;t.length===1||t.length===2?(n=this.presenter.events[this.events[e]],typeof n=="function"?(this.container.on(r,function(e){var t=null,r=null;e.type==="submit"&&(t=CoreUtil.serializeForm(e.target),r=$(e.target).data()),n.call(s.presenter,e,r,t)}),this.log("Register Event:",r,"on selector",i,"with callback",n)):this.warn("Event handler callback not defined in Presenter:",this.events[e])):this.warn("Incorect event configuration",e)},this):this.warn("No view events defined"),this.init(),this.presenter.viewInit(this)):this.error("Can't initialize View, Container not found!",this.container)};return e.prototype.init=function(){},e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype.render=function(e){this.log("Render view template",this.template,"with data:",e);var t=Handlebars.compile(this.template);this.container.html(t(e))},e.prototype.resize=function(){},e}(),CoreEvent=function(){function n(e,t){this.objectName="CoreEvent";var n=this.store.length,r=0,i;for(;r<n;r++){i=this.store[r];if(e===null||e===i.event&&t===null||t===i.callback)return i}return null}var e,t;return t=function(e){this.store=[]},e=new EventEmitter,t.prototype.emit=function(t,n){return this.debug&&console.debug("Akonda Core - Emit event",t,n),e.emitEvent(t,[n])},t.prototype.on=function(t,n){return this.debug&&console.debug("Akonda Core - Add listener",t,n),e.addListener(t,n)},t.prototype.once=function(t,n){var r=function(){return e.removeListener(t,n),n.call(null,arguments),!0};return this.debug&&console.debug("Akonda Core - Add once listener",t,n),e.addListener(t,r)},t.prototype.off=function(t,n){return this.debug&&console.debug("Akonda Core - Remove listener",t,n),n===undefined?e.removeEvent(t):e.removeListener(t,n)},t}(),CoreLogger=function(e){function t(e){return e<1e3?e+" ms":e<6e4?Math.round(e/100)/10+" sec":Math.round(e/6e4)+" min "+Math.round(e%6e4/1e3)+" sec"}function n(){var e,t;e=localStorage.get("core-onscreen-console")||{pos:"bottom"},t='<div id="CoreLogger-OnScreenConsole">			</div>'}var r=function(){};return r.prototype.log=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.log.apply(console,e))},r.prototype.warn=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.warn.apply(console,e))},r.prototype.error=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.error.apply(console,e))},r.prototype.timer=function(e){var n={start:null,stop:null,name:e,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",t(this.stop-this.start))}};return this.log("Start Timer",e),n.start=Date.now(),n},r.prototype.timerEnd=function(e){},r.prototype.__scope={getHumanTime:t},r}(),CoreUtil=function(e){var t={name:"CoreUtil",debug:!0};return t.serializeForm=function(t){var n={},r=e(t);return r.get(0).tagName!=="INPUT"&&(r=r.find(":input")),r.serializeArray().forEach(function(e){n[e.name]=e.value}),this.debug&&console.log("Akonda Core - Serialize form:",r,n),n},t.checkLength=function(e,t,n){if(typeof e=="Number"){if(e<t)return"num-to-small";if(e>n)return"num-to-large"}else{console.log(e,e.length);if(e.length<t)return"str-to-short";if(e.length>n)return"str-to-long"}},t.checkEqual=function(e,t){if(e!==t)return"str-not-equal"},t.checkEmail=function(e){if(!/^\S+\@\S+\.[a-z]{2,10}$/.test(e))return"invalid-email"},t}(jQuery);