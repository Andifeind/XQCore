var XQCore={version:.2,defaultRoute:"default",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent"};window.include||(window.include=function(e,t){var n=location.protocol+"//"+location.host+e;$.ajax({url:n,dataType:"script",success:t,async:!1})},window.preload=function(e){var t,n=location.protocol+"//"+location.host+e;return $.ajax({url:n,dataType:"text",success:function(e){t=e},async:!1}),{execute:function(e){eval.call(e||window,t)}}}),XQCore._dump={},XQCore.dump=function(e){return XQCore._dump[e]?(console.log("[XQCore dump]",e,XQCore._dump[e]),XQCore._dump[e]):!1},XQCore.Event=function(){var e,t=function(){"use strict";function e(){}function t(e,t){if(i)return t.indexOf(e);for(var n=t.length;n--;)if(t[n]===e)return n;return-1}var n=e.prototype,i=Array.prototype.indexOf?!0:!1;return n.getListeners=function(e){var t=this._events||(this._events={});return t[e]||(t[e]=[])},n.addListener=function(e,n){var i=this.getListeners(e);return-1===t(n,i)&&i.push(n),this},n.removeListener=function(e,n){var i=this.getListeners(e),r=t(n,i);return-1!==r&&(i.splice(r,1),0===i.length&&(this._events[e]=null)),this},n.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},n.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},n.manipulateListeners=function(e,t,n){var i,r,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"==typeof t)for(i in t)t.hasOwnProperty(i)&&(r=t[i])&&("function"==typeof r?o.call(this,i,r):s.call(this,i,r));else for(i=n.length;i--;)o.call(this,t,n[i]);return this},n.removeEvent=function(e){return e?this._events[e]=null:this._events=null,this},n.emitEvent=function(e,t){for(var n,i=this.getListeners(e),r=i.length;r--;)n=t?i[r].apply(null,t):i[r](),n===!0&&this.removeListener(e,i[r]);return this},e}();return e=function(){this.store=[],this.ee=new t},e.prototype.emit=function(e,t){return this.debug&&console.debug("XQCore - Emit event",e,t),this.ee.emitEvent(e,[t],this)},e.prototype.on=function(e,t){return this.debug&&console.debug("XQCore - Add listener",e,t,this),this.ee.addListener(e,t)},e.prototype.once=function(e,t){var n=function(){return this.ee.removeListener(e,t),t.call(null,arguments),!0};return this.debug&&console.debug("XQCore - Add once listener",e,t),this.ee.addListener(e,n)},e.prototype.off=function(e,t){return this.debug&&console.debug("XQCore - Remove listener",e,t),void 0===t?this.ee.removeEvent(e):this.ee.removeListener(e,t)},e.prototype.getListeners=function(e){return this.ee.getListeners(e)},e}(),XQCore.Logger=function(){function e(e){return 1e3>e?e+" ms":6e4>e?Math.round(e/100)/10+" sec":Math.round(e/6e4)+" min "+Math.round(e%6e4/1e3)+" sec"}var t=function(){};return t.prototype.log=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.log.apply(console,e))},t.prototype.warn=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.warn.apply(console,e))},t.prototype.error=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.error.apply(console,e))},t.prototype.timer=function(t){var n={start:null,stop:null,name:t,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",e(this.stop-this.start))}};return this.log("Start Timer",t),n.start=Date.now(),n},t.prototype.timerEnd=function(){},t.prototype.__scope={getHumanTime:e},t}(),XQCore.GetSet=function(e,t,n,i){var r=function(e){this.properties={},this._isValid=!1,e&&(this.schema=e.schema,this.debug=Boolean(e.debug)),this.name="GetSet",n.extend(this,new XQCore.Logger),n.extend(this,new XQCore.Event)},o=function(e,t){return e&&(e=e.split("."),e.forEach(function(e){t=t[e]})),t};return r.prototype.set=function(){var e,t,i={},r=this.get();if(Array.isArray(arguments[0]))i=Array.prototype.slice.call(arguments[0]);else if("object"==typeof arguments[0])i=n.extend(r,arguments[0]),this.log("Set data",arguments[0],i);else if("string"==typeof arguments[0]){i=this.get(),t=arguments[0];var o=arguments[1];i[t]=o,this.log("Set data",arguments[0],arguments[1],i)}else this.warn("Data are incorrect in getset.set()",arguments);return this.schema&&(e=this.validate(i),null!==e)?(this.warn("Validate error in getset.set",e),this.emit("validation.error",e),!1):this.customValidate&&(console.log("Use custom validation",this.customValidate),e=this.customValidate(i),null!==e)?(this.warn("Validate error in getset.set",e),this.emit("validation.error",e),!1):(this.properties=i,this.emit("data.change",i,r),t&&this.emit("change."+t,i[t]),!0)},r.prototype.get=function(e){return e===i?this.properties:this.properties[e]},r.prototype.has=function(e){return!!this.properties[e]},r.prototype.reset=function(){this.log("Reset getset"),this.properties={}},r.prototype.append=function(e,t){var i=this.properties;return e.split(".").forEach(function(e){i=i[e]}),i instanceof Array?i.push(t):i=n.extend(i,t),t},r.prototype.prepend=function(e,t){var i=this.properties;return e.split(".").forEach(function(e){i=i[e]}),i instanceof Array?i.unshift(t):i=n.extend(t,i),t},r.prototype.remove=function(e,t){var n=this.properties,i=null;return e.split(".").forEach(function(e){n=n[e]}),n instanceof Array?(i=n.splice(t,1),i=i[0]||null):this.warn("getset.remove() doesn't work with Objects in getset",this.name),i},r.prototype.search=function(e,t){var n=o(e,this.properties);if(n)for(var i=0;n.length>i;i++){var r,s=n[i];for(var a in t)if(t.hasOwnProperty(a)){if(!s[a]||s[a]!==t[a]){r=!1;break}r=!0}if(r===!0)return s}return null},r.prototype.validate=function(e){var t=[];return this.schema&&Object.keys(this.schema).forEach(function(n){var i=this.validateOne(n,e[n]);null!==i&&t.push(i)}.bind(this)),0===t.length?(this._isValid=!0,null):(this._isValid=!1,t)},r.prototype.validateOne=function(e,t){var n=null,r=this.schema[e];if(console.log("Schema",r,r.match),t!==i&&null!==t||!r.default||(t=r.default),t!==i&&null!==t&&""!==t||r.required!==!0)if("string"===r.type)r.type!==typeof t?n={property:e,msg:"Property type is a "+typeof t+", but a string is required",errCode:11}:r.min&&r.min>t.length?n={property:e,msg:"String length is too short",errCode:12}:r.max&&r.max<t.length?n={property:e,msg:"String length is too long",errCode:13}:r.match&&!r.match.test(t)&&(n={property:e,msg:"String doesn't match regexp",errCode:14});else if("number"===r.type)r.convert&&"string"==typeof t&&(t=parseInt(t,10)),r.type!==typeof t?n={property:e,msg:"Property type is a "+typeof t+", but a number is required",errCode:21}:r.min&&r.min>t?n={property:e,msg:"Number is too low",errCode:22}:r.max&&t>r.max&&(n={property:e,msg:"Number is too high",errCode:23});else if("date"===r.type){if(t){var o=Date.parse(t);isNaN(o)&&(n={property:e,msg:"Property isn't a valid date",errCode:31})}}else"array"===r.type?Array.isArray(t)?r.min&&r.min>t.length?n={property:e,msg:"Array length is "+t.length+" but must be greater than "+r.min,errCode:42}:r.max&&r.max<t.length&&(n={property:e,msg:"Array length is "+t.length+" but must be lesser than "+r.max,errCode:43}):n={property:e,msg:"Property type is a "+typeof t+", but an array is required",errCode:41}:"object"===r.type?"object"!=typeof t&&(n={property:e,msg:"Property isn't a valid object",errCode:51}):"boolean"===r.type&&"object"!=typeof t&&(n={property:e,msg:"Property isn't a valid boolean",errCode:61});else n={property:e,msg:"Property is undefined or null, but it's required",errCode:10};return null!==n&&this.warn("Validation error on property",e,n,"Data:",t),n},r.prototype.isValid=function(){return this._isValid},r}(window,document,jQuery),XQCore.Presenter=function(){var e=function(e){this.root="/",this.debug=!1,this.routes=[],e=e||{},this.customInit=e.init,this.conf=e,delete e.init,$.extend(this,e,new XQCore.Event,new XQCore.Logger),this.name=(e.name||"Nameless")+"Presenter",this.eventCallbacks={},this.lastShownView=null,this.registeredViews=[],this.fireViewInit=function(e){var t=!0;this.registeredViews.forEach(function(n){e===n.view&&(n.isReady=!0),n.isReady===!1&&(t=!1)}),this.viewInit(e),t===!0&&this.emit("views.ready")},this.registerView=function(e){var t;if(e instanceof Array)for(t=0;e.length>t;t++)this.registeredViews.push({view:e[t],isReady:!1});else this.registeredViews.push({view:e,isReady:!1})}};return e.prototype.init=function(e){var t,n=this,i=this.conf;if(i.routes&&(this.Router=new XQCore.Router,Object.keys(i.routes).forEach(function(e){var t=this.routes[e];"string"==typeof t&&(t=this[t]),"function"==typeof t?this.Router.addRoute(e,t):this.warn("Router callback isn't a function",t,"of route",e)}.bind(this)),window.addEventListener("popstate",function(e){n.log("popstate event recived",e);var t=XQCore.defaultRoute;if(XQCore.html5Routes){var i=RegExp("^"+n.root);t=location.pathname.replace(i,"")}else/^#![a-zA-Z0-9]+/.test(location.hash)&&(t=location.hash.substr(2));if(t=n.Router.match(t)){var r=e.state||t.params;XQCore.callerEvent&&(r[XQCore.callerEvent]="popstate"),n.log("Trigger route",t,r),t.fn.call(n,r)}},!1),this.on("views.ready",function(){var e=XQCore.defaultRoute;if(/^#![a-zA-Z0-9]+/.test(location.hash)&&(e=location.hash.substr(2)),e=n.Router.match(e)){var t=e.params;XQCore.callerEvent&&(t[XQCore.callerEvent]="pageload"),n.log("Trigger route",e,t),e.fn.call(n,e.params)}})),"function"==typeof this.customInit&&this.customInit.call(this),console.log("views",e),e instanceof Array)for(t=0;e.length>t;t++)this.registerView(e[t]);else e&&this.registerView(e);this.registeredViews.forEach(function(e){e.view.init(n)})},e.prototype.viewInit=function(){},e.prototype.pushState=function(e,t){var n=XQCore.html5Routes||"/"===t.charAt(0)?"":XQCore.hashBang;t=n+t,history.pushState(e,"",t||null),this.log("Update history with pushState",e,t)},e.prototype.replaceState=function(e,t){var n=XQCore.html5Routes||"/"===t.charAt(0)?"":XQCore.hashBang;t=n+t,history.replaceState(e,"",t||null),this.log("Update history with replaceState",e,t)},e.prototype.navigateTo=function(e,t){var n=this.Router.match(e);n&&(XQCore.callerEvent&&(t=t||{},t[XQCore.callerEvent]="redirect"),n.fn.call(this,t)),this.log("Navigate to",e,t)},e.prototype.getView=function(e){var t,n;for(t=0;this.registeredViews.length>t;t++)if(n=this.registeredViews[t].view,n.name===e)return n;return null},e.prototype.showView=function(e,t){var n=this.getView(e+"View");return n?(XQCore.callerEvent&&"popstate"!==t[XQCore.callerEvent]&&XQCore.callerEvent&&"pageload"!==t[XQCore.callerEvent]&&this.pushState(t||null,n.url),this.log("Show view:",e,t),this.log("Hide view:",this.lastShownView),this.lastShownView!==n&&(this.lastShownView&&"function"==typeof this.lastShownView.hide?(this.lastShownView.hide(),n.show()):n.show(!0)),undefined):(this.warn("View not defined!",e),undefined)},e}(),XQCore.Model=function(e,t,n,i){var r;return r=function(e){e===i&&(e={}),this.customInit=e.init,delete e.init,this.customValidate=e.validate,delete e.validate,this.conf=e,n.extend(this,e,new XQCore.Logger),n.extend(this,new XQCore.Event),this.name=(e.name||"Nameless")+"Model",this.debug=Boolean(e.debug),this.properties={},this.defaults&&!n.isEmptyObject(this.defaults)&&this.set(this.defaults),this.init()},n.extend(r.prototype,new XQCore.GetSet),r.prototype.init=function(){this.debug&&(XQCore._dump[this.name]=this),"function"==typeof this.customInit&&this.customInit.call(this)},r.prototype.onSend=function(e){return e},r.prototype.send=function(e,t,r){"function"==typeof t?(r=t,t=this.get()):t===i&&(t=this.get()),e===i&&(e="POST"),"function"==typeof this.onSend&&(t=this.onSend.call(this,t)),this.log("Sending an ajax call to ",this.server,"with data: ",t),n.ajax({url:this.server,type:e,data:t,success:function(e,t,n){"function"==typeof r&&r.call(this,null,e,t,n)}.bind(this),error:function(e,t,n){"function"==typeof r&&r.call(this,{type:t,http:n},null,t,e)}.bind(this)})},r.prototype.sendPOST=function(e,t){this.send("POST",e,t)},r.prototype.sendGET=function(e,t){this.send("GET",e,t)},r.prototype.sendPUT=function(e,t){this.send("PUT",e,t)},r.prototype.sendDELETE=function(e,t){this.send("DELETE",e,t)},r.prototype.ready=function(e){e===!0?(Array.isArray(this.__callbacksOnReady)&&(this.log("Trigger ready state"),this.__callbacksOnReady.forEach(function(e){e.call(this)}.bind(this))),this.__isReady=!0,delete this.__callbacksOnReady):"function"==typeof e?this.__isReady===!0?e():(this.__callbacksOnReady||(this.__callbacksOnReady=[]),this.__callbacksOnReady.push(e)):this.warn("arg0 isn't a callback in model.ready()!")},r.prototype.fetch=function(e,t){this.sendGET(e,t)},r.fetch=function(e){this.sendGET(e,function(e,t){e&&console.error(e),t=this.prepare(t),this.set(t)}.bind(this))},r}(window,document,jQuery),XQCore.View=function(e){var t=function(e){2===arguments.length&&(this.presenter=arguments[0],e=arguments[1],console.info("Defining View with presenter is deprecated.")),e=e||{events:null},this.customInit=e.init,this.conf=e,delete e.init,$.extend(this,e,new XQCore.Event,new XQCore.Logger),this.name=(e.name||"Nameless")+"View",this.debug=Boolean(e.debug)};t.prototype.init=function(e){var t=this,i=this.conf;e||(e=this.presenter,e.registerView(this)),console.log("View Init2",this),this.presenter=e,$(function(){this.container=$(i.container),this.$el=this.container,this.el=$(i.container).get(0),this.container.length>0?(window.addEventListener("resize",function(e){t.resize(e)},!1),this.log("Initialize view with conf:",i),this.log("  ... using Presenter:",this.presenter.name),this.log("  ... using Container:",this.container),this.events&&Object.keys(this.events).forEach(function(e){var t,i=e.indexOf(" "),r=this.events[e],o=e.substr(0,i),s=e.substr(i+1)||this.container,a=this;"function"==typeof r?t=this:0===r.indexOf("view:")?(r=this[r.substr(5)],t=this):(r=this.presenter.events[this.events[e]],"string"==typeof r&&(r=this.presenter[this.events[e]]),t=this.presenter),r&&o?"function"==typeof r?(this.container.delegate(s,o,function(e){var i=null,o=null;"submit"===e.type?i=XQCore.Util.serializeForm(e.target):("keydown"===e.type||"keyup"===e.type||"keypress"===e.type)&&(i=$(e.target).val()),o=$.extend($(e.target).data(),{itemIndex:n.call(a,e.target)}),r.call(t,e,o,i)}),this.log("Register Event:",o,"on selector",s,"with callback",r)):this.warn("Event handler callback not defined in Presenter:",this.events[e]):this.warn("Incorect event configuration",e)},this),"function"==typeof this.customInit&&this.customInit.call(this),this.presenter.fireViewInit(this)):this.error("Can't initialize View, Container not found!",this.container)}.bind(this))},t.prototype.show=function(){},t.prototype.hide=function(){},t.prototype.render=function(e){this.log("Render view template",this.template,"with data:",e);var t="function"==typeof this.template?this.template:Handlebars.compile(this.template);this.container.html(t(e||{})),this.emit("content.change",e)},t.prototype.renderHTML=function(e,t){return this.log("Render view html snipet",e,"with data:",t),e="function"==typeof e?e:Handlebars.compile(e),e(t)},t.prototype.resize=function(){},t.prototype.append=function(e,t){this.manipulate("append",e,t)},t.prototype.prepend=function(e,t){this.manipulate("prepend",e,t)},t.prototype.remove=function(e){this.manipulate("remove",e)},t.prototype.manipulate=function(t,n,i){if(this.subSelector===e)return this.warn("You must set the subSelector option"),!1;if(this.itemTemplate===e)return this.warn("You must set the itemTemplate option"),!1;var r,o=$(this.subSelector,this.container);switch(t){case"append":r=Handlebars.compile(this.itemTemplate)(n),$(r).appendTo(o);break;case"prepend":r=Handlebars.compile(this.itemTemplate)(n),$(r).prependTo(o);break;case"remove":o.children().eq(n).remove();break;default:this.error("undefined action in view.manipulate()",t)}},t.prototype.getElementData=function(t){var n=$(t,this.container);if(n.length){var i,r={},o=n.get(0).attributes;for(i=0;o.length>i;i++)if(0===o[i].name.indexOf("data-")){var s=o[i].name.substr(5),a=o[i].value;if("string"==typeof a)try{"true"===a||"TRUE"===a?a=!0:"false"===a||"FALSE"===a?a=!1:"null"===a||"NULL"===a?a=null:"undefined"===a?a=e:+a+""===a?a=+a:(a=JSON.parse(a),console.log(a))}catch(l){}r[s]=a}return console.log("Get data",r),r}return null},t.prototype.triggerEvent=function(e,t,n,i){this.presenter.events[e].call(this.presenter,t,n,i)};var n=function(e){var t=null,n=$(this.container).get(0),i=$(e),r=i.parent(),o=$(this.subSelector).get(0),s=0;if(this.subSelector)do{if(r.get(0)===o)return $(i).index();if(i=i.parent(),r=i.parent(),++s>100){console.log(i,r),console.error("Break loop!");break}}while(i.length&&i.get(0)!==n);return t};return t}(),XQCore.Util=function(e){var t={name:"XQCore.Util",debug:!0};return t.serializeForm=function(t){var n={},i=e(t);return"INPUT"===i.get(0).tagName||(i=i.find(":input")),i.serializeArray().forEach(function(e){n[e.name]=e.value}),this.debug&&console.log("XQCore - Serialize form:",i,n),n},t.checkLength=function(e,t,n){if("Number"==typeof e){if(t>e)return"num-to-small";if(e>n)return"num-to-large"}else{if(console.log(e,e.length),t>e.length)return"str-to-short";if(e.length>n)return"str-to-long"}},t.checkEqual=function(e,t){return e!==t?"str-not-equal":void 0},t.checkEmail=function(e){return/^\S+\@\S+\.[a-z]{2,10}$/.test(e)?void 0:"invalid-email"},t.checkUrl=function(e){return/^http(s)?:\/\/\S\.[a-zA-Z]{2,10}\/?$/.test(e)?void 0:"invalid-url"},t}(jQuery),XQCore.Router=function(){var e=function(e){var n,i,r=[];return e instanceof RegExp?(i=e,n=""+e):(i=t(e,r),n=e),{re:i,src:""+e,keys:r}},t=function(e,t){return e=e.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,n,i,r,o,s){return t.push(r),n=n||"",""+(s?"":n)+"(?:"+(s?n:"")+(i||"")+(o||"([^/]+?)")+")"+(s||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)"),RegExp("^"+e+"$","i")},n=function(e,t){for(var n,i=0,r=e.length;r>i;++i){var o,s=e[i],a=s.re,l=s.keys,h=[],u={};if(n=a.exec(t)){for(o=1,r=n.length;r>o;++o){var c=l[o-1],p="string"==typeof n[o]?decodeURIComponent(n[o]):n[o];c?u[c]=p:h.push(p)}return{params:u,splats:h,route:s.src}}}},i=function(e){e=$.extend({debug:!1},e),this.debug=Boolean(e.debug),this.routes=[],this.routeMap={}};return i.prototype.addRoute=function(t,n){if(!t)throw Error(" route requires a path");if(!n)throw Error(" route "+(""+t)+" requires a callback");var i=new e(t);i.fn=n,this.routes.push(i),this.routeMap[t]=n},i.prototype.match=function(e){var t=n(this.routes,e);return t&&(t.fn=this.routeMap[t.route]),t},i.prototype.fire=function(e,t){e=this.match(e),e&&e.fn(t)},i}(),function(e,t){console.log("View slide",e);var n,i=function(){return"transition"in document.body.style?"transition":"MozTransition"in document.body.style?"MozTransition":"WebkitTransition"in document.body.style?"WebkitTransition":"OTransition"in document.body.style?"OTransition":"MsTransition"in document.body.style?"MsTransition":t};e.slideIn=function(e){if(e=$.extend({parent:this.el.parentNode,transition:"left .75s",direction:"auto"},e),n===t&&(n=i()),e.parent&&this.el){this.log("> slide plugin > Slide view",this.el,"in container",e.parent),console.log({el:e.parent,cw:e.parent.clientWidth,ow:e.parent.offsetWidth,w:e.parent.style.width});var r=e.parent.offsetWidth;this.el.style.display="block",this.el.style[n]="none",this.el.style.left=r+"px",window.setTimeout(function(){this.el.style[n]=e.transition,this.el.style.left="0"}.bind(this))}else this.warn("> slide plugin > Can't slide view! View or parent not found! View",this.el,"in container",e.parent)},e.slideOut=function(e){if(e=$.extend({parent:this.el.parentNode,transition:"left .75s",direction:"auto"},e),n===t&&(n=i()),e.parent&&this.el){this.log("> slide plugin > Slide view",this.el,"in container",e.parent),console.log({el:e.parent,cw:e.parent.clientWidth,ow:e.parent.offsetWidth,w:e.parent.style.width});var r=e.parent.offsetWidth;this.el.style[n]=e.transition,this.el.style.left=r+"px";var o=function(){+this.el.style.left.replace("px","")>=r?(this.el.style.display="none",this.el.style[n]="none"):console.warn("Old transitionEndFunc???",this.el,+this.el.style.left.replace("px",""),this.el.style[n]),this.el.removeEventListener("transitionend",o)}.bind(this);this.el.addEventListener("transitionend",o)}else this.warn("> slide plugin > Can't slide view! View or parent not found! View",this.el,"in container",e.parent)}}(XQCore.View.prototype);