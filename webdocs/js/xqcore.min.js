var XQCore={version:.2,defaultRoute:"default",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent"};window.include||(window.include=function(t,e){var n=location.protocol+"//"+location.host+t;$.ajax({url:n,dataType:"script",success:e,async:!1})},window.preload=function(t){var e,n=location.protocol+"//"+location.host+t;return $.ajax({url:n,dataType:"text",success:function(t){e=t},async:!1}),{execute:function(t){eval.call(t||window,e)}}}),XQCore._dump={},XQCore.dump=function(t){return XQCore._dump[t]?(console.log("[XQCore dump]",t,XQCore._dump[t]),XQCore._dump[t]):!1},XQCore.Event=function(){var t,e=function(){"use strict";function t(){}function e(t,e){if(i)return e.indexOf(t);for(var n=e.length;n--;)if(e[n]===t)return n;return-1}var n=t.prototype,i=Array.prototype.indexOf?!0:!1;return n.getListeners=function(t){var e=this._events||(this._events={});return e[t]||(e[t]=[])},n.addListener=function(t,n){var i=this.getListeners(t);return-1===e(n,i)&&i.push(n),this},n.removeListener=function(t,n){var i=this.getListeners(t),r=e(n,i);return-1!==r&&(i.splice(r,1),0===i.length&&(this._events[t]=null)),this},n.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},n.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},n.manipulateListeners=function(t,e,n){var i,r,o=t?this.removeListener:this.addListener,s=t?this.removeListeners:this.addListeners;if("object"==typeof e)for(i in e)e.hasOwnProperty(i)&&(r=e[i])&&("function"==typeof r?o.call(this,i,r):s.call(this,i,r));else for(i=n.length;i--;)o.call(this,e,n[i]);return this},n.removeEvent=function(t){return t?this._events[t]=null:this._events=null,this},n.emitEvent=function(t,e){for(var n,i=this.getListeners(t),r=i.length;r--;)n=e?i[r].apply(null,e):i[r](),n===!0&&this.removeListener(t,i[r]);return this},t}();return t=function(){this.store=[],this.ee=new e},t.prototype.emit=function(t,e){return this.debug&&console.debug("XQCore - Emit event",t,e),this.ee.emitEvent(t,[e],this)},t.prototype.on=function(t,e){return this.debug&&console.debug("XQCore - Add listener",t,e,this),this.ee.addListener(t,e)},t.prototype.once=function(t,e){var n=function(){return this.ee.removeListener(t,e),e.call(null,arguments),!0};return this.debug&&console.debug("XQCore - Add once listener",t,e),this.ee.addListener(t,n)},t.prototype.off=function(t,e){return this.debug&&console.debug("XQCore - Remove listener",t,e),void 0===e?this.ee.removeEvent(t):this.ee.removeListener(t,e)},t.prototype.getListeners=function(t){return this.ee.getListeners(t)},t}(),XQCore.GetSet=function(t,e,n,i){var r=function(){this.properties={}},o=function(t,e){return t&&(t=t.split("."),t.forEach(function(t){e=e[t]})),e};return n.extend(r.prototype,new XQCore.Event),r.prototype.set=function(){var t,e={};return"object"==typeof arguments[0]?(n.extend(e,arguments[0]),this.log("Set data",arguments[0])):"string"==typeof arguments[0]?(e[arguments[0]]=arguments[1],this.log("Set data",arguments[0],arguments[1])):this.warn("Data are incorrect in getset.set()",arguments),this.validate&&(t=this.validate(e))?(this.warn("Validate error in getset.set",t),t):(n.extend(this.properties,e),this.emit("data.change",e),i)},r.prototype.get=function(t){return t===i?this.properties:this.properties[t]},r.prototype.has=function(t){return!!this.properties[t]},r.prototype.reset=function(){this.log("Reset getset"),this.properties={}},r.prototype.append=function(t,e){var i=this.properties;return t.split(".").forEach(function(t){i=i[t]}),i instanceof Array?i.push(e):i=n.extend(i,e),e},r.prototype.prepend=function(t,e){var i=this.properties;return t.split(".").forEach(function(t){i=i[t]}),i instanceof Array?i.unshift(e):i=n.extend(e,i),e},r.prototype.remove=function(t,e){var n=this.properties,i=null;return t.split(".").forEach(function(t){n=n[t]}),n instanceof Array?(i=n.splice(e,1),i=i[0]||null):this.warn("getset.remove() doesn't work with Objects in getset",this.name),i},r.prototype.search=function(t,e){var n=o(t,this.properties);if(n)for(var i=0;n.length>i;i++){var r,s=n[i];for(var a in e)if(e.hasOwnProperty(a)){if(!s[a]||s[a]!==e[a]){r=!1;break}r=!0}if(r===!0)return s}return null},r}(window,document,jQuery),XQCore.Presenter=function(){var t=function(t){this.root="/",this.debug=!1,this.routes=[],t=t||{},this.customInit=t.init,this.conf=t,delete t.init,$.extend(this,t,new XQCore.Event,new XQCore.Logger),this.name=(t.name||"Nameless")+"Presenter",this.eventCallbacks={},this.lastShownView=null,this.registeredViews=[],this.fireViewInit=function(t){var e=!0;this.registeredViews.forEach(function(n){t===n.view&&(n.isReady=!0),n.isReady===!1&&(e=!1)}),this.viewInit(t),e===!0&&this.emit("views.ready")},this.registerView=function(t){var e;if(t instanceof Array)for(e=0;t.length>e;e++)this.registeredViews.push({view:t[e],isReady:!1});else this.registeredViews.push({view:t,isReady:!1})}};return t.prototype.init=function(t){var e,n=this,i=this.conf;if(i.routes&&(this.Router=new XQCore.Router,Object.keys(i.routes).forEach(function(t){var e=this.routes[t];"string"==typeof e&&(e=this[e]),"function"==typeof e?this.Router.addRoute(t,e):this.warn("Router callback isn't a function",e,"of route",t)}.bind(this)),window.addEventListener("popstate",function(t){n.log("popstate event recived",t);var e=XQCore.defaultRoute;if(XQCore.html5Routes){var i=RegExp("^"+n.root);e=location.pathname.replace(i,"")}else/^#![a-zA-Z0-9]+/.test(location.hash)&&(e=location.hash.substr(2));if(e=n.Router.match(e)){var r=t.state||e.params;XQCore.callerEvent&&(r[XQCore.callerEvent]="popstate"),n.log("Trigger route",e,r),e.fn.call(n,r)}},!1),this.on("views.ready",function(){var t=XQCore.defaultRoute;if(/^#![a-zA-Z0-9]+/.test(location.hash)&&(t=location.hash.substr(2)),t=n.Router.match(t)){var e=t.params;XQCore.callerEvent&&(e[XQCore.callerEvent]="pageload"),n.log("Trigger route",t,e),t.fn.call(n,t.params)}})),"function"==typeof this.customInit&&this.customInit.call(this),console.log("views",t),t instanceof Array)for(e=0;t.length>e;e++)this.registerView(t[e]);else t&&this.registerView(t);this.registeredViews.forEach(function(t){t.view.init(n)})},t.prototype.viewInit=function(){},t.prototype.pushState=function(t,e){var n=XQCore.html5Routes||"/"===e.charAt(0)?"":XQCore.hashBang;e=n+e,history.pushState(t,"",e||null),this.log("Update history with pushState",t,e)},t.prototype.replaceState=function(t,e){var n=XQCore.html5Routes||"/"===e.charAt(0)?"":XQCore.hashBang;e=n+e,history.replaceState(t,"",e||null),this.log("Update history with replaceState",t,e)},t.prototype.navigateTo=function(t,e){var n=this.Router.match(t);n&&(XQCore.callerEvent&&(e=e||{},e[XQCore.callerEvent]="redirect"),n.fn.call(this,e)),this.log("Navigate to",t,e)},t.prototype.getView=function(t){var e,n;for(e=0;this.registeredViews.length>e;e++)if(n=this.registeredViews[e].view,n.name===t)return n;return null},t.prototype.showView=function(t,e){var n=this.getView(t+"View");return n?(XQCore.callerEvent&&"popstate"!==e[XQCore.callerEvent]&&XQCore.callerEvent&&"pageload"!==e[XQCore.callerEvent]&&this.pushState(e||null,n.url),this.log("Show view:",t,e),this.log("Hide view:",this.lastShownView),this.lastShownView!==n&&(this.lastShownView&&"function"==typeof this.lastShownView.hide?(this.lastShownView.hide(),n.show()):n.show(!0)),undefined):(this.warn("View not defined!",t),undefined)},t}(),XQCore.Model=function(t,e,n,i){var r;return r=function(t){t===i&&(t={}),this.customInit=t.init,this.conf=t,delete t.init,n.extend(this,t,new XQCore.Logger),this.name=(t.name||"Nameless")+"Model",this.debug=Boolean(t.debug),this._isValid=!1,this.properties={},t.validate&&(this.validate=function(e){var n;return this._isValid=!1,n=t.validate.call(this,e),(!n||"object"==typeof n&&0===Object.keys(n).length)&&(this._isValid=!0),n}.bind(this)),this.defaults&&this.set(this.defaults),this.init()},n.extend(r.prototype,XQCore.GetSet.prototype),r.prototype.init=function(){this.debug&&(XQCore._dump[this.name]=this),"function"==typeof this.customInit&&this.customInit.call(this)},r.prototype.validate=function(){},r.prototype.isValid=function(){return this._isValid},r.prototype.onSend=function(t){return t},r.prototype.send=function(t,e,r){return this.server?(e===i&&(e=this.get()),t===i&&(t="POST"),"function"==typeof this.onSend&&(e=this.onSend.call(this,e)),this.log("Sending an ajax call to ",this.server,"with data: ",e),n.ajax({url:this.server,type:t,data:e,success:function(t,e,n){"function"==typeof r&&r.call(this,null,t,e,n)}.bind(this),error:function(t,e,n){"function"==typeof r&&r.call(this,{type:e,http:n},null,e,t)}.bind(this)}),i):(this.error("Can not send an ajax request! You must define a server URL first."),!1)},r.prototype.sendPOST=function(t,e){this.send("POST",t,e)},r.prototype.sendGET=function(t,e){this.send("GET",t,e)},r.prototype.sendUPDATE=function(t,e){this.send("UPDATE",t,e)},r.prototype.sendDELETE=function(t,e){this.send("DELETE",t,e)},r}(window,document,jQuery),XQCore.View=function(t){var e=function(t){2===arguments.length&&(this.presenter=arguments[0],t=arguments[1],console.info("Defining View with presenter is deprecated.")),t=t||{events:null},this.customInit=t.init,this.conf=t,delete t.init,$.extend(this,t,new XQCore.Event,new XQCore.Logger),this.name=(t.name||"Nameless")+"View",this.debug=Boolean(t.debug)};e.prototype.init=function(t){var e=this,i=this.conf;t||(t=this.presenter,t.registerView(this)),console.log("View Init2",this),this.presenter=t,$(function(){this.container=$(i.container),this.$el=this.container,this.el=$(i.container).get(0),this.container.length>0?(window.addEventListener("resize",function(t){e.resize(t)},!1),this.log("Initialize view with conf:",i),this.log("  ... using Presenter:",this.presenter.name),this.log("  ... using Container:",this.container),this.events?Object.keys(this.events).forEach(function(t){var e,i=t.indexOf(" "),r=this.events[t],o=t.substr(0,i),s=t.substr(i+1)||this.container,a=this;"function"==typeof r?e=this:0===r.indexOf("view:")?(r=this[r.substr(5)],e=this):(r=this.presenter.events[this.events[t]],"string"==typeof r&&(r=this.presenter[this.events[t]]),e=this.presenter),r&&o?"function"==typeof r?(this.container.delegate(s,o,function(t){var i=null,o=null;"submit"===t.type?i=XQCore.Util.serializeForm(t.target):("keydown"===t.type||"keyup"===t.type||"keypress"===t.type)&&(i=$(t.target).val()),o=$.extend($(t.target).data(),{itemIndex:n.call(a,t.target)}),r.call(e,t,o,i)}),this.log("Register Event:",o,"on selector",s,"with callback",r)):this.warn("Event handler callback not defined in Presenter:",this.events[t]):this.warn("Incorect event configuration",t)},this):this.warn("No view events defined"),"function"==typeof this.customInit&&this.customInit.call(this),this.presenter.fireViewInit(this)):this.error("Can't initialize View, Container not found!",this.container)}.bind(this))},e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype.render=function(t){this.log("Render view template",this.template,"with data:",t);var e="function"==typeof this.template?this.template:Handlebars.compile(this.template);this.container.html(e(t||{})),this.emit("content.change",t)},e.prototype.renderHTML=function(t,e){return this.log("Render view html snipet",t,"with data:",e),t="function"==typeof t?t:Handlebars.compile(t),t(e)},e.prototype.resize=function(){},e.prototype.append=function(t,e){this.manipulate("append",t,e)},e.prototype.prepend=function(t,e){this.manipulate("prepend",t,e)},e.prototype.remove=function(t){this.manipulate("remove",t)},e.prototype.manipulate=function(e,n,i){if(this.subSelector===t)return this.warn("You must set the subSelector option"),!1;if(this.itemTemplate===t)return this.warn("You must set the itemTemplate option"),!1;var r,o=$(this.subSelector,this.container);switch(e){case"append":r=Handlebars.compile(this.itemTemplate)(n),$(r).appendTo(o);break;case"prepend":r=Handlebars.compile(this.itemTemplate)(n),$(r).prependTo(o);break;case"remove":o.children().eq(n).remove();break;default:this.error("undefined action in view.manipulate()",e)}},e.prototype.getElementData=function(e){var n=$(e,this.container);if(n.length){var i,r={},o=n.get(0).attributes;for(i=0;o.length>i;i++)if(0===o[i].name.indexOf("data-")){var s=o[i].name.substr(5),a=o[i].value;if("string"==typeof a)try{"true"===a||"TRUE"===a?a=!0:"false"===a||"FALSE"===a?a=!1:"null"===a||"NULL"===a?a=null:"undefined"===a?a=t:+a+""===a?a=+a:(a=JSON.parse(a),console.log(a))}catch(l){}r[s]=a}return console.log("Get data",r),r}return null};var n=function(t){var e=null,n=$(this.container).get(0),i=$(t),r=i.parent(),o=$(this.subSelector).get(0),s=0;if(this.subSelector)do{if(r.get(0)===o)return $(i).index();if(i=i.parent(),r=i.parent(),++s>100){console.log(i,r),console.error("Break loop!");break}}while(i.length&&i.get(0)!==n);return e};return e}(),XQCore.Logger=function(){function t(t){return 1e3>t?t+" ms":6e4>t?Math.round(t/100)/10+" sec":Math.round(t/6e4)+" min "+Math.round(t%6e4/1e3)+" sec"}var e=function(){};return e.prototype.log=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),t.unshift("["+this.name+"]"),console.log.apply(console,t))},e.prototype.warn=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),t.unshift("["+this.name+"]"),console.warn.apply(console,t))},e.prototype.error=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),t.unshift("["+this.name+"]"),console.error.apply(console,t))},e.prototype.timer=function(e){var n={start:null,stop:null,name:e,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",t(this.stop-this.start))}};return this.log("Start Timer",e),n.start=Date.now(),n},e.prototype.timerEnd=function(){},e.prototype.__scope={getHumanTime:t},e}(),XQCore.Util=function(t){var e={name:"XQCore.Util",debug:!0};return e.serializeForm=function(e){var n={},i=t(e);return"INPUT"===i.get(0).tagName||(i=i.find(":input")),i.serializeArray().forEach(function(t){n[t.name]=t.value}),this.debug&&console.log("XQCore - Serialize form:",i,n),n},e.checkLength=function(t,e,n){if("Number"==typeof t){if(e>t)return"num-to-small";if(t>n)return"num-to-large"}else{if(console.log(t,t.length),e>t.length)return"str-to-short";if(t.length>n)return"str-to-long"}},e.checkEqual=function(t,e){return t!==e?"str-not-equal":void 0},e.checkEmail=function(t){return/^\S+\@\S+\.[a-z]{2,10}$/.test(t)?void 0:"invalid-email"},e.checkUrl=function(t){return/^http(s)?:\/\/\S\.[a-zA-Z]{2,10}\/?$/.test(t)?void 0:"invalid-url"},e}(jQuery),XQCore.Router=function(){var t=function(t){var n,i,r=[];return t instanceof RegExp?(i=t,n=""+t):(i=e(t,r),n=t),{re:i,src:""+t,keys:r}},e=function(t,e){return t=t.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(t,n,i,r,o,s){return e.push(r),n=n||"",""+(s?"":n)+"(?:"+(s?n:"")+(i||"")+(o||"([^/]+?)")+")"+(s||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)"),RegExp("^"+t+"$","i")},n=function(t,e){for(var n,i=0,r=t.length;r>i;++i){var o,s=t[i],a=s.re,l=s.keys,u=[],h={};if(n=a.exec(e)){for(o=1,r=n.length;r>o;++o){var c=l[o-1],p="string"==typeof n[o]?decodeURIComponent(n[o]):n[o];c?h[c]=p:u.push(p)}return{params:h,splats:u,route:s.src}}}},i=function(t){t=$.extend({debug:!1},t),this.debug=Boolean(t.debug),this.routes=[],this.routeMap={}};return i.prototype.addRoute=function(e,n){if(!e)throw Error(" route requires a path");if(!n)throw Error(" route "+(""+e)+" requires a callback");var i=new t(e);i.fn=n,this.routes.push(i),this.routeMap[e]=n},i.prototype.match=function(t){var e=n(this.routes,t);return e&&(e.fn=this.routeMap[e.route]),e},i.prototype.fire=function(t,e){t=this.match(t),t&&t.fn(e)},i}(),function(t,e){console.log("View slide",t);var n,i=function(){return"transition"in document.body.style?"transition":"MozTransition"in document.body.style?"MozTransition":"WebkitTransition"in document.body.style?"WebkitTransition":"OTransition"in document.body.style?"OTransition":"MsTransition"in document.body.style?"MsTransition":e};t.slideIn=function(t){if(t=$.extend({parent:this.el.parentNode,transition:"left .75s",direction:"auto"},t),n===e&&(n=i()),t.parent&&this.el){this.log("> slide plugin > Slide view",this.el,"in container",t.parent),console.log({el:t.parent,cw:t.parent.clientWidth,ow:t.parent.offsetWidth,w:t.parent.style.width});var r=t.parent.offsetWidth;this.el.style.display="block",this.el.style[n]="none",this.el.style.left=r+"px",window.setTimeout(function(){this.el.style[n]=t.transition,this.el.style.left="0"}.bind(this))}else this.warn("> slide plugin > Can't slide view! View or parent not found! View",this.el,"in container",t.parent)},t.slideOut=function(t){if(t=$.extend({parent:this.el.parentNode,transition:"left .75s",direction:"auto"},t),n===e&&(n=i()),t.parent&&this.el){this.log("> slide plugin > Slide view",this.el,"in container",t.parent),console.log({el:t.parent,cw:t.parent.clientWidth,ow:t.parent.offsetWidth,w:t.parent.style.width});var r=t.parent.offsetWidth;this.el.style[n]=t.transition,this.el.style.left=r+"px";var o=function(){+this.el.style.left.replace("px","")>=r?(this.el.style.display="none",this.el.style[n]="none"):console.warn("Old transitionEndFunc???",this.el,+this.el.style.left.replace("px",""),this.el.style[n]),this.el.removeEventListener("transitionend",o)}.bind(this);this.el.addEventListener("transitionend",o)}else this.warn("> slide plugin > Can't slide view! View or parent not found! View",this.el,"in container",t.parent)}}(XQCore.View.prototype);