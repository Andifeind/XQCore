<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>webdocs&#x2F;js&#x2F;xqcore-getset.js - xqcore</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="xqcore"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.4.3</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/GetSet.html">GetSet</a></li>
            
                <li><a href="..&#x2F;classes/Manages event registering and emitting..html">Manages event registering and emitting.</a></li>
            
                <li><a href="..&#x2F;classes/XQCore.Logger.html">XQCore.Logger</a></li>
            
                <li><a href="..&#x2F;classes/XQCore.Presenter.html">XQCore.Presenter</a></li>
            
                <li><a href="..&#x2F;classes/XQCore.View.html">XQCore.View</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/XQCore Presenter.html">XQCore Presenter</a></li>
            
                <li><a href="..&#x2F;modules/XQCore.GetSet.html">XQCore.GetSet</a></li>
            
                <li><a href="..&#x2F;modules/XQCore.Logger.html">XQCore.Logger</a></li>
            
                <li><a href="..&#x2F;modules/XQCore.View.html">XQCore.View</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: webdocs&#x2F;js&#x2F;xqcore-getset.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * XQCore.GetSet
 *
 * @module XQCore.GetSet
 * @requires XQCore.Logger
 * @requires XQCore.Event
 *&#x2F;
XQCore.GetSet = (function(window, document, $, undefined) {

	&#x2F;**
	 * GetSet constructor
	 *
	 * @constructor
	 * @class GetSet
	 * @param {Object} conf COnfig object
	 *&#x2F;
	var getset = function(conf) {
		this.properties = {};
		this._isValid = false;

		if (conf) {
			this.schema = conf.schema;
			this.debug = Boolean(conf.debug);
		}

		this.name = &#x27;GetSet&#x27;;
		$.extend(this, new XQCore.Logger());
		$.extend(this, new XQCore.Event());
	};

	var undotify = function(path, obj) {
		if(path) {
			path = path.split(&#x27;.&#x27;);
			path.forEach(function(key) {
				obj = obj[key];
			});
		}

		return obj;
	};

	&#x2F;&#x2F; $.extend(getset.prototype, new XQCore.Event());

	&#x2F;**
	 * Set getset data
	 *
	 * Triggers a data.change event if data was set succesfully
	 *
	 * @method set
	 * @param {Object} data
	 *&#x2F;
	
	&#x2F;**
	 * Set getset data
	 *
	 * Triggers these events if data was set succesfully&lt;br&gt;
	 * data.change&lt;br&gt;
	 * &amp;lt;key&amp;gt;.change
	 *
	 * @method set
	 * @param {String} key
	 * @param {Object} value Data value
	 *&#x2F;
	getset.prototype.set = function() {
		var newData = {},
			oldData = this.get(),
			validateResult,
			key;

		if (arguments[0] === null) {
			newData = arguments[1];
			this.log(&#x27;Set data&#x27;, newData, oldData);
		}
		else if (typeof arguments[0] === &#x27;object&#x27;) {
			&#x2F;&#x2F;Add a dataset
			newData = arguments[0];
			this.log(&#x27;Set data&#x27;, newData, oldData);
		}
		else if (typeof arguments[0] === &#x27;string&#x27;) {
			newData = this.get();
			key = arguments[0];
			var val = arguments[1];

			newData[key] = val;
			this.log(&#x27;Set data&#x27;, newData, oldData);
		}
		else {
			this.warn(&#x27;Data are incorrect in getset.set()&#x27;, arguments);
		}

		if (this.schema) {
			validateResult = this.validate(newData);
			if (validateResult !== null) {
				this.warn(&#x27;Validate error in getset.set&#x27;, validateResult);
				this.emit(&#x27;validation.error&#x27;, validateResult);
				return false;
			}
		}

		if (this.customValidate) {
			console.log(&#x27;Use custom validation&#x27;, this.customValidate);
			validateResult = this.customValidate(newData);
			if (validateResult !== null) {
				this.warn(&#x27;Validate error in getset.set&#x27;, validateResult);
				this.emit(&#x27;validation.error&#x27;, validateResult);
				return false;
			}
		}

		this.properties = newData;
		this.emit(&#x27;data.change&#x27;, newData, oldData);

		if (key) {
			this.emit(&#x27;change.&#x27; + key, newData[key]);
		}

		return true;
	};

	&#x2F;**
	 * Get one or all properties from a dataset
	 *
	 * @param  {String} key Data key
	 *
	 * @return {Object}     getset dataset
	 *&#x2F;
	getset.prototype.get = function(key) {
		if (key === undefined) {
			return this.properties;
		}
		else {
			return this.properties[key];
		}
	};

	&#x2F;**
	 * Check wether getset has a dataset
	 *
	 * @param {String} key Dataset key
	 * @return {Boolean} Returns true if getset has a dataset with key
	 *&#x2F;
	getset.prototype.has = function(key) {
		return !!this.properties[key];
	};

	&#x2F;**
	 * Remove all data from getset
	 *&#x2F;
	getset.prototype.reset = function() {
		this.log(&#x27;Reset getset&#x27;);
		this.properties = {};
		this.removeAllListener();
	};

	&#x2F;**
	 * Append data to a subset
	 *
	 * @param {String} path path to subset
	 * @param {Object} data data to add
	 *&#x2F;
	getset.prototype.append = function(path, data) {
		if (arguments.length === 1) {
			data = path;
			path = null;
		}

		var dataset = this.properties,
			oldDataset = this.get(),
			trigger = true;

		if (path) {
			path.split(&#x27;.&#x27;).forEach(function(key) {
				dataset = dataset[key];
			});
		}

		console.log(dataset === this.properties);
		if (dataset instanceof Array) {
			dataset.push(data);
		}
		else {
			if (path === null) {
				this.properties = [data];
				dataset = this.get();
			}
			else {
				this.warn(&#x27;GetSet.append requires an array. Dataset isn\&#x27;t an array&#x27;, path);
			}
		}

		if (trigger) {
			this.emit(&#x27;data.change&#x27;, dataset, oldDataset);
		}

		console.log(dataset, this.properties);
		return data;
	};

	&#x2F;**
	 * Prepend data to a subset
	 *
	 * @param {String} path path to subset
	 * @param {Object} data data to add
	 *&#x2F;
	getset.prototype.prepend = function(path, data) {
		if (arguments.length === 1) {
			data = path;
			path = null;
		}

		var dataset = this.properties,
			oldDataset = this.get(),
			trigger = true;

		if (path) {
			path.split(&#x27;.&#x27;).forEach(function(key) {
				dataset = dataset[key];
			});
		}

		if (dataset instanceof Array) {
			dataset.unshift(data);
		}
		else {
			if (path === null) {
				this.properties = [data];
				dataset = this.get();
			}
			else {
				this.warn(&#x27;GetSet.append requires an array. Dataset isn\&#x27;t an array&#x27;, path);
			}
		}

		if (trigger) {
			this.emit(&#x27;data.change&#x27;, dataset, oldDataset);
		}

		return data;
	};

	&#x2F;**
	 * Remove a subset
	 *
	 * @param {String} path path to subset
	 * @param {Number} index Index of the subsut to remove
	 *
	 * @return {Object} removed subset
	 *&#x2F;
	getset.prototype.remove = function(path, index) {
		var dataset = this.properties,
			data = null;
		path.split(&#x27;.&#x27;).forEach(function(key) {
			dataset = dataset[key];
		});

		if (dataset instanceof Array) {
			data = dataset.splice(index, 1);
			data = data[0] || null;
		}
		else {
			this.warn(&#x27;getset.remove() doesn\&#x27;t work with Objects in getset&#x27;, this.name);
		}

		return data;
	};

	&#x2F;**
	 * Search a item in models properties
	 *
	 * @param {String} path to the parent property. We use dot notation to navigate to subproperties. (data.bla.blub)
	 * @param {Object} searchfor Searching for object
	 * @return {Object} Returns the first matched item or null
	 *&#x2F;
	getset.prototype.search = function(path, searchfor) {
		var parent = undotify(path, this.properties);

		if (parent) {
			for (var i = 0; i &lt; parent.length; i++) {
				var prop = parent[i],
					matching;

				for (var p in searchfor) {
					if (searchfor.hasOwnProperty(p)) {
						if (prop[p] &amp;&amp; prop[p] === searchfor[p]) {
							matching = true;
						}
						else {
							matching = false;
							break;
						}
					}
				}

				if (matching === true) {
					return prop;
				}

			}
		}

		return null;
	};

	&#x2F;**
	 * Sort an array collection by a given attribute
	 *
	 * @param {String} path Path to the collection
	 * @param {Object} sortKeys Sort by key
	 *
	 * sortKeys: {
	 *   &#x27;key&#x27;: 1 &#x2F;&#x2F; Sort ascend by key,
	 *   &#x27;second.key&#x27;: -1 &#x2F;&#x2F; Sort descand by second.key
	 * }
	 *
	 * ascend, a -&gt; z, 0 - &gt; 9 (-1)
	 * descend, z -&gt; a, 9 -&gt; 0 (1)
	 * 
	 *&#x2F;
	getset.prototype.sortBy = function(path, sortKeys) {
		if (arguments.length === 1) {
			sortKeys = path;
			path = null;
		}

		var data = undotify(path, this.properties),
			order;

		data.sort(function(a, b) {
			order = -1;
			&#x2F;&#x2F;jshint forin: false
			for (var key in sortKeys) {
				order = String(undotify(key, a)).localeCompare(String(undotify(key, b)));
				if (order === 0) {
					continue;
				}
				else if(sortKeys[key] === -1) {
					order = order &gt; 0 ? -1 : 1;
				}

				break;
			}

			return order;
		});

		this.set(path, data);
		return data;
	};

	getset.prototype.validate = function(data) {
		var failed = [];

		if (this.schema) {
			Object.keys(this.schema).forEach(function(key) {
				var validationResult = this.validateOne(key, data[key]);

				if (validationResult.isValid === true) {
					data[key] = validationResult.value;
				}
				else {
					failed.push(validationResult.error);
				}
			}.bind(this));
		}

		if (failed.length === 0) {
			this._isValid = true;
			return null;
		}
		else {
			this._isValid = false;
			return failed;
		}
	};

	&#x2F;**
	 * Validate one property
	 *
	 * ValidatorResultItemObject
	 * {
	 *   isValid: Boolean,
	 *   value: Any,
	 *   error: Object
	 * }
	 *
	 * @param  {String} key   Property key
	 * @param  {Any} value Property value
	 *
	 * @return {Object}       Returns a ValidatorResultItemObject
	 *&#x2F;
	getset.prototype.validateOne = function(key, value) {
		var failed = null,
			schema = this.schema[key];

		console.log(&#x27;Schema&#x27;, schema, schema.match);
		if (value === &#x27;&#x27; &amp;&amp; schema.noEmpty === true) {
			value = undefined;
		}

		if ((value === undefined || value === null) &amp;&amp; schema.default) {
			value = schema.default;
		}

		if ((value === undefined || value === null || value === &#x27;&#x27;) &amp;&amp; schema.required === true) {
			failed = {
				property: key,
				msg: &#x27;Property is undefined or null, but it\&#x27;s required&#x27;,
				errCode: 10
			};
		}
		else if (schema.type === &#x27;string&#x27;) {
			if (schema.convert &amp;&amp; typeof(value) === &#x27;number&#x27;) {
				value = String(value);
			}

			if (schema.type !== typeof(value)) {
				failed = {
					property: key,
					msg: &#x27;Property type is a &#x27; + typeof(value) + &#x27;, but a string is required&#x27;,
					errCode: 11
				};
			}
			else if(schema.min &amp;&amp; schema.min &gt; value.length) {
				failed = {
					property: key,
					msg: &#x27;String length is too short&#x27;,
					errCode: 12
				};
			}
			else if(schema.max &amp;&amp; schema.max &lt; value.length) {
				failed = {
					property: key,
					msg: &#x27;String length is too long&#x27;,
					errCode: 13
				};
			}
			else if(schema.match &amp;&amp; !schema.match.test(value)) {
				failed = {
					property: key,
					msg: &#x27;String doesn\&#x27;t match regexp&#x27;,
					errCode: 14
				};
			}

		}
		else if(schema.type === &#x27;number&#x27;) {
			if (schema.convert &amp;&amp; typeof(value) === &#x27;string&#x27;) {
				value = parseInt(value, 10);
			}

			if (schema.type !== typeof(value)) {
				failed = {
					property: key,
					msg: &#x27;Property type is a &#x27; + typeof(value) + &#x27;, but a number is required&#x27;,
					errCode: 21
				};
			}
			else if(schema.min &amp;&amp; schema.min &gt; value) {
				failed = {
					property: key,
					msg: &#x27;Number is too low&#x27;,
					errCode: 22
				};
			}
			else if(schema.max &amp;&amp; schema.max &lt; value) {
				failed = {
					property: key,
					msg: &#x27;Number is too high&#x27;,
					errCode: 23
				};
			}
		}
		else if(schema.type === &#x27;date&#x27;) {
			if (value) {
				var date = Date.parse(value);
				if (isNaN(date)) {
					failed = {
						property: key,
						msg: &#x27;Property isn\&#x27;t a valid date&#x27;,
						errCode: 31
					};
				}
			}
		}
		else if(schema.type === &#x27;array&#x27;) {
			if (!Array.isArray(value)) {
				failed = {
					property: key,
					msg: &#x27;Property type is a &#x27; + typeof(value) + &#x27;, but an array is required&#x27;,
					errCode: 41
				};
			}
			else if(schema.min &amp;&amp; schema.min &gt; value.length) {
				failed = {
					property: key,
					msg: &#x27;Array length is &#x27; + value.length + &#x27; but must be greater than &#x27; + schema.min,
					errCode: 42
				};
			}
			else if(schema.max &amp;&amp; schema.max &lt; value.length) {
				failed = {
					property: key,
					msg: &#x27;Array length is &#x27; + value.length + &#x27; but must be lesser than &#x27; + schema.max,
					errCode: 43
				};
			}
		}
		else if(schema.type === &#x27;object&#x27;) {
			if (typeof(value) !== &#x27;object&#x27;) {
				failed = {
					property: key,
					msg: &#x27;Property isn\&#x27;t a valid object&#x27;,
					errCode: 51
				};
			}
		}
		else if(schema.type === &#x27;boolean&#x27;) {
			if (typeof(value) !== &#x27;object&#x27;) {
				failed = {
					property: key,
					msg: &#x27;Property isn\&#x27;t a valid boolean&#x27;,
					errCode: 61
				};
			}
		}
		else {

		}

		if (failed === null) {
			failed = {
				isValid: true,
				value: value,
				error: null
			};
		}
		else {
			this.warn(&#x27;Validation error on property&#x27;, key, failed, &#x27;Data:&#x27;, value);
			failed = {
				isValid: false,
				value: value,
				error: failed
			};
		}

		return failed;
	};

	getset.prototype.isValid = function() {
		return this._isValid;
	};


	return getset;
})(window, document, jQuery);
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
