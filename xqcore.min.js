/*!
 * XQCore - +0.11.1-159
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2015 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2015-09-28
 * 
 */
var XQCore;!function(a,b){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],b):"undefined"!=typeof module&&module.exports?module.exports=b(require("jquery")):a.XQCore=b(a.jQuery)}(this,function(a){"use strict";return XQCore={version:"0.11.1-159",defaultRoute:"index",html5Routes:!1,basePath:"",hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire",socketPort:9889,eventListenerMaxLength:1328},XQCore.extend=a.extend,XQCore.isEmptyObject=a.isEmptyObject,XQCore.isPlainObject=a.isPlainObject,XQCore.isFunction=a.isFunction,XQCore.__moduleCache={},XQCore.isObjectId=function(a){return this.objectIdPattern.test(a)},XQCore.modules={jquery:{cjs:"jquery",amd:"jquery",win:"jQuery"},firetpl:{cjs:"firetpl",amd:"firetpl",win:"fireTpl"},sockjs:{cjs:"xqcore/lib/sockjs.js",amd:"xqcore/lib/sockjs.js",win:"SockJS"}},XQCore.require=function(a){if(XQCore.__moduleCache[a])return XQCore.__moduleCache[a];var b="win";"undefined"!=typeof module&&module.exports&&"function"==typeof require?b="cjs":"function"==typeof define&&define.amd&&(b="amd"),XQCore.modules[a][b]&&(a=XQCore.modules[a][b]);try{if("cjs"===b||"amd"===b)try{return require(a)}catch(c){console.warn("Module not registered as a "+("cjs"===b?"CommonJS":"AMD")+" module! Try to load from window object",a)}return window[a]}catch(c){console.error("Could not load module!",a,c)}},XQCore.setLocale=function(a){localStorage.setItem("xqcore.locale",a)},XQCore.getLocale=function(){var a=localStorage.getItem("xqcore.locale");return a?a:navigator.language},XQCore.logLevel=1,XQCore}),function(a,b){"use strict";a.undotify=function(a,c){return a&&(a=a.split("."),a.forEach(function(a){c=c?c[a]:b})),c},a.dedotify=function(a,b,c){"string"==typeof a&&(c=b,b=a,a={});var d=a;if(b){b=b.split(".");var e=b.length;b.forEach(function(b,d){return d===e-1?/\[\]$/.test(b)?(b=b.substr(0,b.length-2),a[b]||(a[b]=[]),a[b].push(c),void 0):(a[b]=c,void 0):(a[b]||(a[b]={}),a=a[b],void 0)})}return a=c,d},a.uid=function(a){a=a||7;for(var b="";b.length<a;){var c=Math.random().toString(36).substr(2);b+=c}return b.substr(0,a)}}(XQCore),function(a){"use strict";a.getQuery=function(b){return a.__query||(a.__query={},location.search.substr(1).split("&").forEach(function(b){if(b=b.split("="),b&&b[0]){var c=encodeURI(b[1]);a.__query[b[0]]=isNaN(c)?c:Number(c)}})),b?a.__query[b]:a.__query}}(XQCore),function(a){"use strict";var b=function(b){this.loggerName=b,this.logLevel=a.logLevel};b.prototype.log=function(){var a;this.logLevel>=3&&(a=Array.prototype.slice.call(arguments),this.loggerName&&a.unshift("["+this.loggerName+"]"),console.log.apply(console,a))},b.prototype.warn=function(){var a;this.logLevel>=2&&(a=Array.prototype.slice.call(arguments),this.loggerName&&a.unshift("["+this.loggerName+"]"),console.warn.apply(console,a))},b.prototype.error=function(){var a;this.logLevel>=1&&(a=Array.prototype.slice.call(arguments),this.loggerName&&a.unshift("["+this.loggerName+"]"),console.error.apply(console,a))},b.prototype.debug=function(){var a;this.logLevel>=4&&(a=Array.prototype.slice.call(arguments),this.loggerName&&a.unshift("["+this.loggerName+"]"),console.debug.apply(console,a))},b.prototype.info=b.prototype.log,b.prototype.timer=function(a){var b=this,c={start:null,stop:null,name:a,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+a+" finished after "+b.getHumanTime(this.stop-this.start))}};return this.log("Start Timer "+a),c.start=Date.now(),c},b.prototype.dev=function(){var a;this.debug&&(a=Array.prototype.slice.call(arguments),this.loggerName&&a.unshift("["+this.loggerName+"]"),console.debug.apply(console,a))},b.prototype.req=b.prototype.log,b.prototype.res=b.prototype.log,b.prototype.getHumanTime=function(a){return 1e3>a?a+"ms":6e4>a?Math.round(a/100)/10+"sec":Math.round(a/6e4)+"min "+Math.round(a%6e4/1e3)+"sec"},a.Logger=b}(XQCore),function(a){"use strict";var b=new a.Logger("Event"),c=function(a,b,c){this.fn=c,this.calls=0,this.once=!1,this.remove=function(){a.off(b,c)}},d=function(){this.__events={},this.__logger=b,this.maxLength=a.eventListenerMaxLength};d.prototype.on=function(a,d){var e=new c(this,a,d);return this.__events[a]||(this.__events[a]=[]),this.__events[a].push(e),this.__events[a].length>this.maxLength?b.warn("Listener max length was exceeded!","List:",a,"Length:",this.__events[a].length):b.info("Register new `"+a+"` event"),e},d.prototype.once=function(){var a=Array.prototype.slice.call(arguments),b=this.on.apply(this,a);return b.once=!0,b},d.prototype.emit=function(a,c){if(!this.__events[a])return b.info("Emit `"+a+"` event failed! No listener of this type are registered"),0;for(var d=Array.prototype.slice.call(arguments,1),e=this.__events[a].length,f=0;e>f;f++){var g=this.__events[a][f];g.fn.apply(this,d),g.calls++,g.once===!0&&this.__events[a].splice(f,1)}return e&&(b.info("Emit `"+a+"` event to",e,"listener"),b.debug(" ... emit data:",c)),e},d.prototype.off=function(a,c){var d=0;if(!this.__events[a])return b.info("Unregister events failed! No `"+a+"` events were found!"),0;if(c)for(var e=this.__events[a].length,f=0;e>f;f++){var g=this.__events[a][f];g&&g.fn===c&&(this.__events[a].splice(f,1),d++,0===this.__events[a].length&&delete this.__events[a])}else d=this.__events[a].length,delete this.__events[a];return b.info("Unregister `"+a+"` events!","Removed "+d+" listener"),d},d.prototype.clearEvents=function(){this.__events={}},a.Event=d}(XQCore),function(a){var b=function(){this.__isReady=!1,this.__readyFuncs=[]};b.prototype.ready=function(a){this.__isReady?a.call(this):this.__readyFuncs.push(a)},b.prototype.setReady=function(){var a=this;this.__isReady=!0,this.__readyFuncs&&(this.__readyFuncs.forEach(function(b){b.call(a)}),this.__readyFuncs=[])},b.prototype.unsetReady=function(){this.__isReady=!1},a.ReadyState=b}(XQCore),function(a){"use strict";var b,c=a.require("jquery"),d=function(d,e){var f=this;"function"==typeof arguments[0]&&(e=d,d=null),this.name=d||"Nameless",this.router=a.Router.getInstance(),b=new a.Logger(this.name+"Presenter"),this.__views={},"function"==typeof e&&e.call(this,f,b),c(function(){f.router.callRoute(f.router.getPath())})};a.extend(d.prototype,new a.Event),d.prototype.init=function(){},d.prototype.pushState=function(c,d){var e=a.html5Routes||"/"===c.charAt(0)?"":a.hashBang;c=e+c,history.pushState(d,"",c||null),b.info("Update history with pushState. New URL: "+d,c)},d.prototype.replaceState=function(c,d){var e=a.html5Routes||"/"===c.charAt(0)?"":a.hashBang;c=e+c,history.replaceState(d,"",c||null),b.info("Update history with replaceState. New URL: "+d,c)},d.prototype.navigateTo=function(b,c){c=c||{},a.html5Routes?this.router.callRoute(b,c):(location.hash=a.hashBang+b,this.router.callRoute(b,c))},d.prototype.navigateBack=function(){history.back()},d.prototype.getView=function(a){return this.__views[a]||null},d.prototype.getHash=function(){return location.hash},d.prototype.getPathname=function(){return location.pathname},d.prototype.couple=function(c,d,e){var f,g=null;e=e||{},!c instanceof a.View&&b.error("First arg is not a valid view in "+this.name+" presenter.couple()!"),(!d instanceof a.Model||!d instanceof a.List)&&b.error("Second arg is not a valid model or list in "+this.name+" presenter.couple()!"),d instanceof a.List&&(g=d,d=null);var h=a.extend({"data.replace":"xrender","data.merge":"xrender","data.item":"xrender","data.append":"xrender","data.prepend":"xrender","data.insert":"insert","data.remove":"remove","validation.error":"validationFailed","state.change":"onStateChange"},e.modelEvents),i=a.extend({"item.push":"xrender","item.unshift":"xrender","item.pop":"xrender","item.shift":"xrender","item.update":"xrender","state.change":"onStateChange"},e.listEvents),j=a.extend({"form.submit":"submit"},e.viewEvents);if(!c instanceof a.View)return b.error("Can't couple view with model! View isn't a XQCore.View"),void 0;if(d&&!d instanceof a.Model)return b.error("Can't couple model with model! Model isn't a XQCore.Model"),void 0;if(g&&!g instanceof a.List)return b.error("Can't couple list with list! List isn't a XQCore.List"),void 0;d&&b.info("Couple view ",c.name,"with model",d.name),g&&b.info("Couple view ",c.name,"with list",g.name),c.__coupledWith||(c.__coupledWith=[]),d&&!d.__coupledWith&&(d.__coupledWith=[]),g&&!g.__coupledWith&&(g.__coupledWith=[]),d&&(c.__coupledWith.some(function(a){return a===d})||c.__coupledWith.push(d),d.__coupledWith.some(function(a){return a===c})||d.__coupledWith.push(c)),g&&(c.__coupledWith.some(function(a){return a===g})||c.__coupledWith.push(g),g.__coupledWith.some(function(a){return a===c})||g.__coupledWith.push(c));var k,l=function(a,b){var e=function(){if("xrender"===b)c.render(d.get());else{var e=Array.prototype.slice.call(arguments);e.push(d.name,a),c[b].apply(c,e)}};e.fnType="coupled-model-listener",e.fnParent=c,d.on(a,e)},m=function(a,b){var d=function(){if("xrender"===b)c.render(g.toArray());else{var d=Array.prototype.slice.call(arguments);d.push(g.name,a),c[b].apply(c,d)}};d.fnType="coupled-list-listener",d.fnParent=c,g.on(a,d)};if(d){k=function(a,b){var e=function(a,e){d[b](a,e,c.name)};e.fnType="coupled-view-listener",e.fnParent=d,c.on(a,e)};for(f in h)h.hasOwnProperty(f)&&l(f,h[f])}if(g){k=function(a,b){var d=function(a,d){g[b](a,d,c.name)};d.fnType="coupled-view-listener",d.fnParent=g,c.on(a,d)};for(f in i)i.hasOwnProperty(f)&&m(f,i[f])}for(f in j)j.hasOwnProperty(f)&&k(f,j[f]);return d&&c.render(d.properties),g&&c.render(g.toArray()),e.forms&&c.formSetup(d),this},d.prototype.initView=function(b,c,d){d=d||{};var e={};d.viewDir&&(e.viewDir=d.viewDir);var f=new a.View(b,function(f){f.template=a.Tmpl.getTemplate(b,e),f.mode=d.mode||"replace",f.container=c||"body",f.hidden=!!d.hidden,d.inject===!1&&(f.autoInject=!1)});this.__views[b]=f;var g=this;return a.html5Routes&&f.on("xqcore.navigate",function(a){g.router.callRoute(a)}),f},d.prototype.route=function(a,c){var d=this;"string"==typeof c&&(c=this[c]),"function"==typeof c?"string"==typeof a?(b.info("Register new route:",a,"using fn as callback:",c),this.router.addRoute(a,c)):Array.isArray(a)&&a.forEach(function(e){b.info("Register new route:",a,"using fn as callback:",c),d.router.addRoute(e,c)}):b.warn("Router callback isn't a function",c,"of route",a)},a.Presenter=d}(XQCore),function(a,b){"use strict";var c=a.require("jquery"),d=function(){this.server=null};d.prototype.onSend=function(a){return a},d.prototype.send=function(a,d,e,f){var g=this;"object"==typeof d?(f=e,e=d,d=this.server,a=a):"function"==typeof e?(f=e,e=this.get()):e===b&&(e=this.get()),a===b&&(a="POST"),d||(d=this.server),"GET"===a&&Array.isArray(e)&&(d=d.replace(/\/$/,"")+"/"+e.join("/"),e=null),"function"==typeof this.onSend&&(e=this.onSend.call(this,e)),this.log("Send an ajax call to ",d,"with data: ",e),this.state("syncing"),c.ajax({url:d,type:a,data:e,dataType:"json",success:function(a,b,c){"function"==typeof f&&f.call(g,null,a,b,c),g.state("success")},error:function(a,b,c){"function"==typeof f&&f.call(g,{type:b,http:c},null,b,a),g.state("failed")}})},d.prototype.sendPOST=function(a,b,c){this.send("POST",a,b,c)},d.prototype.sendGET=function(a,b,c){this.send("GET",a,b,c)},d.prototype.sendPUT=function(a,b,c){this.send("PUT",a,b,c)},d.prototype.sendDELETE=function(a,b,c){this.send("DELETE",a,b,c)},d.prototype.fetch=function(a,b){this.sendGET(a,b)},d.prototype.save=function(a,b){"function"==typeof a&&(b=a,a=this.schema?this.getByKeys(Object.keys(this.schema)):this.get()),this.isValid()?this.sendPOST(a,b):"function"==typeof b&&b({msg:"Model isn't valid. Cancle save"})},d.prototype.update=function(a,b){"function"==typeof a&&(b=a,a=this.schema?this.getByKeys(Object.keys(this.schema)):this.get()),this.isValid()?this.sendPUT(a,b):"function"==typeof b&&b({msg:"Model isn't valid. Cancel update"})},d.prototype.submit=function(a){if(this.set(a,{extend:!0})){if(a.id===b||null===a.id)return this.save(a),void 0;this.update(a)}},a.Sync=d}(XQCore),function(XQCore,undefined){"use strict";var Model;Model=function(a,b){XQCore.ReadyState.call(this),XQCore.Event.call(this),"object"==typeof arguments[0]&&(b=a,a=b.name),this.debug=XQCore.debug,this.properties={},b===undefined&&(b={}),"function"==typeof b?b.call(this,this):XQCore.extend(this,b),this.__state="starting",this.__unfiltered={},this.customValidate=b.validate,delete b.validate,this.conf=b,this.name=(a?a.replace(/Model$/,""):"Nameless")+"Model",this._isValid=!1,this.defaults&&!XQCore.isEmptyObject(this.defaults)&&this.set(this.defaults,{silent:!0,noValidation:!0}),this._isValid=!this.schema,this.state("ready")},XQCore.extend(Model.prototype,XQCore.ReadyState.prototype),XQCore.extend(Model.prototype,XQCore.Event.prototype),XQCore.extend(Model.prototype,new XQCore.Logger),XQCore.Sync&&XQCore.extend(Model.prototype,XQCore.Sync.prototype),Model.inherit=function(a,b){"object"==typeof a&&(b=a,a=undefined);var c=function(c,d){XQCore.Model.call(this,a,b),c&&("string"==typeof c?a=c:d=c,"function"==typeof d?d.call(this,this):"object"==typeof d&&XQCore.extend(this,d))};return c.prototype=Object.create(XQCore.Model.prototype),c.prototype.constructor=c,c},Model.prototype.init=function(){console.warn("Model.init is deprecated since v0.10.0")},Model.prototype.state=function(a){this.__state=a,this.emit("state."+a),this.emit("state.change",a)},Model.prototype.getState=function(){return this.__state},Model.prototype.set=function(a,b,c){var d,e={},f=this.get(),g=!1,h=!1;if(c=c||{},null===arguments[0])e=arguments[1],h=!0,this.log("Set data",e,f);else if("object"==typeof arguments[0])c=b||{},e=c.replace?arguments[0]:XQCore.extend(e,f,arguments[0]),h=!0,a=null,this.log("Set data",e,f);else if("string"==typeof arguments[0]){if(e=XQCore.extend({},this.get()),g=!0,XQCore.dedotify(e,a,b),this.log("Set data",e,f),c=c||{},!this.customValidate&&c.validateOne&&(c.noValidation=!0,d=this.validateOne(this.schema[a],b),d.isValid===!1))return d.error=d.error||{},d.error.property=a,this.warn("Validation error in model.set of property",a,d),c.silent!==!0&&this.emit("validation.error",d,e),!1}else this.warn("Data are incorrect in model.set()",arguments);return c=c||{},!this.customValidate&&this.schema&&c.noValidation!==!0&&(d=this.validate(e),null!==d)?(this.warn("Validate error in model.set",d),c.silent!==!0&&this.emit("validation.error",d,e),!1):this.customValidate&&c.noValidation!==!0&&(d=this.customValidate(e),this.log("Using a custom validation which returns:",d),null!==d)?(this.warn("Validate error in model.set",d),this.emit("validation.error",d,e),!1):(this.properties=e,c.silent!==!0&&(h?c.noSync||"function"!=typeof this.sync?this.emit(c.replace?"data.replace":"data.merge",e,f):this.sync("set",e):g&&(c.noSync||"function"!=typeof this.sync||this.sync("item",a,b),this.emit("data.item",a,b)),this.emit("data.change",e,f)),!0)},Model.prototype.get=function(key,options){options===undefined&&(options={});var data;if("object"==typeof key&&1===arguments.length&&(options=key,key=null),key===undefined||null===key){if(options.copy===!0)switch(data=this.properties,typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+data.toString()+")");default:return data}return this.properties}if("string"==typeof key&&"number"==typeof options){var index=options;3===arguments.length&&(options=arguments[2]);var item=this.get(key);return options.copy===!0&&"object"==typeof item[index]?XQCore.extend({},item[index]):item[index]}if(options.copy===!0)switch(data=XQCore.undotify(key,this.properties),typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+data.toString()+")");default:return data}return XQCore.undotify(key,this.properties)},Model.prototype.getByKeys=function(a,b){if("object"!=typeof a)throw new Error("First param must be an object or array in Model.getByKeys()!");var c={};if(b=b||this.get(),Array.isArray(a))a.forEach(function(a){-1===a.indexOf(".")?c[a]=b[a]:c=XQCore.dedotify(c,a,XQCore.undotify(a,b))});else for(var d in a)if(a.hasOwnProperty(d)){var e=b[d];c[d]="object"==typeof e?this.getByKeys(a[d],b[d]):b[d]}return c},Model.prototype.has=function(a){var b=!0,c=this.properties;a=a.split(".");for(var d=0,e=a.length;e>d;d++){if("object"!=typeof c||!c.hasOwnProperty(a[d])){b=!1;break}c=c[a[d]]}return b},Model.prototype.reset=function(a){a=a||{},this.log("Reset model");var b=this.get();return this.properties=XQCore.extend({},this.defaults),this.state("starting"),a.silent||this.emit("data.reset",b),a.removeListener&&this.clearEvents(),a.noSync||"function"==typeof this.sync&&this.sync("reset",b),b},Model.prototype.append=function(a,b,c){var d=XQCore.undotify(a,this.properties);if(c=c||{},d instanceof Array)d.push(b);else if("undefined"==typeof d)XQCore.dedotify(this.properties,a,[b]);else{if("object"!=typeof d||a||!XQCore.isEmptyObject(this.properties))return this.error("Model.append requires an array. Dataset isn't an array. Path: ",a),void 0;this.properties=[b]}c.silent!==!0&&(c.noSync||"function"!=typeof this.sync||this.sync("append",a,b),this.emit("data.append",a,b),this.emit("data.change",this.properties))},Model.prototype.prepend=function(a,b,c){var d=XQCore.undotify(a,this.properties);if(c=c||{},d instanceof Array)d.unshift(b);else if("undefined"==typeof d)XQCore.dedotify(this.properties,a,[b]);else{if("object"!=typeof d||a||!XQCore.isEmptyObject(this.properties))return this.error("Model.prepend requires an array. Dataset isn't an array. Path: ",a),void 0;this.properties=[b]}c.silent!==!0&&(c.noSync||"function"!=typeof this.sync||this.sync("prepend",a,b),this.emit("data.prepend",a,b),this.emit("data.change",this.properties))},Model.prototype.insert=function(a,b,c,d){var e=XQCore.undotify(a,this.properties);if(d=d||{},e instanceof Array)e.splice(b,0,c);else if("undefined"==typeof e)XQCore.dedotify(this.properties,a,[c]);else{if("object"!=typeof e||a||!XQCore.isEmptyObject(this.properties))return this.error("Model.insert requires an array. Dataset isn't an array. Path: ",a),void 0;this.properties=[c]}d.silent!==!0&&(d.noSync||"function"!=typeof this.sync||this.sync("insert",a,b,c),this.emit("data.insert",a,b,c),this.emit("data.change",this.properties))},Model.prototype.remove=function(a,b,c){var d=XQCore.undotify(a,this.properties),e=null;if(c=c||{},d instanceof Array)e=d.splice(b,1);else if("object"==typeof d)return this.error("Model.remove requires an array. Dataset isn't an array. Path: ",a),void 0;return e&&c.silent!==!0&&(c.noSync||"function"!=typeof this.sync||this.sync("remove",a,b),this.emit("data.remove",a,b,e[0]),this.emit("data.change",this.properties)),e},Model.prototype.repalce=function(a,b){return b=b||{},b.repalce=!0,this.set(a,b)},Model.prototype.search=function(a,b){var c;if(1===arguments.length?(b=a,a="",c=this.properties):c=a?XQCore.undotify(a,this.properties):this.properties,c)for(var d=0;d<c.length;d++){var e,f=c[d];for(var g in b)if(b.hasOwnProperty(g)){if(f[g]&&f[g]===b[g]){e=!0;break}e=!1}if(e===!0)return f}return null},Model.prototype.modify=function(a,b,c){var d=this.search(a,b);d&&(XQCore.extend(d,c),this.emit("data.modify",a,c,d),this.emit("data.change",this.properties))},Model.prototype.sortBy=function(a,b){1===arguments.length&&(b=a,a=null);var c,d=XQCore.undotify(a,this.properties);return Array.isArray(d)?(d.sort(function(a,d){c=-1;for(var e in b)if(b.hasOwnProperty(e)){if(c=String(XQCore.undotify(e,a)).localeCompare(String(XQCore.undotify(e,d))),0===c)continue;-1===b[e]&&(c=c>0?-1:1);break}return c}),this.set(a,d),d):(this.warn("Could not sort data of type",typeof d),[])},Model.prototype.filter=function(a,b,c,d){if(1===arguments.length&&(d=a,a=null),"string"==typeof d){if(!this.__registeredFilter[d])throw new Error("Filter "+d+" not registered!");d=this.__registeredFilter[d]}for(var e=XQCore.undotify(a,this.__unfiltered.data||this.properties),f=[],g=0,h=e.length;h>g;g++)d(b,c,e[g])&&f.push(e[g]);return this.__unfiltered={path:a,data:e},this.set(a,f),f},Model.prototype.filterReset=function(a){this.__unfiltered&&this.set(this.__unfiltered.path,this.__unfiltered.data,a)},Model.prototype.validate=function(a,b){var c=this,d=[];return b=b||this.schema,b&&Object.keys(b).forEach(function(e){if("object"==typeof a[e]&&"undefined"==typeof b[e].type){var f=c.validate(XQCore.extend({},a[e]),XQCore.extend({},b[e]));return Array.isArray(f)&&f.length>0&&(d=d.concat(f)),void 0}var g=c.validateOne(b[e],a[e]);g.isValid===!0?a[e]=g.value:(g.error.property=e,d.push(g.error))}),0===d.length?(this._isValid=!0,this.state("valid"),null):(this._isValid=!1,this.state("invalid"),d)},Model.prototype.validateOne=function(a,b){var c,d="function"==typeof a.type?typeof a.type():a.type.toLowerCase();if(""===b&&a.noEmpty===!0&&(b=undefined),b!==undefined&&null!==b&&""!==b||!a["default"]||(b=a["default"]),b===undefined||null===b||""===b)a.required===!0&&(c={msg:"Property is undefined or null, but it's required",errCode:10});else{if(!this.__registeredValidations[d])throw new Error("Undefined schema type",a);c=this.__registeredValidations[d].call(this,b,a)}return c=c===undefined?{isValid:!0,value:b,error:null}:{isValid:!1,value:b,error:c}},Model.prototype.isValid=function(){return this._isValid},Model.prototype.setData=function(a){this.warn("Model.setData has been deprecated since v0.9"),this.set(a,{extend:!0})},Model.registerFilter=function(a,b){if("function"!=typeof b)throw new Error("Filter function isn't a function");var c="function"==typeof this?Model.prototype:this;c.__registeredFilter[a]=b},Model.prototype.registerFilter=Model.registerFilter,Model.prototype.__registeredFilter={quicksearch:function(a,b,c){var d=XQCore.undotify(a,c),e=new RegExp(b.replace(/[a-z0-9äüöß]/g,"$&.*"),"i");return e.test(d)}},Model.registerValidation=function(a,b){var c="function"==typeof this?Model.prototype:this;c.__registeredValidations[a]=b},Model.prototype.registerValidation=Model.registerValidation,Model.prototype.__registeredValidations={string:function(a,b){return b.convert&&"number"==typeof a&&(a=String(a)),"string"!=typeof a?{msg:"Property type is a "+typeof a+", but a string is required",errCode:11}:b.min&&b.min>a.length?{msg:"String length is too short",errCode:12}:b.max&&b.max<a.length?{msg:"String length is too long",errCode:13}:b.match&&!b.match.test(a)?{msg:"String doesn't match regexp",errCode:14}:void 0},number:function(a,b){return b.convert&&"string"==typeof a&&(a=parseInt(a,10)),"number"!=typeof a||isNaN(a)?{msg:"Property type is not a valid number",errCode:21}:b.min&&b.min>a?{msg:"Number is too low",errCode:22}:b.max&&b.max<a?{msg:"Number is too high",errCode:23}:void 0},date:function(a){if(a){var b=Date.parse(a);if(isNaN(b))return{msg:"Property isn't a valid date",errCode:31}}},array:function(a,b){return Array.isArray(a)?b.min&&b.min>a.length?{msg:"Array length is "+a.length+" but must be greater than "+b.min,errCode:42}:b.max&&b.max<a.length?{msg:"Array length is "+a.length+" but must be lesser than "+b.max,errCode:43}:void 0:{msg:"Property type is a "+typeof a+", but an array is required",errCode:41}},object:function(a){return"object"!=typeof a?{msg:"Property isn't a valid object",errCode:51}:void 0},objectid:function(a){return/^[a-zA-Z0-9]{24}$/.test(a)?void 0:{msg:"Property isn't a valid objectId",errCode:52}},"boolean":function(a){return"boolean"!=typeof a?{msg:"Property isn't a valid boolean",errCode:61}:void 0},time:function(a){return/^\d+(:\d{2}){1,3}$/.test(a)?void 0:{msg:"Property isn't a valid time",errCode:61}}},XQCore.Model=Model}(XQCore),function(a,b){"use strict";if("function"==typeof define&&define.amd)define("xqcore",[XQCore.templateEngine],b);else if("undefined"!=typeof module&&module.exports)module.exports=b(require(XQCore.templateEngine));else{var c="firetpl"===XQCore.templateEngine?"FireTPL":"Handlebars";a.XQCore=b(a[c])}}(this,function(a){"use strict";return XQCore.Tmpl={type:XQCore.templateEngine,compile:a.compile,getTemplate:function(b,c){if(c=c||{},"firetpl"===XQCore.templateEngine){var d=a;if(d.templateCache&&d.templateCache[b])return d.templateCache[b];if(d.loadFile){var e=c.viewDir||XQCore.viewsDir,f=d.readFile(e.replace(/\/$/,"")+"/"+b+"."+XQCore.viewExt.replace(/^\./,""));return d.compile(f,{eventAttrs:!0})}throw new Error("FireTPL runtime is being used. Please preload the "+b+"View")}}},XQCore}),function(a,b){"use strict";var c,d=a.require("jquery"),e=function(e,f){a.Event.call(this),"object"==typeof arguments[0]||"function"==typeof arguments[0]?(f=e,e=null):"string"==typeof arguments[0]&&(this.name=e),c=new a.Logger(this.name+"View"),this.container="body",this.tag=b,this.className=b,this.id=b,this.mode="replace",this.autoInject=!0,this.__domReady=!1,this.__viewEvents=[];var g=this;"function"==typeof f?f.call(this,g):a.extend(this,f),this.name=(this.name?this.name.replace(/View$/,""):"Nameless")+"View",this.__createView(),d(function(){g.container.length>0?(window.addEventListener("resize",function(a){g.resize(a)},!1),c.info("Initialize view "+this.name," with conf:",f),c.info(" ... using Container:",g.container)):c.error("Can't initialize View, Container not found!",g.container)})};a.extend(e.prototype,a.Event.prototype),e.prototype.show=function(){this.$el.show()},e.prototype.hide=function(){this.$el.hide()},e.prototype.renderHTML=function(b,d){return c.log("Render html snippet",b,"with data:",d),b="function"==typeof b?b:a.Tmpl.compile(b),b(d)},e.prototype.resize=function(){},e.prototype.getElementData=function(a){var c=d(a,this.container);if(c.length){var e,f={},g=c.get(0).attributes;for(e=0;e<g.length;e++)if(0===g[e].name.indexOf("data-")){var h=g[e].name.substr(5),i=g[e].value;if("string"==typeof i)try{i="true"===i||"TRUE"===i?!0:"false"===i||"FALSE"===i?!1:"null"===i||"NULL"===i?null:"undefined"===i?b:+i+""===i?+i:JSON.parse(i)}catch(j){}f[h]=i}return f}return null},e.prototype.validationFailed=function(a){var b=this;a.forEach(function(a){b.$el.find('[name="'+a.property+'"]').addClass("xq-invalid")})},e.prototype.onStateChange=function(a){var b=this.el.className.split(" ");b=b.filter(function(a){return!/^xq-state-/.test(a)}),b.push("xq-state-"+a),this.el.className=b.join(" ")},e.prototype.ready=function(a){this.isReady?a.call(this):(this.__readyCallbacks||(this.__readyCallbacks=[]),this.__readyCallbacks.push(a))},e.prototype.__setReadyState=function(){var a=this;this.isReady=!0,this.__readyCallbacks&&(this.__readyCallbacks.forEach(function(b){b.call(a)}),this.__readyCallbacks=[])},e.prototype.inject=function(){if(this.el.parentNode!==this.ct)if(c.info("Inject view into container",this.$ct),"replace"===this.mode)this.$ct.contents().detach(),this.$ct.append(this.$el);else if("append"===this.mode)this.$ct.append(this.$el);else{if("prepend"!==this.mode)throw new Error("Unknown insert mode in view constructor");this.$ct.prepend(this.$el)}},e.prototype.parse=function(a,b,c){var e,f;a.scopeStore={},a.scopes=c||{};try{e=a(b||{},a.scopes)}catch(g){e='<p class="renderError"><b>View render error!</b><br>'+g.message+"</p>",this.error("View render error!",g)}var h=function(b,c,e){b=d.parseHTML(b);var f=d(b),g=f.find("scope"),i={};return g.each(function(){var b,f=d(this).attr("id"),g=d(this).attr("path"),j=e?e+"."+g:g,k=c;if(Array.isArray(c)&&(i[g]=i[g]||0,k=c[i[g]++]),b={},f){var l=a.scopes[f](c[g],c);b.value=l?h(l,c[g],j):document.createTextNode(""),b.id=f}else b.value=d.parseHTML(c[g]);a.scopeStore[j]=a.scopeStore[j]||[],a.scopeStore[j].push(b),d(this).replaceWith(d(b.value))}),f};return e&&(f=h(e,b)),f},e.prototype.render=function(b){if(this.__domReady===!1)return this.__initialData=b||{},void 0;this.autoInject&&this.inject();var d;c.info("Render view template of view "+this.name,"with data:",b);var e="function"==typeof this.template?this.template:a.Tmpl.compile(this.template);this.scopes={};try{d=e(b||{},this.scopes)}catch(f){d='<p class="renderError"><b>View render error!</b><br>'+f.message+"</p>",this.error("View render error!",f)}this.el.innerHTML=d,this.emit("content.change",b),this.registerListener(this.$el)},e.prototype.registerListener=function(a){var b=this;a.find("[on]").addBack("[on]").each(function(){var a,c=d(this),e=d(this).attr("on"),f=d(this).data();c.removeAttr("on"),e=e.split(";"),e.forEach(function(d){d=d.split(":"),a="submit"===d[0]?function(a){a.preventDefault(),f=b.serializeForm(a.target),f=b.onSubmit(f,a.target),b.emit(d[1],f,a)}:function(a){var c;a.originalEvent instanceof KeyboardEvent?c={key:a.key,code:a.keyCode,alt:a.altKey,ctrl:a.ctrlKey,meta:a.metaKey,shift:a.shiftKey}:a.originalEvent instanceof MouseEvent?(a.preventDefault(),c={button:a.button,alt:a.altKey,ctrl:a.ctrlKey,meta:a.metaKey,shift:a.shiftKey},"click"===a.type&&a.currentTarget.href&&(c.href=a.currentTarget.href)):(a.preventDefault(),c=a.currentTarget.value||""),b.emit(d[1],c,f,a)},c.bind(d[0],a)})}),this.__viewEvents.forEach(function(a){b.$el.delegate(a.selector,a.events,a.callback)})},e.prototype.serializeForm=function(b){var e={},f=d(b);return"INPUT"!==f.get(0).tagName&&(f=f.find(":input")),f.serializeArray().forEach(function(b){a.dedotify(e,b.name,b.value)}),c.info("Serialize form of view "+this.name,"form selector:",f,"form data:",e),e},e.prototype.insert=function(a,b,c){var e=this,f=this.$el.find('[fire-path="'+a+'"]');f.length&&f.each(function(){var a=d(this).attr("fire-scope"),f=e.scopes[a]([c]),g=d(this).children();b>-1?(b>g.length-1&&(b=g.length-1),g.eq(b).before(f)):g.eq(b).after(f)})},e.prototype.update=function(){c.warn("XQCore doesn`t support update events yet")},e.prototype.append=function(a,b){this.insert(a,-1,b)},e.prototype.prepend=function(a,b){this.insert(a,0,b)},e.prototype.remove=function(a,b){var c=this.$el.find('[fire-path="'+a+'"]');c.children(":eq("+b+")").remove()},e.prototype.formSetup=function(a,b){var c=this;this.ready(function(){var e="xq-invalid",f="xq-disabled";b||(b=this.$el.find("form"));var g=function(){var b=d(this).closest("form"),c=d(this);c.removeClass(e);var g=c.attr("name"),h=c.val();if(g&&a.schema&&a.schema[g]){var i=a.validateOne(a.schema[g],h);i.isValid?0===b.find(':input[class~="'+e+'"]').length&&(b.removeClass(e),b.find(":submit").removeAttr("disabled").removeClass(f)):(c.addClass(e),b.addClass(e),b.find(":submit").attr("disabled","disabled").addClass(f))}},h=function(a){a.preventDefault();var b=c.serializeForm(a.target);c.emit("form.submit",b)};this.addEvent(":input","blur",g),this.addEvent("form","submit",h)})},e.prototype.onSubmit=function(a){return a},e.prototype.destroy=function(){if(this.$el.remove(),this.removeAllListeners(),this.__coupledWith)for(var a=0,b=this.__coupledWith.length;b>a;a++){var d=this.__coupledWith[a];if(d._events)for(var e in d._events)if(d._events[e])for(var f=e,g=0,h=d._events[e].length;h>g;g++)"coupled-model-listener"===d._events[e][g].listener.fnType&&d._events[e][g].listener.fnParent===this&&d.removeEvent(f,d._events[e][g].listener)}c.info("View "+this.name+" has been destroyed")},e.prototype.addEvent=function(a,b,c){this.__viewEvents.push({events:b,selector:a,callback:c}),this.$el&&this.$el.delegate(a,b,c)},e.prototype.__viewTagTypes={"*":"div",body:"section",section:"section",ul:"li",table:"tbody",tbody:"tr",tr:"td"},e.prototype.__createViewElement=function(){if(this.tag)return document.createElement(this.tag);var a=this.ct?this.ct.tagName.toLowerCase():"*",b=this.__viewTagTypes["*"];return this.__viewTagTypes[a]&&(b=this.__viewTagTypes[a]),document.createElement(b)},e.prototype.__createView=function(){var b=this,c=[];d(function(){b.$ct=b.$ct||d(b.container),b.ct=b.$ct.get(0),b.el=b.__createViewElement(),b.$el=d(b.el),c.push("xq-view xq-"+b.name.replace(/View$/,"-view").toLowerCase()),b.id&&b.el.setAttribute("id",b.id),b.className&&c.push(b.className),b.hidden===!0&&(c.push("xq-hidden"),b.$el.hide()),b.el.className=c.join(" "),b.__domReady=!0,b.__initialData&&(b.render(b.__initialData),delete b.__initialData),b.__setReadyState(),b.registerListener(b.$el),a.html5Routes&&b.$el.on("click","a",function(a){/^http(s)?:\/\//.test(a.href)||/^\/?[a-z]/.test(a.href)&&(a.preventDefault(),a.stopPropagation(),b.emit("xqcore.navigate",a.href))
})})},a.View=e}(XQCore),function(a){"use strict";var b,c=new a.Logger("Router"),d=function(a){var b,c,d=[];return a instanceof RegExp?(c=a,b=a.toString()):(c=e(a,d),b=a),{re:c,src:a.toString(),keys:d}},e=function(a,b){return a=a.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?|\*/g,function(a,c,d,e,f,g){return"*"===a?(b.push(void 0),a):(b.push(e),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||"([^/]+?)")+")"+(g||""))}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+a+"$","i")},f=function(a,b,c){for(var d,e=c||0,f=a.length;f>e;++e){var g=a[e],h=g.re,i=g.keys,j=[],k={};if(d=b.match(h)){for(var l=1,m=d.length;m>l;++l){var n=i[l-1],o="string"==typeof d[l]?unescape(d[l]):d[l];n?k[n]=o:j.push(o)}return{params:k,splats:j,route:g.src,next:e+1}}}},g=function(a){a=a||{},this.routes=[],this.routeMap={},a.noListener||this.registerListener()};g.getInstance=function(){return b||(b=new a.Router),b},g.prototype.registerListener=function(){a.html5Routes?(console.log("DEFINE"),window.addEventListener("popstate",this.onPopStateHandler.bind(this))):window.addEventListener("hashchange",this.onPopStateHandler.bind(this))},g.prototype.onPopStateHandler=function(){var a=this.getPath();this.callRoute(a,{noPush:!0})},g.prototype.getPath=function(){var b;return a.html5Routes?(b=location.pathname,b.replace(new RegExp("^"+a.basePath),"")):(b="/"+location.hash,b.replace(new RegExp("^"+a.hashBang),""))},g.prototype.addRoute=function(a,b){if(!a)throw new Error(" route requires a path");if(!b)throw new Error(" route "+a.toString()+" requires a callback");if(this.routeMap[a])throw new Error("path is already defined: "+a);var c=new d(a);return c.fn=b,this.routes.push(c),this.routeMap[a]=b,this},g.prototype.removeRoute=function(a){if(!a)throw new Error(" route requires a path");if(!this.routeMap[a])return c.warn("Can not remove route! Route does not exists: "+a),this;for(var b=0;b<this.routes.length;b++){var d=this.routes[b];d.src===a&&this.routes.splice(b,1)}return delete this.routeMap[a],this},g.prototype.match=function(a,b){var c=f(this.routes,a,b);return c&&(c.fn=this.routeMap[c.route],c.next=this.match.bind(this,a,c.next)),c},g.prototype.callRoute=function(b,d){if(d=d||{},void 0===b)throw new Error("XQCore.Router error! Path is undefined in callRoute()!");var e=this.match(b);return e?(!a.html5Routes||d.noPush||d.replace?a.html5Routes&&d.replace&&history.replaceState(null,"",b):history.pushState(null,"",b),e.fn.call(this,e.params,e.splats),void 0):(c.warn("Could not call any route! No route were found! Called path: "+b),void 0)},a.Router=g}(XQCore),function(a){"use strict";var b=new a.Logger("SocketConnection"),c=a.require("sockjs"),d={},e=function(a){return d[a]?d[a]:(d[a]=this,this.__isReady=!1,this.__onReadyCallbacks=[],this.__channels={},this.conn=null,this.connect(a),this.autoReconnect=!0,this.reconnectionInterval=1500,void 0)};e.prototype.connect=function(a){var d=this;this.conn&&"disconnected"!==this.connectionState||(b.info("Connect to socket server ",a),this.conn=new c(a,null,{debug:b.logLevel>=4}),this.connectionState="connecting",this.conn.onopen=function(){b.info("Connection was successful!"),d.setReady(),d.connectionState="connected"},this.conn.onmessage=function(a){var c;try{c=JSON.parse(a.data)}catch(e){console.error("Could not parse socket message!",a.data)}if(!c.channel)throw new Error("No socket channel was sent!");b.info("Got socket message",c.eventName,"in channel "+c.channel,c.args);var f=c.args||[];f.unshift(c.eventName),d.__channels[c.channel]?d.__channels[c.channel].emit.apply(d.__channels[c.channel],f):b.info(" ... channel not found!",c.channel)},this.conn.onclose=function(c){d.connectionState="disconnected",d.unsetReady(),b.warn("Connection to "+a+" closed!",c),d.autoReconnect&&(b.info("Try to reconnect to "+a),setTimeout(function(){d.connect(a)},d.reconnectionInterval))})},e.prototype.registerChannel=function(a,c){b.info("Register new channel",a),this.__channels[a]?b.info(" ... channel already registered!"):this.__channels[a]=c},e.prototype.unregisterChannel=function(a){b.info("Unregister channel",a),this.__channels[a]?delete this.__channels[a]:b.info(" ... channel not found!")},e.prototype.send=function(a,c){var d=this,e=Array.prototype.slice.call(arguments,2);this.ready(function(){b.info("Send socket message to channel "+a,c,e),d.conn.send(JSON.stringify({channel:a,eventName:c,args:e}))})},e.prototype.ready=function(a){this.__isReady?a.call(this):this.__onReadyCallbacks.push(a)},e.prototype.setReady=function(){var a=this;this.__isReady=!0,this.__onReadyCallbacks.forEach(function(b){b.call(a)}),this.__onReadyCallbacks=[]},e.prototype.unsetReady=function(){this.__isReady=!1},a.SocketConnection=e}(XQCore),function(a){"use strict";var b=new a.Logger("Socket");b.logLevel=5;var c=function(b,c){this.__isReady=!1,this.__onReadyCallbacks=[],this.channel=c,this.socket=new a.SocketConnection(b),this.socket.registerChannel(c,this)};a.extend(c.prototype,new a.Event),c.prototype.send=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.channel),this.socket.send.apply(this.socket,a)},a.Socket=c}(XQCore),function(a,b){"use strict";var c;c=function(b,c){this.noAutoRegister=!1,a.Model.call(this,b,c),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||a.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},c.prototype=Object.create(a.Model.prototype),c.prototype.constructor=c,c.inherit=function(c,d){"object"==typeof c&&(d=c,c=b);var e=function(){a.SyncModel.call(this,c,d)};return e.prototype=Object.create(a.SyncModel.prototype),e.prototype.constructor=e,e},c.prototype.connectToSocket=function(){var b=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",b),this.socket=new a.Socket(b,this.channel))},c.prototype.register=function(a){var b=this;this.syncEnabled=!!a,b.dev("Register syncmodel at server:",b.name);var c={noSync:!0};b.socket.on("syncmodel.set",function(a){b.set(a,c)}),b.socket.on("syncmodel.item",function(a,d){b.set(a,d,c)}),b.socket.on("syncmodel.append",function(a,d){b.append(a,d,c)}),b.socket.on("syncmodel.prepend",function(a,d){b.prepend(a,d,c)}),b.socket.on("syncmodel.insert",function(a,d,e){b.insert(a,d,e,c)}),b.socket.on("syncmodel.remove",function(a,d,e){b.remove(a,d,e,c)}),b.socket.on("syncmodel.reset",function(){b.reset(c)}),b.socket.on("syncmodel.init",function(a){console.log("Got initial data request:",a),b.set(a,c)}),b.socket.send("syncmodel.register",{name:b.name})},c.prototype.unregister=function(){var a=this.conf.syncWith||this.name.replace(/Model$/,"");this.socket.send("syncmodel.unregister",{name:a}),this.socket.off("syncmodel.set"),this.socket.off("syncmodel.item"),this.socket.off("syncmodel.append"),this.socket.off("syncmodel.prepend"),this.socket.off("syncmodel.insert"),this.socket.off("syncmodel.remove"),this.socket.off("syncmodel.reset"),this.socket.off("syncmodel.init")},c.prototype.emitRemote=function(a,b){this.socket.send(a,b)},c.prototype.sync=function(a){if(this.syncEnabled){var b=Array.prototype.slice.call(arguments,1);b.unshift("syncmodel."+a),this.emitRemote.apply(this,b)}},c.prototype.fetchModel=function(){this.emitRemote("syncmodel.fetch")},a.SyncModel=c}(XQCore),function(a,b){"use strict";var c;c=function(c,d){a.ReadyState.call(this),a.Event.call(this);var e=this;"object"==typeof arguments[0]&&(d=c,c=d.name),this.debug=a.debug,d===b&&(d={}),this.__unfiltered={},this.name=(c?c.replace(/List$/,""):"Nameless")+"List",this.items=[],this.maxLength=null,this.model||(this.model=a.Model),"function"==typeof d?d.call(this,e):a.extend(this,d),this.state("ready")},a.extend(c.prototype,a.ReadyState.prototype),a.extend(c.prototype,a.Event.prototype),a.extend(c.prototype,new a.Logger),c.inherit=function(c,d){"object"==typeof c&&(d=c,c=b);var e=function(){a.List.call(this,c,d)};return e.prototype=Object.create(a.List.prototype),e.prototype.constructor=e,e},Object.defineProperty(c.prototype,"length",{get:function(){return this.items.length}}),c.prototype.state=function(a){this.__state=a,this.emit("state."+a),this.emit("state.change",a)},c.prototype.getState=function(){return this.__state},c.prototype.push=function(b,c){var d,e,f=[];c=c||{},Array.isArray(b)||(b=[b]);for(var g=0,h=b.length;h>g;g++){if(e=b[g],e instanceof a.Model?d=e:(d=new this.model("ListItem"),d.set(e)),!d.isValid())return!1;f.push(d)}var i=this.items.push.apply(this.items,f);return this.maxLength&&this.items.length>this.maxLength&&this.items.splice(0,this.items.length-this.maxLength),c.silent||this.emit("item.push",i-f.length,f.length),c.noSync||"function"==typeof this.sync&&this.sync("push",f),!0},c.prototype.unshift=function(b,c){var d,e,f=[];c=c||{},Array.isArray(b)||(b=[b]);for(var g=0,h=b.length;h>g;g++){if(e=b[g],e instanceof a.Model?d=e:(d=new this.model("ListItem"),d.set(e)),!d.isValid())return!1;f.unshift(d)}var i=this.items.unshift.apply(this.items,f);return c.silent||this.emit("item.unshift",i-f.length,f.length),c.noSync||"function"==typeof this.sync&&this.sync("unshift",f),!0},c.prototype.pop=function(a){var c;return a=a||{},c=this.items.pop()||null,c===b?null:(a.silent||this.emit("item.pop",c),a.noSync||"function"==typeof this.sync&&this.sync("pop",c),c)},c.prototype.shift=function(a){var c;return a=a||{},c=this.items.shift()||null,c===b?null:(a.silent||this.emit("item.shift",c),a.noSync||"function"==typeof this.sync&&this.sync("shift",c),c)},c.prototype.update=function(a,b,c){var d;c=c||{},Array.isArray(b)||(b=[b]);for(var e=0,f=b.length;f>e;e++){d=b[e];var g=this.findOne(a);g&&g.set(d,{noSync:!0})}return c.silent||this.emit("item.update"),c.noSync||"function"==typeof this.sync&&this.sync("update",a,b),!0},c.prototype.clear=function(a){if(a=a||{},0===this.items.length)return 0;var b=this.toArray();return this.items=[],a.silent||this.emit("item.clear",b),a.noSync||"function"==typeof this.sync&&this.sync("clear",b),b.length},c.prototype.toArray=function(){return this.items.map(function(a){return a.properties})},c.prototype.findOne=function(a){var b;if(b=this.items)for(var c=0;c<b.length;c++){var d,e=b[c];for(var f in a)if(a.hasOwnProperty(f)){if(e.properties[f]&&e.properties[f]===a[f]){d=!0;break}d=!1}if(d===!0)return e}return null},c.prototype.find=function(a){var b,c=[];if(b=this.items)for(var d=0;d<b.length;d++){var e,f=b[d];for(var g in a)if(a.hasOwnProperty(g)){if(f.properties[g]&&f.properties[g]===a[g]){e=!0;break}e=!1}e===!0&&c.push(f)}return c},c.prototype.each=function(a,b){"function"==typeof a&&(b=a,a=null);for(var c=a,d=0,e=this.items.length;e>d;d++)c=b(c,this.items[d].properties);return c},a.List=c}(XQCore),function(a,b){"use strict";var c;c=function(b,c){this.noAutoRegister=!1,a.List.call(this,b,c),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||a.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},c.prototype=Object.create(a.List.prototype),c.prototype.constructor=c,c.inherit=function(c,d){"object"==typeof c&&(d=c,c=b);var e=function(){a.SyncList.call(this,c,d)};return e.prototype=Object.create(a.SyncList.prototype),e.prototype.constructor=e,e},c.prototype.connectToSocket=function(){var b=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",b),this.socket=new a.Socket(b,this.channel))},c.prototype.register=function(a){var b=this;"boolean"==typeof a&&(this.syncEnabled=a),b.dev("Register synclist at server:",b.name);var c={noSync:!0};b.socket.on("synclist.push",function(a){b.push(a,c)}),b.socket.on("synclist.unshift",function(a){b.push(a,c)}),b.socket.on("synclist.pop",function(){b.push(c)}),b.socket.on("synclist.shift",function(){b.push(c)}),b.socket.on("synclist.update",function(a,d){b.update(a,d,c)}),b.socket.on("synclist.clear",function(){b.clear(c)}),b.socket.on("synclist.init",function(a){console.log("Got initial data request:",a),b.push(a,c)}),b.socket.send("synclist.register",{name:b.name})},c.prototype.unregister=function(){this.dev("Unregister synclist at server:",this.name),this.socket.send("synclist.unregister",{name:this.name}),this.socket.off("synclist.push"),this.socket.off("synclist.unshift"),this.socket.off("synclist.pop"),this.socket.off("synclist.shift"),this.socket.off("synclist.update"),this.socket.off("synclist.clear"),this.socket.off("synclist.init")},c.prototype.emitRemote=function(a,b){this.socket.send(a,b)},c.prototype.sync=function(a){if(this.syncEnabled){var b=Array.prototype.slice.call(arguments,1);b.unshift("syncmodel."+a),this.emitRemote.apply(this,b)}},c.prototype.fetchList=function(){this.emitRemote("synclist.fetch")},a.SyncList=c}(XQCore);