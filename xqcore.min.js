/*!
 * XQCore - +0.11.1-121
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2015 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2015-08-30
 * 
 */
var XQCore;(function(e,t){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery")):e.XQCore=t(e.jQuery)})(this,function(e){"use strict";return XQCore={version:"0.11.1-121",defaultRoute:"index",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire",socketPort:9889},XQCore.extend=e.extend,XQCore.isEmptyObject=e.isEmptyObject,XQCore.isPlainObject=e.isPlainObject,XQCore.isFunction=e.isFunction,XQCore.__moduleCache={},XQCore.isObjectId=function(e){return this.objectIdPattern.test(e)},XQCore.modules={jquery:{cjs:"jquery",amd:"jquery",win:"jQuery"},firetpl:{cjs:"firetpl",amd:"firetpl",win:"fireTpl"},sockjs:{cjs:"xqcore/lib/sockjs.js",amd:"xqcore/lib/sockjs.js",win:"SockJS"}},XQCore.require=function(e){if(XQCore.__moduleCache[e])return XQCore.__moduleCache[e];var t="win";"undefined"!=typeof module&&module.exports&&"function"==typeof require?t="cjs":"function"==typeof define&&define.amd&&(t="amd"),XQCore.modules[e][t]&&(e=XQCore.modules[e][t]);try{if("cjs"===t||"amd"===t)try{return require(e)}catch(n){console.warn("Module not registered as a "+("cjs"===t?"CommonJS":"AMD")+" module! Try to load from window object",e)}return window[e]}catch(n){console.error("Could not load module!",e,n)}},XQCore.setLocale=function(e){localStorage.setItem("xqcore.locale",e)},XQCore.getLocale=function(){var e=localStorage.getItem("xqcore.locale");return e?e:navigator.language},XQCore.logLevel=1,XQCore}),function(e){"use strict";var t=function(t){this.loggerName=t,this.logLevel=e.logLevel};t.prototype.log=function(){var e;this.logLevel>=3&&(e=Array.prototype.slice.call(arguments),3===this.logLevel&&(e=[e[0]]),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.log.apply(console,e))},t.prototype.warn=function(){var e;this.logLevel>=2&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.warn.apply(console,e))},t.prototype.error=function(){var e;this.logLevel>=1&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.error.apply(console,e))},t.prototype.debug=function(){var e;this.logLevel>=4&&(e=Array.prototype.slice.call(arguments),4===this.logLevel&&(e=[e[0]]),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.debug.apply(console,e))},t.prototype.info=t.prototype.log,t.prototype.timer=function(e){var t=this,n={start:null,stop:null,name:e,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+e+" finished after "+t.getHumanTime(this.stop-this.start))}};return this.log("Start Timer "+e),n.start=Date.now(),n},t.prototype.dev=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.debug.apply(console,e))},t.prototype.req=t.prototype.log,t.prototype.res=t.prototype.log,t.prototype.getHumanTime=function(e){return 1e3>e?e+"ms":6e4>e?Math.round(e/100)/10+"sec":Math.round(e/6e4)+"min "+Math.round(e%6e4/1e3)+"sec"},e.Logger=t}(XQCore),function(e){"use strict";function t(){}function n(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}var i=new e.Logger("Event"),o=t.prototype;o.getListeners=function(e){var t,n,i=this._getEvents();if(e instanceof RegExp){t={};for(n in i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n])}else t=i[e]||(i[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;e.length>t;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},o.on=function(e,t){var o,r=this.getListenersAsObject(e),s="object"==typeof t;for(o in r)r.hasOwnProperty(o)&&-1===n(r[o],t)&&r[o].push(s?t:{listener:t,once:!1});return i.debug('Register "'+e+'" as an event listener. Total listener length of this type is: '+r[o].length),this},o.once=function(e,t){return this.on(e,{listener:t,once:!0})},o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},o.off=function(e,t){var o,r,s=this.getListenersAsObject(e),a=0;if(1===arguments.length)return this.removeEvent(e),this;for(r in s)if(s.hasOwnProperty(r)&&(o=n(s[r],t),-1!==o)){var c=s[r].splice(o,1);a=c.length}return i.debug('Remove an event listener of type "'+e+'". Length of removed listeners is: '+a),this},o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var i,o,r=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)r.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(o=t[i])&&("function"==typeof o?r.call(this,i,o):s.call(this,i,o));return this},o.removeEvent=function(e){var t,n,o=typeof e,r=this._getEvents();if("string"===o)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&(n=r[t].length,delete r[t]);else delete this._events;return i.debug('Remove an event listener of type "'+e+'". Length of removed listeners is: '+n),this},o.emitEvent=function(e,t){var n,o,r,s,a=this.getListenersAsObject(e);for(r in a)if(a.hasOwnProperty(r))for(o=a[r].length;o--;)n=a[r][o],n.once===!0&&this.off(e,n.listener),s=n.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.off(e,n.listener);return i.debug('Emit an event of type "'+e+'"',"Args array:",t),this},o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},o._getEvents=function(){return this._events||(this._events={})},e.Event=t}(XQCore),function(e){"use strict";var t,n=e.require("jquery"),i=function(i,o){var r=this;"function"==typeof arguments[0]&&(o=i,i=null),this.name=i||"Nameless",this.__Router=new e.Router,t=new e.Logger(this.name+"Presenter"),this.__views={},"function"==typeof o&&o.call(this,r,t),e.html5Routes?window.addEventListener("popstate",function(e){r.__onPopstate(e.state)},!1):window.addEventListener("hashchange",function(e){r.__onPopstate(e.state)},!1);var s=e.defaultRoute;if(/^#![a-zA-Z0-9]+/.test(r.getHash())&&(s=r.getHash().substr(2)),s=r.__Router.match(s)){var a=s.params;e.callerEvent&&(a[e.callerEvent]="pageload"),n(function(){t.info("Trigger route",s,a),s.fn.call(r,s.params)})}};e.extend(i.prototype,new e.Event),i.prototype.init=function(){},i.prototype.pushState=function(t,n){var i=e.html5Routes||"/"===n.charAt(0)?"":e.hashBang;n=i+n,history.pushState(t,"",n||null),this.log("Update history with pushState",t,n)},i.prototype.replaceState=function(t,n){var i=e.html5Routes||"/"===n.charAt(0)?"":e.hashBang;n=i+n,history.replaceState(t,"",n||null),this.log("Update history with replaceState",t,n)},i.prototype.navigateTo=function(t,n,i){if(this.log("Navigate to route: ",t,n,i),i=i||{},e.html5Routes){i.replace?this.replaceState(n,t):this.pushState(n,t);var o=new PopStateEvent("popstate",{bubbles:!1,cancelable:!1,state:null});window.dispatchEvent(o)}else{var r=e.hashBang+t;if(i.trigger!==!1&&location.hash===r)return this.__onPopstate(),undefined;location.hash=r}},i.prototype.navigateBack=function(){history.back()},i.prototype.getView=function(e){return this.__views[e]||null},i.prototype.getHash=function(){return location.hash},i.prototype.getPathname=function(){return location.pathname},i.prototype.couple=function(n,i,o){var r,s=null;o=o||{},!n instanceof e.View&&t.error("First arg is not a valid view in "+this.name+" presenter.couple()!"),(!i instanceof e.Model||!i instanceof e.List)&&t.error("Second arg is not a valid model or list in "+this.name+" presenter.couple()!"),i instanceof e.List&&(s=i,i=null);var a=e.extend({"data.replace":"xrender","data.item":"xrender","data.append":"xrender","data.prepend":"xrender","data.insert":"insert","data.remove":"remove","validation.error":"validationFailed","state.change":"onStateChange"},o.modelEvents),c=e.extend({"item.push":"xrender","item.unshift":"xrender","item.pop":"xrender","item.shift":"xrender","item.update":"xrender","state.change":"onStateChange"},o.listEvents),l=e.extend({"form.submit":"submit"},o.viewEvents);if(!n instanceof e.View)return t.error("Can't couple view with model! View isn't a XQCore.View"),undefined;if(i&&!i instanceof e.Model)return t.error("Can't couple model with model! Model isn't a XQCore.Model"),undefined;if(s&&!s instanceof e.List)return t.error("Can't couple list with list! List isn't a XQCore.List"),undefined;i&&t.info("Couple view ",n.name,"with model",i.name),s&&t.info("Couple view ",n.name,"with list",s.name),n.__coupledWith||(n.__coupledWith=[]),i&&!i.__coupledWith&&(i.__coupledWith=[]),s&&!s.__coupledWith&&(s.__coupledWith=[]),i&&(n.__coupledWith.some(function(e){return e===i})||n.__coupledWith.push(i),i.__coupledWith.some(function(e){return e===n})||i.__coupledWith.push(n)),s&&(n.__coupledWith.some(function(e){return e===s})||n.__coupledWith.push(s),s.__coupledWith.some(function(e){return e===n})||s.__coupledWith.push(n));var h,u=function(e,t){var o=function(){if("xrender"===t)n.render(i.get());else{var o=Array.prototype.slice.call(arguments);o.push(i.name,e),n[t].apply(n,o)}};o.fnType="coupled-model-listener",o.fnParent=n,i.on(e,o)},p=function(e,t){var i=function(){if("xrender"===t)n.render(s.toArray());else{var i=Array.prototype.slice.call(arguments);i.push(s.name,e),n[t].apply(n,i)}};i.fnType="coupled-list-listener",i.fnParent=n,s.on(e,i)};if(i){h=function(e,t){var o=function(e,o){i[t](e,o,n.name)};o.fnType="coupled-view-listener",o.fnParent=i,n.on(e,o)};for(r in a)a.hasOwnProperty(r)&&u(r,a[r])}if(s){h=function(e,t){var i=function(e,i){s[t](e,i,n.name)};i.fnType="coupled-view-listener",i.fnParent=s,n.on(e,i)};for(r in c)c.hasOwnProperty(r)&&p(r,c[r])}for(r in l)l.hasOwnProperty(r)&&h(r,l[r]);return i&&n.render(i.properties),s&&n.render(s.toArray()),o.forms&&n.formSetup(i),this},i.prototype.__onPopstate=function(n){var i=this;t.info("popstate event recived",n,i);var o=e.defaultRoute;if(e.html5Routes){var r=RegExp("^"+i.root);o=i.getPathname().replace(r,"")}else/^#!\S+/.test(this.getHash())&&(o=i.getHash().substr(2));o=i.__Router.match(o),o&&(n=n||o.params,e.callerEvent&&(n[e.callerEvent]="popstate"),t.info("Trigger route",o,n),o.fn.call(i,n))},i.prototype.initView=function(t,n,i){i=i||{};var o={};i.viewDir&&(o.viewDir=i.viewDir);var r=new e.View(t,function(r){r.template=e.Tmpl.getTemplate(t,o),r.mode=i.mode||"replace",r.container=n||"body",r.hidden=!!i.hidden,i.inject===!1&&(r.autoInject=!1)});return this.__views[t]=r,r},i.prototype.route=function(e,n){var i=this;"string"==typeof n&&(n=this[n]),"function"==typeof n?"string"==typeof e?(t.info("Register route",e,"with callback",n),this.__Router.addRoute(e,n)):Array.isArray(e)&&e.forEach(function(e){t.info("Register route",e,"with callback",n),i.__Router.addRoute(e,n)}):t.warn("Router callback isn't a function",n,"of route",e)},e.Presenter=i}(XQCore),function(e,t){"use strict";var n=e.require("jquery"),i=function(){};i.prototype.onSend=function(e){return e},i.prototype.send=function(e,i,o,r){var s=this;"object"==typeof i?(r=o,o=i,i=this.server,e=e):"function"==typeof o?(r=o,o=this.get()):o===t&&(o=this.get()),e===t&&(e="POST"),i||(i=this.server),"GET"===e&&Array.isArray(o)&&(i=i.replace(/\/$/,"")+"/"+o.join("/"),o=null),"function"==typeof this.onSend&&(o=this.onSend.call(this,o)),this.log("Send an ajax call to ",i,"with data: ",o),this.state("syncing"),n.ajax({url:i,type:e,data:o,dataType:"json",success:function(e,t,n){"function"==typeof r&&r.call(s,null,e,t,n),s.state("success")},error:function(e,t,n){"function"==typeof r&&r.call(s,{type:t,http:n},null,t,e),s.state("failed")}})},i.prototype.sendPOST=function(e,t,n){this.send("POST",e,t,n)},i.prototype.sendGET=function(e,t,n){this.send("GET",e,t,n)},i.prototype.sendPUT=function(e,t,n){this.send("PUT",e,t,n)},i.prototype.sendDELETE=function(e,t,n){this.send("DELETE",e,t,n)},i.prototype.ready=function(e){var t=this;e===!0?(Array.isArray(this.__callbacksOnReady)&&(this.log("Trigger ready state"),this.__callbacksOnReady.forEach(function(e){e.call(t)})),this.__isReady=!0,delete this.__callbacksOnReady):"function"==typeof e?this.__isReady===!0?e():(this.__callbacksOnReady||(this.__callbacksOnReady=[]),this.__callbacksOnReady.push(e)):this.warn("arg0 isn't a callback in model.ready()!")},i.prototype.fetch=function(e,t){this.sendGET(e,t)},i.prototype.save=function(e,t){"function"==typeof e&&(t=e,e=this.schema?this.getByKeys(Object.keys(this.schema)):this.get()),this.isValid()?this.sendPOST(e,t):"function"==typeof t&&t({msg:"Model isn't valid. Cancle save"})},i.prototype.update=function(e,t){"function"==typeof e&&(t=e,e=this.schema?this.getByKeys(Object.keys(this.schema)):this.get()),this.isValid()?this.sendPUT(e,t):"function"==typeof t&&t({msg:"Model isn't valid. Cancel update"})},i.prototype.submit=function(e){if(this.set(e,{extend:!0})){if(e.id===t||null===e.id)return this.save(e),t;this.update(e)}},e.Sync=i}(XQCore),function(XQCore,undefined){"use strict";var Model;Model=function(e,t){"object"==typeof arguments[0]&&(t=e,e=t.name),this.debug=XQCore.debug,this.properties={},t===undefined&&(t={}),"function"==typeof t?t.call(this,this):XQCore.extend(this,t),this.__state="starting",this.__unfiltered={},this.customValidate=t.validate,delete t.validate,this.conf=t,this.name=(e?e.replace(/Model$/,""):"Nameless")+"Model",this._isValid=!1,this.defaults&&!XQCore.isEmptyObject(this.defaults)&&this.set(this.defaults,{silent:!0,noValidation:!0}),this._isValid=!this.schema,this.state("ready")},XQCore.extend(Model.prototype,new XQCore.Event,new XQCore.Logger),XQCore.Sync&&XQCore.extend(Model.prototype,XQCore.Sync.prototype),Model.inherit=function(e,t){"object"==typeof e&&(t=e,e=undefined);var n=function(){XQCore.Model.call(this,e,t)};return n.prototype=Object.create(XQCore.Model.prototype),n.prototype.constructor=n,n},Model.prototype.init=function(){console.warn("Model.init is deprecated since v0.10.0")},Model.prototype.state=function(e){this.__state=e,this.emit("state."+e),this.emit("state.change",e)},Model.prototype.getState=function(){return this.__state},Model.prototype.set=function(e,t,n){var i,o={},r=this.get(),s=!1,a=!1;if(n=n||{},null===arguments[0])o=arguments[1],a=!0,this.log("Set data",o,r);else if("object"==typeof arguments[0])n=t||{},o=n.replace?arguments[0]:XQCore.extend(o,r,arguments[0]),a=!0,e=null,this.log("Set data",o,r);else if("string"==typeof arguments[0]){if(o=XQCore.extend({},this.get()),s=!0,XQCore.dedotify(o,e,t),this.log("Set data",o,r),n=n||{},!this.customValidate&&n.validateOne&&(n.noValidation=!0,i=this.validateOne(this.schema[e],t),i.isValid===!1))return i.error=i.error||{},i.error.property=e,this.warn("Validation error in model.set of property",e,i),n.silent!==!0&&this.emit("validation.error",i,o),!1}else this.warn("Data are incorrect in model.set()",arguments);return n=n||{},!this.customValidate&&this.schema&&n.noValidation!==!0&&(i=this.validate(o),null!==i)?(this.warn("Validate error in model.set",i),n.silent!==!0&&this.emit("validation.error",i,o),!1):this.customValidate&&n.noValidation!==!0&&(i=this.customValidate(o),this.log("Using a custom validation which returns:",i),null!==i)?(this.warn("Validate error in model.set",i),this.emit("validation.error",i,o),!1):(this.properties=o,n.silent!==!0&&(a?n.noSync||"function"!=typeof this.sync?this.emit("data.replace",o,r):this.sync("set",o):s&&(n.noSync||"function"!=typeof this.sync||this.sync("item",e,t),this.emit("data.item",e,t)),this.emit("data.change",o,r)),!0)},Model.prototype.get=function(key,options){options=options||{};var data;if("object"==typeof key&&1===arguments.length&&(options=key,key=null),key===undefined||null===key){if(options.copy===!0)switch(data=this.properties,typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+(""+data)+")");default:return data}return this.properties}if(options.copy===!0)switch(data=XQCore.undotify(key,this.properties),typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+(""+data)+")");default:return data}return XQCore.undotify(key,this.properties)},Model.prototype.getByKeys=function(e,t){if("object"!=typeof e)throw Error("First param must be an object or array in Model.getByKeys()!");var n={};if(t=t||this.get(),Array.isArray(e))e.forEach(function(e){-1===e.indexOf(".")?n[e]=t[e]:n=XQCore.dedotify(n,e,XQCore.undotify(e,t))});else for(var i in e)if(e.hasOwnProperty(i)){var o=t[i];n[i]="object"==typeof o?this.getByKeys(e[i],t[i]):t[i]}return n},Model.prototype.has=function(e){var t=!0,n=this.properties;e=e.split(".");for(var i=0,o=e.length;o>i;i++){if("object"!=typeof n||!n.hasOwnProperty(e[i])){t=!1;break}n=n[e[i]]}return t},Model.prototype.reset=function(e){e=e||{},this.log("Reset model");var t=this.get();return this.properties=XQCore.extend({},this.defaults),this.state("starting"),e.removeListener&&this.removeEvent(),e.silent||this.emit("data.reset",t),e.noSync||"function"==typeof this.sync&&this.sync("reset",t),t},Model.prototype.append=function(e,t,n){var i=XQCore.undotify(e,this.properties);if(n=n||{},i instanceof Array)i.push(t);else if(i===undefined)XQCore.dedotify(this.properties,e,[t]);else{if("object"!=typeof i||e||!XQCore.isEmptyObject(this.properties))return this.error("Model.append requires an array. Dataset isn't an array. Path: ",e),undefined;this.properties=[t]}n.silent!==!0&&(n.noSync||"function"!=typeof this.sync||this.sync("append",e,t),this.emit("data.append",e,t),this.emit("data.change",this.properties))},Model.prototype.prepend=function(e,t,n){var i=XQCore.undotify(e,this.properties);if(n=n||{},i instanceof Array)i.unshift(t);else if(i===undefined)XQCore.dedotify(this.properties,e,[t]);else{if("object"!=typeof i||e||!XQCore.isEmptyObject(this.properties))return this.error("Model.prepend requires an array. Dataset isn't an array. Path: ",e),undefined;this.properties=[t]}n.silent!==!0&&(n.noSync||"function"!=typeof this.sync||this.sync("prepend",e,t),this.emit("data.prepend",e,t),this.emit("data.change",this.properties))},Model.prototype.insert=function(e,t,n,i){var o=XQCore.undotify(e,this.properties);if(i=i||{},o instanceof Array)o.splice(t,0,n);else if(o===undefined)XQCore.dedotify(this.properties,e,[n]);else{if("object"!=typeof o||e||!XQCore.isEmptyObject(this.properties))return this.error("Model.insert requires an array. Dataset isn't an array. Path: ",e),undefined;this.properties=[n]}i.silent!==!0&&(i.noSync||"function"!=typeof this.sync||this.sync("insert",e,t,n),this.emit("data.insert",e,t,n),this.emit("data.change",this.properties))},Model.prototype.remove=function(e,t,n){var i=XQCore.undotify(e,this.properties),o=null;if(n=n||{},i instanceof Array)o=i.splice(t,1);else if("object"==typeof i)return this.error("Model.remove requires an array. Dataset isn't an array. Path: ",e),undefined;return o&&n.silent!==!0&&(n.noSync||"function"!=typeof this.sync||this.sync("remove",e,t),this.emit("data.remove",e,t,o[0]),this.emit("data.change",this.properties)),o},Model.prototype.repalce=function(e,t){return t=t||{},t.repalce=!0,this.set(e,t)},Model.prototype.search=function(e,t){var n;if(1===arguments.length?(t=e,e="",n=this.properties):n=e?XQCore.undotify(e,this.properties):this.properties,n)for(var i=0;n.length>i;i++){var o,r=n[i];for(var s in t)if(t.hasOwnProperty(s)){if(r[s]&&r[s]===t[s]){o=!0;break}o=!1}if(o===!0)return r}return null},Model.prototype.modify=function(e,t,n){var i=this.search(e,t);i&&(XQCore.extend(i,n),this.emit("data.modify",e,n,i),this.emit("data.change",this.properties))},Model.prototype.sortBy=function(e,t){1===arguments.length&&(t=e,e=null);var n,i=XQCore.undotify(e,this.properties);return Array.isArray(i)?(i.sort(function(e,i){n=-1;for(var o in t)if(t.hasOwnProperty(o)){if(n=(XQCore.undotify(o,e)+"").localeCompare(XQCore.undotify(o,i)+""),0===n)continue;-1===t[o]&&(n=n>0?-1:1);break}return n}),this.set(e,i),i):(this.warn("Could not sort data of type",typeof i),[])},Model.prototype.filter=function(e,t,n,i){if(1===arguments.length&&(i=e,e=null),"string"==typeof i){if(!this.__registeredFilter[i])throw Error("Filter "+i+" not registered!");i=this.__registeredFilter[i]}for(var o=XQCore.undotify(e,this.__unfiltered.data||this.properties),r=[],s=0,a=o.length;a>s;s++)i(t,n,o[s])&&r.push(o[s]);return this.__unfiltered={path:e,data:o},this.set(e,r),r},Model.prototype.filterReset=function(e){this.__unfiltered&&this.set(this.__unfiltered.path,this.__unfiltered.data,e)},Model.prototype.validate=function(e,t){var n=this,i=[];return t=t||this.schema,t&&Object.keys(t).forEach(function(o){if("object"==typeof e[o]&&t[o].type===undefined){var r=n.validate(XQCore.extend({},e[o]),XQCore.extend({},t[o]));return Array.isArray(r)&&r.length>0&&(i=i.concat(r)),undefined}var s=n.validateOne(t[o],e[o]);s.isValid===!0?e[o]=s.value:(s.error.property=o,i.push(s.error))}),0===i.length?(this._isValid=!0,this.state("valid"),null):(this._isValid=!1,this.state("invalid"),i)},Model.prototype.validateOne=function(e,t){var n,i="function"==typeof e.type?typeof e.type():e.type.toLowerCase();if(""===t&&e.noEmpty===!0&&(t=undefined),t!==undefined&&null!==t&&""!==t||!e["default"]||(t=e["default"]),t===undefined||null===t||""===t)e.required===!0&&(n={msg:"Property is undefined or null, but it's required",errCode:10});else{if(!this.__registeredValidations[i])throw Error("Undefined schema type",e);n=this.__registeredValidations[i].call(this,t,e)}return n=n===undefined?{isValid:!0,value:t,error:null}:{isValid:!1,value:t,error:n}},Model.prototype.isValid=function(){return this._isValid},Model.prototype.setData=function(e){this.warn("Model.setData has been deprecated since v0.9"),this.set(e,{extend:!0})},Model.registerFilter=function(e,t){if("function"!=typeof t)throw Error("Filter function isn't a function");var n="function"==typeof this?Model.prototype:this;n.__registeredFilter[e]=t},Model.prototype.registerFilter=Model.registerFilter,Model.prototype.__registeredFilter={quicksearch:function(e,t,n){var i=XQCore.undotify(e,n),o=RegExp(t.replace(/[a-z0-9äüöß]/g,"$&.*"),"i");return o.test(i)}},Model.registerValidation=function(e,t){var n="function"==typeof this?Model.prototype:this;n.__registeredValidations[e]=t},Model.prototype.registerValidation=Model.registerValidation,Model.prototype.__registeredValidations={string:function(e,t){return t.convert&&"number"==typeof e&&(e+=""),"string"!=typeof e?{msg:"Property type is a "+typeof e+", but a string is required",errCode:11}:t.min&&t.min>e.length?{msg:"String length is too short",errCode:12}:t.max&&t.max<e.length?{msg:"String length is too long",errCode:13}:t.match&&!t.match.test(e)?{msg:"String doesn't match regexp",errCode:14}:undefined},number:function(e,t){return t.convert&&"string"==typeof e&&(e=parseInt(e,10)),"number"!=typeof e||isNaN(e)?{msg:"Property type is not a valid number",errCode:21}:t.min&&t.min>e?{msg:"Number is too low",errCode:22}:t.max&&e>t.max?{msg:"Number is too high",errCode:23}:undefined},date:function(e){if(e){var t=Date.parse(e);if(isNaN(t))return{msg:"Property isn't a valid date",errCode:31}}},array:function(e,t){return Array.isArray(e)?t.min&&t.min>e.length?{msg:"Array length is "+e.length+" but must be greater than "+t.min,errCode:42}:t.max&&t.max<e.length?{msg:"Array length is "+e.length+" but must be lesser than "+t.max,errCode:43}:undefined:{msg:"Property type is a "+typeof e+", but an array is required",errCode:41}},object:function(e){return"object"!=typeof e?{msg:"Property isn't a valid object",errCode:51}:undefined},objectid:function(e){return/^[a-zA-Z0-9]{24}$/.test(e)?undefined:{msg:"Property isn't a valid objectId",errCode:52}},"boolean":function(e){return"boolean"!=typeof e?{msg:"Property isn't a valid boolean",errCode:61}:undefined},time:function(e){return/^\d+(:\d{2}){1,3}$/.test(e)?undefined:{msg:"Property isn't a valid time",errCode:61}}},XQCore.Model=Model}(XQCore),function(e,t){"use strict";if("function"==typeof define&&define.amd)define("xqcore",[XQCore.templateEngine],t);else if("undefined"!=typeof module&&module.exports)module.exports=t(require(XQCore.templateEngine));else{var n="firetpl"===XQCore.templateEngine?"FireTPL":"Handlebars";e.XQCore=t(e[n])}}(this,function(e){"use strict";return XQCore.Tmpl={type:XQCore.templateEngine,compile:e.compile,getTemplate:function(t,n){if(n=n||{},"firetpl"===XQCore.templateEngine){var i=e;if(i.templateCache&&i.templateCache[t])return i.templateCache[t];if(i.loadFile){var o=n.viewDir||XQCore.viewsDir,r=i.readFile(o.replace(/\/$/,"")+"/"+t+"."+XQCore.viewExt.replace(/^\./,""));return i.compile(r,{eventAttrs:!0})}throw Error("FireTPL runtime is being used. Please preload the "+t+"View")}}},XQCore}),function(e,t){"use strict";var n,i=e.require("jquery"),o=function(o,r){"object"==typeof arguments[0]||"function"==typeof arguments[0]?(r=o,o=null):"string"==typeof arguments[0]&&(this.name=o),n=new e.Logger(this.name+"View"),this.container="body",this.tag=t,this.className=t,this.id=t,this.mode="replace",this.autoInject=!0,this.__domReady=!1,this.__viewEvents=[];var s=this;"function"==typeof r?r.call(this,s):e.extend(this,r),this.name=(this.name?this.name.replace(/View$/,""):"Nameless")+"View",this.__createView(),i(function(){s.container.length>0?(window.addEventListener("resize",function(e){s.resize(e)},!1),n.info("Initialize view "+this.name," with conf:",r),n.info(" ... using Container:",s.container)):n.error("Can't initialize View, Container not found!",s.container)})};e.extend(o.prototype,new e.Event),o.prototype.show=function(){this.$el.show()},o.prototype.hide=function(){this.$el.hide()},o.prototype.renderHTML=function(t,i){return n.log("Render html snippet",t,"with data:",i),t="function"==typeof t?t:e.Tmpl.compile(t),t(i)},o.prototype.resize=function(){},o.prototype.getElementData=function(e){var n=i(e,this.container);if(n.length){var o,r={},s=n.get(0).attributes;for(o=0;s.length>o;o++)if(0===s[o].name.indexOf("data-")){var a=s[o].name.substr(5),c=s[o].value;if("string"==typeof c)try{c="true"===c||"TRUE"===c?!0:"false"===c||"FALSE"===c?!1:"null"===c||"NULL"===c?null:"undefined"===c?t:+c+""===c?+c:JSON.parse(c)}catch(l){}r[a]=c}return r}return null},o.prototype.validationFailed=function(e){var t=this;e.forEach(function(e){t.$el.find('[name="'+e.property+'"]').addClass("xq-invalid")})},o.prototype.onStateChange=function(e){var t=this.el.className.split(" ");t=t.filter(function(e){return!/^xq-state-/.test(e)}),t.push("xq-state-"+e),this.el.className=t.join(" ")},o.prototype.ready=function(e){this.isReady?e.call(this):(this.__readyCallbacks||(this.__readyCallbacks=[]),this.__readyCallbacks.push(e))},o.prototype.__setReadyState=function(){var e=this;this.isReady=!0,this.__readyCallbacks&&(this.__readyCallbacks.forEach(function(t){t.call(e)}),this.__readyCallbacks=[])},o.prototype.inject=function(){if(this.el.parentNode!==this.ct)if(n.info("Inject view into container",this.$ct),"replace"===this.mode)this.$ct.contents().detach(),this.$ct.append(this.$el);else if("append"===this.mode)this.$ct.append(this.$el);else{if("prepend"!==this.mode)throw Error("Unknown insert mode in view constructor");this.$ct.prepend(this.$el)}},o.prototype.parse=function(e,t,n){var o,r;e.scopeStore={},e.scopes=n||{};try{o=e(t||{},e.scopes)}catch(s){o='<p class="renderError"><b>View render error!</b><br>'+s.message+"</p>",this.error("View render error!",s)}var a=function(t,n,o){t=i.parseHTML(t);var r=i(t),s=r.find("scope"),c={};return s.each(function(){var t,r=i(this).attr("id"),s=i(this).attr("path"),l=o?o+"."+s:s,h=n;if(Array.isArray(n)&&(c[s]=c[s]||0,h=n[c[s]++]),t={},r){var u=e.scopes[r](n[s],n);t.value=u?a(u,n[s],l):document.createTextNode(""),t.id=r}else t.value=i.parseHTML(n[s]);e.scopeStore[l]=e.scopeStore[l]||[],e.scopeStore[l].push(t),i(this).replaceWith(i(t.value))}),r};return o&&(r=a(o,t)),r},o.prototype.render=function(i){if(this.__domReady===!1)return this.__initialData=i||{},t;this.autoInject&&this.inject();var o;n.info("Render view template of view "+this.name,"with data:",i);var r="function"==typeof this.template?this.template:e.Tmpl.compile(this.template);this.scopes={};try{o=r(i||{},this.scopes)}catch(s){o='<p class="renderError"><b>View render error!</b><br>'+s.message+"</p>",this.error("View render error!",s)}this.el.innerHTML=o,this.emit("content.change",i),this.registerListener(this.$el)},o.prototype.registerListener=function(e){console.log("REG LISTENER");var t=this;e.find("[on]").addBack("[on]").each(function(){var e,n=i(this),o=i(this).attr("on"),r=i(this).data();n.removeAttr("on"),console.log(" ... NEW LISTENER",o),o=o.split(";"),o.forEach(function(i){i=i.split(":"),e="submit"===i[0]?function(e){e.preventDefault(),r=t.serializeForm(e.target),r=t.onSubmit(r,e.target),t.emit(i[1],r,e)}:function(e){var n;e.originalEvent instanceof KeyboardEvent?n={key:e.key,code:e.keyCode,alt:e.altKey,ctrl:e.ctrlKey,meta:e.metaKey,shift:e.shiftKey}:e.originalEvent instanceof MouseEvent?(e.preventDefault(),n={button:e.button,alt:e.altKey,ctrl:e.ctrlKey,meta:e.metaKey,shift:e.shiftKey},"click"===e.type&&e.currentTarget.href&&(n.href=e.currentTarget.href)):(e.preventDefault(),n=e.currentTarget.value||""),t.emit(i[1],n,r,e)},n.bind(i[0],e)})}),this.__viewEvents.forEach(function(e){t.$el.delegate(e.selector,e.events,e.callback)})},o.prototype.serializeForm=function(t){var o={},r=i(t);return"INPUT"!==r.get(0).tagName&&(r=r.find(":input")),r.serializeArray().forEach(function(t){e.dedotify(o,t.name,t.value)}),n.info("Serialize form of view "+this.name,"form selector:",r,"form data:",o),o},o.prototype.insert=function(e,t,n){var o=this,r=this.$el.find('[fire-path="'+e+'"]');r.length&&r.each(function(){var e=i(this).attr("fire-scope"),r=o.scopes[e]([n]),s=i(this).children();t>-1?(t>s.length-1&&(t=s.length-1),s.eq(t).before(r)):s.eq(t).after(r)})},o.prototype.update=function(){n.warn("XQCore doesn`t support update events yet")},o.prototype.append=function(e,t){this.insert(e,-1,t)},o.prototype.prepend=function(e,t){this.insert(e,0,t)},o.prototype.remove=function(e,t){var n=this.$el.find('[fire-path="'+e+'"]');n.children(":eq("+t+")").remove()},o.prototype.formSetup=function(e,t){var n=this;this.ready(function(){var o="xq-invalid",r="xq-disabled";t||(t=this.$el.find("form"));var s=function(){var t=i(this).closest("form"),n=i(this);n.removeClass(o);var s=n.attr("name"),a=n.val();if(s&&e.schema&&e.schema[s]){var c=e.validateOne(e.schema[s],a);c.isValid?0===t.find(':input[class~="'+o+'"]').length&&(t.removeClass(o),t.find(":submit").removeAttr("disabled").removeClass(r)):(n.addClass(o),t.addClass(o),t.find(":submit").attr("disabled","disabled").addClass(r))}},a=function(e){e.preventDefault();var t=n.serializeForm(e.target);n.emit("form.submit",t)};this.addEvent(":input","blur",s),this.addEvent("form","submit",a)})},o.prototype.onSubmit=function(e){return e},o.prototype.destroy=function(){if(this.$el.remove(),this.removeAllListeners(),this.__coupledWith)for(var e=0,t=this.__coupledWith.length;t>e;e++){var i=this.__coupledWith[e];if(i._events)for(var o in i._events)if(i._events[o])for(var r=o,s=0,a=i._events[o].length;a>s;s++)"coupled-model-listener"===i._events[o][s].listener.fnType&&i._events[o][s].listener.fnParent===this&&i.removeEvent(r,i._events[o][s].listener)}n.info("View "+this.name+" has been destroyed")},o.prototype.addEvent=function(e,t,n){this.__viewEvents.push({events:t,selector:e,callback:n}),this.$el&&this.$el.delegate(e,t,n)},o.prototype.__viewTagTypes={"*":"div",body:"section",section:"section",ul:"li",table:"tbody",tbody:"tr",tr:"td"},o.prototype.__createViewElement=function(){if(this.tag)return document.createElement(this.tag);var e=this.ct?this.ct.tagName.toLowerCase():"*",t=this.__viewTagTypes["*"];
return this.__viewTagTypes[e]&&(t=this.__viewTagTypes[e]),document.createElement(t)},o.prototype.__createView=function(){var e=this,t=[];i(function(){e.$ct=e.$ct||i(e.container),e.ct=e.$ct.get(0),e.el=e.__createViewElement(),e.$el=i(e.el),t.push("xq-view xq-"+e.name.replace(/View$/,"-view").toLowerCase()),e.id&&e.el.setAttribute("id",e.id),e.className&&t.push(e.className),e.hidden===!0&&(t.push("xq-hidden"),e.$el.hide()),e.el.className=t.join(" "),e.__domReady=!0,e.__initialData&&(e.render(e.__initialData),delete e.__initialData),e.__setReadyState(),e.registerListener(e.$el)})},e.View=o}(XQCore),function(e,t){"use strict";e.undotify=function(e,n){return e&&(e=e.split("."),e.forEach(function(e){n=n?n[e]:t})),n},e.dedotify=function(e,n,i){"string"==typeof e&&(i=n,n=e,e={});var o=e;if(n){n=n.split(".");var r=n.length;n.forEach(function(n,o){return o===r-1?/\[\]$/.test(n)?(n=n.substr(0,n.length-2),e[n]||(e[n]=[]),e[n].push(i),t):(e[n]=i,t):(e[n]||(e[n]={}),e=e[n],t)})}return e=i,o},e.uid=function(e){e=e||7;for(var t="";e>t.length;){var n=Math.random().toString(36).substr(2);t+=n}return t.substr(0,e)}}(XQCore),function(e){"use strict";e.getQuery=function(t){return e.__query||(e.__query={},location.search.substr(1).split("&").forEach(function(t){if(t=t.split("="),t&&t[0]){var n=encodeURI(t[1]);e.__query[t[0]]=isNaN(n)?n:Number(n)}})),t?e.__query[t]:e.__query}}(XQCore),function(e){"use strict";var t=function(e){var t,i,o=[];return e instanceof RegExp?(i=e,t=""+e):(i=n(e,o),t=e),{re:i,src:""+e,keys:o}},n=function(e,t){return e=e.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,n,i,o,r,s){return t.push(o),n=n||"",""+(s?"":n)+"(?:"+(s?n:"")+(i||"")+(r||"([^/]+?)")+")"+(s||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)"),RegExp("^"+e+"$","i")},i=function(e,t){for(var n,i=0,o=e.length;o>i;++i){var r,s=e[i],a=s.re,c=s.keys,l=[],h={};if(n=a.exec(t)){for(r=1,o=n.length;o>r;++r){var u=c[r-1],p="string"==typeof n[r]?decodeURIComponent(n[r]):n[r];u?h[u]=p:l.push(p)}return{params:h,splats:l,route:s.src}}}},o=function(t){t=e.extend({debug:!1},t),this.debug=Boolean(t.debug),this.routes=[],this.routeMap={}};o.prototype.addRoute=function(e,n){if(!e)throw Error(" route requires a path");if(!n)throw Error(" route "+(""+e)+" requires a callback");var i=new t(e);i.fn=n,this.routes.push(i),this.routeMap[e]=n},o.prototype.match=function(e){var t=i(this.routes,e);return t&&(t.fn=this.routeMap[t.route]),t},o.prototype.fire=function(e,t){e=this.match(e),e&&e.fn(t)},e.Router=o}(XQCore),function(e){"use strict";var t=new e.Logger("SocketConnection");t.logLevel=5;var n=e.require("sockjs"),i={},o=function(e){return i[e]?i[e]:(i[e]=this,this.__isReady=!1,this.__onReadyCallbacks=[],this.__channels={},this.conn=null,this.connect(e),this.autoReconnect=!0,this.reconnectionInterval=1500,void 0)};o.prototype.connect=function(e){var i=this;this.conn&&"disconnected"!==this.connectionState||(t.info("Connect to socket server ",e),this.conn=new n(e,null,{debug:t.logLevel>=4}),this.connectionState="connecting",this.conn.onopen=function(){t.info("Connection was successful!"),i.setReady(),i.connectionState="connected"},this.conn.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(o){console.error("Could not parse socket message!",e.data)}if(!n.channel)throw Error("No socket channel was sent!");t.info("Got socket message",n.eventName,"in channel "+n.channel,n.args);var r=n.args||[];r.unshift(n.eventName),i.__channels[n.channel]?i.__channels[n.channel].emit.apply(i.__channels[n.channel],r):t.info(" ... channel not found!",n.channel)},this.conn.onclose=function(n){i.connectionState="disconnected",i.unsetReady(),t.warn("Connection to "+e+" closed!",n),i.autoReconnect&&(t.info("Try to reconnect to "+e),setTimeout(function(){i.connect(e)},i.reconnectionInterval))},console.log("CONN",this.conn))},o.prototype.registerChannel=function(e,n){t.info("Register new channel",e),this.__channels[e]?t.info(" ... channel already registered!"):this.__channels[e]=n},o.prototype.unregisterChannel=function(e){t.info("Unregister channel",e),this.__channels[e]?delete this.__channels[e]:t.info(" ... channel not found!")},o.prototype.send=function(e,n){var i=this,o=Array.prototype.slice.call(arguments,2);this.ready(function(){t.info("Send socket message to channel "+e,n,o),i.conn.send(JSON.stringify({channel:e,eventName:n,args:o}))})},o.prototype.ready=function(e){this.__isReady?e.call(this):this.__onReadyCallbacks.push(e)},o.prototype.setReady=function(){var e=this;this.__isReady=!0,this.__onReadyCallbacks.forEach(function(t){t.call(e)}),this.__onReadyCallbacks=[]},o.prototype.unsetReady=function(){this.__isReady=!1},e.SocketConnection=o}(XQCore),function(e){"use strict";var t=new e.Logger("Socket");t.logLevel=5;var n=function(t,n){this.__isReady=!1,this.__onReadyCallbacks=[],this.channel=n,this.socket=new e.SocketConnection(t),this.socket.registerChannel(n,this)};e.extend(n.prototype,new e.Event),n.prototype.send=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.channel),this.socket.send.apply(this.socket,e)},e.Socket=n}(XQCore),function(e,t){"use strict";var n;n=function(t,n){this.noAutoRegister=!1,e.Model.call(this,t,n),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||e.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},n.prototype=Object.create(e.Model.prototype),n.prototype.constructor=n,n.inherit=function(n,i){"object"==typeof n&&(i=n,n=t);var o=function(){e.SyncModel.call(this,n,i)};return o.prototype=Object.create(e.SyncModel.prototype),o.prototype.constructor=o,o},n.prototype.connectToSocket=function(){var t=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",t),this.socket=new e.Socket(t,this.channel))},n.prototype.register=function(e){var t=this;this.syncEnabled=!!e,t.dev("Register syncmodel at server:",t.name);var n={noSync:!0};t.socket.on("syncmodel.set",function(e){t.set(e,n)}),t.socket.on("syncmodel.item",function(e,i){t.set(e,i,n)}),t.socket.on("syncmodel.append",function(e,i){t.append(e,i,n)}),t.socket.on("syncmodel.prepend",function(e,i){t.prepend(e,i,n)}),t.socket.on("syncmodel.insert",function(e,i,o){t.insert(e,i,o,n)}),t.socket.on("syncmodel.remove",function(e,i,o){t.remove(e,i,o,n)}),t.socket.on("syncmodel.reset",function(){t.reset(n)}),t.socket.on("syncmodel.init",function(e){console.log("Got initial data request:",e),t.set(e,n)}),t.socket.send("syncmodel.register",{name:t.name})},n.prototype.unregister=function(){var e=this.conf.syncWith||this.name.replace(/Model$/,"");this.socket.send("syncmodel.unregister",{name:e}),this.socket.off("syncmodel.set"),this.socket.off("syncmodel.item"),this.socket.off("syncmodel.append"),this.socket.off("syncmodel.prepend"),this.socket.off("syncmodel.insert"),this.socket.off("syncmodel.remove"),this.socket.off("syncmodel.reset"),this.socket.off("syncmodel.init")},n.prototype.emitRemote=function(e,t){this.socket.send(e,t)},n.prototype.sync=function(e){if(this.syncEnabled){var t=Array.prototype.slice.call(arguments,1);t.unshift("syncmodel."+e),this.emitRemote.apply(this,t)}},n.prototype.fetchModel=function(){this.emitRemote("syncmodel.fetch")},e.SyncModel=n}(XQCore),function(e,t){"use strict";var n;n=function(n,i){var o=this;"object"==typeof arguments[0]&&(i=n,n=i.name),this.debug=e.debug,i===t&&(i={}),this.__unfiltered={},this.name=(n?n.replace(/List$/,""):"Nameless")+"List",this.items=[],this.maxLength=null,this.model||(this.model=e.Model),"function"==typeof i?i.call(this,o):e.extend(this,i),this.state("ready")},e.extend(n.prototype,new e.Event,new e.Logger),n.inherit=function(n,i){"object"==typeof n&&(i=n,n=t);var o=function(){e.List.call(this,n,i)};return o.prototype=Object.create(e.List.prototype),o.prototype.constructor=o,o},Object.defineProperty(n.prototype,"length",{get:function(){return this.items.length}}),n.prototype.state=function(e){this.__state=e,this.emit("state."+e),this.emit("state.change",e)},n.prototype.getState=function(){return this.__state},n.prototype.push=function(t,n){var i,o,r=[];n=n||{},Array.isArray(t)||(t=[t]);for(var s=0,a=t.length;a>s;s++){if(o=t[s],o instanceof e.Model?i=o:(i=new this.model("ListItem"),i.set(o)),!i.isValid())return!1;r.push(i)}var c=this.items.push.apply(this.items,r);return this.maxLength&&this.items.length>this.maxLength&&this.items.splice(0,this.items.length-this.maxLength),n.silent||this.emit("item.push",c-r.length,r.length),n.noSync||"function"==typeof this.sync&&this.sync("push",r),!0},n.prototype.unshift=function(t,n){var i,o,r=[];n=n||{},Array.isArray(t)||(t=[t]);for(var s=0,a=t.length;a>s;s++){if(o=t[s],o instanceof e.Model?i=o:(i=new this.model("ListItem"),i.set(o)),!i.isValid())return!1;r.unshift(i)}var c=this.items.unshift.apply(this.items,r);return n.silent||this.emit("item.unshift",c-r.length,r.length),n.noSync||"function"==typeof this.sync&&this.sync("unshift",r),!0},n.prototype.pop=function(e){var n;return e=e||{},n=this.items.pop()||null,n===t?null:(e.silent||this.emit("item.pop",n),e.noSync||"function"==typeof this.sync&&this.sync("pop",n),n)},n.prototype.shift=function(e){var n;return e=e||{},n=this.items.shift()||null,n===t?null:(e.silent||this.emit("item.shift",n),e.noSync||"function"==typeof this.sync&&this.sync("shift",n),n)},n.prototype.update=function(e,t,n){var i;n=n||{},Array.isArray(t)||(t=[t]);for(var o=0,r=t.length;r>o;o++){i=t[o];var s=this.findOne(e);s&&s.set(i,{noSync:!0})}return n.silent||this.emit("item.update"),n.noSync||"function"==typeof this.sync&&this.sync("update",e,t),!0},n.prototype.clear=function(e){if(e=e||{},0===this.items.length)return 0;var t=this.toArray();return this.items=[],e.silent||this.emit("item.clear",t),e.noSync||"function"==typeof this.sync&&this.sync("clear",t),t.length},n.prototype.toArray=function(){return this.items.map(function(e){return e.properties})},n.prototype.findOne=function(e){var t;if(t=this.items)for(var n=0;t.length>n;n++){var i,o=t[n];for(var r in e)if(e.hasOwnProperty(r)){if(o.properties[r]&&o.properties[r]===e[r]){i=!0;break}i=!1}if(i===!0)return o}return null},n.prototype.find=function(e){var t,n=[];if(t=this.items)for(var i=0;t.length>i;i++){var o,r=t[i];for(var s in e)if(e.hasOwnProperty(s)){if(r.properties[s]&&r.properties[s]===e[s]){o=!0;break}o=!1}o===!0&&n.push(r)}return n},n.prototype.each=function(e,t){"function"==typeof e&&(t=e,e=null);for(var n=e,i=0,o=this.items.length;o>i;i++)n=t(n,this.items[i].properties);return n},e.List=n}(XQCore),function(e,t){"use strict";var n;n=function(t,n){this.noAutoRegister=!1,e.List.call(this,t,n),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||e.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},n.prototype=Object.create(e.List.prototype),n.prototype.constructor=n,n.inherit=function(n,i){"object"==typeof n&&(i=n,n=t);var o=function(){e.SyncList.call(this,n,i)};return o.prototype=Object.create(e.SyncList.prototype),o.prototype.constructor=o,o},n.prototype.connectToSocket=function(){var t=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",t),this.socket=new e.Socket(t,this.channel))},n.prototype.register=function(e){var t=this;"boolean"==typeof e&&(this.syncEnabled=e),t.dev("Register synclist at server:",t.name);var n={noSync:!0};t.socket.on("synclist.push",function(e){t.push(e,n)}),t.socket.on("synclist.unshift",function(e){t.push(e,n)}),t.socket.on("synclist.pop",function(){t.push(n)}),t.socket.on("synclist.shift",function(){t.push(n)}),t.socket.on("synclist.update",function(e,i){t.update(e,i,n)}),t.socket.on("synclist.clear",function(){t.clear(n)}),t.socket.on("synclist.init",function(e){console.log("Got initial data request:",e),t.push(e,n)}),t.socket.send("synclist.register",{name:t.name})},n.prototype.unregister=function(){this.dev("Unregister synclist at server:",this.name),this.socket.send("synclist.unregister",{name:this.name}),this.socket.off("synclist.push"),this.socket.off("synclist.unshift"),this.socket.off("synclist.pop"),this.socket.off("synclist.shift"),this.socket.off("synclist.update"),this.socket.off("synclist.clear"),this.socket.off("synclist.init")},n.prototype.emitRemote=function(e,t){this.socket.send(e,t)},n.prototype.sync=function(e){if(this.syncEnabled){var t=Array.prototype.slice.call(arguments,1);t.unshift("syncmodel."+e),this.emitRemote.apply(this,t)}},n.prototype.fetchList=function(){this.emitRemote("synclist.fetch")},e.SyncList=n}(XQCore);