/*!
 * XQCore - +0.12.1-224
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2015 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2015-11-24
 * 
 */
var XQCore;!function(a,b){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],b):"undefined"!=typeof module&&module.exports?module.exports=b(require("jquery")):a.XQCore=b(a.jQuery)}(this,function(a){"use strict";return XQCore={version:"0.12.1-224",defaultRoute:"/",html5Routes:!1,basePath:"",hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire",socketPort:9889,eventListenerMaxLength:1328},XQCore.extend=a.extend,XQCore.isPlainObject=a.isPlainObject,XQCore.isFunction=a.isFunction,XQCore.__moduleCache={},XQCore.isObjectId=function(a){return this.objectIdPattern.test(a)},XQCore.modules={jquery:{cjs:"jquery",amd:"jquery",win:"jQuery"},firetpl:{cjs:"firetpl",amd:"firetpl",win:"fireTpl"},sockjs:{cjs:"xqcore/lib/sockjs.js",amd:"xqcore/lib/sockjs.js",win:"SockJS"}},XQCore.require=function(a){if(XQCore.__moduleCache[a])return XQCore.__moduleCache[a];var b="win";"undefined"!=typeof module&&module.exports&&"function"==typeof require?b="cjs":"function"==typeof define&&define.amd&&(b="amd"),XQCore.modules[a][b]&&(a=XQCore.modules[a][b]);try{if("cjs"===b||"amd"===b)try{return require(a)}catch(c){console.warn("Module not registered as a "+("cjs"===b?"CommonJS":"AMD")+" module! Try to load from window object",a)}return window[a]}catch(c){console.error("Could not load module!",a,c)}},XQCore.setLocale=function(a){localStorage.setItem("xqcore.locale",a)},XQCore.getLocale=function(){var a=localStorage.getItem("xqcore.locale");return a?a:navigator.language},XQCore.logLevel=1,XQCore.getQuery=function(a){return XQCore.__query||(XQCore.__query={},location.search.substr(1).split("&").forEach(function(a){if(a=a.split("="),a&&a[0]){var b=encodeURI(a[1]);XQCore.__query[a[0]]=isNaN(b)?b:Number(b)}})),a?XQCore.__query[a]:XQCore.__query},XQCore.isEmptyObject=function(a){var b;for(b in a)return!1;return!0},XQCore.isEmpty=function(a){return Array.isArray(a)?0===a.length:XQCore.isEmptyObject(a)},XQCore}),function(a,b){"use strict";a.undotify=function(a,c){return a&&(a=a.split("."),a.forEach(function(a){c=c?c[a]:b})),c},a.dedotify=function(a,b,c){"string"==typeof a&&(c=b,b=a,a={});var d=a;if(b){b=b.split(".");var e=b.length;b.forEach(function(b,d){return d===e-1?/\[\]$/.test(b)?(b=b.substr(0,b.length-2),a[b]||(a[b]=[]),a[b].push(c),void 0):(a[b]=c,void 0):(a[b]||(a[b]={}),a=a[b],void 0)})}return a=c,d},a.uid=function(a){a=a||7;for(var b="";b.length<a;){var c=Math.random().toString(36).substr(2);b+=c}return b.substr(0,a)},a.promise=function(a){var b,c,d=new Promise(function(a,d){b=a,c=d});d.resolve=function(c){return b(c),"function"==typeof a&&a(null,c),d},d.reject=function(b){return c(b),"function"==typeof a&&a(b),d};var e=[];return d.push=function(a){return e.push(a),this},d.each=function(a){var b=e.shift();return null===b?d.resolve(a):(b(a).then(function(a){d.each(a)}).catch(function(a){d.reject(a)}),this)},d}}(XQCore),function(a){"use strict";var b=function(b){this.loggerName=b,this.logLevel=a.logLevel};b.prototype.log=function(){var b;a.logLevel>=3&&(b=Array.prototype.slice.call(arguments),this.loggerName&&b.unshift("["+this.loggerName+"]"),console.log.apply(console,b))},b.prototype.warn=function(){var b;a.logLevel>=2&&(b=Array.prototype.slice.call(arguments),this.loggerName&&b.unshift("["+this.loggerName+"]"),console.warn.apply(console,b))},b.prototype.error=function(){var b;a.logLevel>=1&&(b=Array.prototype.slice.call(arguments),this.loggerName&&b.unshift("["+this.loggerName+"]"),console.error.apply(console,b))},b.prototype.debug=function(){var b;a.logLevel>=4&&(b=Array.prototype.slice.call(arguments),this.loggerName&&b.unshift("["+this.loggerName+"]"),console.debug.apply(console,b))},b.prototype.info=b.prototype.log,b.prototype.timer=function(a){var b=this,c={start:null,stop:null,name:a,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+a+" finished after "+b.getHumanTime(this.stop-this.start))}};return this.log("Start Timer "+a),c.start=Date.now(),c},b.prototype.dev=function(){var a;this.debug&&(a=Array.prototype.slice.call(arguments),this.loggerName&&a.unshift("["+this.loggerName+"]"),console.debug.apply(console,a))},b.prototype.req=b.prototype.log,b.prototype.res=b.prototype.log,b.prototype.getHumanTime=function(a){return 1e3>a?a+"ms":6e4>a?Math.round(a/100)/10+"sec":Math.round(a/6e4)+"min "+Math.round(a%6e4/1e3)+"sec"},a.Logger=b}(XQCore),function(a){"use strict";var b=new a.Logger("EventEmitter"),c=function(a,b,c){this.fn=c,this.calls=0,this.once=!1,this.remove=function(){a.off(b,c)}},d=function(){this.__events={},this.__logger=b,this.maxLength=a.eventListenerMaxLength};d.prototype.on=function(a,d){var e=new c(this,a,d);return this.__events[a]||(this.__events[a]=[]),this.__events[a].push(e),this.__events[a].length>this.maxLength?b.warn("Listener max length was exceeded!","List:",a,"Length:",this.__events[a].length):b.info("Register new `"+a+"` event"),e},d.prototype.once=function(){var a=Array.prototype.slice.call(arguments),b=this.on.apply(this,a);return b.once=!0,b},d.prototype.emit=function(a,c){if(!this.__events[a])return b.info("Emit `"+a+"` event failed! No listener of this type are registered"),0;for(var d=Array.prototype.slice.call(arguments,1),e=this.__events[a].length,f=e-1;f>=0;f--){var g=this.__events[a][f];g.fn.apply(this,d),g.calls++,g.once===!0&&this.__events[a].splice(f,1)}return e&&(b.info("Emit `"+a+"` event to",e,"listener"),b.debug(" ... data:",c)),e},d.prototype.off=function(a,c){var d=0;if(!this.__events[a])return b.info("Unregister events failed! No `"+a+"` events were found!"),0;if(c)for(var e=this.__events[a].length,f=0;e>f;f++){var g=this.__events[a][f];g&&g.fn===c&&(this.__events[a].splice(f,1),d++,0===this.__events[a].length&&delete this.__events[a])}else d=this.__events[a].length,delete this.__events[a];return b.info("Unregister `"+a+"` events!","Removed "+d+" listener"),d},d.prototype.clearEvents=function(){this.__events={}},a.Event=d}(XQCore),function(a){var b=function(){this.__isReady=!1,this.__readyFuncs=[]};b.prototype.ready=function(a){this.__isReady?a.call(this):this.__readyFuncs.push(a)},b.prototype.setReady=function(){var a=this;this.__isReady=!0,this.__readyFuncs&&(this.__readyFuncs.forEach(function(b){b.call(a)}),this.__readyFuncs=[])},b.prototype.unsetReady=function(){this.__isReady=!1},a.ReadyState=b}(XQCore),function(a,b){"use strict";var c=a.require("jquery"),d=function(){this.server=null};d.prototype.onSend=function(a){return a},d.prototype.send=function(d,e,f,g){var h=this;"object"==typeof e?(g=f,f=e,e=this.server,d=d):"function"==typeof f?(g=f,f=this.toJSON?this.toJSON():null):f===b&&(f=this.toJSON?this.toJSON():null),d===b&&(d="POST"),e||(e=this.server),"GET"===d&&Array.isArray(f)&&(e=e.replace(/\/$/,"")+"/"+f.join("/"),f=null),"function"==typeof this.onSend&&(f=this.onSend.call(this,f)),this.log("Send an ajax call to ",e,"with data: ",f),this.state("syncing");var i=new Promise(function(b,i){c.ajax({url:e,type:d,data:a.isEmpty(f)?null:JSON.stringify(f),dataType:"json",contentType:"application/json",headers:{Accept:"application/json"},success:function(a,c,d){"function"==typeof g&&g.call(h,null,a,c,d),h.state("success"),b(a)},error:function(a,b,c){"function"==typeof g&&g.call(h,{type:b,http:c},null,b,a),h.state("failed"),i({type:b,http:c})}})});return i},d.prototype.sendPOST=function(a,b,c){return this.send("POST",a,b,c)},d.prototype.sendGET=function(a,b,c){return this.send("GET",a,b,c)},d.prototype.sendPUT=function(a,b,c){return this.send("PUT",a,b,c)},d.prototype.sendDELETE=function(a,b,c){return this.send("DELETE",a,b,c)},d.prototype.fetch=function(a,b){return this.sendGET(a,b)},d.prototype.save=function(a,b){return"function"==typeof a&&(b=a,a=this.schema?this.getByKeys(Object.keys(this.schema)):this.toJSON()),this.isValid()?this.sendPOST(a,b):"function"!=typeof b?Promise.reject({msg:"Model isn't valid. Cancle save"}):(b({msg:"Model isn't valid. Cancle save"}),void 0)},d.prototype.update=function(a,b){"function"==typeof a&&(b=a,a=this.schema?this.getByKeys(Object.keys(this.schema)):this.toJSON()),this.isValid()?this.sendPUT(a,b):"function"==typeof b&&b({msg:"Model isn't valid. Cancel update"})},d.prototype.submit=function(a){var c=this,d=new Promise(function(d,e){c.set(a,{extend:!0}).then(function(){c.server&&(c.get("id")===b||null===c.get("id")?c.save(a).then(function(a){d(a),c.emit("data.submit",a)}).catch(function(a){e(a)}):c.update(a).then(function(a){d(a),c.emit("data.submit",a)}).catch(function(a){e(a)}))})});return d},a.Sync=d}(XQCore),function(a){"use strict";var b,c=function(c,d){var e=this;"function"==typeof arguments[0]&&(d=c,c=null),this.name=c||"Nameless",this.router=a.Router.getInstance(),b=new a.Logger(this.name+"Presenter"),this.__views={},"function"==typeof d&&d.call(this,e,b)};a.extend(c.prototype,new a.Event),c.prototype.init=function(){},c.prototype.pushState=function(c,d){var e=a.html5Routes||"/"===c.charAt(0)?"":a.hashBang;c=e+c,history.pushState(d,"",c||null),b.info("Update history with pushState. New URL: "+d,c)},c.prototype.replaceState=function(c,d){var e=a.html5Routes||"/"===c.charAt(0)?"":a.hashBang;c=e+c,history.replaceState(d,"",c||null),b.info("Update history with replaceState. New URL: "+d,c)},c.prototype.navigateTo=function(b,c){c=c||{},a.html5Routes?this.router.callRoute(b,c):(location.hash=a.hashBang+b,this.router.callRoute(b,c))},c.prototype.navigateBack=function(){history.back()},c.prototype.getView=function(a){return this.__views[a]||null},c.prototype.getHash=function(){return location.hash},c.prototype.getPathname=function(){return location.pathname},c.prototype.couple=function(b,c,d){d=d||{},c instanceof a.List?this.coupleList(b,c,d):this.coupleModel(b,c,d),this.coupleView(b,c,d)},c.prototype.coupleModel=function(c,d,e){if(e=e||{},!(c instanceof a.View))return b.error("Could not couple model with view. First arg is not a valid view!");if(!(d instanceof a.Model))return b.error("Could not couple model with view. Second arg is not a valid model!");d.__coupled&&(console.log("UNCOUPLE MODEL",c===d.__coupled.obj),d.__coupled.uncouple()),b.info("Couple model",d.name,"with",c.name),d.__coupled={obj:c,events:[],uncouple:function(){b.info("Uncouple model",d.name,"from",c.name),d.__coupled.events.forEach(function(a){a.remove()}),delete d.__coupled}};var f={"data.replace":"render","data.set":"render","value.set":"change","item.remove":"remove","validation.error":"validationFailed","state.change":"onStateChange"},g=function(a,b){var e="function"==typeof b?b:c[b].bind(c),f=d.on(a,e);d.__coupled.events.push(f)};for(var h in f)f.hasOwnProperty(h)&&g(h,f[h]);c.render(d.get()),console.log("VIEW",c),console.log("MODEL",d)},c.prototype.coupleList=function(c,d){if(!(c instanceof a.View))return b.error("Could not couple list with view. First arg is not a valid view!");if(!(d instanceof a.List))return b.error("Could not couple list with view. Second arg is not a valid list!");d.__coupled&&d.__coupled.uncouple(),b.info("Couple list",d.name,"with",c.name),d.__coupled={obj:c,events:[],uncouple:function(){b.info("Uncouple list",d.name,"from",c.name),d.__coupled.events.forEach(function(a){a.remove()}),delete d.__coupled}};var e={"item.push":function(a){c.append("_ftl_root",a[0].toJSON())},"item.unshift":"prepend","item.pop":"removeLast","item.shift":"removeFirst","item.update":"update","item.remove":function(a,b){c.remove("_ftl_root",b)},"state.change":"onStateChange"},f=function(a,b){var e="function"==typeof b?b:c[b].bind(c),f=d.on(a,e);d.__coupled.events.push(f)};for(var g in e)e.hasOwnProperty(g)&&f(g,e[g]);c.render(d.toArray()),console.log("VIEW",c),console.log("LIST",d)},c.prototype.coupleView=function(c,d){if(!(c instanceof a.View))return b.error("Could not couple list with view. First arg is not a valid view!");if(!(d instanceof a.Model||d instanceof a.List))return b.error("Could not couple list with view. Second arg is not a valid model or list!");c.__coupled&&(console.log("UNCOUPLE VIEW",d===d.__coupled.obj),c.__coupled.uncouple()),b.info("Couple view",c.name,"with",d.name),c.__coupled={obj:d,events:[],uncouple:function(){b.info("Uncouple view",c.name,"from",d.name),c.__coupled.events.forEach(function(a){a.remove()}),delete c.__coupled}};var e;e=d instanceof a.Model?{"form.submit":"submit","input.change":"set","input.edit":function(a,b){var e=d.checkValidation(a,b);e?c.validationSucceeded(a,b):c.validationFailed([{property:name}])}}:{"form.submit":"submit"};var f=function(a,b){var e="function"==typeof b?b:d[b].bind(d),f=c.on(a,e);c.__coupled.events.push(f)};for(var g in e)e.hasOwnProperty(g)&&f(g,e[g]);console.log("VIEW",c),console.log("MODE or LIST",d)},c.prototype.initView=function(b,c,d){d=d||{};var e={};d.viewDir&&(e.viewDir=d.viewDir);var f=new a.View(b,function(f){f.template=a.Tmpl.getTemplate(b,e),f.mode=d.mode||"replace",f.container=c||"body",f.hidden=!!d.hidden,f.forms=d.forms,d.inject===!1&&(f.autoInject=!1)});this.__views[b]=f;var g=this;return a.html5Routes&&f.on("xqcore.navigate",function(a){g.router.callRoute(a)}),f},c.prototype.initFormView=function(){},c.prototype.route=function(a,c){var d=this;return"string"==typeof c&&(c=this[c]),"function"==typeof c?"string"==typeof a?this.router.addRoute(a,c):Array.isArray(a)&&a.forEach(function(a){d.router.addRoute(a,c)}):b.warn("Router callback isn't a function",c,"of route",a),this},c.prototype.send=a.Sync.prototype.send,a.Presenter=c}(XQCore),function(XQCore,undefined){"use strict";var Model;Model=function(a,b){XQCore.ReadyState.call(this),XQCore.Event.call(this),"object"==typeof arguments[0]&&(b=a,a=b.name),this.logLevel=XQCore.logLevel,this.properties={},this.lastValidationErr=null,b===undefined&&(b={}),"function"==typeof b?b.call(this,this):XQCore.extend(this,b),this.__state="starting",this.__unfiltered={},this.customValidate=b.validate,delete b.validate,this.conf=b,this.name=(a?a.replace(/Model$/,""):"Nameless")+"Model",this.__isValid=!1,this.defaults&&!XQCore.isEmptyObject(this.defaults)&&this.set(this.defaults,{silent:!0,noValidation:!0}),this.schema&&Object.keys(this.schema).forEach(function(a){a in this.properties||(this.properties[a]=this.schema[a].default!==undefined?this.schema[a].default:null)},this),this.__isValid=!this.schema,this.state("ready")},XQCore.extend(Model.prototype,XQCore.ReadyState.prototype),XQCore.extend(Model.prototype,XQCore.Event.prototype),XQCore.extend(Model.prototype,new XQCore.Logger),XQCore.Sync&&XQCore.extend(Model.prototype,XQCore.Sync.prototype),Model.inherit=function(a,b){"object"==typeof a&&(b=a,a=undefined);var c=function(c,d){XQCore.Model.call(this,a,b),c&&("string"==typeof c?a=c:d=c,"function"==typeof d?d.call(this,this):"object"==typeof d&&XQCore.extend(this,d))};return c.prototype=Object.create(XQCore.Model.prototype),c.prototype.constructor=c,c},Model.prototype.state=function(a){this.__state=a,this.emit("state."+a),this.emit("state.change",a)},Model.prototype.getState=function(){return this.__state},Model.prototype.set=function(a,b,c){var d,e={},f=this.get(),g=!1,h=!1;if(c=c||{},null===arguments[0]?(e=arguments[1],h=!0,this.log("Set data",e,f)):"object"==typeof arguments[0]?(c=b||{},e=c.replace?arguments[0]:XQCore.extend(e,f,arguments[0]),h=!0,a=null,this.log("Set data",e,f)):"string"==typeof arguments[0]?(e=XQCore.extend({},this.get()),g=!0,XQCore.dedotify(e,a,b),this.log("Set value",a,b,f)):this.warn("Data are incorrect in model.set()",arguments),c=c||{},c.noValidation!==!0){if(this.customValidate)this.log("Using a custom validation!"),d=this.customValidate(e);else if(this.schema&&(d=this.validate(e),g&&d)){for(var i,j=0,k=d.length;k>j;j++)if(d[j].property===a){i=[d[j]];break}d=i||null}if(d)return this.warn("Validation error",d),c.silent!==!0&&this.emit("validation.error",d,e),Promise.reject({msg:"validation.error",err:d})}return this.properties=e,c.silent!==!0&&(h?c.noSync||"function"!=typeof this.sync?this.emit(c.replace?"data.replace":"data.set",e,f):this.sync(c.replace?"replace":"set",e):g&&(c.noSync||"function"!=typeof this.sync||this.sync("value",a,b),this.emit("value.set",a,b)),this.emit("data.change",e,f)),Promise.resolve(e)},Model.prototype.get=function(key,options){options===undefined&&(options={});var data;if("object"==typeof key&&1===arguments.length&&(options=key,key=null),key===undefined||null===key){if(options.copy===!0)switch(data=this.properties,typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+data.toString()+")");default:return data}return this.properties}if("string"==typeof key&&"number"==typeof options){var index=options;3===arguments.length&&(options=arguments[2]);var item=this.get(key);return options.copy===!0&&"object"==typeof item[index]?XQCore.extend({},item[index]):item?item[index]:null}if(options.copy===!0)switch(data=XQCore.undotify(key,this.properties),typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+data.toString()+")");default:return data}return XQCore.undotify(key,this.properties)},Model.prototype.getByKeys=function(a,b){if("object"!=typeof a)throw new Error("First param must be an object or array in Model.getByKeys()!");var c={};if(b=b||this.get(),Array.isArray(a))a.forEach(function(a){-1===a.indexOf(".")?c[a]=b[a]:c=XQCore.dedotify(c,a,XQCore.undotify(a,b))});else for(var d in a)if(a.hasOwnProperty(d)){var e=b[d];c[d]="object"==typeof e?this.getByKeys(a[d],b[d]):b[d]}return c},Model.prototype.has=function(a){var b=!0,c=this.properties;a=a.split(".");for(var d=0,e=a.length;e>d;d++){if("object"!=typeof c||!c.hasOwnProperty(a[d])){b=!1;break}c=c[a[d]]}return b},Model.prototype.reset=function(a){a=a||{},this.log("Reset model");var b=this.get();return this.properties=XQCore.extend({},this.defaults),this.state("ready"),a.silent||this.emit("data.reset",b),a.removeListener&&this.clearEvents(),a.noSync||"function"==typeof this.sync&&this.sync("reset",b),b},Model.prototype.push=function(a,b,c){var d=XQCore.undotify(a,this.properties);if(c=c||{},d instanceof Array)d.push(b);else if("undefined"==typeof d)XQCore.dedotify(this.properties,a,[b]);else{if("object"!=typeof d||a||!XQCore.isEmptyObject(this.properties))return this.error("Model.push requires an array. Dataset isn't an array. Path: ",a),void 0;this.properties=[b]}c.silent!==!0&&(c.noSync||"function"!=typeof this.sync||this.sync("insert",a,-1,b),this.emit("item.insert",a,-1,b),this.emit("data.change",this.properties))},Model.prototype.unshift=function(a,b,c){var d=XQCore.undotify(a,this.properties);if(c=c||{},d instanceof Array)d.unshift(b);else if("undefined"==typeof d)XQCore.dedotify(this.properties,a,[b]);else{if("object"!=typeof d||a||!XQCore.isEmptyObject(this.properties))return this.error("Model.unshift requires an array. Dataset isn't an array. Path: ",a),void 0;this.properties=[b]}c.silent!==!0&&(c.noSync||"function"!=typeof this.sync||this.sync("insert",a,0,b),this.emit("item.insert",a,0,b),this.emit("data.change",this.properties))},Model.prototype.insert=function(a,b,c,d){var e=XQCore.undotify(a,this.properties);if(d=d||{},e instanceof Array)-1===b?e.push(c):0===b?e.unshift(c):e.splice(b,0,c);else{if(e)return this.error("Model.insert requires an array. Dataset isn't an array. Path: ",a),void 0;XQCore.dedotify(this.properties,a,[c])}d.silent!==!0&&(d.noSync||"function"!=typeof this.sync||this.sync("insert",a,b,c),this.emit("item.insert",a,b,c),this.emit("data.change",this.properties))},Model.prototype.remove=function(a,b,c){var d=XQCore.undotify(a,this.properties),e=null;if(c=c||{},d instanceof Array)e=d.splice(b,1);else if("object"==typeof d)return this.error("Model.remove requires an array. Dataset isn't an array. Path: ",a),void 0;return e&&c.silent!==!0&&(c.noSync||"function"!=typeof this.sync||this.sync("remove",a,b),this.emit("item.remove",a,b,e[0]),this.emit("data.change",this.properties)),e},Model.prototype.replace=function(a,b){return b=b||{},b.replace=!0,this.set(a,b)},Model.prototype.search=function(a,b){var c;if(1===arguments.length?(b=a,a="",c=this.properties):c=a?XQCore.undotify(a,this.properties):this.properties,c)for(var d=0;d<c.length;d++){var e,f=c[d];for(var g in b)if(b.hasOwnProperty(g)){if(f[g]&&f[g]===b[g]){e=!0;break}e=!1}if(e===!0)return f}return null},Model.prototype.modify=function(a,b,c,d){var e;d=d||{},e="number"==typeof b?this.get(a,b):this.search(a,b);var f=XQCore.extend({},e);e&&(XQCore.extend(e,c),d.silent!==!0&&(this.emit("data.modify",a,b,c,f),this.emit("data.change",this.properties)),d.noSync||"function"!=typeof this.sync||this.sync("modify",a,b,c))},Model.prototype.sortBy=function(a,b){1===arguments.length&&(b=a,a=null);var c,d=XQCore.undotify(a,this.properties);return Array.isArray(d)?(d.sort(function(a,d){c=-1;for(var e in b)if(b.hasOwnProperty(e)){if(c=String(XQCore.undotify(e,a)).localeCompare(String(XQCore.undotify(e,d))),0===c)continue;-1===b[e]&&(c=c>0?-1:1);break}return c}),this.set(a,d),d):(this.warn("Could not sort data of type",typeof d),[])},Model.prototype.filter=function(a,b,c,d){if(1===arguments.length&&(d=a,a=null),"string"==typeof d){if(!this.__registeredFilter[d])throw new Error("Filter "+d+" not registered!");d=this.__registeredFilter[d]}for(var e=XQCore.undotify(a,this.__unfiltered.data||this.properties),f=[],g=0,h=e.length;h>g;g++)d(b,c,e[g])&&f.push(e[g]);return this.__unfiltered={path:a,data:e},this.set(a,f),f},Model.prototype.filterReset=function(a){this.__unfiltered&&this.set(this.__unfiltered.path,this.__unfiltered.data,a)},Model.prototype.validate=function(a,b){var c=this,d=[];return b=b||this.schema,b&&Object.keys(b).forEach(function(e){if("object"==typeof a[e]&&"undefined"==typeof b[e].type){var f=c.validate(XQCore.extend({},a[e]),XQCore.extend({},b[e]));return Array.isArray(f)&&f.length>0&&(d=d.concat(f)),void 0}var g=c.validateOne(b[e],a[e]);g.isValid===!0?a[e]=g.value:(g.error.property=e,d.push(g.error))}),0===d.length?(this.__isValid=!0,this.lastValidationErr=null,this.state("valid"),null):(this.__isValid=!1,this.lastValidationErr=d,this.state("invalid"),d)},Model.prototype.validateOne=function(a,b){var c,d="function"==typeof a.type?typeof a.type():a.type.toLowerCase();if(""===b&&a.noEmpty===!0&&(b=undefined),b!==undefined&&null!==b&&""!==b||!a["default"]||(b=a["default"]),b===undefined||null===b||""===b)a.required===!0&&(c={msg:"Property is undefined or null, but it's required",errCode:10});else{if(!this.__registeredValidations[d])throw new Error("Undefined schema type",a);c=this.__registeredValidations[d].call(this,b,a)}return c=c===undefined?{isValid:!0,value:b,error:null}:{isValid:!1,value:b,error:c}},Model.prototype.checkValidation=function(a,b){var c=this.validateOne(this.schema[a],b,a);return c.isValid},Model.prototype.isValid=function(){return this.__isValid},Model.prototype.setData=function(a){this.warn("Model.setData has been deprecated since v0.9"),this.set(a,{extend:!0})},Model.registerFilter=function(a,b){if("function"!=typeof b)throw new Error("Filter function isn't a function");var c="function"==typeof this?Model.prototype:this;c.__registeredFilter[a]=b},Model.prototype.registerFilter=Model.registerFilter,Model.prototype.__registeredFilter={quicksearch:function(a,b,c){var d=XQCore.undotify(a,c),e=new RegExp(b.replace(/[a-z0-9äüöß]/g,"$&.*"),"i");return e.test(d)}},Model.registerValidation=function(a,b){var c="function"==typeof this?Model.prototype:this;c.__registeredValidations[a]=b},Model.prototype.registerValidation=Model.registerValidation,Model.prototype.__registeredValidations={string:function(a,b){return b.convert&&"number"==typeof a&&(a=String(a)),"string"!=typeof a?{msg:"Property type is a "+typeof a+", but a string is required",errCode:11}:b.min&&b.min>a.length?{msg:"String length is too short",errCode:12}:b.max&&b.max<a.length?{msg:"String length is too long",errCode:13}:b.match&&!b.match.test(a)?{msg:"String doesn't match regexp",errCode:14}:void 0},number:function(a,b){return b.convert&&"string"==typeof a&&(a=parseInt(a,10)),"number"!=typeof a||isNaN(a)?{msg:"Property type is not a valid number",errCode:21}:b.min&&b.min>a?{msg:"Number is too low",errCode:22}:b.max&&b.max<a?{msg:"Number is too high",errCode:23}:void 0},date:function(a){if(a){var b=Date.parse(a);if(isNaN(b))return{msg:"Property isn't a valid date",errCode:31}}},array:function(a,b){return Array.isArray(a)?b.min&&b.min>a.length?{msg:"Array length is "+a.length+" but must be greater than "+b.min,errCode:42}:b.max&&b.max<a.length?{msg:"Array length is "+a.length+" but must be lesser than "+b.max,errCode:43}:void 0:{msg:"Property type is a "+typeof a+", but an array is required",errCode:41}},object:function(a){return"object"!=typeof a?{msg:"Property isn't a valid object",errCode:51}:void 0},objectid:function(a){return/^[a-zA-Z0-9]{24}$/.test(a)?void 0:{msg:"Property isn't a valid objectId",errCode:52}},"boolean":function(a){return"boolean"!=typeof a?{msg:"Property isn't a valid boolean",errCode:61}:void 0},time:function(a){return/^\d+(:\d{2}){1,3}$/.test(a)?void 0:{msg:"Property isn't a valid time",errCode:71}},email:function(a){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)?void 0:{msg:"Property isn't a valid email",errCode:72}}},Model.prototype.toJSON=function(){return this.get()},XQCore.Model=Model}(XQCore),function(a,b){"use strict";if("function"==typeof define&&define.amd)define("xqcore",[XQCore.templateEngine],b);else if("undefined"!=typeof module&&module.exports)module.exports=b(require(XQCore.templateEngine));else{var c="firetpl"===XQCore.templateEngine?"FireTPL":"Handlebars";a.XQCore=b(a[c])}}(this,function(a){"use strict";return XQCore.Tmpl={type:XQCore.templateEngine,compile:a.compile,getTemplate:function(b,c){if(c=c||{},"firetpl"===XQCore.templateEngine){var d=a;if(d.templateCache&&d.templateCache[b])return d.templateCache[b];if(d.loadFile){var e=c.viewDir||XQCore.viewsDir,f=d.readFile(e.replace(/\/$/,"")+"/"+b+"."+XQCore.viewExt.replace(/^\./,""));return d.compile(f,{eventAttrs:!0})}throw new Error("FireTPL runtime is being used. Please preload the "+b+"View")}}},XQCore}),function(a,b){"use strict";var c,d=a.require("jquery"),e=function(e,f){a.Event.call(this),"object"==typeof arguments[0]||"function"==typeof arguments[0]?(f=e,e=null):"string"==typeof arguments[0]&&(this.name=e),c=new a.Logger(this.name+"View"),this.container="body",this.tag=b,this.className=b,this.id=b,this.mode="replace",this.autoInject=!0,this.__domReady=!1,this.__viewEvents=[];var g=this;"function"==typeof f?f.call(this,g):a.extend(this,f),this.name=(this.name?this.name.replace(/View$/,""):"Nameless")+"View",this.__createView(),d(function(){g.container.length>0?(window.addEventListener("resize",function(a){g.resize(a)},!1),c.info("Initialize view "+this.name," with conf:",f),c.info(" ... using Container:",g.container)):c.error("Can't initialize View, Container not found!",g.container)})};a.extend(e.prototype,a.Event.prototype),e.prototype.show=function(a){var b=this;return a&&b.$ct.children(".xq-view").each(function(){if(this!==b.el){var a=d(this).data("view");a.hide()}}),this.$el.show().removeClass("xq-hidden"),this.emit("view.show"),this},e.prototype.hide=function(){return this.$el.hide().addClass("xq-hidden"),this.emit("view.hide"),this},e.prototype.active=function(a){var b=this;return a&&b.$ct.children(".xq-view").each(function(){if(this!==b.el){var a=d(this).data("view");a.inactive()}}),this.$el.addClass("xq-active").removeClass("xq-inactive"),this.emit("view.active"),this},e.prototype.inactive=function(){return this.$el.removeClass("xq-active").addClass("xq-inactive"),this.emit("view.inactive"),this},e.prototype.renderHTML=function(b,d){return c.log("Render html snippet",b,"with data:",d),b="function"==typeof b?b:a.Tmpl.compile(b),b(d)},e.prototype.resize=function(){return this},e.prototype.getElementData=function(a){var c=d(a,this.container);if(c.length){var e,f={},g=c.get(0).attributes;for(e=0;e<g.length;e++)if(0===g[e].name.indexOf("data-")){var h=g[e].name.substr(5),i=g[e].value;if("string"==typeof i)try{i="true"===i||"TRUE"===i?!0:"false"===i||"FALSE"===i?!1:"null"===i||"NULL"===i?null:"undefined"===i?b:+i+""===i?+i:JSON.parse(i)}catch(j){}f[h]=i}return f}return null},e.prototype.validationFailed=function(a){var b=this;a.forEach(function(a){b.$el.find('[name="'+a.property+'"]').addClass("xq-invalid")})},e.prototype.validationSucceeded=function(a){var b=this;b.$el.find('[name="'+a+'"]').removeClass("xq-invalid")},e.prototype.onStateChange=function(a){if(!this.el)return this.__initialState=a,void 0;var b=this.el.className.split(" ");b=b.filter(function(a){return!/^xq-state-/.test(a)}),b.push("xq-state-"+a),this.el.className=b.join(" ")},e.prototype.ready=function(a){this.isReady?a.call(this):(this.__readyCallbacks||(this.__readyCallbacks=[]),this.__readyCallbacks.push(a))},e.prototype.__setReadyState=function(){var a=this;this.isReady=!0,this.__readyCallbacks&&(this.__readyCallbacks.forEach(function(b){b.call(a)}),this.__readyCallbacks=[])},e.prototype.inject=function(){var a=this.isElementInDOM(this.ct);if(this.el.parentNode!==this.ct||!a)if(a||(this.$ct=d(this.container),this.ct=this.$ct.get(0)),c.info("Inject view into container",this.$ct),"replace"===this.mode){var b=this.$ct.contents();b.each(function(){var a=d(this).data("view");a?a.detach():d(this).detach()}),this.$ct.append(this.$el)}else if("append"===this.mode)this.$ct.append(this.$el);else{if("prepend"!==this.mode)throw new Error("Unknown insert mode in view constructor");this.$ct.prepend(this.$el)}},e.prototype.parse=function(a,b,e){var f,g;a.scopeStore={},a.scopes=e||{};try{f=a(b||{},a.scopes)}catch(h){f='<p class="renderError"><b>View render error!</b><br>'+h.message+"</p>",c.error("View render error!",h)}var i=function(b,c,e){b=d.parseHTML(b);var f=d(b),g=f.find("scope"),h={};return g.each(function(){var b,f=d(this).attr("id"),g=d(this).attr("path"),j=e?e+"."+g:g,k=c;if(Array.isArray(c)&&(h[g]=h[g]||0,k=c[h[g]++]),b={},f){var l=a.scopes[f](c[g],c);b.value=l?i(l,c[g],j):document.createTextNode(""),b.id=f}else b.value=d.parseHTML(c[g]);a.scopeStore[j]=a.scopeStore[j]||[],a.scopeStore[j].push(b),d(this).replaceWith(d(b.value))}),f};return f&&(g=i(f,b)),g},e.prototype._render=function(b){if(this.__domReady===!1)return this.__initialData=b||{},this;this.autoInject&&this.inject();var d;c.info("Render view template of view "+this.name,"with data:",b);var e="function"==typeof this.template?this.template:a.Tmpl.compile(this.template);this.scopes={};try{d=e(b||{},this.scopes)}catch(f){d='<p class="renderError"><b>View render error!</b><br>'+f.message+"</p>",c.error("View render error!",f)}return this.el.innerHTML=d,this.emit("content.change",b),this.registerListener(this.$el),this.registerForms(),this},e.prototype.render=function(e){if(this.__domReady===!1)return this.__initialData=e||{},this;this.autoInject&&this.inject();var f;c.info("Render view template of view "+this.name,"with data:",e);var g="function"==typeof this.template?this.template:a.Tmpl.compile(this.template);this.scopes={dataFn:function(a,c){var d=c[a];return(null===d||d===b)&&(d=""),'<ftl path="'+a+'">'+d+"</ftl>"},scopeFn:function(a,b,c){return"data"===b&&Array.isArray(c)&&(b="_ftl_root"),'<ftl scope="'+a+'" path="'+b+'"></ftl>'},attrFn:function(a,b){var c=b.replace(/<ftl path="([a-zA-Z0-9_.-]+)">(.+?)<\/ftl>/g,function(a,b,c){return c}),d=b.replace(/<ftl path="([a-zA-Z0-9_.-]+)">(.+?)<\/ftl>/g,function(){return"%s"}),e=a+'="'+c+'" xq-'+a+'="'+d+'"';return e}};try{f=g(e||{},this.scopes)}catch(h){f='<p class="renderError"><b>View render error!</b><br>'+h.message+"</p>",c.error("View render error!",h)}this.el.innerHTML=f;var i=this;return this.scopesMap={},this.$el.find("ftl").each(function(){var a=d(this).attr("scope"),b=d(this).attr("path");a?i.replaceScopes(d(this),a,e,b,b):i.replaceNode(d(this),b)}),console.log("Scopes map",this.scopesMap),this.emit("content.change",e),this.registerListener(this.$el),this.registerForms(),this
},e.prototype.replaceScopes=function(a,b,c,e,f){console.log("Replace scope",b,c,e);var g=this,h=e&&"_ftl_root"!==e?c[e]:c,i=g.scopes[b](h,c),j=d(d.parseHTML(i)),k=a.parent();if(j.find("ftl").each(function(){var a=d(this).attr("scope"),b=d(this).attr("path");a?g.replaceScopes(d(this),a,h,b,f+(Array.isArray(h)?"[].":".")+b):g.replaceNode(d(this),f+(Array.isArray(h)?"[].":".")+b)}),a.replaceWith(j),-1===f.indexOf("[].")){f in g.scopesMap||(g.scopesMap[f]=[]);var l=function(a){if(!Array.isArray(h))return[a];var b=a.length/h.length,c=[],e=[];return a.each(function(){e.push(d(this).get(0)),e.length===b&&(c.push(e),e=[])}),c};g.scopesMap[f].push({type:"scope",fn:g.scopes[b],childs:l(j,h),parentData:c,parent:k})}},e.prototype.replaceNode=function(a,b){console.log("Replace node",b);var c=this,d=a.html(),e=document.createTextNode(d);a.replaceWith(e),-1===b.indexOf("[].")&&(b in c.scopesMap||(c.scopesMap[b]=[]),c.scopesMap[b].push({type:"node",node:e}))},e.prototype.renderScope=function(a,b,c){var e=this,f=d.parseHTML(a.fn(c,a.parentData)),g=d(f);return g.find("ftl").each(function(){var a=d(this).attr("scope"),b=d(this).attr("path");a?e.replaceScopes(d(this),a,c,b,b):e.replaceNode(d(this),b)}),this.registerListener(g),g},e.prototype.renderNode=function(a,b,c){a.node.nodeValue=c},e.prototype.registerListener=function(a){var b=this;console.log("REGISTER VIEW LISTENER"),a.find("[on]").addBack("[on]").each(function(){var a,c=d(this),e=d(this).attr("on"),f=d(this).data();c.removeAttr("on"),e=e.split(";"),e.forEach(function(d){d=d.split(":"),a="submit"===d[0]?function(a){a.preventDefault(),f=b.serializeForm(a.target),f=b.onSubmit(f,a.target),b.emit(d[1],f,a)}:function(a){var c;a.originalEvent instanceof KeyboardEvent?c={key:a.key,code:a.keyCode,alt:a.altKey,ctrl:a.ctrlKey,meta:a.metaKey,shift:a.shiftKey}:a.originalEvent instanceof MouseEvent?(a.preventDefault(),c={button:a.button,alt:a.altKey,ctrl:a.ctrlKey,meta:a.metaKey,shift:a.shiftKey},"click"===a.type&&a.currentTarget.href&&(c.href=a.currentTarget.href)):(a.preventDefault(),c=a.currentTarget.value||""),b.emit(d[1],c,f,a)},c.bind(d[0],a)})})},e.prototype.serializeForm=function(b){var e={},f=d(b);return"INPUT"!==f.get(0).tagName&&(f=f.find(":input")),f.serializeArray().forEach(function(b){a.dedotify(e,b.name,b.value)}),c.info("Serialize form of view "+this.name,"form selector:",f,"form data:",e),e},e.prototype.insert=function(a,b,c){var e=this;console.log("INSERT new item",a,b,c),a in this.scopesMap&&(console.log(" matched items",this.scopesMap[a]),this.scopesMap[a].forEach(function(f){var g=e.renderScope(f,a,[c]);if(-1===b)f.parent.append(g),f.childs.push([g.get()]);else if(0===b)f.parent.prepend(g),f.childs.unshift([g.get()]);else{var h=f.childs[b];d(h[0]).before(g);var i=[b,0].concat([g.get()]);f.childs.splice.apply(f.childs,i)}}))},e.prototype.update=function(){c.warn("XQCore doesn`t support update events yet")},e.prototype.append=function(a,b){1===arguments.length&&(b=a,a="data"),this.insert(a,-1,b)},e.prototype.prepend=function(a,b){1===arguments.length&&(b=a,a="data"),this.insert(a,0,b)},e.prototype.remove=function(a,b){console.log("REMOVE item",a,b),a in this.scopesMap&&(console.log(" matched items",this.scopesMap[a]),this.scopesMap[a].forEach(function(a){var c=a.childs[b];Array.isArray(c)?c.forEach(function(a){d(a).remove()}):d(c).remove(),a.childs.splice(b,1)}))},e.prototype.removeLast=function(){c.warn("XQCore doesn`t support pop events yet")},e.prototype.removeFirst=function(){c.warn("XQCore doesn`t support shift events yet")},e.prototype.change=function(a,b){var c=this;this.ready(function(){a in this.scopesMap&&(console.log(" change item",this.scopesMap[a]),this.scopesMap[a].forEach(function(d){"node"===d.type&&c.renderNode(d,a,b)}))})},e.prototype.formSetup=function(){var a=this;console.log("VIEW FORMSET UP INIT"),this.ready(function(){console.log("VIEW FORMSET UP RUN");var b=function(b){var c=b.target.value,d=b.target.name;a.emit("input.change",d,c)},c=function(b){var c=b.target.value,d=b.target.name;a.emit("input.edit",d,c)},d=function(b){b.preventDefault();var c=a.serializeForm(b.target);a.emit("form.submit",c)};this.addEvent(":input","change",b),this.addEvent(":input","keyup",c),this.addEvent("form","submit",d)})},e.prototype.onSubmit=function(a){return a},e.prototype.detach=function(){c.info("Destroy view"),this.emit("view.detach"),this.$el.detach(),this.__coupled&&(this.__coupled.obj.__coupled&&this.__coupled.obj.__coupled.obj===this&&this.__coupled.obj.__coupled.uncouple(),this.__coupled.uncouple()),c.info("View "+this.name+" has been destroyed")},e.prototype.destroy=function(){c.info("Destroy view"),this.emit("view.destroy"),this.$el.remove(),this.__coupled&&(this.__coupled.obj.__coupled&&this.__coupled.obj.__coupled.obj===this&&this.__coupled.obj.__coupled.uncouple(),this.__coupled.uncouple()),c.info("View "+this.name+" has been destroyed")},e.prototype.addEvent=function(a,b,c){this.__viewEvents.push({events:b,selector:a,callback:c}),this.$el&&this.$el.delegate(a,b,c)},e.prototype.__viewTagTypes={"*":"div",body:"section",section:"section",ul:"li",table:"tbody",tbody:"tr",tr:"td"},e.prototype.__createViewElement=function(){if(this.tag)return document.createElement(this.tag);var a=this.ct?this.ct.tagName.toLowerCase():"*",b=this.__viewTagTypes["*"];return this.__viewTagTypes[a]&&(b=this.__viewTagTypes[a]),document.createElement(b)},e.prototype.__createView=function(){var b=this,c=[];d(function(){b.$ct=b.$ct||d(b.container),b.ct=b.$ct.get(0),b.el=b.__createViewElement(),b.$el=d(b.el),b.$el.data("view",b),c.push("xq-view xq-"+b.name.replace(/View$/,"-view").toLowerCase()),b.id&&b.el.setAttribute("id",b.id),b.className&&c.push(b.className),b.hidden===!0&&(c.push("xq-hidden"),b.$el.hide()),b.el.className=c.join(" "),b.__domReady=!0,b.__initialData&&(b.render(b.__initialData),delete b.__initialData),b.__setReadyState(),b.registerListener(b.$el),a.html5Routes&&b.$el.on("click","a",function(a){/^http(s)?:\/\//.test(a.currentTarget.href)||/^\/?[a-z]/.test(a.currentTarget.href)&&(a.preventDefault(),a.stopPropagation(),b.emit("xqcore.navigate",a.currentTarget.href))}),b.forms&&b.formSetup(),b.__initialState&&(b.onStateChange(b.__initialState),delete b.__initialState)})},e.prototype.registerForms=function(){if(this.forms){var a="form";"string"==typeof this.forms&&(a=this.forms),this.ready(function(){this.$forms=this.$el.find(a),this.$forms.addClass("xq-forms"),this.$forms.find(":input").addClass("xq-input")})}},e.prototype.isElementInDOM=function(a){for(;a;){if(a===document.body)return!0;a=a.parentNode}return!1},a.View=e}(XQCore),function(a){"use strict";var b,c=new a.Logger("Router"),d=a.require("jquery"),e=function(b){var d,e,g=[];return c.logLevel=a.logLevel,b instanceof RegExp?(e=b,d=b.toString()):(e=f(b,g),d=b),{re:e,src:b.toString(),keys:g}},f=function(a,b){return a=a.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?|\*/g,function(a,c,d,e,f,g){return"*"===a?(b.push(void 0),a):(b.push(e),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||"([^/]+?)")+")"+(g||""))}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+a+"$","i")},g=function(a,b,c){for(var d,e=c||0,f=a.length;f>e;++e){var g=a[e],h=g.re,i=g.keys,j=[],k={};if(d=b.match(h)){for(var l=1,m=d.length;m>l;++l){var n=i[l-1],o="string"==typeof d[l]?unescape(d[l]):d[l];n?k[n]=o:j.push(o)}return{params:k,splats:j,route:g.src,next:e+1}}}},h=function(a){a=a||{},this.routes=[],this.routeMap={},a.noListener||this.registerListener();var b=this;d(function(){b.callRoute(b.getPath(),{initialCall:!0})})};h.getInstance=function(){return b||(b=new a.Router),b},h.prototype.registerListener=function(){a.html5Routes?window.addEventListener("popstate",this.onPopStateHandler.bind(this)):window.addEventListener("hashchange",this.onPopStateHandler.bind(this))},h.prototype.onPopStateHandler=function(){var a=this.getPath();this.callRoute(a,{noPush:!0})},h.prototype.getPath=function(){var b;return a.html5Routes?(b=location.pathname,b.replace(new RegExp("^"+a.basePath),"")):(b=location.hash,b=b.replace(new RegExp("^"+a.hashBang),""),b="/"+b)},h.prototype.addRoute=function(a,b){if(c.info("Register new route:",a,b),!a)throw new Error(" route requires a path");if(!b)throw new Error(" route "+a.toString()+" requires a callback");if(this.routeMap[a])throw new Error("path is already defined: "+a);"string"==typeof a&&(a=a.replace(/\/$/,""),"/"!==a.charAt(0)&&(a="/"+a));var d=new e(a);return d.fn=b,this.routes.push(d),this.routeMap[a]=b,this},h.prototype.removeRoute=function(a){if(!a)throw new Error(" route requires a path");if(!this.routeMap[a])return c.warn("Can not remove route! Route does not exists: "+a),this;for(var b=0;b<this.routes.length;b++){var d=this.routes[b];d.src===a&&this.routes.splice(b,1)}return delete this.routeMap[a],this},h.prototype.match=function(a,b){var c=g(this.routes,a,b);return c&&(c.fn=this.routeMap[c.route],c.next=this.match.bind(this,a,c.next)),c},h.prototype.callRoute=function(b,d){if(d=d||{},c.info("Call route",b),void 0===b)throw new Error("XQCore.Router error! Path is undefined in callRoute()!");var e=this.match(b);if(e.path=b,e.initialCall=!!d.initialCall,!e)return c.warn("Could not call any route! No route were found! Called path: "+b),void 0;!a.html5Routes||d.noPush||d.replace?a.html5Routes&&d.replace&&history.replaceState(null,"",b):history.pushState(null,"",b);var f=function(){c.info("... trigger route",this.route,this.fn,this.next),this.fn.call(this,this.params,this.splats,function(){var a=this.next();a&&f.call(a)}.bind(this))};f.call(e)},a.Router=h}(XQCore),function(a){"use strict";var b=new a.Logger("SocketConnection"),c=a.require("sockjs"),d={},e=function(a){return d[a]?d[a]:(d[a]=this,this.__isReady=!1,this.__onReadyCallbacks=[],this.__channels={},this.conn=null,this.connect(a),this.autoReconnect=!0,this.reconnectionInterval=1500,void 0)};e.prototype.connect=function(a){var d=this;this.conn&&"disconnected"!==this.connectionState||(b.info("Connect to socket server ",a),this.conn=new c(a,null,{debug:b.logLevel>=4}),this.connectionState="connecting",this.conn.onopen=function(){b.info("Connection was successful!"),d.setReady(),d.connectionState="connected"},this.conn.onmessage=function(a){var c;try{c=JSON.parse(a.data)}catch(e){console.error("Could not parse socket message!",a.data)}if(!c.channel)throw new Error("No socket channel was sent!");b.info("Got socket message",c.eventName,"in channel "+c.channel,c.args);var f=c.args||[];f.unshift(c.eventName),d.__channels[c.channel]?d.__channels[c.channel].emit.apply(d.__channels[c.channel],f):b.info(" ... channel not found!",c.channel)},this.conn.onclose=function(c){d.connectionState="disconnected",d.unsetReady(),b.warn("Connection to "+a+" closed!",c),d.autoReconnect&&(b.info("Try to reconnect to "+a),setTimeout(function(){d.connect(a)},d.reconnectionInterval))})},e.prototype.registerChannel=function(a,c){b.info("Register new channel",a),this.__channels[a]?b.info(" ... channel already registered!"):this.__channels[a]=c},e.prototype.unregisterChannel=function(a){b.info("Unregister channel",a),this.__channels[a]?delete this.__channels[a]:b.info(" ... channel not found!")},e.prototype.send=function(a,c){var d=this,e=Array.prototype.slice.call(arguments,2);this.ready(function(){b.info("Send socket message to channel "+a,c,e),d.conn.send(JSON.stringify({channel:a,eventName:c,args:e}))})},e.prototype.ready=function(a){this.__isReady?a.call(this):this.__onReadyCallbacks.push(a)},e.prototype.setReady=function(){var a=this;this.__isReady=!0,this.__onReadyCallbacks.forEach(function(b){b.call(a)}),this.__onReadyCallbacks=[]},e.prototype.unsetReady=function(){this.__isReady=!1},a.SocketConnection=e}(XQCore),function(a){"use strict";var b=new a.Logger("Socket");b.logLevel=5;var c=function(b,c){this.__isReady=!1,this.__onReadyCallbacks=[],this.channel=c,this.socket=new a.SocketConnection(b),this.socket.registerChannel(c,this)};a.extend(c.prototype,new a.Event),c.prototype.send=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.channel),this.socket.send.apply(this.socket,a)},a.Socket=c}(XQCore),function(a,b){"use strict";var c;c=function(b,c){this.noAutoRegister=!1,a.Model.call(this,b,c),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||a.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},c.prototype=Object.create(a.Model.prototype),c.prototype.constructor=c,c.inherit=function(c,d){"object"==typeof c&&(d=c,c=b);var e=function(){a.SyncModel.call(this,c,d)};return e.prototype=Object.create(a.SyncModel.prototype),e.prototype.constructor=e,e},c.prototype.connectToSocket=function(){var b=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",b),this.socket=new a.Socket(b,this.channel))},c.prototype.register=function(a){var b=this;this.syncEnabled=!!a,b.dev("Register syncmodel at server:",b.name);var c={noSync:!0};b.socket.on("syncmodel.set",function(a){b.set(a,c)}),b.socket.on("syncmodel.replace",function(a){c.replace=!0,b.set(a,c)}),b.socket.on("syncmodel.item",function(a,d){b.set(a,d,c)}),b.socket.on("syncmodel.insert",function(a,d,e){b.insert(a,d,e,c)}),b.socket.on("syncmodel.remove",function(a,d,e){b.remove(a,d,e,c)}),b.socket.on("syncmodel.reset",function(){b.reset(c)}),b.socket.on("syncmodel.init",function(a){console.log("Got initial data request:",a),b.set(a,c)}),b.socket.send("syncmodel.register",{name:b.name})},c.prototype.unregister=function(){var a=this.conf.syncWith||this.name.replace(/Model$/,"");this.socket.send("syncmodel.unregister",{name:a}),this.socket.off("syncmodel.set"),this.socket.off("syncmodel.replace"),this.socket.off("syncmodel.item"),this.socket.off("syncmodel.insert"),this.socket.off("syncmodel.remove"),this.socket.off("syncmodel.reset"),this.socket.off("syncmodel.init")},c.prototype.emitRemote=function(a,b){this.socket.send(a,b)},c.prototype.sync=function(a){if(this.syncEnabled){var b=Array.prototype.slice.call(arguments,1);b.unshift("syncmodel."+a),this.emitRemote.apply(this,b)}},c.prototype.fetchModel=function(){this.emitRemote("syncmodel.fetch")},a.SyncModel=c}(XQCore),function(a,b){"use strict";var c;c=function(c,d){a.ReadyState.call(this),a.Event.call(this);var e=this;"object"==typeof arguments[0]&&(d=c,c=d.name),this.debug=a.debug,d===b&&(d={}),this.__unfiltered={},this.name=(c?c.replace(/List$/,""):"Nameless")+"List",this.items=[],this.maxLength=null,this.model||(this.model=a.Model),"function"==typeof d?d.call(this,e):a.extend(this,d),this.defaults&&!a.isEmpty(this.defaults)&&this.push(this.defaults,{silent:!0,noValidation:!0}),this.state("ready"),this.setReady()},a.extend(c.prototype,a.ReadyState.prototype),a.extend(c.prototype,a.Event.prototype),a.extend(c.prototype,new a.Logger),a.Sync&&a.extend(c.prototype,a.Sync.prototype),c.inherit=function(c,d){"object"==typeof c&&(d=c,c=b);var e=function(){a.List.call(this,c,d)};return e.prototype=Object.create(a.List.prototype),e.prototype.constructor=e,e},Object.defineProperty(c.prototype,"length",{get:function(){return this.items.length}}),c.prototype.state=function(a){this.__state=a,this.emit("state."+a),this.emit("state.change",a)},c.prototype.getState=function(){return this.__state},c.prototype.push=function(b,c){var d,e,f=[];c=c||{},Array.isArray(b)||(b=[b]);for(var g=0,h=b.length;h>g;g++){if(e=b[g],e instanceof a.Model?d=e:(d=new this.model("ListItem"),d.set(e,{noSync:!0,silent:!0})),!d.isValid())return!1;f.push(d)}var i=this.items.push.apply(this.items,f);return i&&(this.maxLength&&this.items.length>this.maxLength&&this.items.splice(0,this.items.length-this.maxLength),c.silent||this.emit("item.push",f,i),c.noSync||"function"==typeof this.sync&&this.sync("push",f)),!0},c.prototype.unshift=function(b,c){var d,e,f=[];c=c||{},Array.isArray(b)||(b=[b]);for(var g=0,h=b.length;h>g;g++){if(e=b[g],e instanceof a.Model?d=e:(d=new this.model("ListItem"),d.set(e,{noSync:!0,silent:!0})),!d.isValid())return!1;f.unshift(d)}var i=this.items.unshift.apply(this.items,f);return i&&(this.maxLength&&this.items.length>this.maxLength&&this.items.splice(this.maxLength),c.silent||this.emit("item.unshift",f,i),c.noSync||"function"==typeof this.sync&&this.sync("unshift",f)),!0},c.prototype.pop=function(a){var c;return a=a||{},c=this.items.pop()||null,c===b?null:(a.silent||this.emit("item.pop",c),a.noSync||"function"==typeof this.sync&&this.sync("pop",c),c)},c.prototype.shift=function(a){var c;return a=a||{},c=this.items.shift()||null,c===b?null:(a.silent||this.emit("item.shift",c),a.noSync||"function"==typeof this.sync&&this.sync("shift",c),c)},c.prototype.update=function(a,b,c){c=c||{};var d;return d="number"==typeof a?this.items[a]:this.findOne(a),d&&(d.set(b,{noSync:!0,silent:!0}),c.silent||this.emit("item.update",d),c.noSync||"function"==typeof this.sync&&this.sync("update",a,b)),d},c.prototype.remove=function(a,b){b=b||{};var c,d=0;if("number"==typeof a)c=this.items[a],d=a;else{c=this.findOne(a);for(var e=0,f=this.items.length;f>e;e++)if(this.items[e]===c){d=e;break}}return c&&(this.items.splice(d,1),b.silent||this.emit("item.remove",c,d),b.noSync||"function"==typeof this.sync&&this.sync("remove",a,d)),c},c.prototype.clear=function(a){if(a=a||{},0===this.items.length)return 0;var b=this.toArray();return this.items=[],a.silent||this.emit("item.clear",b),a.noSync||"function"==typeof this.sync&&this.sync("clear",b),b.length},c.prototype.toArray=function(){return this.items.map(function(a){return a.properties})},c.prototype.toJSON=function(){return this.toArray()},c.prototype.findOne=function(a){var b;if(b=this.items)for(var c=0;c<b.length;c++){var d,e=b[c];for(var f in a)if(a.hasOwnProperty(f)){if(e.properties[f]&&e.properties[f]===a[f]){d=!0;break}d=!1}if(d===!0)return e}return null},c.prototype.find=function(a){var b,c=[];if(b=this.items)for(var d=0;d<b.length;d++){var e,f=b[d];for(var g in a)if(a.hasOwnProperty(g)){if(f.properties[g]&&f.properties[g]===a[g]){e=!0;break}e=!1}e===!0&&c.push(f)}return c},c.prototype.each=function(a,b){"function"==typeof a&&(b=a,a={});for(var c=a,d=0,e=this.items.length;e>d;d++)c=b(this.items[d],c);return c},a.List=c}(XQCore),function(a,b){"use strict";var c;c=function(b,c){this.noAutoRegister=!1,a.List.call(this,b,c),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||a.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},c.prototype=Object.create(a.List.prototype),c.prototype.constructor=c,c.inherit=function(c,d){"object"==typeof c&&(d=c,c=b);var e=function(){a.SyncList.call(this,c,d)};return e.prototype=Object.create(a.SyncList.prototype),e.prototype.constructor=e,e},c.prototype.connectToSocket=function(){var b=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",b),this.socket=new a.Socket(b,this.channel))},c.prototype.register=function(a){var b=this;"boolean"==typeof a&&(this.syncEnabled=a),b.dev("Register synclist at server:",b.name);var c={noSync:!0};b.socket.on("synclist.push",function(a){b.push(a,c)}),b.socket.on("synclist.unshift",function(a){b.push(a,c)}),b.socket.on("synclist.pop",function(){b.push(c)}),b.socket.on("synclist.shift",function(){b.push(c)}),b.socket.on("synclist.update",function(a,d){b.update(a,d,c)}),b.socket.on("synclist.clear",function(){b.clear(c)}),b.socket.on("synclist.init",function(a){console.log("Got initial data request:",a),b.push(a,c)}),b.socket.send("synclist.register",{name:b.name})},c.prototype.unregister=function(){this.dev("Unregister synclist at server:",this.name),this.socket.send("synclist.unregister",{name:this.name}),this.socket.off("synclist.push"),this.socket.off("synclist.unshift"),this.socket.off("synclist.pop"),this.socket.off("synclist.shift"),this.socket.off("synclist.update"),this.socket.off("synclist.clear"),this.socket.off("synclist.init")},c.prototype.emitRemote=function(a,b){this.socket.send(a,b)},c.prototype.sync=function(a){if(this.syncEnabled){var b=Array.prototype.slice.call(arguments,1);b.unshift("syncmodel."+a),this.emitRemote.apply(this,b)}},c.prototype.fetchList=function(){this.emitRemote("synclist.fetch")},a.SyncList=c}(XQCore),function(a,b){"use strict";var c;c=function(c,d){a.Event.call(this),"object"==typeof arguments[0]&&(d=c,c=d.name),this.logLevel=a.logLevel,d===b&&(d={}),"function"==typeof d?d.call(this,this):a.extend(this,d),this.conf=d,this.name=(c?c.replace(/Model$/,""):"Nameless")+"Model",this.__state="ready"},a.extend(c.prototype,a.Event.prototype),a.extend(c.prototype,new a.Logger),a.extend(c.prototype,a.Sync.prototype),c.inherit=function(c,d){"object"==typeof c&&(d=c,c=b);var e=function(b,e){a.Service.call(this,c,d),b&&("string"==typeof b?c=b:e=b,"function"==typeof e?e.call(this,this):"object"==typeof e&&a.extend(this,e))};return e.prototype=Object.create(a.Service.prototype),e.prototype.constructor=e,e},c.prototype.state=function(a){this.__state=a,this.emit("state."+a),this.emit("state.change",a)},c.prototype.getState=function(){return this.__state},a.Service=c}(XQCore);