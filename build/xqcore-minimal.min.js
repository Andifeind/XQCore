/*!
 * XQCore - 0.5.1-18
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2013 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2013-12-08
 */
var XQCore;(function(e,t){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery","handlebars"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery"),require("handlebars")):e.XQCore=t(e.jQuery,e.Handlebars)})(this,function(e,t){"use strict";return XQCore={version:"0.5.1-18",defaultRoute:"default",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/},XQCore.extend=e.extend,XQCore.isEmptyObject=e.isEmptyObject,XQCore.isObjectId=function(e){return this.objectIdPattern.test(e)},XQCore._dump={},XQCore.dump=function(e){return XQCore._dump[e]?(console.log("[XQCore dump]",e,XQCore._dump[e]),XQCore._dump[e]):!1},XQCore.require=function(n){return"jquery"===n?e:"handlebars"===n?t:void 0},XQCore}),function(e){"use strict";/*!
	 * EventEmitter v4.2.5 - git.io/ee
	 * Oliver Caldwell
	 * MIT license
	 * @preserve
	 */
function t(){}function n(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}var i=t.prototype;i.getListeners=function(e){var t,n,r=this._getEvents();if("object"==typeof e){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},i.flattenListeners=function(e){var t,n=[];for(t=0;e.length>t;t+=1)n.push(e[t].listener);return n},i.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},i.addListener=function(e,t){var r,i=this.getListenersAsObject(e),s="object"==typeof t;for(r in i)i.hasOwnProperty(r)&&-1===n(i[r],t)&&i[r].push(s?t:{listener:t,once:!1});return this},i.on=r("addListener"),i.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},i.once=r("addOnceListener"),i.defineEvent=function(e){return this.getListeners(e),this},i.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},i.removeListener=function(e,t){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(r=n(s[i],t),-1!==r&&s[i].splice(r,1));return this},i.off=r("removeListener"),i.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},i.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},i.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},i.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if("object"===n)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},i.removeAllListeners=r("removeEvent"),i.emitEvent=function(e,t){var n,r,i,s,o=this.getListenersAsObject(e);for(i in o)if(o.hasOwnProperty(i))for(r=o[i].length;r--;)n=o[i][r],n.once===!0&&this.removeListener(e,n.listener),s=n.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},i.trigger=r("emitEvent"),i.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},i.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},i._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},i._getEvents=function(){return this._events||(this._events={})},e.Event=t}(XQCore),function(e){"use strict";function t(e){return 1e3>e?e+" ms":6e4>e?Math.round(e/100)/10+" sec":Math.round(e/6e4)+" min "+Math.round(e%6e4/1e3)+" sec"}var n=function(){};n.prototype.log=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.log.apply(console,e))},n.prototype.warn=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.warn.apply(console,e))},n.prototype.error=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.error.apply(console,e))},n.prototype.timer=function(e){var n={start:null,stop:null,name:e,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",t(this.stop-this.start))}};return this.log("Start Timer",e),n.start=Date.now(),n},n.prototype.__scope={getHumanTime:t},e.Logger=n}(XQCore),function(e,t){"use strict";var n,r=function(e,t){return e&&(e=e.split("."),e.forEach(function(e){t=t[e]})),t};n=function(n){n===t&&(n={}),this.__state="starting",this.customInit=n.init,delete n.init,this.customValidate=n.validate,delete n.validate,this.conf=n,e.extend(this,n,new e.Logger),e.extend(this,new e.Event),this.name=(n.name||"Nameless")+"Model",this.debug=Boolean(n.debug),this._isValid=!1,this.properties={},this.schema=n.schema,this.defaults&&!e.isEmptyObject(this.defaults)&&this.set(this.defaults)},e.Sync&&e.extend(n.prototype,e.Sync.prototype),n.prototype.init=function(){this.debug&&(e._dump[this.name]=this),"function"==typeof this.customInit&&this.customInit.call(this),this.state("ready")},n.prototype.state=function(e){this.__state=e,this.emit("state."+e),this.emit("state.change",e)},n.prototype.getState=function(){return this.__state},n.prototype.set=function(e,t,n){var r,i={},s=this.get();if(n=n||{},null===arguments[0])i=arguments[1],this.log("Set data",i,s);else if("object"==typeof arguments[0])i=arguments[0],this.log("Set data",i,s);else if("string"==typeof arguments[0]){i=this.get(),e=arguments[0];var o=arguments[1];if(i[e]=o,this.log("Set data",i,s),n.validateOne&&(n.noValidation=!0,r=this.validateOne(this.schema[e],o),r.isValid===!1))return this.warn("Validate error in model.set",r),n.silent!==!0&&this.emit("validation.error",r),!1}else this.warn("Data are incorrect in model.set()",arguments);return this.schema&&n.noValidation!==!0&&(r=this.validate(i),null!==r)?(this.warn("Validate error in model.set",r),n.silent!==!0&&this.emit("validation.error",r),!1):this.customValidate&&n.noValidation!==!0&&(r=this.customValidate(i),null!==r)?(this.warn("Validate error in model.set",r),this.emit("validation.error",r),!1):(this.properties=i,n.silent!==!0&&this.emit("data.change",i,s),e&&n.silent!==!0&&this.emit("change."+e,i[e]),!0)},n.prototype.get=function(e){return e===t?this.properties:this.properties[e]},n.prototype.has=function(e){return!!this.properties[e]},n.prototype.reset=function(){this.log("Reset model"),this.properties={}},n.prototype.append=function(e,t){1===arguments.length&&(t=e,e=null);var n=this.properties,r=this.get(),i=!0;return e&&e.split(".").forEach(function(e){n=n[e]}),n instanceof Array?n.push(t):null===e?(this.properties=[t],n=this.get()):this.warn("Model.append requires an array. Dataset isn't an array",e),i&&this.emit("data.change",n,r),t},n.prototype.prepend=function(e,t){1===arguments.length&&(t=e,e=null);var n=this.properties,r=this.get(),i=!0;return e&&e.split(".").forEach(function(e){n=n[e]}),n instanceof Array?n.unshift(t):null===e?(this.properties=[t],n=this.get()):this.warn("Model.append requires an array. Dataset isn't an array",e),i&&this.emit("data.change",n,r),t},n.prototype.remove=function(e,t){var n=this.properties,r=null;return e.split(".").forEach(function(e){n=n[e]}),n instanceof Array?(r=n.splice(t,1),r=r[0]||null):this.warn("Model.remove() doesn't work with Objects in model",this.name),r},n.prototype.search=function(e,t){var n;if(1===arguments.length?(t=e,e="",n=this.properties):n=r(e,this.properties),n)for(var i=0;n.length>i;i++){var s,o=n[i];for(var a in t)if(t.hasOwnProperty(a)){if(!o[a]||o[a]!==t[a]){s=!1;break}s=!0}if(s===!0)return o}return null},n.prototype.sortBy=function(e,t){1===arguments.length&&(t=e,e=null);var n,i=r(e,this.properties);return i.sort(function(e,i){n=-1;for(var s in t)if(t.hasOwnProperty(s)){if(n=(r(s,e)+"").localeCompare(r(s,i)+""),0===n)continue;-1===t[s]&&(n=n>0?-1:1);break}return n}),this.set(e,i),i},n.prototype.validate=function(n,r){var i=[];return r=r||this.schema,r&&Object.keys(r).forEach(function(s){if("object"==typeof n[s]&&r[s].type===t){var o=this.validate(e.extend({},n[s]),e.extend({},r[s]));return Array.isArray(o)&&o.length>0&&(i=i.concat(o)),t}var a=this.validateOne(r[s],n[s]);a.isValid===!0?n[s]=a.value:(a.error.property=s,i.push(a.error))}.bind(this)),0===i.length?(this._isValid=!0,null):(this._isValid=!1,i)},n.prototype.validateOne=function(e,n){var r=null,i="function"==typeof e.type?typeof e.type():e.type.toLowerCase();if(""===n&&e.noEmpty===!0&&(n=t),n!==t&&null!==n||!e.default||(n=e.default),n===t||null===n||""===n)e.required===!0&&(r={msg:"Property is undefined or null, but it's required",errCode:10});else if("string"===i)e.convert&&"number"==typeof n&&(n+=""),i!==typeof n?r={msg:"Property type is a "+typeof n+", but a string is required",errCode:11}:e.min&&e.min>n.length?r={msg:"String length is too short",errCode:12}:e.max&&e.max<n.length?r={msg:"String length is too long",errCode:13}:e.match&&!e.match.test(n)&&(r={msg:"String doesn't match regexp",errCode:14});else if("number"===i)e.convert&&"string"==typeof n&&(n=parseInt(n,10)),i!==typeof n?r={msg:"Property type is a "+typeof n+", but a number is required",errCode:21}:e.min&&e.min>n?r={msg:"Number is too low",errCode:22}:e.max&&n>e.max&&(r={msg:"Number is too high",errCode:23});else if("date"===i){if(n){var s=Date.parse(n);isNaN(s)&&(r={msg:"Property isn't a valid date",errCode:31})}}else"array"===i?Array.isArray(n)?e.min&&e.min>n.length?r={msg:"Array length is "+n.length+" but must be greater than "+e.min,errCode:42}:e.max&&e.max<n.length&&(r={msg:"Array length is "+n.length+" but must be lesser than "+e.max,errCode:43}):r={msg:"Property type is a "+typeof n+", but an array is required",errCode:41}:"object"===i?"object"!=typeof n&&(r={msg:"Property isn't a valid object",errCode:51}):"objectid"===i?/^[a-zA-Z0-9]{24}$/.test(n)||(r={msg:"Property isn't a valid objectId",errCode:52}):"boolean"===i&&"boolean"!=typeof n&&(r={msg:"Property isn't a valid boolean",errCode:61});return null===r?r={isValid:!0,value:n,error:null}:(this.warn("Validation error on property",r,"Data:",n),r={isValid:!1,value:n,error:r}),r},n.prototype.isValid=function(){return this._isValid},e.Model=n}(XQCore);