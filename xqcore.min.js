/*!
 * XQCore - +0.11.1-305
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2015 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2015-10-30
 * 
 */
var XQCore;(function(t,e){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):t.XQCore=e(t.jQuery)})(this,function(t){"use strict";return XQCore={version:"0.11.1-305",defaultRoute:"/",html5Routes:!1,basePath:"",hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire",socketPort:9889,eventListenerMaxLength:1328},XQCore.extend=t.extend,XQCore.isEmptyObject=t.isEmptyObject,XQCore.isPlainObject=t.isPlainObject,XQCore.isFunction=t.isFunction,XQCore.__moduleCache={},XQCore.isObjectId=function(t){return this.objectIdPattern.test(t)},XQCore.modules={jquery:{cjs:"jquery",amd:"jquery",win:"jQuery"},firetpl:{cjs:"firetpl",amd:"firetpl",win:"fireTpl"},sockjs:{cjs:"xqcore/lib/sockjs.js",amd:"xqcore/lib/sockjs.js",win:"SockJS"}},XQCore.require=function(t){if(XQCore.__moduleCache[t])return XQCore.__moduleCache[t];var e="win";"undefined"!=typeof module&&module.exports&&"function"==typeof require?e="cjs":"function"==typeof define&&define.amd&&(e="amd"),XQCore.modules[t][e]&&(t=XQCore.modules[t][e]);try{if("cjs"===e||"amd"===e)try{return require(t)}catch(n){console.warn("Module not registered as a "+("cjs"===e?"CommonJS":"AMD")+" module! Try to load from window object",t)}return window[t]}catch(n){console.error("Could not load module!",t,n)}},XQCore.setLocale=function(t){localStorage.setItem("xqcore.locale",t)},XQCore.getLocale=function(){var t=localStorage.getItem("xqcore.locale");return t?t:navigator.language},XQCore.logLevel=1,XQCore}),function(t,e){"use strict";t.undotify=function(t,n){return t&&(t=t.split("."),t.forEach(function(t){n=n?n[t]:e})),n},t.dedotify=function(t,n,i){"string"==typeof t&&(i=n,n=t,t={});var o=t;if(n){n=n.split(".");var r=n.length;n.forEach(function(n,o){return o===r-1?/\[\]$/.test(n)?(n=n.substr(0,n.length-2),t[n]||(t[n]=[]),t[n].push(i),e):(t[n]=i,e):(t[n]||(t[n]={}),t=t[n],e)})}return t=i,o},t.uid=function(t){t=t||7;for(var e="";t>e.length;){var n=Math.random().toString(36).substr(2);e+=n}return e.substr(0,t)}}(XQCore),function(t){"use strict";t.getQuery=function(e){return t.__query||(t.__query={},location.search.substr(1).split("&").forEach(function(e){if(e=e.split("="),e&&e[0]){var n=encodeURI(e[1]);t.__query[e[0]]=isNaN(n)?n:Number(n)}})),e?t.__query[e]:t.__query}}(XQCore),function(t){"use strict";var e=function(e){this.loggerName=e,this.logLevel=t.logLevel};e.prototype.log=function(){var e;t.logLevel>=3&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.log.apply(console,e))},e.prototype.warn=function(){var e;t.logLevel>=2&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.warn.apply(console,e))},e.prototype.error=function(){var e;t.logLevel>=1&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.error.apply(console,e))},e.prototype.debug=function(){var e;t.logLevel>=4&&(e=Array.prototype.slice.call(arguments),this.loggerName&&e.unshift("["+this.loggerName+"]"),console.debug.apply(console,e))},e.prototype.info=e.prototype.log,e.prototype.timer=function(t){var e=this,n={start:null,stop:null,name:t,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+t+" finished after "+e.getHumanTime(this.stop-this.start))}};return this.log("Start Timer "+t),n.start=Date.now(),n},e.prototype.dev=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),this.loggerName&&t.unshift("["+this.loggerName+"]"),console.debug.apply(console,t))},e.prototype.req=e.prototype.log,e.prototype.res=e.prototype.log,e.prototype.getHumanTime=function(t){return 1e3>t?t+"ms":6e4>t?Math.round(t/100)/10+"sec":Math.round(t/6e4)+"min "+Math.round(t%6e4/1e3)+"sec"},t.Logger=e}(XQCore),function(t){"use strict";var e=new t.Logger("EventEmitter"),n=function(t,e,n){this.fn=n,this.calls=0,this.once=!1,this.remove=function(){t.off(e,n)}},i=function(){this.__events={},this.__logger=e,this.maxLength=t.eventListenerMaxLength};i.prototype.on=function(t,i){var o=new n(this,t,i);return this.__events[t]||(this.__events[t]=[]),this.__events[t].push(o),this.__events[t].length>this.maxLength?e.warn("Listener max length was exceeded!","List:",t,"Length:",this.__events[t].length):e.info("Register new `"+t+"` event"),o},i.prototype.once=function(){var t=Array.prototype.slice.call(arguments),e=this.on.apply(this,t);return e.once=!0,e},i.prototype.emit=function(t,n){if(!this.__events[t])return e.info("Emit `"+t+"` event failed! No listener of this type are registered"),0;for(var i=Array.prototype.slice.call(arguments,1),o=this.__events[t].length,r=o-1;r>=0;r--){var s=this.__events[t][r];s.fn.apply(this,i),s.calls++,s.once===!0&&this.__events[t].splice(r,1)}return o&&(e.info("Emit `"+t+"` event to",o,"listener"),e.debug(" ... data:",n)),o},i.prototype.off=function(t,n){var i=0;if(!this.__events[t])return e.info("Unregister events failed! No `"+t+"` events were found!"),0;if(n)for(var o=this.__events[t].length,r=0;o>r;r++){var s=this.__events[t][r];s&&s.fn===n&&(this.__events[t].splice(r,1),i++,0===this.__events[t].length&&delete this.__events[t])}else i=this.__events[t].length,delete this.__events[t];return e.info("Unregister `"+t+"` events!","Removed "+i+" listener"),i},i.prototype.clearEvents=function(){this.__events={}},t.Event=i}(XQCore),function(t){var e=function(){this.__isReady=!1,this.__readyFuncs=[]};e.prototype.ready=function(t){this.__isReady?t.call(this):this.__readyFuncs.push(t)},e.prototype.setReady=function(){var t=this;this.__isReady=!0,this.__readyFuncs&&(this.__readyFuncs.forEach(function(e){e.call(t)}),this.__readyFuncs=[])},e.prototype.unsetReady=function(){this.__isReady=!1},t.ReadyState=e}(XQCore),function(t){"use strict";var e,n=t.require("jquery"),i=function(i,o){var r=this;"function"==typeof arguments[0]&&(o=i,i=null),this.name=i||"Nameless",this.router=t.Router.getInstance(),e=new t.Logger(this.name+"Presenter"),this.__views={},"function"==typeof o&&o.call(this,r,e),n(function(){r.router.callRoute(r.router.getPath())})};t.extend(i.prototype,new t.Event),i.prototype.init=function(){},i.prototype.pushState=function(n,i){var o=t.html5Routes||"/"===n.charAt(0)?"":t.hashBang;n=o+n,history.pushState(i,"",n||null),e.info("Update history with pushState. New URL: "+i,n)},i.prototype.replaceState=function(n,i){var o=t.html5Routes||"/"===n.charAt(0)?"":t.hashBang;n=o+n,history.replaceState(i,"",n||null),e.info("Update history with replaceState. New URL: "+i,n)},i.prototype.navigateTo=function(e,n){n=n||{},t.html5Routes?this.router.callRoute(e,n):(location.hash=t.hashBang+e,this.router.callRoute(e,n))},i.prototype.navigateBack=function(){history.back()},i.prototype.getView=function(t){return this.__views[t]||null},i.prototype.getHash=function(){return location.hash},i.prototype.getPathname=function(){return location.pathname},i.prototype.couple=function(e,n,i){i=i||{},n instanceof t.List?this.coupleList(e,n,i):this.coupleModel(e,n,i),this.coupleView(e,n,i)},i.prototype.coupleModel=function(n,i,o){if(o=o||{},!(n instanceof t.View))return e.error("Could not couple model with view. First arg is not a valid view!");if(!(i instanceof t.Model))return e.error("Could not couple model with view. Second arg is not a valid model!");e.info("Couple model",i.name,"with",n.name),i.__coupled&&i.__coupled.uncouple(),i.__coupled={obj:n,events:[],uncouple:function(){e.info("Uncouple model",i.name,"from",n.name),i.__coupled.events.forEach(function(t){t.remove()}),delete i.__coupled}};var r={"data.replace":"xrender","data.set":"xrender","value.set":"xrender","item.insert":"xrender","item.remove":"remove","validation.error":"validationFailed","state.change":"onStateChange"},s=function(t,e){var o;o="xrender"===e?function(){n.render(i.get())}:n[e].bind(n);var r=i.on(t,o);i.__coupled.events.push(r)};for(var a in r)r.hasOwnProperty(a)&&s(a,r[a]);n.render(i.get()),console.log("VIEW",n),console.log("MODEL",i)},i.prototype.coupleList=function(n,i){if(!(n instanceof t.View))return e.error("Could not couple list with view. First arg is not a valid view!");if(!(i instanceof t.List))return e.error("Could not couple list with view. Second arg is not a valid list!");e.info("Couple list",i.name,"with",n.name),i.__coupled&&i.__coupled.uncouple(),i.__coupled={obj:n,events:[],uncouple:function(){e.info("Uncouple list",i.name,"from",n.name),i.__coupled.events.forEach(function(t){t.remove()}),delete i.__coupled}};var o={"item.push":"xrender","item.unshift":"xrender","item.pop":"xrender","item.shift":"xrender","item.update":"xrender","state.change":"onStateChange"},r=function(t,e){var o=n[e].bind(n);"xrender"===e&&(o=function(){n.render(i.get())});var r=i.on(t,o);i.__coupled.events.push(r)};for(var s in o)o.hasOwnProperty(s)&&r(s,o[s]);n.render(i.toArray()),console.log("VIEW",n),console.log("LIST",i)},i.prototype.coupleView=function(n,i){if(!(n instanceof t.View))return e.error("Could not couple list with view. First arg is not a valid view!");if(!(i instanceof t.Model||i instanceof t.List))return e.error("Could not couple list with view. Second arg is not a valid model or list!");e.info("Couple view",n.name,"with",i.name),n.__coupled&&n.__coupled.uncouple(),n.__coupled={obj:i,events:[],uncouple:function(){e.info("Uncouple view",n.name,"from",i.name),n.__coupled.events.forEach(function(t){t.remove()}),delete n.__coupled}};var o;o=i instanceof t.Model?{"form.submit":"submit","input.change":"set","input.edit":function(t,e){var o=i.checkValidation(t,e);o?n.validationSucceeded(t,e):n.validationFailed([{property:name}])}}:{"form.submit":"submit"};var r=function(t,e){var o="function"==typeof e?e:i[e].bind(i),r=n.on(t,o);n.__coupled.events.push(r)};for(var s in o)o.hasOwnProperty(s)&&r(s,o[s]);console.log("VIEW",n),console.log("MODE or LIST",i)},i.prototype.initView=function(e,n,i){i=i||{};var o={};i.viewDir&&(o.viewDir=i.viewDir);var r=new t.View(e,function(r){r.template=t.Tmpl.getTemplate(e,o),r.mode=i.mode||"replace",r.container=n||"body",r.hidden=!!i.hidden,r.forms=i.forms,i.inject===!1&&(r.autoInject=!1)});this.__views[e]=r;var s=this;return t.html5Routes&&r.on("xqcore.navigate",function(t){s.router.callRoute(t)}),r},i.prototype.route=function(t,n){var i=this;return"string"==typeof n&&(n=this[n]),"function"==typeof n?"string"==typeof t?this.router.addRoute(t,n):Array.isArray(t)&&t.forEach(function(t){i.router.addRoute(t,n)}):e.warn("Router callback isn't a function",n,"of route",t),this},t.Presenter=i}(XQCore),function(t,e){"use strict";var n=t.require("jquery"),i=function(){this.server=null};i.prototype.onSend=function(t){return t},i.prototype.send=function(t,i,o,r){var s=this;"object"==typeof i?(r=o,o=i,i=this.server,t=t):"function"==typeof o?(r=o,o=this.get()):o===e&&(o=this.get()),t===e&&(t="POST"),i||(i=this.server),"GET"===t&&Array.isArray(o)&&(i=i.replace(/\/$/,"")+"/"+o.join("/"),o=null),"function"==typeof this.onSend&&(o=this.onSend.call(this,o)),this.log("Send an ajax call to ",i,"with data: ",o),this.state("syncing"),n.ajax({url:i,type:t,data:o,dataType:"json",success:function(t,e,n){"function"==typeof r&&r.call(s,null,t,e,n),s.state("success")},error:function(t,e,n){"function"==typeof r&&r.call(s,{type:e,http:n},null,e,t),s.state("failed")}})},i.prototype.sendPOST=function(t,e,n){this.send("POST",t,e,n)},i.prototype.sendGET=function(t,e,n){this.send("GET",t,e,n)},i.prototype.sendPUT=function(t,e,n){this.send("PUT",t,e,n)},i.prototype.sendDELETE=function(t,e,n){this.send("DELETE",t,e,n)},i.prototype.fetch=function(t,e){this.sendGET(t,e)},i.prototype.save=function(t,e){"function"==typeof t&&(e=t,t=this.schema?this.getByKeys(Object.keys(this.schema)):this.get()),this.isValid()?this.sendPOST(t,e):"function"==typeof e&&e({msg:"Model isn't valid. Cancle save"})},i.prototype.update=function(t,e){"function"==typeof t&&(e=t,t=this.schema?this.getByKeys(Object.keys(this.schema)):this.get()),this.isValid()?this.sendPUT(t,e):"function"==typeof e&&e({msg:"Model isn't valid. Cancel update"})},i.prototype.submit=function(t){if(this.set(t,{extend:!0})){if(t.id===e||null===t.id)return this.save(t),e;this.update(t)}},t.Sync=i}(XQCore),function(XQCore,undefined){"use strict";var Model;Model=function(t,e){XQCore.ReadyState.call(this),XQCore.Event.call(this),"object"==typeof arguments[0]&&(e=t,t=e.name),this.logLevel=XQCore.logLevel,this.properties={},this.lastValidationErr=null,e===undefined&&(e={}),"function"==typeof e?e.call(this,this):XQCore.extend(this,e),this.__state="starting",this.__unfiltered={},this.customValidate=e.validate,delete e.validate,this.conf=e,this.name=(t?t.replace(/Model$/,""):"Nameless")+"Model",this.__isValid=!1,this.defaults&&!XQCore.isEmptyObject(this.defaults)&&this.set(this.defaults,{silent:!0,noValidation:!0}),this.schema&&Object.keys(this.schema).forEach(function(t){t in this.properties||(this.properties[t]=this.schema[t].default!==undefined?this.schema[t].default:null)},this),this.__isValid=!this.schema,this.state("ready")},XQCore.extend(Model.prototype,XQCore.ReadyState.prototype),XQCore.extend(Model.prototype,XQCore.Event.prototype),XQCore.extend(Model.prototype,new XQCore.Logger),XQCore.Sync&&XQCore.extend(Model.prototype,XQCore.Sync.prototype),Model.inherit=function(t,e){"object"==typeof t&&(e=t,t=undefined);var n=function(n,i){XQCore.Model.call(this,t,e),n&&("string"==typeof n?t=n:i=n,"function"==typeof i?i.call(this,this):"object"==typeof i&&XQCore.extend(this,i))};return n.prototype=Object.create(XQCore.Model.prototype),n.prototype.constructor=n,n},Model.prototype.init=function(){console.warn("Model.init is deprecated since v0.10.0")},Model.prototype.state=function(t){this.__state=t,this.emit("state."+t),this.emit("state.change",t)},Model.prototype.getState=function(){return this.__state},Model.prototype.set=function(t,e,n){var i,o={},r=this.get(),s=!1,a=!1;if(n=n||{},null===arguments[0]?(o=arguments[1],a=!0,this.log("Set data",o,r)):"object"==typeof arguments[0]?(n=e||{},o=n.replace?arguments[0]:XQCore.extend(o,r,arguments[0]),a=!0,t=null,this.log("Set data",o,r)):"string"==typeof arguments[0]?(o=XQCore.extend({},this.get()),s=!0,XQCore.dedotify(o,t,e),this.log("Set value",t,e,r)):this.warn("Data are incorrect in model.set()",arguments),n=n||{},n.noValidation!==!0){if(this.customValidate)this.log("Using a custom validation!"),i=this.customValidate(o);else if(this.schema&&(i=this.validate(o),s&&i)){for(var c,l=0,h=i.length;h>l;l++)if(i[l].property===t){c=[i[l]];break}i=c||null}if(i)return this.warn("Validation error",i),n.silent!==!0&&this.emit("validation.error",i,o),!1}return this.properties=o,n.silent!==!0&&(a?n.noSync||"function"!=typeof this.sync?this.emit(n.replace?"data.replace":"data.set",o,r):this.sync(n.replace?"replace":"set",o):s&&(n.noSync||"function"!=typeof this.sync||this.sync("value",t,e),this.emit("value.set",t,e)),this.emit("data.change",o,r)),!0},Model.prototype.get=function(key,options){options===undefined&&(options={});var data;if("object"==typeof key&&1===arguments.length&&(options=key,key=null),key===undefined||null===key){if(options.copy===!0)switch(data=this.properties,typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+(""+data)+")");default:return data}return this.properties}if("string"==typeof key&&"number"==typeof options){var index=options;3===arguments.length&&(options=arguments[2]);var item=this.get(key);return options.copy===!0&&"object"==typeof item[index]?XQCore.extend({},item[index]):item?item[index]:null}if(options.copy===!0)switch(data=XQCore.undotify(key,this.properties),typeof data){case"object":return Array.isArray(data)?data.slice():XQCore.extend(!0,{},data);case"function":return eval("("+(""+data)+")");default:return data}return XQCore.undotify(key,this.properties)},Model.prototype.getByKeys=function(t,e){if("object"!=typeof t)throw Error("First param must be an object or array in Model.getByKeys()!");var n={};if(e=e||this.get(),Array.isArray(t))t.forEach(function(t){-1===t.indexOf(".")?n[t]=e[t]:n=XQCore.dedotify(n,t,XQCore.undotify(t,e))});else for(var i in t)if(t.hasOwnProperty(i)){var o=e[i];n[i]="object"==typeof o?this.getByKeys(t[i],e[i]):e[i]}return n},Model.prototype.has=function(t){var e=!0,n=this.properties;t=t.split(".");for(var i=0,o=t.length;o>i;i++){if("object"!=typeof n||!n.hasOwnProperty(t[i])){e=!1;break}n=n[t[i]]}return e},Model.prototype.reset=function(t){t=t||{},this.log("Reset model");var e=this.get();return this.properties=XQCore.extend({},this.defaults),this.state("starting"),t.silent||this.emit("data.reset",e),t.removeListener&&this.clearEvents(),t.noSync||"function"==typeof this.sync&&this.sync("reset",e),e},Model.prototype.push=function(t,e,n){var i=XQCore.undotify(t,this.properties);if(n=n||{},i instanceof Array)i.push(e);else if(i===undefined)XQCore.dedotify(this.properties,t,[e]);else{if("object"!=typeof i||t||!XQCore.isEmptyObject(this.properties))return this.error("Model.push requires an array. Dataset isn't an array. Path: ",t),undefined;this.properties=[e]}n.silent!==!0&&(n.noSync||"function"!=typeof this.sync||this.sync("insert",t,-1,e),this.emit("item.insert",t,-1,e),this.emit("data.change",this.properties))},Model.prototype.unshift=function(t,e,n){var i=XQCore.undotify(t,this.properties);if(n=n||{},i instanceof Array)i.unshift(e);else if(i===undefined)XQCore.dedotify(this.properties,t,[e]);else{if("object"!=typeof i||t||!XQCore.isEmptyObject(this.properties))return this.error("Model.unshift requires an array. Dataset isn't an array. Path: ",t),undefined;this.properties=[e]}n.silent!==!0&&(n.noSync||"function"!=typeof this.sync||this.sync("insert",t,0,e),this.emit("item.insert",t,0,e),this.emit("data.change",this.properties))},Model.prototype.insert=function(t,e,n,i){var o=XQCore.undotify(t,this.properties);if(i=i||{},o instanceof Array)-1===e?o.push(n):0===e?o.unshift(n):o.splice(e,0,n);else{if(o)return this.error("Model.insert requires an array. Dataset isn't an array. Path: ",t),undefined;XQCore.dedotify(this.properties,t,[n])}i.silent!==!0&&(i.noSync||"function"!=typeof this.sync||this.sync("insert",t,e,n),this.emit("item.insert",t,e,n),this.emit("data.change",this.properties))},Model.prototype.remove=function(t,e,n){var i=XQCore.undotify(t,this.properties),o=null;if(n=n||{},i instanceof Array)o=i.splice(e,1);else if("object"==typeof i)return this.error("Model.remove requires an array. Dataset isn't an array. Path: ",t),undefined;return o&&n.silent!==!0&&(n.noSync||"function"!=typeof this.sync||this.sync("remove",t,e),this.emit("item.remove",t,e,o[0]),this.emit("data.change",this.properties)),o},Model.prototype.replace=function(t,e){return e=e||{},e.replace=!0,this.set(t,e)},Model.prototype.search=function(t,e){var n;if(1===arguments.length?(e=t,t="",n=this.properties):n=t?XQCore.undotify(t,this.properties):this.properties,n)for(var i=0;n.length>i;i++){var o,r=n[i];for(var s in e)if(e.hasOwnProperty(s)){if(r[s]&&r[s]===e[s]){o=!0;break}o=!1}if(o===!0)return r}return null},Model.prototype.update=function(t,e,n,i){var o;i=i||{},o="number"==typeof e?this.get(t,e):this.search(t,e);var r=XQCore.extend({},o);o&&(XQCore.extend(o,n),i.silent!==!0&&(this.emit("data.update",t,e,n,r),this.emit("data.change",this.properties)),i.noSync||"function"!=typeof this.sync||this.sync("update",t,e,n))},Model.prototype.sortBy=function(t,e){1===arguments.length&&(e=t,t=null);var n,i=XQCore.undotify(t,this.properties);return Array.isArray(i)?(i.sort(function(t,i){n=-1;for(var o in e)if(e.hasOwnProperty(o)){if(n=(XQCore.undotify(o,t)+"").localeCompare(XQCore.undotify(o,i)+""),0===n)continue;-1===e[o]&&(n=n>0?-1:1);break}return n}),this.set(t,i),i):(this.warn("Could not sort data of type",typeof i),[])},Model.prototype.filter=function(t,e,n,i){if(1===arguments.length&&(i=t,t=null),"string"==typeof i){if(!this.__registeredFilter[i])throw Error("Filter "+i+" not registered!");i=this.__registeredFilter[i]}for(var o=XQCore.undotify(t,this.__unfiltered.data||this.properties),r=[],s=0,a=o.length;a>s;s++)i(e,n,o[s])&&r.push(o[s]);return this.__unfiltered={path:t,data:o},this.set(t,r),r},Model.prototype.filterReset=function(t){this.__unfiltered&&this.set(this.__unfiltered.path,this.__unfiltered.data,t)},Model.prototype.validate=function(t,e){var n=this,i=[];return e=e||this.schema,e&&Object.keys(e).forEach(function(o){if("object"==typeof t[o]&&e[o].type===undefined){var r=n.validate(XQCore.extend({},t[o]),XQCore.extend({},e[o]));return Array.isArray(r)&&r.length>0&&(i=i.concat(r)),undefined}var s=n.validateOne(e[o],t[o]);s.isValid===!0?t[o]=s.value:(s.error.property=o,i.push(s.error))}),0===i.length?(this.__isValid=!0,this.lastValidationErr=null,this.state("valid"),null):(this.__isValid=!1,this.lastValidationErr=i,this.state("invalid"),i)},Model.prototype.validateOne=function(t,e){var n,i="function"==typeof t.type?typeof t.type():t.type.toLowerCase();if(""===e&&t.noEmpty===!0&&(e=undefined),e!==undefined&&null!==e&&""!==e||!t["default"]||(e=t["default"]),e===undefined||null===e||""===e)t.required===!0&&(n={msg:"Property is undefined or null, but it's required",errCode:10});else{if(!this.__registeredValidations[i])throw Error("Undefined schema type",t);n=this.__registeredValidations[i].call(this,e,t)}return n=n===undefined?{isValid:!0,value:e,error:null}:{isValid:!1,value:e,error:n}},Model.prototype.checkValidation=function(t,e){var n=this.validateOne(this.schema[t],e,t);return n.isValid},Model.prototype.isValid=function(){return this.__isValid},Model.prototype.setData=function(t){this.warn("Model.setData has been deprecated since v0.9"),this.set(t,{extend:!0})},Model.registerFilter=function(t,e){if("function"!=typeof e)throw Error("Filter function isn't a function");var n="function"==typeof this?Model.prototype:this;n.__registeredFilter[t]=e},Model.prototype.registerFilter=Model.registerFilter,Model.prototype.__registeredFilter={quicksearch:function(t,e,n){var i=XQCore.undotify(t,n),o=RegExp(e.replace(/[a-z0-9äüöß]/g,"$&.*"),"i");return o.test(i)}},Model.registerValidation=function(t,e){var n="function"==typeof this?Model.prototype:this;n.__registeredValidations[t]=e},Model.prototype.registerValidation=Model.registerValidation,Model.prototype.__registeredValidations={string:function(t,e){return e.convert&&"number"==typeof t&&(t+=""),"string"!=typeof t?{msg:"Property type is a "+typeof t+", but a string is required",errCode:11}:e.min&&e.min>t.length?{msg:"String length is too short",errCode:12}:e.max&&e.max<t.length?{msg:"String length is too long",errCode:13}:e.match&&!e.match.test(t)?{msg:"String doesn't match regexp",errCode:14}:undefined},number:function(t,e){return e.convert&&"string"==typeof t&&(t=parseInt(t,10)),"number"!=typeof t||isNaN(t)?{msg:"Property type is not a valid number",errCode:21}:e.min&&e.min>t?{msg:"Number is too low",errCode:22}:e.max&&t>e.max?{msg:"Number is too high",errCode:23}:undefined},date:function(t){if(t){var e=Date.parse(t);if(isNaN(e))return{msg:"Property isn't a valid date",errCode:31}}},array:function(t,e){return Array.isArray(t)?e.min&&e.min>t.length?{msg:"Array length is "+t.length+" but must be greater than "+e.min,errCode:42}:e.max&&e.max<t.length?{msg:"Array length is "+t.length+" but must be lesser than "+e.max,errCode:43}:undefined:{msg:"Property type is a "+typeof t+", but an array is required",errCode:41}},object:function(t){return"object"!=typeof t?{msg:"Property isn't a valid object",errCode:51}:undefined},objectid:function(t){return/^[a-zA-Z0-9]{24}$/.test(t)?undefined:{msg:"Property isn't a valid objectId",errCode:52}},"boolean":function(t){return"boolean"!=typeof t?{msg:"Property isn't a valid boolean",errCode:61}:undefined},time:function(t){return/^\d+(:\d{2}){1,3}$/.test(t)?undefined:{msg:"Property isn't a valid time",errCode:71}},email:function(t){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)?undefined:{msg:"Property isn't a valid email",errCode:72}}},XQCore.Model=Model}(XQCore),function(t,e){"use strict";if("function"==typeof define&&define.amd)define("xqcore",[XQCore.templateEngine],e);else if("undefined"!=typeof module&&module.exports)module.exports=e(require(XQCore.templateEngine));else{var n="firetpl"===XQCore.templateEngine?"FireTPL":"Handlebars";t.XQCore=e(t[n])}}(this,function(t){"use strict";return XQCore.Tmpl={type:XQCore.templateEngine,compile:t.compile,getTemplate:function(e,n){if(n=n||{},"firetpl"===XQCore.templateEngine){var i=t;if(i.templateCache&&i.templateCache[e])return i.templateCache[e];if(i.loadFile){var o=n.viewDir||XQCore.viewsDir,r=i.readFile(o.replace(/\/$/,"")+"/"+e+"."+XQCore.viewExt.replace(/^\./,""));return i.compile(r,{eventAttrs:!0})}throw Error("FireTPL runtime is being used. Please preload the "+e+"View")}}},XQCore}),function(t,e){"use strict";var n,i=t.require("jquery"),o=function(o,r){t.Event.call(this),"object"==typeof arguments[0]||"function"==typeof arguments[0]?(r=o,o=null):"string"==typeof arguments[0]&&(this.name=o),n=new t.Logger(this.name+"View"),this.container="body",this.tag=e,this.className=e,this.id=e,this.mode="replace",this.autoInject=!0,this.__domReady=!1,this.__viewEvents=[];var s=this;"function"==typeof r?r.call(this,s):t.extend(this,r),this.name=(this.name?this.name.replace(/View$/,""):"Nameless")+"View",this.__createView(),i(function(){s.container.length>0?(window.addEventListener("resize",function(t){s.resize(t)},!1),n.info("Initialize view "+this.name," with conf:",r),n.info(" ... using Container:",s.container)):n.error("Can't initialize View, Container not found!",s.container)})};t.extend(o.prototype,t.Event.prototype),o.prototype.show=function(t){var e=this;return t&&e.$ct.children(".xq-view").each(function(){if(this!==e.el){var t=i(this).data("view");t.hide()}}),this.$el.show().removeClass("xq-hidden"),this.emit("view.show"),this},o.prototype.hide=function(){return this.$el.hide().addClass("xq-hidden"),this.emit("view.hide"),this},o.prototype.active=function(t){var e=this;return t&&e.$ct.children(".xq-view").each(function(){if(this!==e.el){var t=i(this).data("view");t.inactive()}}),this.$el.addClass("xq-active").removeClass("xq-inactive"),this.emit("view.active"),this},o.prototype.inactive=function(){return this.$el.removeClass("xq-active").addClass("xq-inactive"),this.emit("view.inactive"),this},o.prototype.renderHTML=function(e,i){return n.log("Render html snippet",e,"with data:",i),e="function"==typeof e?e:t.Tmpl.compile(e),e(i)},o.prototype.resize=function(){return this},o.prototype.getElementData=function(t){var n=i(t,this.container);if(n.length){var o,r={},s=n.get(0).attributes;for(o=0;s.length>o;o++)if(0===s[o].name.indexOf("data-")){var a=s[o].name.substr(5),c=s[o].value;if("string"==typeof c)try{c="true"===c||"TRUE"===c?!0:"false"===c||"FALSE"===c?!1:"null"===c||"NULL"===c?null:"undefined"===c?e:+c+""===c?+c:JSON.parse(c)}catch(l){}r[a]=c}return r}return null},o.prototype.validationFailed=function(t){var e=this;t.forEach(function(t){e.$el.find('[name="'+t.property+'"]').addClass("xq-invalid")})},o.prototype.validationSucceeded=function(t){var e=this;e.$el.find('[name="'+t+'"]').removeClass("xq-invalid")},o.prototype.onStateChange=function(t){var e=this.el.className.split(" ");e=e.filter(function(t){return!/^xq-state-/.test(t)}),e.push("xq-state-"+t),this.el.className=e.join(" ")},o.prototype.ready=function(t){this.isReady?t.call(this):(this.__readyCallbacks||(this.__readyCallbacks=[]),this.__readyCallbacks.push(t))},o.prototype.__setReadyState=function(){var t=this;this.isReady=!0,this.__readyCallbacks&&(this.__readyCallbacks.forEach(function(e){e.call(t)}),this.__readyCallbacks=[])},o.prototype.inject=function(){if(this.el.parentNode!==this.ct)if(n.info("Inject view into container",this.$ct),"replace"===this.mode){var t=this.$ct.contents();t.each(function(){var t=i(this).data("view");t?t.destroy():i(this).remove()}),this.$ct.append(this.$el)}else if("append"===this.mode)this.$ct.append(this.$el);else{if("prepend"!==this.mode)throw Error("Unknown insert mode in view constructor");this.$ct.prepend(this.$el)}},o.prototype.parse=function(t,e,o){var r,s;t.scopeStore={},t.scopes=o||{};try{r=t(e||{},t.scopes)}catch(a){r='<p class="renderError"><b>View render error!</b><br>'+a.message+"</p>",n.error("View render error!",a)}var c=function(e,n,o){e=i.parseHTML(e);var r=i(e),s=r.find("scope"),a={};return s.each(function(){var e,r=i(this).attr("id"),s=i(this).attr("path"),l=o?o+"."+s:s,h=n;if(Array.isArray(n)&&(a[s]=a[s]||0,h=n[a[s]++]),e={},r){var u=t.scopes[r](n[s],n);e.value=u?c(u,n[s],l):document.createTextNode(""),e.id=r}else e.value=i.parseHTML(n[s]);t.scopeStore[l]=t.scopeStore[l]||[],t.scopeStore[l].push(e),i(this).replaceWith(i(e.value))}),r};return r&&(s=c(r,e)),s},o.prototype.render=function(e){if(this.__domReady===!1)return this.__initialData=e||{},this;this.autoInject&&this.inject();var i;n.info("Render view template of view "+this.name,"with data:",e);var o="function"==typeof this.template?this.template:t.Tmpl.compile(this.template);this.scopes={};try{i=o(e||{},this.scopes)}catch(r){i='<p class="renderError"><b>View render error!</b><br>'+r.message+"</p>",n.error("View render error!",r)}return this.el.innerHTML=i,this.emit("content.change",e),this.registerListener(this.$el),this.registerForms(),this},o.prototype.srender=function(e){if(this.__domReady===!1)return this.__initialData=e||{},this;this.autoInject&&this.inject();var o;n.info("Render view template of view "+this.name,"with data:",e);var r="function"==typeof this.template?this.template:t.Tmpl.compile(this.template);this.scopes={dataFn:function(t,e){return'<ftl path="'+t+'">'+e[t]+"</ftl>"},scopeFn:function(t,e){return'<ftl scope="'+t+'" path="'+e+'"></ftl>'}};try{o=r(e||{},this.scopes)}catch(s){o='<p class="renderError"><b>View render error!</b><br>'+s.message+"</p>",n.error("View render error!",s)}this.el.innerHTML=o;var a=this,c=function(t,e,n,o){console.log("Replace scope",e,n,o);var r=o?n[o]:n,s=a.scopes[e](r,n),l=i(i.parseHTML(s));l.find("ftl").each(function(){var t=i(this).attr("scope"),e=i(this).attr("path");t&&c(i(this),t,n,e)}),t.replaceWith(l)};return this.$el.find("ftl").each(function(){var t=i(this).attr("scope"),n=i(this).attr("path");t&&c(i(this),t,e,n)}),this.emit("content.change",e),this.registerListener(this.$el),this.registerForms(),this},o.prototype.registerListener=function(t){var e=this;t.find("[on]").addBack("[on]").each(function(){var t,n=i(this),o=i(this).attr("on"),r=i(this).data();n.removeAttr("on"),o=o.split(";"),o.forEach(function(i){i=i.split(":"),t="submit"===i[0]?function(t){t.preventDefault(),r=e.serializeForm(t.target),r=e.onSubmit(r,t.target),e.emit(i[1],r,t)}:function(t){var n;t.originalEvent instanceof KeyboardEvent?n={key:t.key,code:t.keyCode,alt:t.altKey,ctrl:t.ctrlKey,meta:t.metaKey,shift:t.shiftKey}:t.originalEvent instanceof MouseEvent?(t.preventDefault(),n={button:t.button,alt:t.altKey,ctrl:t.ctrlKey,meta:t.metaKey,shift:t.shiftKey},"click"===t.type&&t.currentTarget.href&&(n.href=t.currentTarget.href)):(t.preventDefault(),n=t.currentTarget.value||""),e.emit(i[1],n,r,t)},n.bind(i[0],t)})})},o.prototype.serializeForm=function(e){var o={},r=i(e);return"INPUT"!==r.get(0).tagName&&(r=r.find(":input")),r.serializeArray().forEach(function(e){t.dedotify(o,e.name,e.value)}),n.info("Serialize form of view "+this.name,"form selector:",r,"form data:",o),o},o.prototype.insert=function(t,e,n){var o=this,r=this.$el.find('[fire-path="'+t+'"]');r.length&&r.each(function(){var t=i(this).attr("fire-scope"),r=o.scopes[t]([n]),s=i(this).children();e>-1?(e>s.length-1&&(e=s.length-1),s.eq(e).before(r)):s.eq(e).after(r)})},o.prototype.update=function(){n.warn("XQCore doesn`t support update events yet")},o.prototype.append=function(t,e){this.insert(t,-1,e)},o.prototype.prepend=function(t,e){this.insert(t,0,e)},o.prototype.remove=function(t,e){var n=this.$el.find('[fire-path="'+t+'"]');
n.children(":eq("+e+")").remove()},o.prototype.formSetup=function(){var t=this;this.ready(function(){var e=function(e){var n=e.target.value,i=e.target.name;t.emit("input.change",i,n)},n=function(e){var n=e.target.value,i=e.target.name;t.emit("input.edit",i,n)},i=function(e){e.preventDefault();var n=t.serializeForm(e.target);t.emit("form.submit",n)};this.addEvent(":input","change",e),this.addEvent(":input","keyup",n),this.addEvent("form","submit",i)})},o.prototype.onSubmit=function(t){return t},o.prototype.destroy=function(){n.info("Destroy view"),this.emit("view.destroy"),this.$el.remove(),this.__coupled&&(this.__coupled.obj.__coupled&&this.__coupled.obj.__coupled.obj===this&&this.__coupled.obj.__coupled.uncouple(),this.__coupled.uncouple()),n.info("View "+this.name+" has been destroyed")},o.prototype.addEvent=function(t,e,n){this.__viewEvents.push({events:e,selector:t,callback:n}),this.$el&&this.$el.delegate(t,e,n)},o.prototype.__viewTagTypes={"*":"div",body:"section",section:"section",ul:"li",table:"tbody",tbody:"tr",tr:"td"},o.prototype.__createViewElement=function(){if(this.tag)return document.createElement(this.tag);var t=this.ct?this.ct.tagName.toLowerCase():"*",e=this.__viewTagTypes["*"];return this.__viewTagTypes[t]&&(e=this.__viewTagTypes[t]),document.createElement(e)},o.prototype.__createView=function(){var e=this,n=[];i(function(){e.$ct=e.$ct||i(e.container),e.ct=e.$ct.get(0),e.el=e.__createViewElement(),e.$el=i(e.el),e.$el.data("view",e),n.push("xq-view xq-"+e.name.replace(/View$/,"-view").toLowerCase()),e.id&&e.el.setAttribute("id",e.id),e.className&&n.push(e.className),e.hidden===!0&&(n.push("xq-hidden"),e.$el.hide()),e.el.className=n.join(" "),e.__domReady=!0,e.__initialData&&(e.render(e.__initialData),delete e.__initialData),e.__setReadyState(),e.registerListener(e.$el),t.html5Routes&&e.$el.on("click","a",function(t){/^http(s)?:\/\//.test(t.href)||/^\/?[a-z]/.test(t.href)&&(t.preventDefault(),t.stopPropagation(),e.emit("xqcore.navigate",t.href))}),e.forms&&e.formSetup()})},o.prototype.registerForms=function(){if(this.forms){var t="form";"string"==typeof this.forms&&(t=this.forms),this.ready(function(){this.$forms=this.$el.find(t),this.$forms.addClass("xq-forms"),this.$forms.find(":input").addClass("xq-input")})}},t.View=o}(XQCore),function(t){"use strict";var e,n=new t.Logger("Router"),i=function(e){var i,r,s=[];return n.logLevel=t.logLevel,e instanceof RegExp?(r=e,i=""+e):(r=o(e,s),i=e),{re:r,src:""+e,keys:s}},o=function(t,e){return t=t.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?|\*/g,function(t,n,i,o,r,s){return"*"===t?(e.push(void 0),t):(e.push(o),n=n||"",""+(s?"":n)+"(?:"+(s?n:"")+(i||"")+(r||"([^/]+?)")+")"+(s||""))}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),RegExp("^"+t+"$","i")},r=function(t,e,n){for(var i,o=n||0,r=t.length;r>o;++o){var s=t[o],a=s.re,c=s.keys,l=[],h={};if(i=e.match(a)){for(var u=1,p=i.length;p>u;++u){var f=c[u-1],d="string"==typeof i[u]?unescape(i[u]):i[u];f?h[f]=d:l.push(d)}return{params:h,splats:l,route:s.src,next:o+1}}}},s=function(t){t=t||{},this.routes=[],this.routeMap={},t.noListener||this.registerListener()};s.getInstance=function(){return e||(e=new t.Router),e},s.prototype.registerListener=function(){t.html5Routes?(console.log("DEFINE"),window.addEventListener("popstate",this.onPopStateHandler.bind(this))):window.addEventListener("hashchange",this.onPopStateHandler.bind(this))},s.prototype.onPopStateHandler=function(){var t=this.getPath();this.callRoute(t,{noPush:!0})},s.prototype.getPath=function(){var e;return t.html5Routes?(e=location.pathname,e.replace(RegExp("^"+t.basePath),"")):(e=location.hash,e=e.replace(RegExp("^"+t.hashBang),""),e="/"+e)},s.prototype.addRoute=function(t,e){if(n.info("Register new route:",t,e),!t)throw Error(" route requires a path");if(!e)throw Error(" route "+(""+t)+" requires a callback");if(this.routeMap[t])throw Error("path is already defined: "+t);"/"!==t.charAt(0)&&(t="/"+t);var o=new i(t);return o.fn=e,this.routes.push(o),this.routeMap[t]=e,this},s.prototype.removeRoute=function(t){if(!t)throw Error(" route requires a path");if(!this.routeMap[t])return n.warn("Can not remove route! Route does not exists: "+t),this;for(var e=0;this.routes.length>e;e++){var i=this.routes[e];i.src===t&&this.routes.splice(e,1)}return delete this.routeMap[t],this},s.prototype.match=function(t,e){var n=r(this.routes,t,e);return n&&(n.fn=this.routeMap[n.route],n.next=this.match.bind(this,t,n.next)),n},s.prototype.callRoute=function(e,i){if(i=i||{},n.info("Call route",e),void 0===e)throw Error("XQCore.Router error! Path is undefined in callRoute()!");var o=this.match(e);if(!o)return n.warn("Could not call any route! No route were found! Called path: "+e),void 0;!t.html5Routes||i.noPush||i.replace?t.html5Routes&&i.replace&&history.replaceState(null,"",e):history.pushState(null,"",e);var r=function(){n.info("... trigger route",this.route,this.fn,this.next),this.fn.call(this,this.params,this.splats,function(){var t=this.next();t&&r.call(t)}.bind(this))};r.call(o)},t.Router=s}(XQCore),function(t){"use strict";var e=new t.Logger("SocketConnection"),n=t.require("sockjs"),i={},o=function(t){return i[t]?i[t]:(i[t]=this,this.__isReady=!1,this.__onReadyCallbacks=[],this.__channels={},this.conn=null,this.connect(t),this.autoReconnect=!0,this.reconnectionInterval=1500,void 0)};o.prototype.connect=function(t){var i=this;this.conn&&"disconnected"!==this.connectionState||(e.info("Connect to socket server ",t),this.conn=new n(t,null,{debug:e.logLevel>=4}),this.connectionState="connecting",this.conn.onopen=function(){e.info("Connection was successful!"),i.setReady(),i.connectionState="connected"},this.conn.onmessage=function(t){var n;try{n=JSON.parse(t.data)}catch(o){console.error("Could not parse socket message!",t.data)}if(!n.channel)throw Error("No socket channel was sent!");e.info("Got socket message",n.eventName,"in channel "+n.channel,n.args);var r=n.args||[];r.unshift(n.eventName),i.__channels[n.channel]?i.__channels[n.channel].emit.apply(i.__channels[n.channel],r):e.info(" ... channel not found!",n.channel)},this.conn.onclose=function(n){i.connectionState="disconnected",i.unsetReady(),e.warn("Connection to "+t+" closed!",n),i.autoReconnect&&(e.info("Try to reconnect to "+t),setTimeout(function(){i.connect(t)},i.reconnectionInterval))})},o.prototype.registerChannel=function(t,n){e.info("Register new channel",t),this.__channels[t]?e.info(" ... channel already registered!"):this.__channels[t]=n},o.prototype.unregisterChannel=function(t){e.info("Unregister channel",t),this.__channels[t]?delete this.__channels[t]:e.info(" ... channel not found!")},o.prototype.send=function(t,n){var i=this,o=Array.prototype.slice.call(arguments,2);this.ready(function(){e.info("Send socket message to channel "+t,n,o),i.conn.send(JSON.stringify({channel:t,eventName:n,args:o}))})},o.prototype.ready=function(t){this.__isReady?t.call(this):this.__onReadyCallbacks.push(t)},o.prototype.setReady=function(){var t=this;this.__isReady=!0,this.__onReadyCallbacks.forEach(function(e){e.call(t)}),this.__onReadyCallbacks=[]},o.prototype.unsetReady=function(){this.__isReady=!1},t.SocketConnection=o}(XQCore),function(t){"use strict";var e=new t.Logger("Socket");e.logLevel=5;var n=function(e,n){this.__isReady=!1,this.__onReadyCallbacks=[],this.channel=n,this.socket=new t.SocketConnection(e),this.socket.registerChannel(n,this)};t.extend(n.prototype,new t.Event),n.prototype.send=function(){var t=Array.prototype.slice.call(arguments);t.unshift(this.channel),this.socket.send.apply(this.socket,t)},t.Socket=n}(XQCore),function(t,e){"use strict";var n;n=function(e,n){this.noAutoRegister=!1,t.Model.call(this,e,n),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||t.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},n.prototype=Object.create(t.Model.prototype),n.prototype.constructor=n,n.inherit=function(n,i){"object"==typeof n&&(i=n,n=e);var o=function(){t.SyncModel.call(this,n,i)};return o.prototype=Object.create(t.SyncModel.prototype),o.prototype.constructor=o,o},n.prototype.connectToSocket=function(){var e=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",e),this.socket=new t.Socket(e,this.channel))},n.prototype.register=function(t){var e=this;this.syncEnabled=!!t,e.dev("Register syncmodel at server:",e.name);var n={noSync:!0};e.socket.on("syncmodel.set",function(t){e.set(t,n)}),e.socket.on("syncmodel.replace",function(t){n.replace=!0,e.set(t,n)}),e.socket.on("syncmodel.item",function(t,i){e.set(t,i,n)}),e.socket.on("syncmodel.insert",function(t,i,o){e.insert(t,i,o,n)}),e.socket.on("syncmodel.remove",function(t,i,o){e.remove(t,i,o,n)}),e.socket.on("syncmodel.reset",function(){e.reset(n)}),e.socket.on("syncmodel.init",function(t){console.log("Got initial data request:",t),e.set(t,n)}),e.socket.send("syncmodel.register",{name:e.name})},n.prototype.unregister=function(){var t=this.conf.syncWith||this.name.replace(/Model$/,"");this.socket.send("syncmodel.unregister",{name:t}),this.socket.off("syncmodel.set"),this.socket.off("syncmodel.replace"),this.socket.off("syncmodel.item"),this.socket.off("syncmodel.insert"),this.socket.off("syncmodel.remove"),this.socket.off("syncmodel.reset"),this.socket.off("syncmodel.init")},n.prototype.emitRemote=function(t,e){this.socket.send(t,e)},n.prototype.sync=function(t){if(this.syncEnabled){var e=Array.prototype.slice.call(arguments,1);e.unshift("syncmodel."+t),this.emitRemote.apply(this,e)}},n.prototype.fetchModel=function(){this.emitRemote("syncmodel.fetch")},t.SyncModel=n}(XQCore),function(t,e){"use strict";var n;n=function(n,i){t.ReadyState.call(this),t.Event.call(this);var o=this;"object"==typeof arguments[0]&&(i=n,n=i.name),this.debug=t.debug,i===e&&(i={}),this.__unfiltered={},this.name=(n?n.replace(/List$/,""):"Nameless")+"List",this.items=[],this.maxLength=null,this.model||(this.model=t.Model),"function"==typeof i?i.call(this,o):t.extend(this,i),this.state("ready")},t.extend(n.prototype,t.ReadyState.prototype),t.extend(n.prototype,t.Event.prototype),t.extend(n.prototype,new t.Logger),n.inherit=function(n,i){"object"==typeof n&&(i=n,n=e);var o=function(){t.List.call(this,n,i)};return o.prototype=Object.create(t.List.prototype),o.prototype.constructor=o,o},Object.defineProperty(n.prototype,"length",{get:function(){return this.items.length}}),n.prototype.state=function(t){this.__state=t,this.emit("state."+t),this.emit("state.change",t)},n.prototype.getState=function(){return this.__state},n.prototype.push=function(e,n){var i,o,r=[];n=n||{},Array.isArray(e)||(e=[e]);for(var s=0,a=e.length;a>s;s++){if(o=e[s],o instanceof t.Model?i=o:(i=new this.model("ListItem"),i.set(o)),!i.isValid())return!1;r.push(i)}var c=this.items.push.apply(this.items,r);return c&&(this.maxLength&&this.items.length>this.maxLength&&this.items.splice(0,this.items.length-this.maxLength),n.silent||this.emit("item.push",r,c),n.noSync||"function"==typeof this.sync&&this.sync("push",r)),!0},n.prototype.unshift=function(e,n){var i,o,r=[];n=n||{},Array.isArray(e)||(e=[e]);for(var s=0,a=e.length;a>s;s++){if(o=e[s],o instanceof t.Model?i=o:(i=new this.model("ListItem"),i.set(o)),!i.isValid())return!1;r.unshift(i)}var c=this.items.unshift.apply(this.items,r);return c&&(this.maxLength&&this.items.length>this.maxLength&&this.items.splice(this.maxLength),n.silent||this.emit("item.unshift",r,c),n.noSync||"function"==typeof this.sync&&this.sync("unshift",r)),!0},n.prototype.pop=function(t){var n;return t=t||{},n=this.items.pop()||null,n===e?null:(t.silent||this.emit("item.pop",n),t.noSync||"function"==typeof this.sync&&this.sync("pop",n),n)},n.prototype.shift=function(t){var n;return t=t||{},n=this.items.shift()||null,n===e?null:(t.silent||this.emit("item.shift",n),t.noSync||"function"==typeof this.sync&&this.sync("shift",n),n)},n.prototype.update=function(t,e,n){n=n||{};var i;return i="number"==typeof t?this.models[t]:this.findOne(t),i&&(i.set(e,{noSync:!0}),n.silent||this.emit("item.update",i),n.noSync||"function"==typeof this.sync&&this.sync("update",t,e)),i},n.prototype.clear=function(t){if(t=t||{},0===this.items.length)return 0;var e=this.toArray();return this.items=[],t.silent||this.emit("item.clear",e),t.noSync||"function"==typeof this.sync&&this.sync("clear",e),e.length},n.prototype.toArray=function(){return this.items.map(function(t){return t.properties})},n.prototype.findOne=function(t){var e;if(e=this.items)for(var n=0;e.length>n;n++){var i,o=e[n];for(var r in t)if(t.hasOwnProperty(r)){if(o.properties[r]&&o.properties[r]===t[r]){i=!0;break}i=!1}if(i===!0)return o}return null},n.prototype.find=function(t){var e,n=[];if(e=this.items)for(var i=0;e.length>i;i++){var o,r=e[i];for(var s in t)if(t.hasOwnProperty(s)){if(r.properties[s]&&r.properties[s]===t[s]){o=!0;break}o=!1}o===!0&&n.push(r)}return n},n.prototype.each=function(t,e){"function"==typeof t&&(e=t,t=null);for(var n=t,i=0,o=this.items.length;o>i;i++)n=e(n,this.items[i].properties);return n},t.List=n}(XQCore),function(t,e){"use strict";var n;n=function(e,n){this.noAutoRegister=!1,t.List.call(this,e,n),this.server=this.server||location.protocol+"//"+location.hostname,this.port=this.port||t.socketPort,this.path=this.path||"xqsocket",this.channel=this.channel||this.name.toLowerCase(),this.syncEnabled=!1,this.connectToSocket(),this.noAutoRegister||this.register()},n.prototype=Object.create(t.List.prototype),n.prototype.constructor=n,n.inherit=function(n,i){"object"==typeof n&&(i=n,n=e);var o=function(){t.SyncList.call(this,n,i)};return o.prototype=Object.create(t.SyncList.prototype),o.prototype.constructor=o,o},n.prototype.connectToSocket=function(){var e=this.server+":"+this.port+"/"+this.path;this.socket||(this.dev("Connect to socket:",e),this.socket=new t.Socket(e,this.channel))},n.prototype.register=function(t){var e=this;"boolean"==typeof t&&(this.syncEnabled=t),e.dev("Register synclist at server:",e.name);var n={noSync:!0};e.socket.on("synclist.push",function(t){e.push(t,n)}),e.socket.on("synclist.unshift",function(t){e.push(t,n)}),e.socket.on("synclist.pop",function(){e.push(n)}),e.socket.on("synclist.shift",function(){e.push(n)}),e.socket.on("synclist.update",function(t,i){e.update(t,i,n)}),e.socket.on("synclist.clear",function(){e.clear(n)}),e.socket.on("synclist.init",function(t){console.log("Got initial data request:",t),e.push(t,n)}),e.socket.send("synclist.register",{name:e.name})},n.prototype.unregister=function(){this.dev("Unregister synclist at server:",this.name),this.socket.send("synclist.unregister",{name:this.name}),this.socket.off("synclist.push"),this.socket.off("synclist.unshift"),this.socket.off("synclist.pop"),this.socket.off("synclist.shift"),this.socket.off("synclist.update"),this.socket.off("synclist.clear"),this.socket.off("synclist.init")},n.prototype.emitRemote=function(t,e){this.socket.send(t,e)},n.prototype.sync=function(t){if(this.syncEnabled){var e=Array.prototype.slice.call(arguments,1);e.unshift("syncmodel."+t),this.emitRemote.apply(this,e)}},n.prototype.fetchList=function(){this.emitRemote("synclist.fetch")},t.SyncList=n}(XQCore);