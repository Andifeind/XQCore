/*!
 * XQCore - +0.8.0-22
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2014 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2014-05-20
 */
var XQCore;(function(e,t){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery")):e.XQCore=t(e.jQuery)})(this,function(e){"use strict";return XQCore={version:"0.8.0-22",defaultRoute:"index",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire"},XQCore.extend=e.extend,XQCore.isEmptyObject=e.isEmptyObject,XQCore.isPlainObject=e.isPlainObject,XQCore.isFunction=e.isFunction,XQCore.isObjectId=function(e){return this.objectIdPattern.test(e)},XQCore._dump={},XQCore.dump=function(e){return XQCore._dump[e]?(console.log("[XQCore dump]",e,XQCore._dump[e]),XQCore._dump[e]):!1},XQCore.require=function(t){return"jquery"===t?e:void 0},XQCore}),function(e){"use strict";/*!
	 * EventEmitter v4.2.5 - git.io/ee
	 * Oliver Caldwell
	 * MIT license
	 * @preserve
	 */
function t(){}function i(e,t){for(var i=e.length;i--;)if(e[i].listener===t)return i;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=t.prototype;r.getListeners=function(e){var t,i,n=this._getEvents();if("object"==typeof e){t={};for(i in n)n.hasOwnProperty(i)&&e.test(i)&&(t[i]=n[i])}else t=n[e]||(n[e]=[]);return t},r.flattenListeners=function(e){var t,i=[];for(t=0;e.length>t;t+=1)i.push(e[t].listener);return i},r.getListenersAsObject=function(e){var t,i=this.getListeners(e);return i instanceof Array&&(t={},t[e]=i),t||i},r.addListener=function(e,t){var n,r=this.getListenersAsObject(e),s="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===i(r[n],t)&&r[n].push(s?t:{listener:t,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,t){var n,r,s=this.getListenersAsObject(e);for(r in s)s.hasOwnProperty(r)&&(n=i(s[r],t),-1!==n&&s[r].splice(n,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,i){var n,r,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=i.length;n--;)s.call(this,t,i[n]);else for(n in t)t.hasOwnProperty(n)&&(r=t[n])&&("function"==typeof r?s.call(this,n,r):o.call(this,n,r));return this},r.removeEvent=function(e){var t,i=typeof e,n=this._getEvents();if("string"===i)delete n[e];else if("object"===i)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var i,n,r,s,o=this.getListenersAsObject(e);for(r in o)if(o.hasOwnProperty(r))for(n=o[r].length;n--;)i=o[r][n],i.once===!0&&this.removeListener(e,i.listener),s=i.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.Event=t}(XQCore),function(e){"use strict";function t(e){return 1e3>e?e+" ms":6e4>e?Math.round(e/100)/10+" sec":Math.round(e/6e4)+" min "+Math.round(e%6e4/1e3)+" sec"}var i=function(){};i.prototype.log=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.log.apply(console,e))},i.prototype.warn=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.warn.apply(console,e))},i.prototype.error=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.error.apply(console,e))},i.prototype.timer=function(e){var i={start:null,stop:null,name:e,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",t(this.stop-this.start))}};return this.log("Start Timer",e),i.start=Date.now(),i},i.prototype.__scope={getHumanTime:t},e.Logger=i}(XQCore),function(e){"use strict";var t=e.require("jquery"),i=function(t,i){"object"==typeof arguments[0]&&(i=t,t=i.name),this.__views=[],this.debug=e.debug,this.name=(t?t.replace(/Presenter$/,""):"Nameless")+"Presenter",this.routes=[],i=i||{},this.conf=i,this.eventCallbacks={},this.lastShownView=null,this.registeredViews=[],this.registeredModels=[],this.fireViewInit=function(e){var t=!0;this.registeredViews.forEach(function(i){e===i.view&&(i.isReady=!0),i.isReady===!1&&(t=!1)}),this.viewInit(e),t===!0&&this.emit("views.ready")},this.registerView=function(e){this.warn("presenter.registerView was deprecated since XQCore 0.7.0");var t;if(e instanceof Array)for(t=0;e.length>t;t++)this.registeredViews.push({view:e[t],isReady:!1});else this.registeredViews.push({view:e,isReady:!1})},this.registerModel=function(e){this.warn("presenter.registerModel was deprecated since XQCore 0.7.0");var t;if(e instanceof Array)for(t=0;e.length>t;t++)this.registeredModels.push({model:e[t],isReady:!1});else this.registeredModels.push({model:e,isReady:!1})},this.__Router=new e.Router};e.extend(i.prototype,new e.Event,new e.Logger),i.prototype.events={},i.prototype.init=function(i){var n,r=this,s=this.conf;"function"==typeof s?s.call(this,r):e.extend(this,s),s.routes&&Object.keys(s.routes).forEach(function(e){var t=this.routes[e];"string"==typeof t&&(t=this[t]),"function"==typeof t?this.__Router.addRoute(e,t):this.warn("Router callback isn't a function",t,"of route",e)}.bind(this)),window.addEventListener("popstate",function(e){r.__onPopstate(e.state)},!1);var o=e.defaultRoute;if(/^#![a-zA-Z0-9]+/.test(r.getHash())&&(o=r.getHash().substr(2)),o=r.__Router.match(o)){var a=o.params;e.callerEvent&&(a[e.callerEvent]="pageload"),t(function(){r.log("Trigger route",o,a),o.fn.call(r,o.params)})}if("function"==typeof s.init&&s.init.call(this),i instanceof Array)for(n=0;i.length>n;n++)this.registerView(i[n]);else i&&this.registerView(i);this.registeredViews.forEach(function(e){e.view.init(r)}),this.registeredModels.forEach(function(e){e.model.init(r)})},i.prototype.viewInit=function(){},i.prototype.pushState=function(t,i){var n=e.html5Routes||"/"===i.charAt(0)?"":e.hashBang;i=n+i,history.pushState(t,"",i||null),this.log("Update history with pushState",t,i)},i.prototype.replaceState=function(t,i){var n=e.html5Routes||"/"===i.charAt(0)?"":e.hashBang;i=n+i,history.replaceState(t,"",i||null),this.log("Update history with replaceState",t,i)},i.prototype.navigateTo=function(e,t,i){this.log("Navigate to route: ",e,t,i),i?this.replaceState(t,e):this.pushState(t,e);var n=new PopStateEvent("popstate",{bubbles:!1,cancelable:!1,state:null});window.dispatchEvent(n)},i.prototype.getView=function(e){var t,i;for(t=0;this.registeredViews.length>t;t++)if(i=this.registeredViews[t].view,i.name===e)return i;return null},i.prototype.showView=function(e,t){var i=this.getView(e+"View");return i?(this.log("Show view:",e,t),this.log("Hide view:",this.lastShownView),this.lastShownView!==i&&(this.lastShownView&&"function"==typeof this.lastShownView.hide?(this.lastShownView.hide(),i.show()):i.show(!0)),undefined):(this.warn("View not defined!",e),undefined)},i.prototype.getHash=function(){return location.hash},i.prototype.getPathname=function(){return location.pathname},i.prototype.couple=function(t){var i,n=t.view,r=t.model,s=e.extend({"data.replace":"render","data.item":"update","data.append":"append","data.prepend":"prepend","data.insert":"insert","data.remove":"remove","validation.error":"validationFailed","state.change":"stateChanged"},t.modelEvents),o=e.extend({"form.submit":"setData"},t.viewEvents);if(!n instanceof e.View)return this.error("Can't couple view with model! View isn't a XQCore.View"),undefined;if(!r instanceof e.Model)return this.error("Can't couple model with model! Model isn't a XQCore.Model"),undefined;this.log("Couple view ",n.name,"with model",r.name),n.__coupledWith||(n.__coupledWith=[]),r.__coupledWith||(r.__coupledWith=[]),n.__coupledWith.some(function(e){return e===r})||n.__coupledWith.push(r),r.__coupledWith.some(function(e){return e===n})||r.__coupledWith.push(n);var a=function(e,t){r.on(e,function(){var e=Array.prototype.slice.call(arguments);e.push(r.name),n[t].apply(n,e)})},h=function(e,t){n.on(e,function(e,i){r[t](e,i,n.name)})};for(i in s)s.hasOwnProperty(i)&&(a(i,s[i]),"data.replace"===i&&r.emit(i,r.get()));for(i in o)o.hasOwnProperty(i)&&h(i,o[i]);return this},i.prototype.triggerEvent=function(e,t,i,n,r){this.events[t]?this.events[t].call(this,i,n,r):(i.preventDefault(),i.stopPropagation(),e.__coupledWith.forEach(function(e){"function"==typeof e[t]?(this.log("Autotrigger to model ",e.name," - ",t,r),e[t](r)):this.warn("Autotrigger to model failed! Function doesn't exists:",t,r)}))},i.prototype.__onPopstate=function(t){var i=this;i.log("popstate event recived",t,i);var n=e.defaultRoute;if(e.html5Routes){var r=RegExp("^"+i.root);n=i.getPathname().replace(r,"")}else/^#!\S+/.test(this.getHash())&&(n=i.getHash().substr(2));n=i.__Router.match(n),n&&(t=t||n.params,e.callerEvent&&(t[e.callerEvent]="popstate"),i.log("Trigger route",n,t),n.fn.call(i,t))},i.prototype.initView=function(t,i,n){if(n=n||{},this.__views[t])return this.warn("View allready registered!",t),undefined;this.debug&&this.log("Init view",t);var r=new e.View(t,function(r){r.template=e.Tmpl.getTemplate(t),r.mode=n.mode||"replace",r.container=i||"body",n.inject===!1&&(r.autoInject=!1)});return this.__views[t]=r,r.init(this),r},i.prototype.route=function(e,t){"string"==typeof t&&(t=this[t]),"function"==typeof t?"string"==typeof e?(this.log("Register route",e,"with callback",t),this.__Router.addRoute(e,t)):Array.isArray(e)&&e.forEach(function(e){this.log("Register route",e,"with callback",t),this.__Router.addRoute(e,t)}.bind(this)):this.warn("Router callback isn't a function",t,"of route",e)},e.Presenter=i}(XQCore),function(e,t){"use strict";var i=e.require("jquery"),n=function(){};n.prototype.onSend=function(e){return e},n.prototype.send=function(e,n,r,s){"object"==typeof n?(s=r,r=n,n=this.server,e=e):"function"==typeof r?(s=r,r=this.get()):r===t&&(r=this.get()),e===t&&(e="POST"),n||(n=this.server),"function"==typeof this.onSend&&(r=this.onSend.call(this,r)),this.log("Sending an ajax call to ",n,"with data: ",r),this.state("syncing"),i.ajax({url:n,type:e,data:r,dataType:"json",success:function(e,t,i){"function"==typeof s&&s.call(this,null,e,t,i),this.state("success")}.bind(this),error:function(e,t,i){"function"==typeof s&&s.call(this,{type:t,http:i},null,t,e),this.state("failed")}.bind(this)})},n.prototype.sendPOST=function(e,t,i){this.send("POST",e,t,i)},n.prototype.sendGET=function(e,t,i){this.send("GET",e,t,i)},n.prototype.sendPUT=function(e,t,i){this.send("PUT",e,t,i)},n.prototype.sendDELETE=function(e,t,i){this.send("DELETE",e,t,i)},n.prototype.ready=function(e){e===!0?(Array.isArray(this.__callbacksOnReady)&&(this.log("Trigger ready state"),this.__callbacksOnReady.forEach(function(e){e.call(this)}.bind(this))),this.__isReady=!0,delete this.__callbacksOnReady):"function"==typeof e?this.__isReady===!0?e():(this.__callbacksOnReady||(this.__callbacksOnReady=[]),this.__callbacksOnReady.push(e)):this.warn("arg0 isn't a callback in model.ready()!")},n.prototype.fetch=function(e,t){this.sendGET(e,t)},n.prototype.save=function(e){this.isValid()?this.sendPOST(this.get(),e):"function"==typeof e&&e({msg:"Model isn't valid. Cancle save"})},n.prototype.update=function(e){this.isValid()?this.sendPUT(this.get(),e):"function"==typeof e&&e({msg:"Model isn't valid. Cancle update"})},e.Sync=n}(XQCore),function(e,t){"use strict";var i;i=function(i,n){"object"==typeof arguments[0]&&(n=i,i=n.name),this.debug=e.debug,n===t&&(n={}),this.__state="starting",this.__unfiltered={},this.customValidate=n.validate,delete n.validate,this.conf=n,this.name=(i?i.replace(/Model$/,""):"Nameless")+"Model",this._isValid=!1,this.properties={},this.schema=n.schema},e.extend(i.prototype,new e.Event,new e.Logger),e.Sync&&e.extend(i.prototype,e.Sync.prototype),i.prototype.init=function(){var t=this,i=this.conf;"function"==typeof i?i.call(this,t):e.extend(this,i),this.debug&&(e._dump[this.name]=this),this.defaults&&!e.isEmptyObject(this.defaults)&&this.set(this.defaults),this.state("ready")},i.prototype.state=function(e){this.__state=e,this.emit("state."+e),this.emit("state.change",e)},i.prototype.getState=function(){return this.__state},i.prototype.set=function(t,i,n){var r,s={},o=this.get(),a=!1,h=!1;if(n=n||{},null===arguments[0])s=arguments[1],h=!0,this.log("Set data",s,o);else if("object"==typeof arguments[0])t=null,n=i||{},s=n.extend?e.extend(s,o,arguments[0]):arguments[0],h=!0,this.log("Set data",s,o);else if("string"==typeof arguments[0]){if(s=e.extend({},this.get()),a=!0,e.dedotify(s,t,i),this.log("Set data",s,o),n=n||{},!this.customValidate&&n.validateOne&&(n.noValidation=!0,r=this.validateOne(this.schema[t],i),r.isValid===!1))return this.warn("Validate error in model.set",r),n.silent!==!0&&this.emit("validation.error",r,s),!1}else this.warn("Data are incorrect in model.set()",arguments);return n=n||{},!this.customValidate&&this.schema&&n.noValidation!==!0&&(r=this.validate(s),null!==r)?(this.warn("Validate error in model.set",r),n.silent!==!0&&this.emit("validation.error",r,s),!1):this.customValidate&&n.noValidation!==!0&&(r=this.customValidate(s),this.log("Using a custom validation which returns:",r),null!==r)?(this.warn("Validate error in model.set",r),this.emit("validation.error",r,s),!1):(this.properties=s,n.silent!==!0&&(h?("function"==typeof this.sync&&n.sync!==!1&&this.sync("replace",s),this.emit("data.replace",s,o)):a&&("function"==typeof this.sync&&n.sync!==!1&&this.sync("item",t,i),this.emit("data.item",t,i)),this.emit("data.change",s,o)),!0)},i.prototype.get=function(i){return i===t?this.properties:e.undotify(i,this.properties)},i.prototype.has=function(e){return!!this.properties[e]},i.prototype.reset=function(){this.log("Reset model"),this.properties={}},i.prototype.append=function(i,n,r){var s=e.undotify(i,this.properties);if(r=r||{},s instanceof Array)s.push(n);else if(s===t)e.dedotify(this.properties,i,[n]);else{if("object"!=typeof s||i||!e.isEmptyObject(this.properties))return this.error("Model.append requires an array. Dataset isn't an array. Path: ",i),t;this.properties=[n]}r.silent!==!0&&("function"==typeof this.sync&&r.sync!==!1&&this.sync("append",i,n),this.emit("data.append",i,n),this.emit("data.change",this.properties))},i.prototype.prepend=function(i,n,r){var s=e.undotify(i,this.properties);if(r=r||{},s instanceof Array)s.unshift(n);else if(s===t)e.dedotify(this.properties,i,[n]);else{if("object"!=typeof s||i||!e.isEmptyObject(this.properties))return this.error("Model.prepend requires an array. Dataset isn't an array. Path: ",i),t;this.properties=[n]}r.silent!==!0&&("function"==typeof this.sync&&r.sync!==!1&&this.sync("prepend",i,n),this.emit("data.prepend",i,n),this.emit("data.change",this.properties))},i.prototype.insert=function(i,n,r,s){var o=e.undotify(i,this.properties);if(s=s||{},o instanceof Array)o.splice(n,0,r);else if(o===t)e.dedotify(this.properties,i,[r]);else{if("object"!=typeof o||i||!e.isEmptyObject(this.properties))return this.error("Model.insert requires an array. Dataset isn't an array. Path: ",i),t;this.properties=[r]}s.silent!==!0&&("function"==typeof this.sync&&s.sync!==!1&&this.sync("insert",i,1,r),this.emit("data.insert",i,n,r),this.emit("data.change",this.properties))},i.prototype.remove=function(i,n,r){var s=e.undotify(i,this.properties),o=null;if(r=r||{},s instanceof Array)o=s.splice(n,1);else if("object"==typeof s)return this.error("Model.remove requires an array. Dataset isn't an array. Path: ",i),t;return o&&r.silent!==!0&&("function"==typeof this.sync&&r.sync!==!1&&this.sync("remove",i,n),this.emit("data.remove",i,n,o[0]),this.emit("data.change",this.properties)),o},i.prototype.search=function(t,i){var n;if(1===arguments.length?(i=t,t="",n=this.properties):n=e.undotify(t,this.properties),n)for(var r=0;n.length>r;r++){var s,o=n[r];for(var a in i)if(i.hasOwnProperty(a)){if(!o[a]||o[a]!==i[a]){s=!1;break}s=!0}if(s===!0)return o}return null},i.prototype.sortBy=function(t,i){1===arguments.length&&(i=t,t=null);var n,r=e.undotify(t,this.properties);return r.sort(function(t,r){n=-1;for(var s in i)if(i.hasOwnProperty(s)){if(n=(e.undotify(s,t)+"").localeCompare(e.undotify(s,r)+""),0===n)continue;-1===i[s]&&(n=n>0?-1:1);break}return n}),this.set(t,r),r},i.prototype.filter=function(t,i,n,r){if(1===arguments.length&&(r=t,t=null),"string"==typeof r){if(!this.__registeredFilter[r])throw Error("Filter "+r+" not registered!");r=this.__registeredFilter[r]}for(var s=e.undotify(t,this.__unfiltered.data||this.properties),o=[],a=0,h=s.length;h>a;a++)r(i,n,s[a])&&o.push(s[a]);return this.__unfiltered={path:t,data:s},this.set(t,o),o},i.prototype.filterReset=function(e){this.__unfiltered&&this.set(this.__unfiltered.path,this.__unfiltered.data,e)},i.prototype.validate=function(i,n){var r=[];return n=n||this.schema,n&&Object.keys(n).forEach(function(s){if("object"==typeof i[s]&&n[s].type===t){var o=this.validate(e.extend({},i[s]),e.extend({},n[s]));return Array.isArray(o)&&o.length>0&&(r=r.concat(o)),t}var a=this.validateOne(n[s],i[s]);a.isValid===!0?i[s]=a.value:(a.error.property=s,r.push(a.error))}.bind(this)),0===r.length?(this._isValid=!0,null):(this._isValid=!1,r)},i.prototype.validateOne=function(e,i){var n=null,r="function"==typeof e.type?typeof e.type():e.type.toLowerCase();if(""===i&&e.noEmpty===!0&&(i=t),i!==t&&null!==i||!e.default||(i=e.default),i===t||null===i||""===i)e.required===!0&&(n={msg:"Property is undefined or null, but it's required",errCode:10});else if("string"===r)e.convert&&"number"==typeof i&&(i+=""),r!==typeof i?n={msg:"Property type is a "+typeof i+", but a string is required",errCode:11}:e.min&&e.min>i.length?n={msg:"String length is too short",errCode:12}:e.max&&e.max<i.length?n={msg:"String length is too long",errCode:13}:e.match&&!e.match.test(i)&&(n={msg:"String doesn't match regexp",errCode:14});else if("number"===r)e.convert&&"string"==typeof i&&(i=parseInt(i,10)),r!==typeof i?n={msg:"Property type is a "+typeof i+", but a number is required",errCode:21}:e.min&&e.min>i?n={msg:"Number is too low",errCode:22}:e.max&&i>e.max&&(n={msg:"Number is too high",errCode:23});else if("date"===r){if(i){var s=Date.parse(i);isNaN(s)&&(n={msg:"Property isn't a valid date",errCode:31})}}else"array"===r?Array.isArray(i)?e.min&&e.min>i.length?n={msg:"Array length is "+i.length+" but must be greater than "+e.min,errCode:42}:e.max&&e.max<i.length&&(n={msg:"Array length is "+i.length+" but must be lesser than "+e.max,errCode:43}):n={msg:"Property type is a "+typeof i+", but an array is required",errCode:41}:"object"===r?"object"!=typeof i&&(n={msg:"Property isn't a valid object",errCode:51}):"objectid"===r?/^[a-zA-Z0-9]{24}$/.test(i)||(n={msg:"Property isn't a valid objectId",errCode:52}):"boolean"===r&&"boolean"!=typeof i&&(n={msg:"Property isn't a valid boolean",errCode:61});return null===n?n={isValid:!0,value:i,error:null}:(this.warn("Validation error on property",n,"Data:",i),n={isValid:!1,value:i,error:n}),n},i.prototype.isValid=function(){return this._isValid},i.prototype.setData=function(e){return this.set(e,{extend:!0})},i.registerFilter=function(e,t){if("function"!=typeof t)throw Error("Filter function isn't a function");var n="function"==typeof this?i.prototype:this;n.__registeredFilter[e]=t},i.prototype.registerFilter=i.registerFilter,i.prototype.__registeredFilter={quicksearch:function(t,i,n){var r=e.undotify(t,n),s=RegExp(i.replace(/[a-z0-9äüöß]/g,"$&.*"),"i");return s.test(r)}},e.Model=i}(XQCore),XQCore.GetSet=XQCore.Model,function(e,t){"use strict";if("function"==typeof define&&define.amd)define("xqcore",[XQCore.templateEngine],t);else if("undefined"!=typeof module&&module.exports)module.exports=t(require(XQCore.templateEngine));else{var i="firetpl"===XQCore.templateEngine?"FireTPL":"Handlebars";e.XQCore=t(e[i])}}(this,function(e){"use strict";return XQCore.Tmpl={type:XQCore.templateEngine,compile:e.compile,getTemplate:function(t){if("firetpl"===XQCore.templateEngine){var i=e;if(i.templateCache&&i.templateCache[t])return i.templateCache[t];if(i.loadFile){var n=i.loadFile(XQCore.viewsDir.replace(/\/$/,"")+"/"+t+"."+XQCore.viewExt.replace(/^\./,""));return i.compile(n)}throw Error("FireTPL runtime is being used. Please preload the "+t+"View")}}},XQCore}),function(e,t){"use strict";var i=e.require("jquery"),n=function(t,i){var n;"object"==typeof arguments[0]&&(n=t,t=n.name),this.debug=e.debug,this.name=(t?t.replace(/View$/,""):"Nameless")+"View",this.container="body",this.tag="div",this.mode="replace",this.autoInject=!0,this.initFunc=i,this.__domReady=!1,n=n||{events:null},this.conf=n};e.extend(n.prototype,new e.Event,new e.Logger),n.prototype.init=function(t){var n=this,s=this.conf;if("function"==typeof this.initFunc&&this.initFunc.call(this,n),"object"!=typeof t)throw Error("No presenter was set in view.init()");this.presenter=t,i(function(){this.container.length>0?(window.addEventListener("resize",function(e){n.resize(e)},!1),this.log("Initialize view with conf:",s),this.log("  ... using Presenter:",this.presenter.name),this.log("  ... using Container:",this.container),this.events&&Object.keys(this.events).forEach(function(t){var n,s=t.indexOf(" "),o=this.events[t],a=t.substr(0,s),h=t.substr(s+1)||this.container,c=this;if("function"==typeof o)n=this;else if(0===o.indexOf("view:"))o=this[o.substr(5)],n=this;else if("function"==typeof this.presenter.events[this.events[t]])o=this.presenter.events[this.events[t]],n=this.presenter;else{var l=o;o=function(e,t,i){this.triggerEvent(l,e,t,i)}.bind(this),n=this}o&&a?"function"==typeof o?(this.container.delegate(h,a,function(t){var s=null,a=null;"submit"===t.type?s=e.Util.serializeForm(t.currentTarget):("keydown"===t.type||"keyup"===t.type||"keypress"===t.type)&&(s=i(t.currentTarget).val()),a=i.extend(i(t.currentTarget).data(),{itemIndex:r.call(c,t.currentTarget)}),o.call(n,t,a,s)}.bind(this)),this.log("Register Event:",a,"on selector",h,"with callback",o)):this.warn("Event handler callback not defined in Presenter:",this.events[t]):this.warn("Incorect event configuration",t)},this),"function"==typeof this.customInit&&this.customInit.call(this)):this.error("Can't initialize View, Container not found!",this.container),this.__domReady=!0,this.__initialData&&(this.render(this.__initialData),delete this.__initialData)}.bind(this))},n.prototype.show=function(){this.$el.show()},n.prototype.hide=function(){this.$el.hide()},n.prototype.renderHTML=function(t,i){return this.log("Render view html snipet",t,"with data:",i),t="function"==typeof t?t:e.Tmpl.compile(t),t(i)},n.prototype.resize=function(){},n.prototype.getElementData=function(e){var n=i(e,this.container);if(n.length){var r,s={},o=n.get(0).attributes;for(r=0;o.length>r;r++)if(0===o[r].name.indexOf("data-")){var a=o[r].name.substr(5),h=o[r].value;if("string"==typeof h)try{h="true"===h||"TRUE"===h?!0:"false"===h||"FALSE"===h?!1:"null"===h||"NULL"===h?null:"undefined"===h?t:+h+""===h?+h:JSON.parse(h)}catch(c){}s[a]=h}return s}return null},n.prototype.triggerEvent=function(e,t,i,n){this.presenter.events[e]?this.presenter.events[e].call(this.presenter,t,i,n):(t&&(t.preventDefault(),t.stopPropagation()),this.__coupledWith&&this.__coupledWith.forEach(function(t){"function"==typeof t[e]?(this.log("Autotrigger to model:",e,n),t[e](n)):this.warn("Autotrigger to model failed! Function doesn't exists:",e,n)}.bind(this)))},n.prototype.navigateTo=function(e,t,i){this.presenter.navigateTo(e,t,i)},n.prototype.validationFailed=function(e,t){console.log(e,t),e.forEach(function(e){this.$el.find('[name="'+e.property+'"]').addClass("xq-invalid")}.bind(this))},n.prototype.stateChanged=function(){},n.prototype.ready=function(e){this.isReady?e.call(this):(this.__readyCallbacks||(this.__readyCallbacks=[]),this.__readyCallbacks.push(e))},n.prototype.__setReadyState=function(){this.isReady=!0,this.__readyCallbacks&&this.__readyCallbacks.forEach(function(e){e.call(this)}.bind(this))};var r=function(e){var t=null,n=i(this.container).get(0),r=i(e),s=r.parent(),o=i(this.subSelector).get(0),a=0;if(this.subSelector)do{if(s.get(0)===o)return i(r).index();if(r=r.parent(),s=r.parent(),++a>100){console.error("Break loop!");break}}while(r.length&&r.get(0)!==n);return t};n.prototype.inject=function(){if(this.$ct=i(this.container),this.log("Inject view into container",this.$ct),this.el=this.$el.get(0),this.$el.addClass("xq-view xq-view-"+this.name.toLowerCase()),this.ct=this.$ct.get(0),this.hidden===!0&&this.$el.hide(),this.id&&this.$el.attr("id",this.id),this.className&&this.$el.addClass(this.className),"replace"===this.mode)this.$ct.contents().detach(),this.$ct.append(this.$el);else if("append"===this.mode)this.$ct.append(this.$el);else{if("prepend"!==this.mode)throw Error("Unknow insert mode in view.init()");this.$ct.prepend(this.$el)}},n.prototype.parse=function(e,t){var n,r;e.scopeStore={},e.scopes={};try{n=e(t||{},e.scopes)}catch(s){n='<p class="renderError"><b>View render error!</b><br>'+s.message+"</p>",this.error("View render error!",s)}if(n){n=i.parseHTML(n),r=i(n);var o=r.find("scope");console.log("EL",o.length),o.each(function(){var n,s=i(this).attr("id"),o=i(this).attr("path");console.log("Parse path",o),n={},s?(n.value=i.parseHTML(e.scopes[s](t[o],t)),n.id=s):n.value=i.parseHTML(t[o]),e.scopeStore[o]=e.scopeStore[o]||[],e.scopeStore[o].push(n),console.log("EL",i(this).get(0).outerHTML),console.log("CONTENT",i(n.value).get(0).outerHTML),i(this).replaceWith(i(n.value)),console.log("REPLACETD",r.get(0).outerHTML)})}return r},n.prototype.render=function(n){if(this.__domReady===!1)return this.__initialData=n||{},t;var r,s,o=!1;this.$el||(o=!0),this.log("Render view template",this.template,"with data:",n);var a="function"==typeof this.template?this.template:e.Tmpl.compile(this.template);this.scopes={};try{s=a(n||{},this.scopes)}catch(h){s='<p class="renderError"><b>View render error!</b><br>'+h.message+"</p>",this.error("View render error!",h)}s=i.parseHTML(s),r=i(s),this.$el&&this.$el.replaceWith(r),this.$el=r,o&&(this.autoInject&&this.inject(),this.__setReadyState()),this.registerListener(this.$el),this.emit("content.change",n)},n.prototype.registerListener=function(e){var t=this;e.find("[on]").addBack("[on]").each(function(){var e,n=i(this),r=i(this).attr("on"),s=i(this).data();n.removeAttr("on"),r=r.split(";"),r.forEach(function(i){i=i.split(":"),e="submit"===i[0]?function(e){e.preventDefault(),s=t.serializeForm(e.target),t.presenter.emit(i[1],s,e),t.emit("form.submit",s)}.bind(this):function(e){e.preventDefault();var n=e.currentTarget.value||"";t.presenter.emit(i[1],n,s,e)}.bind(this),n.bind(i[0],e)})})},n.prototype.serializeForm=function(t){var n={},r=i(t);return"INPUT"!==r.get(0).tagName&&(r=r.find(":input")),r.serializeArray().forEach(function(t){e.dedotify(n,t.name,t.value)}),this.debug&&console.log("XQCore - Serialize form:",r,n),n},n.prototype.insert=function(e,t,n){var r=this,s=this.$el.find('.xq-scope[xq-path="'+e+'"]');s.length&&s.each(function(){var e=i(this).attr("xq-scope"),s=r.scopes[e]([n]),o=i(this).children();t>-1?(t>o.length-1&&(t=o.length-1),o.eq(t).before(s)):o.eq(t).after(s)})},n.prototype.update=function(){console.warn("XQCore doesn`t support update event yet")},n.prototype.append=function(e,t){this.insert(e,-1,t)},n.prototype.prepend=function(e,t){this.insert(e,0,t)},n.prototype.remove=function(e,t){var i=this.$el.find('.xq-scope[xq-path="'+e+'"]');i.children(":eq("+t+")").remove()},e.View=n}(XQCore),function(e){"use strict";e.undotify=function(e,t){return e&&(e=e.split("."),e.forEach(function(e){t=t[e]})),t},e.dedotify=function(e,t,i){"string"==typeof e&&(i=t,t=e,e={});var n=e;if(t){t=t.split(".");var r=t.length;t.forEach(function(t,n){return n===r-1?(e[t]=i,undefined):(e[t]||(e[t]={}),e=e[t],undefined)})}return e=i,n}}(XQCore),function(e){"use strict";var t=function(e){var t,n,r=[];return e instanceof RegExp?(n=e,t=""+e):(n=i(e,r),t=e),{re:n,src:""+e,keys:r}},i=function(e,t){return e=e.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,i,n,r,s,o){return t.push(r),i=i||"",""+(o?"":i)+"(?:"+(o?i:"")+(n||"")+(s||"([^/]+?)")+")"+(o||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)"),RegExp("^"+e+"$","i")},n=function(e,t){for(var i,n=0,r=e.length;r>n;++n){var s,o=e[n],a=o.re,h=o.keys,c=[],l={};if(i=a.exec(t)){for(s=1,r=i.length;r>s;++s){var p=h[s-1],u="string"==typeof i[s]?decodeURIComponent(i[s]):i[s];p?l[p]=u:c.push(u)}return{params:l,splats:c,route:o.src}}}},r=function(t){t=e.extend({debug:!1},t),this.debug=Boolean(t.debug),this.routes=[],this.routeMap={}};r.prototype.addRoute=function(e,i){if(!e)throw Error(" route requires a path");if(!i)throw Error(" route "+(""+e)+" requires a callback");var n=new t(e);n.fn=i,this.routes.push(n),this.routeMap[e]=i},r.prototype.match=function(e){var t=n(this.routes,e);return t&&(t.fn=this.routeMap[t.route]),t},r.prototype.fire=function(e,t){e=this.match(e),e&&e.fn(t)},e.Router=r}(XQCore),function(e){"use strict";var t=function(){this.__isReady=!1,this.__onReadyCallbacks=[],this.__eventEmitter=new e.Event};e.extend(t.prototype,new e.Logger),t.prototype.connect=function(e,t,i){var n=this;this.sockJS=new SockJS(e,null,t),console.log("Connect to socket server ",e,"using options:",t),this.sockJS.onopen=function(){console.log("Connection was successful!"),"function"==typeof i&&i(),n.setReady()}.bind(this),this.sockJS.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(i){console.error("Could't parse socket message!",e.data)}console.log("Got message",t.eventName,t.data),n.__eventEmitter.emit(t.eventName,t.data)}.bind(this),this.sockJS.onclose=function(){console.log("Connection closed!")}.bind(this)},t.prototype.emit=function(e,t){this.ready(function(){console.log("Send message ",e,t),this.sockJS.send(JSON.stringify({eventName:e,data:t}))}.bind(this))},t.prototype.on=function(e,t){this.__eventEmitter.on(e,t)},t.prototype.once=function(e,t){this.__eventEmitter.once(e,t)},t.prototype.off=function(e,t){this.__eventEmitter.off(e,t)},t.prototype.ready=function(e){this.__isReady?e.call(this):this.__onReadyCallbacks.push(e)},t.prototype.setReady=function(){this.__isReady=!0,this.__onReadyCallbacks.forEach(function(e){e.call(this)}.bind(this)),this.__onReadyCallbacks=[]},e.Socket=t}(XQCore),function(e){"use strict";var t;t=function(t,i){e.Model.call(this,t,i),this.server=i.server||location.protocol+"//"+location.hostname,this.port=i.port||9999,this.path=i.path||"xqsocket/"+t,this.syncEnabled=!1},t.prototype=Object.create(e.Model.prototype),t.prototype.constructor=t,t.prototype.init=function(){e.Model.prototype.init.call(this),this.connectToSocket()},t.prototype.connectToSocket=function(){var t=this.server+":"+this.port+"/"+this.path;this.socket||(this.socket=new e.Socket,this.socket.connect(t))},t.prototype.register=function(e){var t=this,i=this.conf.syncWith||this.name.replace(/Model$/,"");this.syncEnabled=!!e,console.log("register model at server"),this.socket.emit("syncmodel.register",{name:i}),this.socket.on("syncmodel.change",function(e){var i={sync:!1},n=e.slice(1);switch(n.push(i),e[0]){case"replace":case"item":t.set.apply(t,n);break;case"append":t.append.apply(t,n);break;case"prepend":t.prepend.apply(t,n);break;case"insert":t.insert.apply(t,n);break;case"remove":t.remove.apply(t,n);break;default:t.warn("Unknown syncmodel event",e[0])}})},t.prototype.unregister=function(){var e=this.conf.syncWith||this.name.replace(/Model$/,"");this.socket.emit("syncmodel.unregister",{name:e}),this.socket.off("syncmodel.change")},t.prototype.emitRemote=function(e,t){this.socket.emit(e,t)},t.prototype.sync=function(){if(this.syncEnabled){var e=Array.prototype.slice.call(arguments);this.emitRemote("syncmodel.change",e)}},e.SyncModel=t}(XQCore);