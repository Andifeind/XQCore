var XQCore={version:.2,defaultRoute:"default",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent"};window.include||(window.include=function(e,t){var n=location.protocol+"//"+location.host+e;$.ajax({url:n,dataType:"script",success:t,async:!1})},window.preload=function(file){var url=location.protocol+"//"+location.host+file,script;return $.ajax({url:url,dataType:"text",success:function(e){script=e},async:!1}),{execute:function(scope){eval.call(scope||window,script)}}}),XQCore._dump={},XQCore.dump=function(e){return XQCore._dump[e]?(console.log("[XQCore dump]",e,XQCore._dump[e]),XQCore._dump[e]):!1},XQCore.Presenter=function(e){var t=function(e){var t=this;this.root="/",this.debug=!1,this.routes=[],e=e||{},this.customInit=e.init,this.conf=e,delete e.init,$.extend(this,e,new XQCore.Event,new XQCore.Logger),this.name=(e.name||"Nameless")+"Presenter",this.eventCallbacks={},this.registeredViews=[],this.fireViewInit=function(e){var t=!0;this.registeredViews.forEach(function(n){e===n.view&&(n.isReady=!0),n.isReady===!1&&(t=!1)}),this.viewInit(e),t===!0&&this.emit("views.ready")},this.registerView=function(e){this.registeredViews.push({view:e,isReady:!1})},this.getView=function(e){var t,n;for(t=0;t<this.registeredViews.length;t++){n=this.registeredViews[t].view;if(n.name===e)return n}}};return t.prototype.init=function(e){var t,n=this,r=this.conf;r.routes&&(this.Router=new XQCore.Router,Object.keys(r.routes).forEach(function(e){var t=this.routes[e];typeof t=="string"&&(t=this[t]),typeof t=="function"?this.Router.addRoute(e,t):this.warn("Router callback isn't a function",t,"of route",e)}.bind(this)),window.addEventListener("popstate",function(e){n.log("popstate event recived",e);var t=XQCore.defaultRoute;if(XQCore.html5Routes){var r=new RegExp("^"+n.root);t=location.pathname.replace(r,"")}else/^#![a-zA-Z0-9]+/.test(location.hash)&&(t=location.hash.substr(2));t=n.Router.match(t);if(t){var i=e.state;XQCore.callerEvent&&(i[XQCore.callerEvent]="popstate"),t.fn.call(n,i)}},!1),this.on("views.ready",function(){var e=XQCore.defaultRoute;/^#![a-zA-Z0-9]+/.test(location.hash)&&(e=location.hash.substr(2)),e=n.Router.match(e),e&&e.fn.call(n,e)})),typeof this.customInit=="function"&&this.customInit.call(this),console.log("views",e);if(e instanceof Array){for(t=0;t<e.length;t++)this.registerView(e[t]);for(t=0;t<e.length;t++)e[t].init(this)}else this.registerView(e),e.init(this)},t.prototype.viewInit=function(e){},t.prototype.pushState=function(e,t){var n=XQCore.html5Routes||t.charAt(0)==="/"?"":XQCore.hashBang;t=n+t,history.pushState(e,"",t||null),this.log("Update history with pushState",e,t)},t.prototype.replaceState=function(e,t){var n=XQCore.html5Routes||t.charAt(0)==="/"?"":XQCore.hashBang;t=n+t,history.replaceState(e,"",t||null),this.log("Update history with replaceState",e,t)},t.prototype.navigateTo=function(e,t){var n=this.Router.match(e);n&&(XQCore.callerEvent&&(t=t||{},t[XQCore.callerEvent]="redirect"),n.fn.call(this,t)),this.log("Navigate to",e,t)},t}(),XQCore.Model=function(e,t,n,r){var i,s=function(e,t){return e&&(e=e.split("."),e.forEach(function(e){t=t[e]})),t};return i=function(e){e===r&&(e={}),this.customInit=e.init,this.conf=e,delete e.init,n.extend(this,e,new XQCore.Event,new XQCore.Logger),this.name=(e.name||"Nameless")+"Model",this.debug=Boolean(e.debug),this.propertys={},this._isValid=!1,e.validate&&(this.validate=function(t){var n;this._isValid=!1,n=e.validate.call(this,t);if(!n||typeof n=="object"&&Object.keys(n).length===0)this._isValid=!0;return n}.bind(this)),this.init(),this.defaults&&this.set(this.defaults)},i.prototype.init=function(){this.debug&&(XQCore._dump[this.name]=this),typeof this.customInit=="function"&&this.customInit.call(this)},i.prototype.validate=function(){},i.prototype.isValid=function(){return this._isValid},i.prototype.set=function(){var e={},t;typeof arguments[0]=="object"?(n.extend(e,arguments[0]),this.log("Set data",arguments[0])):typeof arguments[0]=="string"?(e[arguments[0]]=arguments[1],this.log("Set data",arguments[0],arguments[1])):this.warn("Data are incorrect in model.set()",arguments);if(this.validate){t=this.validate(e);if(t)return this.warn("Validate error in model.set",t),t}n.extend(this.propertys,e)},i.prototype.get=function(e){return e===r?this.propertys:this.propertys[e]},i.prototype.has=function(e){return!!this.propertys[e]},i.prototype.reset=function(){this.log("Reset model"),this.propertys={}},i.prototype.append=function(e,t){var r=this.propertys;return e.split(".").forEach(function(e){r=r[e]}),r instanceof Array?r.push(t):r=n.extend(r,t),t},i.prototype.prepend=function(e,t){var r=this.propertys;return e.split(".").forEach(function(e){r=r[e]}),r instanceof Array?r.unshift(t):r=n.extend(t,r),t},i.prototype.remove=function(e,t){var n=this.propertys,r=null;return e.split(".").forEach(function(e){n=n[e]}),n instanceof Array?(r=n.splice(t,1),r=r[0]||null):this.warn("Model.remove() doesn't work with Objects in model",this.name),r},i.prototype.onSend=function(e){return e},i.prototype.send=function(e,t,i){if(!this.server)return this.error("Can not send an ajax request! You must define a server URL first."),!1;t===r&&(t=this.get()),e===r&&(e="POST"),typeof this.onSend=="function"&&(t=this.onSend.call(this,t)),this.log("Sending an ajax call to ",this.server,"with data: ",t),n.ajax({url:this.server,type:e,data:t,success:function(e,t,n){typeof i=="function"&&i.call(this,null,e,t,n)}.bind(this),error:function(e,t,n){typeof i=="function"&&i.call(this,{type:t,http:n},null,t,e)}.bind(this)})},i.prototype.sendPOST=function(e,t){this.send("POST",e,t)},i.prototype.sendGET=function(e,t){this.send("GET",e,t)},i.prototype.sendUPDATE=function(e,t){this.send("UPDATE",e,t)},i.prototype.sendDELETE=function(e,t){this.send("DELETE",e,t)},i.prototype.search=function(e,t){var n=s(e,this.propertys);if(n)for(var r=0;r<n.length;r++){var i=n[r],o;for(var u in t)if(t.hasOwnProperty(u)){if(!i[u]||i[u]!==t[u]){o=!1;break}o=!0}if(o===!0)return i}return null},i}(window,document,jQuery),XQCore.View=function(e){var t=function(e){arguments.length===2&&(this.presenter=arguments[0],e=arguments[1],console.info("Defining View with presenter is deprecated.")),e=e||{events:null},this.customInit=e.init,this.conf=e,delete e.init,$.extend(this,e,new XQCore.Event,new XQCore.Logger),this.name=(e.name||"Nameless")+"View",this.debug=Boolean(e.debug)};t.prototype.init=function(e){var t=this,r=this.conf;e||(e=this.presenter,e.registerView(this)),console.log("View Init2",this),this.presenter=e,$(function(){this.container=$(r.container),this.$el=this.container,this.el=$(r.container).get(0),this.container.length>0?(window.addEventListener("resize",function(e){t.resize(e)},!1),this.log("Initialize view with conf:",r),this.log("  ... using Presenter:",this.presenter.name),this.log("  ... using Container:",this.container),this.events?Object.keys(this.events).forEach(function(e){var t=e.indexOf(" "),r=this.events[e],i=e.substr(0,t),s=e.substr(t+1)||this.container,o=this,u;typeof r=="function"?u=this:r.indexOf("view:")===0?(r=this[r.substr(5)],u=this):(r=this.presenter.events[this.events[e]],typeof r=="string"&&(r=this.presenter[this.events[e]]),u=this.presenter),r&&i?typeof r=="function"?(this.container.delegate(s,i,function(e){var t=null,i=null;e.type==="submit"&&(t=XQCore.Util.serializeForm(e.target)),i=$.extend($(e.target).data(),{itemIndex:n.call(o,e.target)}),r.call(u,e,i,t)}),this.log("Register Event:",i,"on selector",s,"with callback",r)):this.warn("Event handler callback not defined in Presenter:",this.events[e]):this.warn("Incorect event configuration",e)},this):this.warn("No view events defined"),typeof this.customInit=="function"&&this.customInit.call(this),this.presenter.fireViewInit(this)):this.error("Can't initialize View, Container not found!",this.container)}.bind(this))},t.prototype.show=function(){},t.prototype.hide=function(){},t.prototype.render=function(e){this.log("Render view template",this.template,"with data:",e);var t=Handlebars.compile(this.template);this.container.html(t(e||{})),this.emit("content.change")},t.prototype.renderHTML=function(e,t){return this.log("Render view html snipet",e,"with data:",t),e=Handlebars.compile(e),e(t)},t.prototype.resize=function(){},t.prototype.append=function(e,t){this.manipulate("append",e,t)},t.prototype.prepend=function(e,t){this.manipulate("prepend",e,t)},t.prototype.remove=function(e){this.manipulate("remove",e)},t.prototype.manipulate=function(t,n,r){if(this.subSelector===e)return this.warn("You must set the subSelector option"),!1;if(this.itemTemplate===e)return this.warn("You must set the itemTemplate option"),!1;var i=$(this.subSelector,this.container),s;r;switch(t){case"append":s=Handlebars.compile(this.itemTemplate)(n),$(s).appendTo(i);break;case"prepend":s=Handlebars.compile(this.itemTemplate)(n),$(s).prependTo(i);break;case"remove":i.children().eq(n).remove();break;default:this.error("undefined action in view.manipulate()",t)}},t.prototype.getElementData=function(t){var n=$(t,this.container);if(n.length){var r={},i=n.get(0).attributes,s;for(s=0;s<i.length;s++)if(i[s].name.indexOf("data-")===0){var o=i[s].name.substr(5),u=i[s].value;if(typeof u=="string")try{u==="true"||u==="TRUE"?u=!0:u==="false"||u==="FALSE"?u=!1:u==="null"||u==="NULL"?u=null:u==="undefined"?u=e:+u+""===u?u=+u:(u=JSON.parse(u),console.log(u))}catch(a){}r[o]=u}return console.log("Get data",r),r}return null};var n=function(e){var t=null,n=$(this.container).get(0),r=$(e),i=r.parent(),s=$(this.subSelector).get(0),o=0;if(this.subSelector)do{if(i.get(0)===s)return $(r).index();r=r.parent(),i=r.parent();if(++o>100){console.log(r,i),console.error("Break loop!");break}}while(r.length&&r.get(0)!==n);return t};return t}(),XQCore.Event=function(){function r(e,t){this.objectName="XQCore.Event";var n=this.store.length,r=0,i;for(;r<n;r++){i=this.store[r];if(e===null||e===i.event&&t===null||t===i.callback)return i}return null}var e=function(){"use strict";function e(){}function r(e,t){if(n)return t.indexOf(e);var r=t.length;while(r--)if(t[r]===e)return r;return-1}var t=e.prototype,n=Array.prototype.indexOf?!0:!1;return t.getListeners=function(e){var t=this._events||(this._events={});return t[e]||(t[e]=[])},t.addListener=function(e,t){var n=this.getListeners(e);return r(t,n)===-1&&n.push(t),this},t.removeListener=function(e,t){var n=this.getListeners(e),i=r(t,n);return i!==-1&&(n.splice(i,1),n.length===0&&(this._events[e]=null)),this},t.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},t.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},t.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if(typeof t=="object")for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&(typeof i=="function"?s.call(this,r,i):o.call(this,r,i));else{r=n.length;while(r--)s.call(this,t,n[r])}return this},t.removeEvent=function(e){return e?this._events[e]=null:this._events=null,this},t.emitEvent=function(e,t){var n=this.getListeners(e),r=n.length,i;while(r--)i=t?n[r].apply(null,t):n[r](),i===!0&&this.removeListener(e,n[r]);return this},e}(),t,n;return n=function(t){this.store=[],this.ee=new e},n.prototype.emit=function(e,t){return this.debug&&console.debug("XQCore - Emit event",e,t),this.ee.emitEvent(e,[t],this)},n.prototype.on=function(e,t){return this.debug&&console.debug("XQCore - Add listener",e,t,this),this.ee.addListener(e,t)},n.prototype.once=function(e,t){var n=function(){return this.ee.removeListener(e,t),t.call(null,arguments),!0};return this.debug&&console.debug("XQCore - Add once listener",e,t),this.ee.addListener(e,n)},n.prototype.off=function(e,t){return this.debug&&console.debug("XQCore - Remove listener",e,t),t===undefined?this.ee.removeEvent(e):this.ee.removeListener(e,t)},n}(),XQCore.Logger=function(e){function t(e){return e<1e3?e+" ms":e<6e4?Math.round(e/100)/10+" sec":Math.round(e/6e4)+" min "+Math.round(e%6e4/1e3)+" sec"}function n(){var e,t;e=localStorage.get("xqcore-onscreen-console")||{pos:"bottom"},t='<div id="XQCoreLogger-OnScreenConsole">			</div>'}var r=function(){};return r.prototype.log=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.log.apply(console,e))},r.prototype.warn=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.warn.apply(console,e))},r.prototype.error=function(){var e;this.debug&&(e=Array.prototype.slice.call(arguments),e.unshift("["+this.name+"]"),console.error.apply(console,e))},r.prototype.timer=function(e){var n={start:null,stop:null,name:e,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",t(this.stop-this.start))}};return this.log("Start Timer",e),n.start=Date.now(),n},r.prototype.timerEnd=function(e){},r.prototype.__scope={getHumanTime:t},r}(),XQCore.Util=function(e){var t={name:"XQCore.Util",debug:!0};return t.serializeForm=function(t){var n={},r=e(t);return r.get(0).tagName!=="INPUT"&&(r=r.find(":input")),r.serializeArray().forEach(function(e){n[e.name]=e.value}),this.debug&&console.log("XQCore - Serialize form:",r,n),n},t.checkLength=function(e,t,n){if(typeof e=="Number"){if(e<t)return"num-to-small";if(e>n)return"num-to-large"}else{console.log(e,e.length);if(e.length<t)return"str-to-short";if(e.length>n)return"str-to-long"}},t.checkEqual=function(e,t){if(e!==t)return"str-not-equal"},t.checkEmail=function(e){if(!/^\S+\@\S+\.[a-z]{2,10}$/.test(e))return"invalid-email"},t}(jQuery),XQCore.Router=function(e){var t=function(e){var t,r,i=[];return e instanceof RegExp?(r=e,t=e.toString()):(r=n(e,i),t=e),{re:r,src:e.toString(),keys:i}},n=function(e,t){return e=e.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,n,r,i,s,o){return t.push(i),n=n||"",""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||"([^/]+?)")+")"+(o||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)"),new RegExp("^"+e+"$","i")},r=function(e,t){var n,r=0;for(var i=e.length;r<i;++r){var s=e[r],o=s.re,u=s.keys,a=[],f={},l;n=o.exec(t);if(n){for(l=1,i=n.length;l<i;++l){var c=u[l-1],h=typeof n[l]=="string"?decodeURIComponent(n[l]):n[l];c?f[c]=h:a.push(h)}return{params:f,splats:a,route:s.src}}}},i=function(e){e=$.extend({debug:!1},e),this.debug=Boolean(e.debug),this.routes=[],this.routeMap={}};return i.prototype.addRoute=function(e,n){if(!e)throw new Error(" route requires a path");if(!n)throw new Error(" route "+e.toString()+" requires a callback");var r=new t(e);r.fn=n,this.routes.push(r),this.routeMap[e]=n},i.prototype.match=function(e){var t=r(this.routes,e);return t&&(t.fn=this.routeMap[t.route]),t},i.prototype.fire=function(e,t){e=this.match(e),e&&e.fn(t)},i}(),function(e,t){console.log("View slide",e);var n,r=function(){return"transition"in document.body.style?"transition":"MozTransition"in document.body.style?"MozTransition":"WebkitTransition"in document.body.style?"WebkitTransition":"OTransition"in document.body.style?"OTransition":"MsTransition"in document.body.style?"MsTransition":t};e.slideIn=function(e){e=$.extend({parent:this.el.parentNode,transition:"left .75s",direction:"auto"},e),n===t&&(n=r());if(e.parent&&this.el){this.log("> slide plugin > Slide view",this.el,"in container",e.parent),console.log({el:e.parent,cw:e.parent.clientWidth,ow:e.parent.offsetWidth,w:e.parent.style.width});var i=e.parent.offsetWidth;this.el.style.display="block",this.el.style[n]="none",this.el.style.left=i+"px",window.setTimeout(function(){this.el.style[n]=e.transition,this.el.style.left="0"}.bind(this))}else this.warn("> slide plugin > Can't slide view! View or parent not found! View",this.el,"in container",e.parent)},e.slideOut=function(e){e=$.extend({parent:this.el.parentNode,transition:"left .75s",direction:"auto"},e),n===t&&(n=r());if(e.parent&&this.el){this.log("> slide plugin > Slide view",this.el,"in container",e.parent),console.log({el:e.parent,cw:e.parent.clientWidth,ow:e.parent.offsetWidth,w:e.parent.style.width});var i=e.parent.offsetWidth;this.el.style[n]=e.transition,this.el.style.left=i+"px";var s=function(){+this.el.style.left.replace("px","")>=i?(this.el.style.display="none",this.el.style[n]="none"):console.warn("Old transitionEndFunc???",this.el,+this.el.style.left.replace("px",""),this.el.style[n]),this.el.removeEventListener("transitionend",s)}.bind(this);this.el.addEventListener("transitionend",s)}else this.warn("> slide plugin > Can't slide view! View or parent not found! View",this.el,"in container",e.parent)}}(XQCore.View.prototype);