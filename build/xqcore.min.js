/*!
 * XQCore - +0.7.1-29
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2014 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2014-01-22
 */
var XQCore;(function(t,e){"use strict";"function"==typeof define&&define.amd?define("xqcore",["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):t.XQCore=e(t.jQuery)})(this,function(t){"use strict";return XQCore={version:"0.7.1-29",defaultRoute:"index",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent",objectIdPattern:/^[a-zA-Z0-9]{24}$/,templateEngine:"firetpl",viewsDir:"./views/",viewExt:".fire"},XQCore.extend=t.extend,XQCore.isEmptyObject=t.isEmptyObject,XQCore.isObjectId=function(t){return this.objectIdPattern.test(t)},XQCore._dump={},XQCore.dump=function(t){return XQCore._dump[t]?(console.log("[XQCore dump]",t,XQCore._dump[t]),XQCore._dump[t]):!1},XQCore.require=function(e){return"jquery"===e?t:void 0},XQCore}),function(t){"use strict";/*!
	 * EventEmitter v4.2.5 - git.io/ee
	 * Oliver Caldwell
	 * MIT license
	 * @preserve
	 */
function e(){}function i(t,e){for(var i=t.length;i--;)if(t[i].listener===e)return i;return-1}function n(t){return function(){return this[t].apply(this,arguments)}}var r=e.prototype;r.getListeners=function(t){var e,i,n=this._getEvents();if("object"==typeof t){e={};for(i in n)n.hasOwnProperty(i)&&t.test(i)&&(e[i]=n[i])}else e=n[t]||(n[t]=[]);return e},r.flattenListeners=function(t){var e,i=[];for(e=0;t.length>e;e+=1)i.push(t[e].listener);return i},r.getListenersAsObject=function(t){var e,i=this.getListeners(t);return i instanceof Array&&(e={},e[t]=i),e||i},r.addListener=function(t,e){var n,r=this.getListenersAsObject(t),s="object"==typeof e;for(n in r)r.hasOwnProperty(n)&&-1===i(r[n],e)&&r[n].push(s?e:{listener:e,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(t){return this.getListeners(t),this},r.defineEvents=function(t){for(var e=0;t.length>e;e+=1)this.defineEvent(t[e]);return this},r.removeListener=function(t,e){var n,r,s=this.getListenersAsObject(t);for(r in s)s.hasOwnProperty(r)&&(n=i(s[r],e),-1!==n&&s[r].splice(n,1));return this},r.off=n("removeListener"),r.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},r.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},r.manipulateListeners=function(t,e,i){var n,r,s=t?this.removeListener:this.addListener,o=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(n=i.length;n--;)s.call(this,e,i[n]);else for(n in e)e.hasOwnProperty(n)&&(r=e[n])&&("function"==typeof r?s.call(this,n,r):o.call(this,n,r));return this},r.removeEvent=function(t){var e,i=typeof t,n=this._getEvents();if("string"===i)delete n[t];else if("object"===i)for(e in n)n.hasOwnProperty(e)&&t.test(e)&&delete n[e];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(t,e){var i,n,r,s,o=this.getListenersAsObject(t);for(r in o)if(o.hasOwnProperty(r))for(n=o[r].length;n--;)i=o[r][n],i.once===!0&&this.removeListener(t,i.listener),s=i.listener.apply(this,e||[]),s===this._getOnceReturnValue()&&this.removeListener(t,i.listener);return this},r.trigger=n("emitEvent"),r.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},r.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},t.Event=e}(XQCore),function(t){"use strict";function e(t){return 1e3>t?t+" ms":6e4>t?Math.round(t/100)/10+" sec":Math.round(t/6e4)+" min "+Math.round(t%6e4/1e3)+" sec"}var i=function(){};i.prototype.log=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),t.unshift("["+this.name+"]"),console.log.apply(console,t))},i.prototype.warn=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),t.unshift("["+this.name+"]"),console.warn.apply(console,t))},i.prototype.error=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),t.unshift("["+this.name+"]"),console.error.apply(console,t))},i.prototype.timer=function(t){var i={start:null,stop:null,name:t,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",e(this.stop-this.start))}};return this.log("Start Timer",t),i.start=Date.now(),i},i.prototype.__scope={getHumanTime:e},t.Logger=i}(XQCore),function(t,e){"use strict";var i=function(e,i){"object"==typeof arguments[0]&&(i=e,e=i.name),this.__views=[],this.debug=t.debug,this.name=(e?e.replace(/Presenter$/,""):"Nameless")+"Presenter",this.routes=[],i=i||{},this.conf=i,this.eventCallbacks={},this.lastShownView=null,this.registeredViews=[],this.registeredModels=[],this.fireViewInit=function(t){var e=!0;this.registeredViews.forEach(function(i){t===i.view&&(i.isReady=!0),i.isReady===!1&&(e=!1)}),this.viewInit(t),e===!0&&this.emit("views.ready")},this.registerView=function(t){this.warn("presenter.registerView was deprecated since XQCore 0.7.0");var e;if(t instanceof Array)for(e=0;t.length>e;e++)this.registeredViews.push({view:t[e],isReady:!1});else this.registeredViews.push({view:t,isReady:!1})},this.registerModel=function(t){this.warn("presenter.registerModel was deprecated since XQCore 0.7.0");var e;if(t instanceof Array)for(e=0;t.length>e;e++)this.registeredModels.push({model:t[e],isReady:!1});else this.registeredModels.push({model:t,isReady:!1})},this.__Router=new t.Router};t.extend(i.prototype,new t.Event,new t.Logger),i.prototype.events={},i.prototype.init=function(e){var i,n=this,r=this.conf;"function"==typeof r?r.call(this,n):t.extend(this,r),r.routes&&Object.keys(r.routes).forEach(function(t){var e=this.routes[t];"string"==typeof e&&(e=this[e]),"function"==typeof e?this.__Router.addRoute(t,e):this.warn("Router callback isn't a function",e,"of route",t)}.bind(this)),window.addEventListener("popstate",function(t){n.__onPopstate(t.state)},!1);var s=t.defaultRoute;if(/^#![a-zA-Z0-9]+/.test(n.getHash())&&(s=n.getHash().substr(2)),s=n.__Router.match(s)){var o=s.params;t.callerEvent&&(o[t.callerEvent]="pageload"),n.log("Trigger route",s,o),s.fn.call(n,s.params)}if("function"==typeof r.init&&r.init.call(this),e instanceof Array)for(i=0;e.length>i;i++)this.registerView(e[i]);else e&&this.registerView(e);this.registeredViews.forEach(function(t){t.view.init(n)}),this.registeredModels.forEach(function(t){t.model.init(n)})},i.prototype.viewInit=function(){},i.prototype.pushState=function(e,i){var n=t.html5Routes||"/"===i.charAt(0)?"":t.hashBang;i=n+i,history.pushState(e,"",i||null),this.log("Update history with pushState",e,i)},i.prototype.replaceState=function(e,i){var n=t.html5Routes||"/"===i.charAt(0)?"":t.hashBang;i=n+i,history.replaceState(e,"",i||null),this.log("Update history with replaceState",e,i)},i.prototype.navigateTo=function(t,e,i){this.log("Navigate to route: ",t,e,i),i?this.replaceState(e,t):this.pushState(e,t),this.__onPopstate(e)},i.prototype.getView=function(t){var e,i;for(e=0;this.registeredViews.length>e;e++)if(i=this.registeredViews[e].view,i.name===t)return i;return null},i.prototype.showView=function(t,i){var n=this.getView(t+"View");return n?(this.log("Show view:",t,i),this.log("Hide view:",this.lastShownView),this.lastShownView!==n&&(this.lastShownView&&"function"==typeof this.lastShownView.hide?(this.lastShownView.hide(),n.show()):n.show(!0)),e):(this.warn("View not defined!",t),e)},i.prototype.getHash=function(){return location.hash},i.prototype.getPathname=function(){return location.pathname},i.prototype.couple=function(i){var n,r=i.view,s=i.model,o=t.extend({"data.change":"render","data.append":"append","data.prepend":"prepend","validation.error":"validationFailed","state.change":"stateChanged"},i.modelEvents),a=t.extend({"form.submit":"setData"},i.viewEvents);if(!r instanceof t.View)return this.error("Can't couple view with model! View isn't a XQCore.View"),e;if(!s instanceof t.Model)return this.error("Can't couple model with model! Model isn't a XQCore.Model"),e;this.log("Couple view ",r.name,"with model",s.name),r.__coupledWith||(r.__coupledWith=[]),s.__coupledWith||(s.__coupledWith=[]),r.__coupledWith.some(function(t){return t===s})||r.__coupledWith.push(s),s.__coupledWith.some(function(t){return t===r})||s.__coupledWith.push(r);var h=function(t,i){s.on(t,function(t,n){n!==e?r[i](t,n,s.name):r[i](t,s.name)})},l=function(t,e){r.on(t,function(t,i){s[e](t,i,r.name)})};for(n in o)o.hasOwnProperty(n)&&(h(n,o[n]),"data.change"===n&&s.emit(n,s.get()));for(n in a)a.hasOwnProperty(n)&&l(n,a[n]);return this},i.prototype.triggerEvent=function(t,e,i,n,r){this.events[e]?this.events[e].call(this,i,n,r):(i.preventDefault(),i.stopPropagation(),t.__coupledWith.forEach(function(t){"function"==typeof t[e]?(this.log("Autotrigger to model ",t.name," - ",e,r),t[e](r)):this.warn("Autotrigger to model failed! Function doesn't exists:",e,r)}))},i.prototype.__onPopstate=function(e){var i=this;i.log("popstate event recived",e);var n=t.defaultRoute;if(t.html5Routes){var r=RegExp("^"+i.root);n=i.getPathname().replace(r,"")}else/^#![a-zA-Z0-9]+/.test(this.getHash())&&(n=i.getHash().substr(2));n=i.__Router.match(n),n&&(e=e||n.params,t.callerEvent&&(e[t.callerEvent]="popstate"),i.log("Trigger route",n,e),n.fn.call(i,e))},i.prototype.initView=function(i,n,r){if(r=r||{},this.__views[i])return this.warn("View allready registered!",i),e;this.debug&&this.log("Init view",i);var s=new t.View(i,function(e){e.template=t.Tmpl.getTemplate(i),e.mode=r.mode||"replace",e.container=n||"body",r.inject===!1&&(e.autoInject=!1)});return this.__views[i]=s,s.init(this),s},i.prototype.route=function(t,e){"string"==typeof e&&(e=this[e]),"function"==typeof e?(this.log("Register route",t,"with callback",e),this.__Router.addRoute(t,e)):this.warn("Router callback isn't a function",e,"of route",t)},t.Presenter=i}(XQCore),function(t,e){"use strict";var i=t.require("jquery"),n=function(){};n.prototype.onSend=function(t){return t},n.prototype.send=function(t,n,r,s){"object"==typeof n?(s=r,r=n,n=this.server,t=t):"function"==typeof r?(s=r,r=this.get()):r===e&&(r=this.get()),t===e&&(t="POST"),n||(n=this.server),"function"==typeof this.onSend&&(r=this.onSend.call(this,r)),this.log("Sending an ajax call to ",this.server,"with data: ",r),this.state("syncing"),i.ajax({url:n,type:t,data:r,dataType:"json",success:function(t,e,i){"function"==typeof s&&s.call(this,null,t,e,i),this.state("success")}.bind(this),error:function(t,e,i){"function"==typeof s&&s.call(this,{type:e,http:i},null,e,t),this.state("failed")}.bind(this)})},n.prototype.sendPOST=function(t,e,i){this.send("POST",t,e,i)},n.prototype.sendGET=function(t,e,i){this.send("GET",t,e,i)},n.prototype.sendPUT=function(t,e,i){this.send("PUT",t,e,i)},n.prototype.sendDELETE=function(t,e,i){this.send("DELETE",t,e,i)},n.prototype.ready=function(t){t===!0?(Array.isArray(this.__callbacksOnReady)&&(this.log("Trigger ready state"),this.__callbacksOnReady.forEach(function(t){t.call(this)}.bind(this))),this.__isReady=!0,delete this.__callbacksOnReady):"function"==typeof t?this.__isReady===!0?t():(this.__callbacksOnReady||(this.__callbacksOnReady=[]),this.__callbacksOnReady.push(t)):this.warn("arg0 isn't a callback in model.ready()!")},n.prototype.fetch=function(t,e){this.sendGET(t,e)},n.prototype.save=function(t){this.isValid()?this.sendPOST(this.get(),t):"function"==typeof t&&t({msg:"Model isn't valid. Cancle save"})},n.prototype.update=function(t){this.isValid()?this.sendPUT(this.get(),t):"function"==typeof t&&t({msg:"Model isn't valid. Cancle update"})},t.Sync=n}(XQCore),function(t,e){"use strict";var i;i=function(i,n){"object"==typeof arguments[0]&&(n=i,i=n.name),this.debug=t.debug,n===e&&(n={}),this.__state="starting",this.customValidate=n.validate,delete n.validate,this.conf=n,this.name=(i?i.replace(/Model$/,""):"Nameless")+"Model",this._isValid=!1,this.properties={},this.schema=n.schema,this.defaults&&!t.isEmptyObject(this.defaults)&&this.set(this.defaults)},t.extend(i.prototype,new t.Event,new t.Logger),t.Sync&&t.extend(i.prototype,t.Sync.prototype),i.prototype.init=function(){var e=this,i=this.conf;"function"==typeof i?i.call(this,e):t.extend(this,i),this.debug&&(t._dump[this.name]=this),this.state("ready")},i.prototype.state=function(t){this.__state=t,this.emit("state."+t),this.emit("state.change",t)},i.prototype.getState=function(){return this.__state},i.prototype.set=function(e,i,n){var r,s={},o=this.get();if(n=n||{},null===arguments[0])s=arguments[1],this.log("Set data",s,o);else if("object"==typeof arguments[0])e=null,n=i||{},s=n.extend?t.extend(s,o,arguments[0]):arguments[0],this.log("Set data",s,o);else if("string"==typeof arguments[0]){s=t.extend({},this.get()),e=arguments[0];var a=arguments[1];if(t.dedotify(s,e,a),this.log("Set data",s,o),n=n||{},!this.customValidate&&n.validateOne&&(n.noValidation=!0,r=this.validateOne(this.schema[e],a),r.isValid===!1))return this.warn("Validate error in model.set",r),n.silent!==!0&&this.emit("validation.error",r,s),!1}else this.warn("Data are incorrect in model.set()",arguments);return n=n||{},!this.customValidate&&this.schema&&n.noValidation!==!0&&(r=this.validate(s),null!==r)?(this.warn("Validate error in model.set",r),n.silent!==!0&&this.emit("validation.error",r,s),!1):this.customValidate&&n.noValidation!==!0&&(r=this.customValidate(s),this.log("Using a custom validation which returns:",r),null!==r)?(this.warn("Validate error in model.set",r),this.emit("validation.error",r,s),!1):(this.properties=s,n.silent!==!0&&this.emit("data.change",s,o),!0)},i.prototype.get=function(i){return i===e?this.properties:t.undotify(i,this.properties)},i.prototype.has=function(t){return!!this.properties[t]},i.prototype.reset=function(){this.log("Reset model"),this.properties={}},i.prototype.append=function(t,e){1===arguments.length&&(e=t,t=null);var i=this.properties,n=!0;return t&&t.split(".").forEach(function(t){i=i[t]}),i instanceof Array?i.push(e):null===t?(this.properties=[e],i=this.get()):this.warn("Model.append requires an array. Dataset isn't an array",t),n&&this.emit("data.append",t,e),e},i.prototype.prepend=function(t,e){1===arguments.length&&(e=t,t=null);var i=this.properties,n=!0;return t&&t.split(".").forEach(function(t){i=i[t]}),i instanceof Array?i.unshift(e):null===t?(this.properties=[e],i=this.get()):this.warn("Model.append requires an array. Dataset isn't an array",t),n&&this.emit("data.prepend",t,e),e},i.prototype.remove=function(t,e){var i=this.properties,n=null;return t.split(".").forEach(function(t){i=i[t]}),i instanceof Array?(n=i.splice(e,1),n=n[0]||null):this.warn("Model.remove() doesn't work with Objects in model",this.name),n},i.prototype.search=function(e,i){var n;if(1===arguments.length?(i=e,e="",n=this.properties):n=t.undotify(e,this.properties),n)for(var r=0;n.length>r;r++){var s,o=n[r];for(var a in i)if(i.hasOwnProperty(a)){if(!o[a]||o[a]!==i[a]){s=!1;break}s=!0}if(s===!0)return o}return null},i.prototype.sortBy=function(e,i){1===arguments.length&&(i=e,e=null);var n,r=t.undotify(e,this.properties);return r.sort(function(e,r){n=-1;for(var s in i)if(i.hasOwnProperty(s)){if(n=(t.undotify(s,e)+"").localeCompare(t.undotify(s,r)+""),0===n)continue;-1===i[s]&&(n=n>0?-1:1);break}return n}),this.set(e,r),r},i.prototype.validate=function(i,n){var r=[];return n=n||this.schema,n&&Object.keys(n).forEach(function(s){if("object"==typeof i[s]&&n[s].type===e){var o=this.validate(t.extend({},i[s]),t.extend({},n[s]));return Array.isArray(o)&&o.length>0&&(r=r.concat(o)),e}var a=this.validateOne(n[s],i[s]);a.isValid===!0?i[s]=a.value:(a.error.property=s,r.push(a.error))}.bind(this)),0===r.length?(this._isValid=!0,null):(this._isValid=!1,r)},i.prototype.validateOne=function(t,i){var n=null,r="function"==typeof t.type?typeof t.type():t.type.toLowerCase();if(""===i&&t.noEmpty===!0&&(i=e),i!==e&&null!==i||!t.default||(i=t.default),i===e||null===i||""===i)t.required===!0&&(n={msg:"Property is undefined or null, but it's required",errCode:10});else if("string"===r)t.convert&&"number"==typeof i&&(i+=""),r!==typeof i?n={msg:"Property type is a "+typeof i+", but a string is required",errCode:11}:t.min&&t.min>i.length?n={msg:"String length is too short",errCode:12}:t.max&&t.max<i.length?n={msg:"String length is too long",errCode:13}:t.match&&!t.match.test(i)&&(n={msg:"String doesn't match regexp",errCode:14});else if("number"===r)t.convert&&"string"==typeof i&&(i=parseInt(i,10)),r!==typeof i?n={msg:"Property type is a "+typeof i+", but a number is required",errCode:21}:t.min&&t.min>i?n={msg:"Number is too low",errCode:22}:t.max&&i>t.max&&(n={msg:"Number is too high",errCode:23});else if("date"===r){if(i){var s=Date.parse(i);isNaN(s)&&(n={msg:"Property isn't a valid date",errCode:31})}}else"array"===r?Array.isArray(i)?t.min&&t.min>i.length?n={msg:"Array length is "+i.length+" but must be greater than "+t.min,errCode:42}:t.max&&t.max<i.length&&(n={msg:"Array length is "+i.length+" but must be lesser than "+t.max,errCode:43}):n={msg:"Property type is a "+typeof i+", but an array is required",errCode:41}:"object"===r?"object"!=typeof i&&(n={msg:"Property isn't a valid object",errCode:51}):"objectid"===r?/^[a-zA-Z0-9]{24}$/.test(i)||(n={msg:"Property isn't a valid objectId",errCode:52}):"boolean"===r&&"boolean"!=typeof i&&(n={msg:"Property isn't a valid boolean",errCode:61});return null===n?n={isValid:!0,value:i,error:null}:(this.warn("Validation error on property",n,"Data:",i),n={isValid:!1,value:i,error:n}),n},i.prototype.isValid=function(){return this._isValid},i.prototype.setData=function(t){return this.set(t,{extend:!0})},t.Model=i}(XQCore),XQCore.GetSet=XQCore.Model,function(t,e){"use strict";if("function"==typeof define&&define.amd)define("xqcore",[XQCore.templateEngine],e);else if("undefined"!=typeof module&&module.exports)module.exports=e(require(XQCore.templateEngine));else{var i="firetpl"===XQCore.templateEngine?"FireTPL":"Handlebars";t.XQCore=e(t[i])}}(this,function(t){"use strict";return XQCore.Tmpl={type:XQCore.templateEngine,compile:t.compile,getTemplate:function(t){if("firetpl"===XQCore.templateEngine){if(FireTPL.templateCache&&FireTPL.templateCache[t])return FireTPL.templateCache[t];var e=FireTPL.loadFile(XQCore.viewsDir.replace(/\/$/,"")+"/"+t+"."+XQCore.viewExt.replace(/^\./,""));return FireTPL.compile(e)}}},XQCore}),function(t,e){"use strict";var i=function(e,i){var n;"object"==typeof arguments[0]&&(n=e,e=n.name),this.debug=t.debug,this.name=(e?e.replace(/View$/,""):"Nameless")+"View",this.container="body",this.tag="div",this.mode="replace",this.autoInject=!0,this.initFunc=i,n=n||{events:null},this.conf=n};t.extend(i.prototype,new t.Event,new t.Logger),i.prototype.init=function(e){var i=this,r=this.conf;if("function"==typeof this.initFunc&&this.initFunc.call(this,i),"object"!=typeof e)throw Error("No presenter was set in view.init()");this.presenter=e,$(function(){this.container.length>0?(window.addEventListener("resize",function(t){i.resize(t)},!1),this.log("Initialize view with conf:",r),this.log("  ... using Presenter:",this.presenter.name),this.log("  ... using Container:",this.container),this.events&&Object.keys(this.events).forEach(function(e){var i,r=e.indexOf(" "),s=this.events[e],o=e.substr(0,r),a=e.substr(r+1)||this.container,h=this;if("function"==typeof s)i=this;else if(0===s.indexOf("view:"))s=this[s.substr(5)],i=this;else if("function"==typeof this.presenter.events[this.events[e]])s=this.presenter.events[this.events[e]],i=this.presenter;else{var l=s;s=function(t,e,i){this.triggerEvent(l,t,e,i)}.bind(this),i=this}s&&o?"function"==typeof s?(this.container.delegate(a,o,function(e){var r=null,o=null;"submit"===e.type?r=t.Util.serializeForm(e.currentTarget):("keydown"===e.type||"keyup"===e.type||"keypress"===e.type)&&(r=$(e.currentTarget).val()),o=$.extend($(e.currentTarget).data(),{itemIndex:n.call(h,e.currentTarget)}),s.call(i,e,o,r)}.bind(this)),this.log("Register Event:",o,"on selector",a,"with callback",s)):this.warn("Event handler callback not defined in Presenter:",this.events[e]):this.warn("Incorect event configuration",e)},this),"function"==typeof this.customInit&&this.customInit.call(this)):this.error("Can't initialize View, Container not found!",this.container),this.$el||this.render(),this.autoInject&&this.inject(),this.isReady=!0,this.__readyCallbacks&&this.__readyCallbacks.forEach(function(t){t.call(this)}.bind(this))}.bind(this))},i.prototype.show=function(){this.$el.show()},i.prototype.hide=function(){this.$el.hide()},i.prototype.renderHTML=function(e,i){return this.log("Render view html snipet",e,"with data:",i),e="function"==typeof e?e:t.Tmpl.compile(e),e(i)},i.prototype.resize=function(){},i.prototype.getElementData=function(t){var i=$(t,this.container);if(i.length){var n,r={},s=i.get(0).attributes;for(n=0;s.length>n;n++)if(0===s[n].name.indexOf("data-")){var o=s[n].name.substr(5),a=s[n].value;if("string"==typeof a)try{a="true"===a||"TRUE"===a?!0:"false"===a||"FALSE"===a?!1:"null"===a||"NULL"===a?null:"undefined"===a?e:+a+""===a?+a:JSON.parse(a)}catch(h){}r[o]=a}return r}return null},i.prototype.triggerEvent=function(t,e,i,n){this.presenter.events[t]?this.presenter.events[t].call(this.presenter,e,i,n):(e&&(e.preventDefault(),e.stopPropagation()),this.__coupledWith&&this.__coupledWith.forEach(function(e){"function"==typeof e[t]?(this.log("Autotrigger to model:",t,n),e[t](n)):this.warn("Autotrigger to model failed! Function doesn't exists:",t,n)}.bind(this)))},i.prototype.navigateTo=function(t,e,i){this.presenter.navigateTo(t,e,i)},i.prototype.validationFailed=function(t,e){console.log(t,e),t.forEach(function(t){this.$el.find('[name="'+t.property+'"]').addClass("xq-invalid")}.bind(this))},i.prototype.stateChanged=function(){},i.prototype.ready=function(t){this.isReady?t.call(this):(this.__readyCallbacks||(this.__readyCallbacks=[]),this.__readyCallbacks.push(t))};var n=function(t){var e=null,i=$(this.container).get(0),n=$(t),r=n.parent(),s=$(this.subSelector).get(0),o=0;if(this.subSelector)do{if(r.get(0)===s)return $(n).index();if(n=n.parent(),r=n.parent(),++o>100){console.error("Break loop!");break}}while(n.length&&n.get(0)!==i);return e};i.prototype.inject=function(){this.ready(function(){if(this.$ct=$(this.container),this.log("Inject view into container",this.$ct),this.el=this.$el.get(0),this.$el.addClass("xq-view xq-view-"+this.name.toLowerCase()),this.ct=this.$ct.get(0),this.hidden===!0&&this.$el.hide(),this.id&&this.$el.attr("id",this.id),this.className&&this.$el.addClass(this.className),"replace"===this.mode)this.$ct.contents().detach(),this.$ct.append(this.$el);else if("append"===this.mode)this.$ct.append(this.$el);else{if("prepend"!==this.mode)throw Error("Unknow insert mode in view.init()");this.$ct.prepend(this.$el)}})},i.prototype.render=function(e){this.log("Render view template",this.template,"with data:",e);var i="function"==typeof this.template?this.template:t.Tmpl.compile(this.template);this.scopes={},this.$el&&this.$el.remove();var n=i(e||{},this.scopes);n=$.parseHTML(n),this.$el=$(n),this.registerListener(this.$el),this.emit("content.change",e)},i.prototype.registerListener=function(t){var e=this;console.log("Register listener",t.find("[on]").addBack("[on]").length),t.find("[on]").addBack("[on]").each(function(){var t,i=$(this),n=$(this).attr("on"),r=$(this).data();i.removeAttr("on"),n=n.split(";"),n.forEach(function(n){n=n.split(":"),t="submit"===n[0]?function(t){t.preventDefault(),r=e.serializeForm(t.target),e.presenter.emit(n[1],r,t),e.emit("form.submit",r)}.bind(this):function(t){t.preventDefault(),e.presenter.emit(n[1],r,t)}.bind(this),i.bind(n[0],t)})})},i.prototype.serializeForm=function(e){var i={},n=$(e);return"INPUT"!==n.get(0).tagName&&(n=n.find(":input")),n.serializeArray().forEach(function(e){t.dedotify(i,e.name,e.value)}),this.debug&&console.log("XQCore - Serialize form:",n,i),i},i.prototype.insert=function(t,e,i){var n=this,r=this.$el.find('.xq-scope[xq-path="'+t+'"]');r.length&&r.each(function(){var t=$(this).attr("xq-scope"),r=n.scopes[t](i);if(e>-1){var s=$(this).children();e>s.length-1&&(e=s.length-1),s.eq(e).after(r)}else $(this).children(":first-child").before(r)})},i.prototype.append=function(t,e){console.log("Got an append event",t,e);var i=this.$el.find('.xq-scope[xq-path="'+t+'"]'),n=i.children().length;this.insert(t,n,e)},i.prototype.prepend=function(t,e){this.insert(t,-1,e)},i.prototype.remove=function(t,e){var i=this.$el.find('.xq-scope[xq-path="'+t+'"]');i.children(":eq("+e+")").remove()},t.View=i}(XQCore),function(t){"use strict";t.undotify=function(t,e){return t&&(t=t.split("."),t.forEach(function(t){e=e[t]})),e},t.dedotify=function(t,e,i){"string"==typeof t&&(i=e,e=t,t={});var n=t;if(e){e=e.split(".");var r=e.length;e.forEach(function(e,n){return n===r-1?(t[e]=i,undefined):(t[e]||(t[e]={}),t=t[e],undefined)})}return t=i,n}}(XQCore),function(t){"use strict";var e=function(t){var e,n,r=[];return t instanceof RegExp?(n=t,e=""+t):(n=i(t,r),e=t),{re:n,src:""+t,keys:r}},i=function(t,e){return t=t.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(t,i,n,r,s,o){return e.push(r),i=i||"",""+(o?"":i)+"(?:"+(o?i:"")+(n||"")+(s||"([^/]+?)")+")"+(o||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)"),RegExp("^"+t+"$","i")},n=function(t,e){for(var i,n=0,r=t.length;r>n;++n){var s,o=t[n],a=o.re,h=o.keys,l=[],u={};if(i=a.exec(e)){for(s=1,r=i.length;r>s;++s){var c=h[s-1],p="string"==typeof i[s]?decodeURIComponent(i[s]):i[s];c?u[c]=p:l.push(p)}return{params:u,splats:l,route:o.src}}}},r=function(e){e=t.extend({debug:!1},e),this.debug=Boolean(e.debug),this.routes=[],this.routeMap={}};r.prototype.addRoute=function(t,i){if(!t)throw Error(" route requires a path");if(!i)throw Error(" route "+(""+t)+" requires a callback");var n=new e(t);n.fn=i,this.routes.push(n),this.routeMap[t]=i},r.prototype.match=function(t){var e=n(this.routes,t);return e&&(e.fn=this.routeMap[e.route]),e},r.prototype.fire=function(t,e){t=this.match(t),t&&t.fn(e)},t.Router=r}(XQCore);