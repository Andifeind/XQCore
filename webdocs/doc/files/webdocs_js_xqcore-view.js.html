<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>webdocs&#x2F;js&#x2F;xqcore-view.js - xqcore</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="xqcore"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.4.9</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/GetSet.html">GetSet</a></li>
            
                <li><a href="..&#x2F;classes/Manages event registering and emitting..html">Manages event registering and emitting.</a></li>
            
                <li><a href="..&#x2F;classes/XQCore.Logger.html">XQCore.Logger</a></li>
            
                <li><a href="..&#x2F;classes/XQCore.Presenter.html">XQCore.Presenter</a></li>
            
                <li><a href="..&#x2F;classes/XQCore.View.html">XQCore.View</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/XQCore Presenter.html">XQCore Presenter</a></li>
            
                <li><a href="..&#x2F;modules/XQCore.GetSet.html">XQCore.GetSet</a></li>
            
                <li><a href="..&#x2F;modules/XQCore.Logger.html">XQCore.Logger</a></li>
            
                <li><a href="..&#x2F;modules/XQCore.View.html">XQCore.View</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: webdocs&#x2F;js&#x2F;xqcore-view.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * XQCore View module
 *
 * @module XQCore.View
 * @returns {object} Returns a XQCore.View prototype object
 *&#x2F;
XQCore.View = (function(undefined) {

	&#x2F;**
	 * XQCore.View
	 *
	 * @constructor
	 * @class XQCore.View
	 * @param {object} conf View configuration
	 *&#x2F;
	var view = function(conf) {

		&#x2F;**
		 * Determines wether the view is hidden after rendering
		 * @property hidden
		 * @type Boolean
		 * @default false
		 *&#x2F;
		
		&#x2F;**
		 * Sets the container element
		 * @property el
		 * @type Selector
		 * @default &quot;body&quot;
		 *&#x2F;

		if (arguments.length === 2) {
			this.presenter = arguments[0];
			conf = arguments[1];
			console.warn(&#x27;Defining View with presenter is deprecated.&#x27;);
		}

		conf = conf || {
			events: null
		};

		this.customInit = conf.init;
		this.conf = conf;
		delete conf.init;

		$.extend(this, conf, new XQCore.Event(), new XQCore.Logger());
		this.name = (conf.name || &#x27;Nameless&#x27;) + &#x27;View&#x27;;

		this.debug = Boolean(conf.debug);
	};

	&#x2F;**
	 * Init function
	 *
	 * @method init
	 *
	 * @param  {Object} presenter Views presenter object
	 *&#x2F;
	view.prototype.init = function(presenter) {
		var self = this,
			conf = this.conf;

		&#x2F;&#x2F;If old style
		if (!presenter) {
			presenter = this.presenter;
			presenter.registerView(this);
		}

		&#x2F;&#x2F;Register view at presenter
		this.presenter = presenter;

		$(function() {
			this.container = $(conf.container);
			if (conf.tag) {
				this.$el = $($.parseHTML(&#x27;&lt;&#x27; + conf.tag + &#x27;&#x2F;&gt;&#x27;));
				this.$el.appendTo(this.container);
			}
			else {
				this.$el = this.container;
			}
			this.el = this.$el.get(0);

			if (conf.hidden === true) {
				this.$el.hide();
			}

			if (conf.id) {
				this.$el.attr(&#x27;id&#x27;, conf.id);
			}

			if (conf.className) {
				this.$el.addClass(conf.className);
			}

			if (this.container.length &gt; 0) {
				window.addEventListener(&#x27;resize&#x27;, function(e) {
					self.resize(e);
				}, false);

				this.log(&#x27;Initialize view with conf:&#x27;, conf);
				this.log(&#x27;  ... using Presenter:&#x27;, this.presenter.name);
				this.log(&#x27;  ... using Container:&#x27;, this.container);

				&#x2F;&#x2F;Send events to presenter
				if (this.events) {
					Object.keys(this.events).forEach(function(key) {
						var spacePos = key.indexOf(&#x27; &#x27;),
							eventFunc = this.events[key],
							eventName = key.substr(0, spacePos),
							selector = key.substr(spacePos + 1) || this.container,
							self = this,
							eventDest;

						if (typeof eventFunc === &#x27;function&#x27;) {
							eventDest = this;
						}
						else if (eventFunc.indexOf(&#x27;view:&#x27;) === 0) {
							eventFunc = this[eventFunc.substr(5)];
							eventDest = this;
						}
						else {
							eventFunc = this.presenter.events[this.events[key]];
							if (typeof eventFunc === &#x27;string&#x27;) {
								eventFunc = this.presenter[this.events[key]];
							}
							eventDest = this.presenter;
						}

						if (eventFunc &amp;&amp; eventName) {

							if (typeof eventFunc === &#x27;function&#x27;) {
								&#x2F;&#x2F;Register event listener
								this.container.delegate(selector, eventName, function(e) {
									var formData = null,
										tagData = null;

									if (e.type === &#x27;submit&#x27;) {
										formData = XQCore.Util.serializeForm(e.currentTarget);
									}
									else if (e.type === &#x27;keydown&#x27; || e.type === &#x27;keyup&#x27; || e.type === &#x27;keypress&#x27;) {
										formData = $(e.currentTarget).val();
									}

									tagData = $.extend($(e.currentTarget).data(), {
										itemIndex: getItemIndex.call(self, e.currentTarget)
									});

									eventFunc.call(eventDest, e, tagData, formData);
								});
								this.log(&#x27;Register Event:&#x27;, eventName, &#x27;on selector&#x27;, selector, &#x27;with callback&#x27;, eventFunc);
							}
							else {
								this.warn(&#x27;Event handler callback not defined in Presenter:&#x27;, this.events[key]);
							}
						}
						else {
							this.warn(&#x27;Incorect event configuration&#x27;, key);
						}
					}, this);
				}

				&#x2F;&#x2F; custom init
				if (typeof this.customInit === &#x27;function&#x27;) {
					this.customInit.call(this);
				}

				&#x2F;&#x2F;Call presenter.initView()
				this.presenter.fireViewInit(this);
			}
			else {
				this.error(&#x27;Can\&#x27;t initialize View, Container not found!&#x27;, this.container);
			}
		}.bind(this));
	};

	view.prototype.show = function() {
		this.$el.show();
	};

	view.prototype.hide = function() {
		this.$el.hide();
	};

	&#x2F;**
	 * Render view
	 *
	 * @method render
	 * @emits content.change
	 *
	 * @param  {Object} data Render data
	 *
	 *&#x2F;
	view.prototype.render = function(data) {
		this.log(&#x27;Render view template&#x27;, this.template, &#x27;with data:&#x27;, data);
		var template = typeof this.template === &#x27;function&#x27; ? this.template : Handlebars.compile(this.template);
		this.$el.html(template(data || {}));

		this.emit(&#x27;content.change&#x27;, data);
	};

	view.prototype.renderHTML = function(template, data) {
		this.log(&#x27;Render view html snipet&#x27;, template, &#x27;with data:&#x27;, data);
		template = typeof template === &#x27;function&#x27; ? template : Handlebars.compile(template);
		return template(data);
	};

	view.prototype.resize = function() {

	};

	&#x2F;**
	 * Appends a html fragment to a html element
	 * You must set the itemTemplate and subSelector  option first
	 *
	 * @param {String} selector parent selector
	 * @param {Object} data item data
	 * @param {Object} options Appending options (not implemented yet)
	 *&#x2F;
	view.prototype.append = function(data, options) {
		this.manipulate(&#x27;append&#x27;, data, options);
	};

	&#x2F;**
	 * Prepends a html fragment to a html element
	 * You must set the itemTemplate and subSelector option first
	 *
	 * @param {Object} data item data
	 * @param {Object} options Prepending options (not implemented yet)
	 *&#x2F;
	view.prototype.prepend = function(data, options) {
		this.manipulate(&#x27;prepend&#x27;, data, options);
	};

	&#x2F;**
	 * Remove a item from a dom node
	 *
	 * @param {Number} index Remove item &lt;index&gt; from a node list
	 *&#x2F;
	view.prototype.remove = function(index) {
		this.manipulate(&#x27;remove&#x27;, index);
	};

	&#x2F;**
	 * Manipulates a dom node
	 *
	 * @param  {String} action  Manipulation method
	 * @param  {[type]} data    [description]
	 * @param  {[type]} options (not implemented yet)
	 *
	 * @return {[type]}         [description]
	 *&#x2F;
	view.prototype.manipulate = function(action, data, options) {
		if (this.subSelector === undefined) {
			this.warn(&#x27;You must set the subSelector option&#x27;);
			return false;
		}

		if (this.itemTemplate === undefined) {
			this.warn(&#x27;You must set the itemTemplate option&#x27;);
			return false;
		}

		var selector = $(this.subSelector, this.container),
			html;

		if (options) {
			&#x2F;&#x2F;TODO handle transition options
		}

		switch (action) {
			case &#x27;append&#x27;:
				html = Handlebars.compile(this.itemTemplate)(data);
				$(html).appendTo(selector);
				break;
			case &#x27;prepend&#x27;:
				html = Handlebars.compile(this.itemTemplate)(data);
				$(html).prependTo(selector);
				break;
			case &#x27;remove&#x27;:
				selector.children().eq(data).remove();
				break;
			default:
				this.error(&#x27;undefined action in view.manipulate()&#x27;, action);
		}

	};

	&#x2F;**
	 * Gets the data of an element
	 *
	 * @param {Object} selector DOM el or a jQuery selector of the element
	 *
	 * @return {Object} Returns the data of an element or null
	 *&#x2F;
	view.prototype.getElementData = function(selector) {
		var el = $(selector, this.container);
		if (el.length) {
			var data = {},
				attrs = el.get(0).attributes,
				i;

			for (i = 0; i &lt; attrs.length; i++) {
				if (attrs[i].name.indexOf(&#x27;data-&#x27;) === 0) {
					var name = attrs[i].name.substr(5),
						value = attrs[i].value;

					if (typeof value === &#x27;string&#x27;) {
						try {
							if (value === &#x27;true&#x27; || value === &#x27;TRUE&#x27;) {
								value = true;
							}
							else if (value === &#x27;false&#x27; || value === &#x27;FALSE&#x27;) {
								value = false;
							}
							else if (value === &#x27;null&#x27; || value === &#x27;NULL&#x27;) {
								value = null;
							}
							else if (value === &#x27;undefined&#x27;) {
								value = undefined;
							}
							else if (+value + &#x27;&#x27; === value) {
								value = +value;
							}
							else {
								value = JSON.parse(value);
							}
						}
						catch(err) {

						}
					}

					data[name] = value;
				}
			}

			return data;
		}
		else {
			return null;
		}
	};

	&#x2F;**
	 * Triggers a view event to the presenter
	 *
	 * @method triggerEvent
	 *
	 * @param {String} eventName Event of the triggered event
	 * @param {Object} e EventObject
	 * @param {Object} tag Tag data
	 * @param {Object} data Event data
	 *&#x2F;
	view.prototype.triggerEvent = function(eventName, e, tag, data) {
		this.presenter.events[eventName].call(this.presenter, e, tag, data);
	};

	&#x2F;**
	 * Navigate to a given route
	 *
	 * @method navigateTo
	 *
	 * @param {String} route Route url
	 * @param {Object} data Data object
	 * @param {Boolean} replace Replace current history entry with route
	 *&#x2F;
	view.prototype.navigateTo = function(route, data, replace) {
		this.presenter.navigateTo(route, data, replace);
	};

	&#x2F;**
	 * Gets the index of a subSelector item
	 * This function must binded to the view
	 *
	 * @param  {Object} el Start element.
	 *
	 * @return {Number}    index of the element or null
	 *&#x2F;
	var getItemIndex = function(el) {
		var index = null,
			container = $(this.container).get(0),
			curEl = $(el),
			nextEl = curEl.parent(),
			subSelector = $(this.subSelector).get(0),
			d = 0;

		if (this.subSelector) {
			do {
				if (nextEl.get(0) === subSelector) {
					return $(curEl).index();
				}
				curEl = curEl.parent();
				nextEl = curEl.parent();

				if (++d &gt; 100) {
					console.error(&#x27;Break loop!&#x27;);
					break;
				}
			} while(curEl.length &amp;&amp; curEl.get(0) !== container);
		}

		return index;
	};



	return view;
})();

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
