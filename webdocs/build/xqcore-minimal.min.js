/*!
 * XQCore Minimal - 0.3.30
 * 
 * Model View Presenter Javascript Framework
 *
 * XQCore is licenced under MIT Licence
 * http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2012 - 2013 Noname Media, http://noname-media.com
 * Author Andi Heinkelein
 *
 * Creation Date: 2013-06-22
 */
(function(t,e){"function"==typeof define&&define.amd?define("xqcore",["jquery"],e):t.XQCore=e(t.jQuery)})(this,function(t){var e={version:"0.3.30",defaultRoute:"default",html5Routes:!1,hashBang:"#!",callerEvent:"callerEvent"};return window.include||(window.include=function(t,e){var n=location.protocol+"//"+location.host+t;$.ajax({url:n,dataType:"script",success:e,async:!1})},window.preload=function(t){var e,n=location.protocol+"//"+location.host+t;return $.ajax({url:n,dataType:"text",success:function(t){e=t},async:!1}),{execute:function(t){eval.call(t||window,e)}}}),e._dump={},e.dump=function(t){return e._dump[t]?(console.log("[XQCore dump]",t,e._dump[t]),e._dump[t]):!1},e.Event=function(){var t,e=function(){"use strict";function t(){}function e(t,e){if(i)return e.indexOf(t);for(var n=e.length;n--;)if(e[n]===t)return n;return-1}var n=t.prototype,i=Array.prototype.indexOf?!0:!1;return n.getListeners=function(t){var e=this._events||(this._events={});return e[t]||(e[t]=[])},n.addListener=function(t,n){var i=this.getListeners(t);return-1===e(n,i)&&i.push(n),this},n.removeListener=function(t,n){var i=this.getListeners(t),r=e(n,i);return-1!==r&&(i.splice(r,1),0===i.length&&(this._events[t]=null)),this},n.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},n.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},n.manipulateListeners=function(t,e,n){var i,r,s=t?this.removeListener:this.addListener,o=t?this.removeListeners:this.addListeners;if("object"==typeof e)for(i in e)e.hasOwnProperty(i)&&(r=e[i])&&("function"==typeof r?s.call(this,i,r):o.call(this,i,r));else for(i=n.length;i--;)s.call(this,e,n[i]);return this},n.removeEvent=function(t){return t?this._events[t]=null:this._events=null,this},n.emitEvent=function(t,e){for(var n,i=this.getListeners(t),r=i.length;r--;)n=e?i[r].apply(null,e):i[r](),n===!0&&this.removeListener(t,i[r]);return this},t}();return t=function(){this.store=[],this.ee=new e},t.prototype.emit=function(t,e){return this.debug&&console.debug("XQCore - Emit event",t,e),this.ee.emitEvent(t,[e],this)},t.prototype.on=function(t,e){return this.debug&&console.debug("XQCore - Add listener",t,e,this),this.ee.addListener(t,e)},t.prototype.once=function(t,e){var n=function(){return this.ee.removeListener(t,e),e.apply(null,arguments),!0}.bind(this);return this.debug&&console.debug("XQCore - Add once listener",t,e),this.ee.addListener(t,n)},t.prototype.off=function(t,e){return this.debug&&console.debug("XQCore - Remove listener",t,e),void 0===e?this.ee.removeEvent(t):this.ee.removeListener(t,e)},t.prototype.getListeners=function(t){return this.ee.getListeners(t)},t}(),e.Logger=function(){function t(t){return 1e3>t?t+" ms":6e4>t?Math.round(t/100)/10+" sec":Math.round(t/6e4)+" min "+Math.round(t%6e4/1e3)+" sec"}var e=function(){};return e.prototype.log=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),t.unshift("["+this.name+"]"),console.log.apply(console,t))},e.prototype.warn=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),t.unshift("["+this.name+"]"),console.warn.apply(console,t))},e.prototype.error=function(){var t;this.debug&&(t=Array.prototype.slice.call(arguments),t.unshift("["+this.name+"]"),console.error.apply(console,t))},e.prototype.timer=function(e){var n={start:null,stop:null,name:e,logger:this,end:function(){this.stop=Date.now(),this.logger.log("Timer "+this.name+" runs: ",t(this.stop-this.start))}};return this.log("Start Timer",e),n.start=Date.now(),n},e.prototype.__scope={getHumanTime:t},e}(),e.GetSet=function(t,n,i,r){var s=function(t){this.properties={},this._isValid=!1,t&&(this.schema=t.schema,this.debug=Boolean(t.debug)),this.name="GetSet",i.extend(this,new e.Logger),i.extend(this,new e.Event)},o=function(t,e){return t&&(t=t.split("."),t.forEach(function(t){e=e[t]})),e};return s.prototype.set=function(){var t,e,n={},i=this.get();if(null===arguments[0])n=arguments[1],this.log("Set data",n,i);else if("object"==typeof arguments[0])n=arguments[0],this.log("Set data",n,i);else if("string"==typeof arguments[0]){n=this.get(),e=arguments[0];var r=arguments[1];n[e]=r,this.log("Set data",n,i)}else this.warn("Data are incorrect in getset.set()",arguments);return this.schema&&(t=this.validate(n),null!==t)?(this.warn("Validate error in getset.set",t),this.emit("validation.error",t),!1):this.customValidate&&(console.log("Use custom validation",this.customValidate),t=this.customValidate(n),null!==t)?(this.warn("Validate error in getset.set",t),this.emit("validation.error",t),!1):(this.properties=n,this.emit("data.change",n,i),e&&this.emit("change."+e,n[e]),!0)},s.prototype.get=function(t){return t===r?this.properties:this.properties[t]},s.prototype.has=function(t){return!!this.properties[t]},s.prototype.reset=function(){this.log("Reset getset"),this.properties={}},s.prototype.append=function(t,e){1===arguments.length&&(e=t,t=null);var n=this.properties,i=this.get(),r=!0;return t&&t.split(".").forEach(function(t){n=n[t]}),console.log(n===this.properties),n instanceof Array?n.push(e):null===t?(this.properties=[e],n=this.get()):this.warn("GetSet.append requires an array. Dataset isn't an array",t),r&&this.emit("data.change",n,i),console.log(n,this.properties),e},s.prototype.prepend=function(t,e){1===arguments.length&&(e=t,t=null);var n=this.properties,i=this.get(),r=!0;return t&&t.split(".").forEach(function(t){n=n[t]}),n instanceof Array?n.unshift(e):null===t?(this.properties=[e],n=this.get()):this.warn("GetSet.append requires an array. Dataset isn't an array",t),r&&this.emit("data.change",n,i),e},s.prototype.remove=function(t,e){var n=this.properties,i=null;return t.split(".").forEach(function(t){n=n[t]}),n instanceof Array?(i=n.splice(e,1),i=i[0]||null):this.warn("getset.remove() doesn't work with Objects in getset",this.name),i},s.prototype.search=function(t,e){var n=o(t,this.properties);if(n)for(var i=0;n.length>i;i++){var r,s=n[i];for(var a in e)if(e.hasOwnProperty(a)){if(!s[a]||s[a]!==e[a]){r=!1;break}r=!0}if(r===!0)return s}return null},s.prototype.sortBy=function(t,e){1===arguments.length&&(e=t,t=null);var n,i=o(t,this.properties);return i.sort(function(t,i){n=-1;for(var r in e)if(n=(o(r,t)+"").localeCompare(o(r,i)+""),0!==n){-1===e[r]&&(n=n>0?-1:1);break}return n}),this.set(t,i),i},s.prototype.validate=function(t){var e=[];return this.schema&&Object.keys(this.schema).forEach(function(n){var i=this.validateOne(n,t[n]);i.isValid===!0?t[n]=i.value:e.push(i.error)}.bind(this)),0===e.length?(this._isValid=!0,null):(this._isValid=!1,e)},s.prototype.validateOne=function(t,e){var n=null,i=this.schema[t];if(console.log("Schema",i,i.match),""===e&&i.noEmpty===!0&&(e=r),e!==r&&null!==e||!i.default||(e=i.default),e!==r&&null!==e&&""!==e||i.required!==!0)if("string"===i.type)i.convert&&"number"==typeof e&&(e+=""),i.type!==typeof e?n={property:t,msg:"Property type is a "+typeof e+", but a string is required",errCode:11}:i.min&&i.min>e.length?n={property:t,msg:"String length is too short",errCode:12}:i.max&&i.max<e.length?n={property:t,msg:"String length is too long",errCode:13}:i.match&&!i.match.test(e)&&(n={property:t,msg:"String doesn't match regexp",errCode:14});else if("number"===i.type)i.convert&&"string"==typeof e&&(e=parseInt(e,10)),i.type!==typeof e?n={property:t,msg:"Property type is a "+typeof e+", but a number is required",errCode:21}:i.min&&i.min>e?n={property:t,msg:"Number is too low",errCode:22}:i.max&&e>i.max&&(n={property:t,msg:"Number is too high",errCode:23});else if("date"===i.type){if(e){var s=Date.parse(e);isNaN(s)&&(n={property:t,msg:"Property isn't a valid date",errCode:31})}}else"array"===i.type?Array.isArray(e)?i.min&&i.min>e.length?n={property:t,msg:"Array length is "+e.length+" but must be greater than "+i.min,errCode:42}:i.max&&i.max<e.length&&(n={property:t,msg:"Array length is "+e.length+" but must be lesser than "+i.max,errCode:43}):n={property:t,msg:"Property type is a "+typeof e+", but an array is required",errCode:41}:"object"===i.type?"object"!=typeof e&&(n={property:t,msg:"Property isn't a valid object",errCode:51}):"boolean"===i.type&&"object"!=typeof e&&(n={property:t,msg:"Property isn't a valid boolean",errCode:61});else n={property:t,msg:"Property is undefined or null, but it's required",errCode:10};return null===n?n={isValid:!0,value:e,error:null}:(this.warn("Validation error on property",t,n,"Data:",e),n={isValid:!1,value:e,error:n}),n},s.prototype.isValid=function(){return this._isValid},s}(window,document,t),e});